  <div id="C00000267">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />Continuation<br/>
  In:
<a href="#" onclick="jsHref('files/ruby-1_8_7-p22/eval_c.html');">ruby-1.8.7-p22/eval.c</a>

Parent:&nbsp;
        <a href="#" onclick="jsHref('classes/YAML/Object.html');">
Object
         </a>
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">

  <div class="description"><p>
<a href="index.html?a=C00000267&name=Continuation">Continuation</a> objects
are generated by <tt><a
href="index.html?a=M006199&name=Kernel#callcc">Kernel#callcc</a></tt>. They
hold a return address and execution context, allowing a nonlocal return to
the end of the <tt>callcc</tt> block from anywhere within a program.
Continuations are somewhat analogous to a structured version of C&#8217;s
<tt>setjmp/longjmp</tt> (although they contain more state, so you might
consider them closer to threads).
</p>
<p>
For instance:
</p>
<pre>
   arr = [ &quot;Freddie&quot;, &quot;Herbie&quot;, &quot;Ron&quot;, &quot;Max&quot;, &quot;Ringo&quot; ]
   callcc{|$cc|}
   puts(message = arr.shift)
   $cc.call unless message =~ /Max/
</pre>
<p>
<em>produces:</em>
</p>
<pre>
   Freddie
   Herbie
   Ron
   Max
</pre>
<p>
This (somewhat contrived) example allows the inner loop to abandon
processing early:
</p>
<pre>
   callcc {|cont|
     for i in 0..4
       print &quot;\n#{i}: &quot;
       for j in i*5...(i+1)*5
         cont.call() if j == 17
         printf &quot;%3d&quot;, j
       end
     end
   }
   print &quot;\n&quot;
</pre>
<p>
<em>produces:</em>
</p>
<pre>
   0:   0  1  2  3  4
   1:   5  6  7  8  9
   2:  10 11 12 13 14
   3:  15 16
</pre>
</div>



  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M002392&name=[]" >[]</a></li>
  <li><a href="index.html?a=M002391&name=call" >call</a></li>
  </ul>






<div class="sectiontitle">Public Instance methods</div>
<div id="M002392" class="method">
  <div id="M002392_title" class="title">
    <b>cont.call(args, ...) <br />
cont[args, ...]<br />
</b>
  </div>
  <div class="description">
  <p>
Invokes the continuation. The program continues from the end of the
<tt>callcc</tt> block. If no arguments are given, the original
<tt>callcc</tt> returns <tt>nil</tt>. If one argument is given,
<tt>callcc</tt> returns it. Otherwise, an array containing <em>args</em> is
returned.
</p>
<pre>
   callcc {|cont|  cont.call }           #=&gt; nil
   callcc {|cont|  cont.call 1 }         #=&gt; 1
   callcc {|cont|  cont.call 1, 2, 3 }   #=&gt; [1, 2, 3]
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002392_source')" id="l_M002392_source">show source</a> ]</p>
  <div id="M002392_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     cont.call(args, ...) 
 *     cont[args, ...]
 *  
 *  Invokes the continuation. The program continues from the end of the
 *  &lt;code&gt;callcc&lt;/code&gt; block. If no arguments are given, the original
 *  &lt;code&gt;callcc&lt;/code&gt; returns &lt;code&gt;nil&lt;/code&gt;. If one argument is
 *  given, &lt;code&gt;callcc&lt;/code&gt; returns it. Otherwise, an array
 *  containing &lt;i&gt;args&lt;/i&gt; is returned.
 *     
 *     callcc {|cont|  cont.call }           #=&gt; nil
 *     callcc {|cont|  cont.call 1 }         #=&gt; 1
 *     callcc {|cont|  cont.call 1, 2, 3 }   #=&gt; [1, 2, 3]
 */

static VALUE
rb_cont_call(argc, argv, cont)
    int argc;
    VALUE *argv;
    VALUE cont;
{
    rb_thread_t th = rb_thread_check(cont);

    if (th-&gt;thread != curr_thread-&gt;thread) {
        rb_raise(rb_eRuntimeError, &quot;continuation called across threads&quot;);
    }
    if (th-&gt;thgroup != cont_protect) {
        rb_raise(rb_eRuntimeError, &quot;continuation called across trap&quot;);
    }
    switch (argc) {
      case 0:
        th-&gt;result = Qnil;
        break;
      case 1:
        th-&gt;result = argv[0];
        break;
      default:
        th-&gt;result = rb_ary_new4(argc, argv);
        break;
    }

    rb_thread_restore_context(th, RESTORE_NORMAL);
    return Qnil;
}
</pre>
  </div>
</div>
</div>
<div id="M002391" class="method">
  <div id="M002391_title" class="title">
    <b>cont.call(args, ...) <br />
cont[args, ...]<br />
</b>
  </div>
  <div class="description">
  <p>
Invokes the continuation. The program continues from the end of the
<tt>callcc</tt> block. If no arguments are given, the original
<tt>callcc</tt> returns <tt>nil</tt>. If one argument is given,
<tt>callcc</tt> returns it. Otherwise, an array containing <em>args</em> is
returned.
</p>
<pre>
   callcc {|cont|  cont.call }           #=&gt; nil
   callcc {|cont|  cont.call 1 }         #=&gt; 1
   callcc {|cont|  cont.call 1, 2, 3 }   #=&gt; [1, 2, 3]
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002391_source')" id="l_M002391_source">show source</a> ]</p>
  <div id="M002391_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     cont.call(args, ...) 
 *     cont[args, ...]
 *  
 *  Invokes the continuation. The program continues from the end of the
 *  &lt;code&gt;callcc&lt;/code&gt; block. If no arguments are given, the original
 *  &lt;code&gt;callcc&lt;/code&gt; returns &lt;code&gt;nil&lt;/code&gt;. If one argument is
 *  given, &lt;code&gt;callcc&lt;/code&gt; returns it. Otherwise, an array
 *  containing &lt;i&gt;args&lt;/i&gt; is returned.
 *     
 *     callcc {|cont|  cont.call }           #=&gt; nil
 *     callcc {|cont|  cont.call 1 }         #=&gt; 1
 *     callcc {|cont|  cont.call 1, 2, 3 }   #=&gt; [1, 2, 3]
 */

static VALUE
rb_cont_call(argc, argv, cont)
    int argc;
    VALUE *argv;
    VALUE cont;
{
    rb_thread_t th = rb_thread_check(cont);

    if (th-&gt;thread != curr_thread-&gt;thread) {
        rb_raise(rb_eRuntimeError, &quot;continuation called across threads&quot;);
    }
    if (th-&gt;thgroup != cont_protect) {
        rb_raise(rb_eRuntimeError, &quot;continuation called across trap&quot;);
    }
    switch (argc) {
      case 0:
        th-&gt;result = Qnil;
        break;
      case 1:
        th-&gt;result = argv[0];
        break;
      default:
        th-&gt;result = rb_ary_new4(argc, argv);
        break;
    }

    rb_thread_restore_context(th, RESTORE_NORMAL);
    return Qnil;
}
</pre>
  </div>
</div>
</div>
</div>

  </div>