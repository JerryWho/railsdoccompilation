  <div id="C00000328">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />TupleSpace<br/>
  In:
<a href="#" onclick="jsHref('files/ruby-1_8_7-p22/lib/rinda/tuplespace_rb.html');">ruby-1.8.7-p22/lib/rinda/tuplespace.rb</a>

Parent:&nbsp;
        <a href="#" onclick="jsHref('classes/YAML/Object.html');">
Object
         </a>
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">

  <div class="description"><p>
The Tuplespace manages access to the tuples it contains, ensuring mutual
exclusion requirements are met.
</p>
<p>
The <tt>sec</tt> option for the write, take, move, read and notify methods
may either be a number of seconds or a Renewer object.
</p>
</div>



  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M002921&name=move" >move</a></li>
  <li><a href="index.html?a=M002918&name=new" >new</a></li>
  <li><a href="index.html?a=M002924&name=notify" >notify</a></li>
  <li><a href="index.html?a=M002922&name=read" >read</a></li>
  <li><a href="index.html?a=M002923&name=read_all" >read_all</a></li>
  <li><a href="index.html?a=M002920&name=take" >take</a></li>
  <li><a href="index.html?a=M002919&name=write" >write</a></li>
  </ul>

<div class="sectiontitle">Included Modules</div>
<ul>
  <li><a href="#" onclick="jsHref('');">DRbUndumped</a></li>
  <li><a href="#" onclick="jsHref('classes/MonitorMixin.html');">MonitorMixin</a></li>
</ul>





<div class="sectiontitle">Public Class methods</div>
<div id="M002918" class="method">
  <div id="M002918_title" class="title">
    <b>new</b>(period=60)
  </div>
  <div class="description">
  <p>
Creates a new <a
href="index.html?a=C00000328&name=TupleSpace">TupleSpace</a>.
<tt>period</tt> is used to control how often to look for dead tuples after
modifications to the <a
href="index.html?a=C00000328&name=TupleSpace">TupleSpace</a>.
</p>
<p>
If no dead tuples are found <tt>period</tt> seconds after the last
modification, the <a
href="index.html?a=C00000328&name=TupleSpace">TupleSpace</a> will stop
looking for dead tuples.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002918_source')" id="l_M002918_source">show source</a> ]</p>
  <div id="M002918_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/rinda/tuplespace.rb, line 438</span>
438:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">period</span>=<span class="ruby-value">60</span>)
439:       <span class="ruby-keyword kw">super</span>()
440:       <span class="ruby-ivar">@bag</span> = <span class="ruby-constant">TupleBag</span>.<span class="ruby-identifier">new</span>
441:       <span class="ruby-ivar">@read_waiter</span> = <span class="ruby-constant">TupleBag</span>.<span class="ruby-identifier">new</span>
442:       <span class="ruby-ivar">@take_waiter</span> = <span class="ruby-constant">TupleBag</span>.<span class="ruby-identifier">new</span>
443:       <span class="ruby-ivar">@notify_waiter</span> = <span class="ruby-constant">TupleBag</span>.<span class="ruby-identifier">new</span>
444:       <span class="ruby-ivar">@period</span> = <span class="ruby-identifier">period</span>
445:       <span class="ruby-ivar">@keeper</span> = <span class="ruby-keyword kw">nil</span>
446:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="sectiontitle">Public Instance methods</div>
<div id="M002921" class="method">
  <div id="M002921_title" class="title">
    <b>move</b>(port, tuple, sec=nil) {|template| ...}
  </div>
  <div class="description">
  <p>
Moves <tt>tuple</tt> to <tt>port</tt>.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002921_source')" id="l_M002921_source">show source</a> ]</p>
  <div id="M002921_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/rinda/tuplespace.rb, line 485</span>
485:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">move</span>(<span class="ruby-identifier">port</span>, <span class="ruby-identifier">tuple</span>, <span class="ruby-identifier">sec</span>=<span class="ruby-keyword kw">nil</span>)
486:       <span class="ruby-identifier">template</span> = <span class="ruby-constant">WaitTemplateEntry</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">tuple</span>, <span class="ruby-identifier">sec</span>)
487:       <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">template</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
488:       <span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
489:         <span class="ruby-identifier">entry</span> = <span class="ruby-ivar">@bag</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">template</span>)
490:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">entry</span>
491:           <span class="ruby-identifier">port</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">entry</span>.<span class="ruby-identifier">value</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">port</span>
492:           <span class="ruby-ivar">@bag</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">entry</span>)
493:           <span class="ruby-identifier">notify_event</span>(<span class="ruby-value str">'take'</span>, <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">value</span>)
494:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">value</span>
495:         <span class="ruby-keyword kw">end</span>
496:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">RequestExpiredError</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">template</span>.<span class="ruby-identifier">expired?</span>
497: 
498:         <span class="ruby-keyword kw">begin</span>
499:           <span class="ruby-ivar">@take_waiter</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">template</span>)
500:           <span class="ruby-identifier">start_keeper</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">template</span>.<span class="ruby-identifier">expires</span>
501:           <span class="ruby-keyword kw">while</span> <span class="ruby-keyword kw">true</span>
502:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">RequestCanceledError</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">template</span>.<span class="ruby-identifier">canceled?</span>
503:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">RequestExpiredError</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">template</span>.<span class="ruby-identifier">expired?</span>
504:             <span class="ruby-identifier">entry</span> = <span class="ruby-ivar">@bag</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">template</span>)
505:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">entry</span>
506:               <span class="ruby-identifier">port</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">entry</span>.<span class="ruby-identifier">value</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">port</span>
507:               <span class="ruby-ivar">@bag</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">entry</span>)
508:               <span class="ruby-identifier">notify_event</span>(<span class="ruby-value str">'take'</span>, <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">value</span>)
509:               <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">value</span>
510:             <span class="ruby-keyword kw">end</span>
511:             <span class="ruby-identifier">template</span>.<span class="ruby-identifier">wait</span>
512:           <span class="ruby-keyword kw">end</span>
513:         <span class="ruby-keyword kw">ensure</span>
514:           <span class="ruby-ivar">@take_waiter</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">template</span>)
515:         <span class="ruby-keyword kw">end</span>
516:       <span class="ruby-keyword kw">end</span>
517:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002924" class="method">
  <div id="M002924_title" class="title">
    <b>notify</b>(event, tuple, sec=nil)
  </div>
  <div class="description">
  <p>
Registers for notifications of <tt>event</tt>. Returns a <a
href="index.html?a=C00000335&name=NotifyTemplateEntry">NotifyTemplateEntry</a>.
See <a
href="index.html?a=C00000335&name=NotifyTemplateEntry">NotifyTemplateEntry</a>
for examples of how to listen for notifications.
</p>
<p>
<tt>event</tt> can be:
</p>
<table>
<tr><td valign="top">&#8216;write&#8217;:</td><td>A tuple was added

</td></tr>
<tr><td valign="top">&#8216;take&#8217;:</td><td>A tuple was taken or moved

</td></tr>
<tr><td valign="top">&#8216;delete&#8217;:</td><td>A tuple was lost after being overwritten or expiring

</td></tr>
</table>
<p>
The <a href="index.html?a=C00000328&name=TupleSpace">TupleSpace</a> will
also notify you of the &#8216;close&#8217; event when the <a
href="index.html?a=C00000335&name=NotifyTemplateEntry">NotifyTemplateEntry</a>
has expired.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002924_source')" id="l_M002924_source">show source</a> ]</p>
  <div id="M002924_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/rinda/tuplespace.rb, line 568</span>
568:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">notify</span>(<span class="ruby-identifier">event</span>, <span class="ruby-identifier">tuple</span>, <span class="ruby-identifier">sec</span>=<span class="ruby-keyword kw">nil</span>)
569:       <span class="ruby-identifier">template</span> = <span class="ruby-constant">NotifyTemplateEntry</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">event</span>, <span class="ruby-identifier">tuple</span>, <span class="ruby-identifier">sec</span>)
570:       <span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
571:         <span class="ruby-ivar">@notify_waiter</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">template</span>)
572:       <span class="ruby-keyword kw">end</span>
573:       <span class="ruby-identifier">template</span>
574:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002922" class="method">
  <div id="M002922_title" class="title">
    <b>read</b>(tuple, sec=nil) {|template| ...}
  </div>
  <div class="description">
  <p>
Reads <tt>tuple</tt>, but does not remove it.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002922_source')" id="l_M002922_source">show source</a> ]</p>
  <div id="M002922_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/rinda/tuplespace.rb, line 522</span>
522:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">read</span>(<span class="ruby-identifier">tuple</span>, <span class="ruby-identifier">sec</span>=<span class="ruby-keyword kw">nil</span>)
523:       <span class="ruby-identifier">template</span> = <span class="ruby-constant">WaitTemplateEntry</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">tuple</span>, <span class="ruby-identifier">sec</span>)
524:       <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">template</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
525:       <span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
526:         <span class="ruby-identifier">entry</span> = <span class="ruby-ivar">@bag</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">template</span>)
527:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">value</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">entry</span>
528:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">RequestExpiredError</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">template</span>.<span class="ruby-identifier">expired?</span>
529: 
530:         <span class="ruby-keyword kw">begin</span>
531:           <span class="ruby-ivar">@read_waiter</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">template</span>)
532:           <span class="ruby-identifier">start_keeper</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">template</span>.<span class="ruby-identifier">expires</span>
533:           <span class="ruby-identifier">template</span>.<span class="ruby-identifier">wait</span>
534:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">RequestCanceledError</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">template</span>.<span class="ruby-identifier">canceled?</span>
535:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">RequestExpiredError</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">template</span>.<span class="ruby-identifier">expired?</span>
536:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">template</span>.<span class="ruby-identifier">found</span>
537:         <span class="ruby-keyword kw">ensure</span>
538:           <span class="ruby-ivar">@read_waiter</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">template</span>)
539:         <span class="ruby-keyword kw">end</span>
540:       <span class="ruby-keyword kw">end</span>
541:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002923" class="method">
  <div id="M002923_title" class="title">
    <b>read_all</b>(tuple)
  </div>
  <div class="description">
  <p>
Returns all tuples matching <tt>tuple</tt>. Does not remove the found
tuples.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002923_source')" id="l_M002923_source">show source</a> ]</p>
  <div id="M002923_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/rinda/tuplespace.rb, line 546</span>
546:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">read_all</span>(<span class="ruby-identifier">tuple</span>)
547:       <span class="ruby-identifier">template</span> = <span class="ruby-constant">WaitTemplateEntry</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">tuple</span>, <span class="ruby-keyword kw">nil</span>)
548:       <span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
549:         <span class="ruby-identifier">entry</span> = <span class="ruby-ivar">@bag</span>.<span class="ruby-identifier">find_all</span>(<span class="ruby-identifier">template</span>)
550:         <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">collect</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span>
551:           <span class="ruby-identifier">e</span>.<span class="ruby-identifier">value</span>
552:         <span class="ruby-keyword kw">end</span>
553:       <span class="ruby-keyword kw">end</span>
554:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002920" class="method">
  <div id="M002920_title" class="title">
    <b>take</b>(tuple, sec=nil, &amp;block)
  </div>
  <div class="description">
  <p>
Removes <tt>tuple</tt>
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002920_source')" id="l_M002920_source">show source</a> ]</p>
  <div id="M002920_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/rinda/tuplespace.rb, line 478</span>
478:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">take</span>(<span class="ruby-identifier">tuple</span>, <span class="ruby-identifier">sec</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
479:       <span class="ruby-identifier">move</span>(<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">tuple</span>, <span class="ruby-identifier">sec</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
480:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002919" class="method">
  <div id="M002919_title" class="title">
    <b>write</b>(tuple, sec=nil)
  </div>
  <div class="description">
  <p>
Adds <tt>tuple</tt>
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002919_source')" id="l_M002919_source">show source</a> ]</p>
  <div id="M002919_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/rinda/tuplespace.rb, line 451</span>
451:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write</span>(<span class="ruby-identifier">tuple</span>, <span class="ruby-identifier">sec</span>=<span class="ruby-keyword kw">nil</span>)
452:       <span class="ruby-identifier">entry</span> = <span class="ruby-identifier">create_entry</span>(<span class="ruby-identifier">tuple</span>, <span class="ruby-identifier">sec</span>)
453:       <span class="ruby-identifier">synchronize</span> <span class="ruby-keyword kw">do</span>
454:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">expired?</span>
455:           <span class="ruby-ivar">@read_waiter</span>.<span class="ruby-identifier">find_all_template</span>(<span class="ruby-identifier">entry</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">template</span><span class="ruby-operator">|</span>
456:             <span class="ruby-identifier">template</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">tuple</span>)
457:           <span class="ruby-keyword kw">end</span>
458:           <span class="ruby-identifier">notify_event</span>(<span class="ruby-value str">'write'</span>, <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">value</span>)
459:           <span class="ruby-identifier">notify_event</span>(<span class="ruby-value str">'delete'</span>, <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">value</span>)
460:         <span class="ruby-keyword kw">else</span>
461:           <span class="ruby-ivar">@bag</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">entry</span>)
462:           <span class="ruby-identifier">start_keeper</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">expires</span>
463:           <span class="ruby-ivar">@read_waiter</span>.<span class="ruby-identifier">find_all_template</span>(<span class="ruby-identifier">entry</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">template</span><span class="ruby-operator">|</span>
464:             <span class="ruby-identifier">template</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">tuple</span>)
465:           <span class="ruby-keyword kw">end</span>
466:           <span class="ruby-ivar">@take_waiter</span>.<span class="ruby-identifier">find_all_template</span>(<span class="ruby-identifier">entry</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">template</span><span class="ruby-operator">|</span>
467:             <span class="ruby-identifier">template</span>.<span class="ruby-identifier">signal</span>
468:           <span class="ruby-keyword kw">end</span>
469:           <span class="ruby-identifier">notify_event</span>(<span class="ruby-value str">'write'</span>, <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">value</span>)
470:         <span class="ruby-keyword kw">end</span>
471:       <span class="ruby-keyword kw">end</span>
472:       <span class="ruby-identifier">entry</span>
473:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>