  <div id="C00000293">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />UDPSocket<br/>
  In:
<a href="#" onclick="jsHref('files/ruby-1_8_7-p22/lib/resolv-replace_rb.html');">ruby-1.8.7-p22/lib/resolv-replace.rb</a>
<a href="#" onclick="jsHref('files/ruby-1_8_7-p22/ext/socket/socket_c.html');">ruby-1.8.7-p22/ext/socket/socket.c</a>

Parent:&nbsp;
        <a href="#" onclick="jsHref('classes/YAML/Object.html');">
Object
         </a>
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">

  <div class="description"><p>
<a href="index.html?a=C00000299&name=Class">Class</a> <tt><a
href="index.html?a=C00000229&name=Socket">Socket</a></tt> provides access
to the underlying operating system socket implementations. It can be used
to provide more operating system specific functionality than the
protocol-specific socket classes but at the expense of greater complexity.
In particular, the class handles addresses using +struct sockaddr+
structures packed into Ruby strings, which can be a joy to manipulate.
</p>
<h3><a href="index.html?a=C00000131&name=Exception">Exception</a> Handling</h3>
<p>
Ruby&#8217;s implementation of <tt><a
href="index.html?a=C00000229&name=Socket">Socket</a></tt> causes an
exception to be raised based on the error generated by the system dependent
implementation. This is why the methods are documented in a way that
isolate Unix-based system exceptions from Windows based exceptions. If more
information on particular exception is needed please refer to the Unix
manual pages or the Windows WinSock reference.
</p>
<h3>Documentation by</h3>
<ul>
<li>Zach Dennis

</li>
<li>Sam Roberts

</li>
<li><em>Programming Ruby</em> from The Pragmatic Bookshelf.

</li>
</ul>
<p>
Much material in this documentation is taken with permission from
<em>Programming Ruby</em> from The Pragmatic Bookshelf.
</p>
</div>



  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M002702&name=bind" >bind</a></li>
  <li><a href="index.html?a=M002703&name=connect" >connect</a></li>
  <li><a href="index.html?a=M002705&name=recvfrom_nonblock" >recvfrom_nonblock</a></li>
  <li><a href="index.html?a=M002704&name=send" >send</a></li>
  </ul>






<div class="sectiontitle">Public Instance methods</div>
<div id="M002702" class="method">
  <div id="M002702_title" class="title">
    <b>bind</b>(host, port)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002702_source')" id="l_M002702_source">show source</a> ]</p>
  <div id="M002702_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/resolv-replace.rb, line 25</span>
25:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">bind</span>(<span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>)
26:     <span class="ruby-identifier">original_resolv_bind</span>(<span class="ruby-constant">IPSocket</span>.<span class="ruby-identifier">getaddress</span>(<span class="ruby-identifier">host</span>), <span class="ruby-identifier">port</span>)
27:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002703" class="method">
  <div id="M002703_title" class="title">
    <b>connect</b>(host, port)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002703_source')" id="l_M002703_source">show source</a> ]</p>
  <div id="M002703_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/resolv-replace.rb, line 30</span>
30:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">connect</span>(<span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span>)
31:     <span class="ruby-identifier">original_resolv_connect</span>(<span class="ruby-constant">IPSocket</span>.<span class="ruby-identifier">getaddress</span>(<span class="ruby-identifier">host</span>), <span class="ruby-identifier">port</span>)
32:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002705" class="method">
  <div id="M002705_title" class="title">
    <b>udpsocket.recvfrom_nonblock(maxlen) => [mesg, sender_inet_addr]<br />
udpsocket.recvfrom_nonblock(maxlen, flags) => [mesg, sender_inet_addr]<br />
</b>
  </div>
  <div class="description">
  <p>
Receives up to <em>maxlen</em> bytes from <tt>udpsocket</tt> using
recvfrom(2) after O_NONBLOCK is set for the underlying file descriptor.
<em>flags</em> is zero or more of the <tt>MSG_</tt> options. The first
element of the results, <em>mesg</em>, is the data received. The second
element, <em>sender_inet_addr</em>, is an array to represent the sender
address.
</p>
<p>
When recvfrom(2) returns 0, <a
href="index.html?a=M002001&name=Socket#recvfrom_nonblock">Socket#recvfrom_nonblock</a>
returns an empty string as data. It means an empty packet.
</p>
<h3>Parameters</h3>
<ul>
<li><tt>maxlen</tt> - the number of bytes to receive from the socket

</li>
<li><tt>flags</tt> - zero or more of the <tt>MSG_</tt> options

</li>
</ul>
<h3>Example</h3>
<pre>
     require 'socket'
     s1 = UDPSocket.new
     s1.bind(&quot;127.0.0.1&quot;, 0)
     s2 = UDPSocket.new
     s2.bind(&quot;127.0.0.1&quot;, 0)
     s2.connect(*s1.addr.values_at(3,1))
     s1.connect(*s2.addr.values_at(3,1))
     s1.send &quot;aaa&quot;, 0
     IO.select([s2])
     p s2.recvfrom_nonblock(10)  #=&gt; [&quot;aaa&quot;, [&quot;AF_INET&quot;, 33302, &quot;localhost.localdomain&quot;, &quot;127.0.0.1&quot;]]
</pre>
<p>
Refer to <a
href="index.html?a=M002000&name=Socket#recvfrom">Socket#recvfrom</a> for
the exceptions that may be thrown if the call to <em><a
href="index.html?a=M002705&name=recvfrom_nonblock">recvfrom_nonblock</a></em>
fails.
</p>
<p>
<a
href="index.html?a=M002705&name=UDPSocket#recvfrom_nonblock">UDPSocket#recvfrom_nonblock</a>
may raise any error corresponding to recvfrom(2) failure, including
Errno::EAGAIN.
</p>
<h3>See</h3>
<ul>
<li><a href="index.html?a=M002000&name=Socket#recvfrom">Socket#recvfrom</a>

</li>
</ul>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002705_source')" id="l_M002705_source">show source</a> ]</p>
  <div id="M002705_source" class="dyn-source">
<pre>
/*
 * call-seq:
 *      udpsocket.recvfrom_nonblock(maxlen) =&gt; [mesg, sender_inet_addr]
 *      udpsocket.recvfrom_nonblock(maxlen, flags) =&gt; [mesg, sender_inet_addr]
 * 
 * Receives up to _maxlen_ bytes from +udpsocket+ using recvfrom(2) after
 * O_NONBLOCK is set for the underlying file descriptor.
 * _flags_ is zero or more of the +MSG_+ options.
 * The first element of the results, _mesg_, is the data received.
 * The second element, _sender_inet_addr_, is an array to represent the sender address.
 *
 * When recvfrom(2) returns 0,
 * Socket#recvfrom_nonblock returns an empty string as data.
 * It means an empty packet.
 * 
 * === Parameters
 * * +maxlen+ - the number of bytes to receive from the socket
 * * +flags+ - zero or more of the +MSG_+ options 
 * 
 * === Example
 *      require 'socket'
 *      s1 = UDPSocket.new
 *      s1.bind(&quot;127.0.0.1&quot;, 0)
 *      s2 = UDPSocket.new
 *      s2.bind(&quot;127.0.0.1&quot;, 0)
 *      s2.connect(*s1.addr.values_at(3,1))
 *      s1.connect(*s2.addr.values_at(3,1))
 *      s1.send &quot;aaa&quot;, 0
 *      IO.select([s2])
 *      p s2.recvfrom_nonblock(10)  #=&gt; [&quot;aaa&quot;, [&quot;AF_INET&quot;, 33302, &quot;localhost.localdomain&quot;, &quot;127.0.0.1&quot;]]
 *
 * Refer to Socket#recvfrom for the exceptions that may be thrown if the call
 * to _recvfrom_nonblock_ fails. 
 *
 * UDPSocket#recvfrom_nonblock may raise any error corresponding to recvfrom(2) failure,
 * including Errno::EAGAIN.
 *
 * === See
 * * Socket#recvfrom
 */
static VALUE
udp_recvfrom_nonblock(int argc, VALUE *argv, VALUE sock)
{
    return s_recvfrom_nonblock(sock, argc, argv, RECV_IP);
}
</pre>
  </div>
</div>
</div>
<div id="M002704" class="method">
  <div id="M002704_title" class="title">
    <b>send</b>(mesg, flags, *rest)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002704_source')" id="l_M002704_source">show source</a> ]</p>
  <div id="M002704_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/resolv-replace.rb, line 35</span>
35:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">send</span>(<span class="ruby-identifier">mesg</span>, <span class="ruby-identifier">flags</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">rest</span>)
36:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rest</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>
37:       <span class="ruby-identifier">host</span>, <span class="ruby-identifier">port</span> = <span class="ruby-identifier">rest</span>
38:       <span class="ruby-keyword kw">begin</span>
39:         <span class="ruby-identifier">addrs</span> = <span class="ruby-constant">Resolv</span>.<span class="ruby-identifier">getaddresses</span>(<span class="ruby-identifier">host</span>)
40:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Resolv</span><span class="ruby-operator">::</span><span class="ruby-constant">ResolvError</span>
41:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">SocketError</span>, <span class="ruby-node">&quot;Hostname not known: #{host}&quot;</span>
42:       <span class="ruby-keyword kw">end</span>
43:       <span class="ruby-identifier">err</span> = <span class="ruby-keyword kw">nil</span>
44:       <span class="ruby-identifier">addrs</span>[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">addr</span><span class="ruby-operator">|</span>
45:         <span class="ruby-keyword kw">begin</span>
46:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">original_resolv_send</span>(<span class="ruby-identifier">mesg</span>, <span class="ruby-identifier">flags</span>, <span class="ruby-identifier">addr</span>, <span class="ruby-identifier">port</span>)
47:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">SystemCallError</span>
48:         <span class="ruby-keyword kw">end</span>
49:       }
50:       <span class="ruby-identifier">original_resolv_send</span>(<span class="ruby-identifier">mesg</span>, <span class="ruby-identifier">flags</span>, <span class="ruby-identifier">addrs</span>[<span class="ruby-value">-1</span>], <span class="ruby-identifier">port</span>)
51:     <span class="ruby-keyword kw">else</span>
52:       <span class="ruby-identifier">original_resolv_send</span>(<span class="ruby-identifier">mesg</span>, <span class="ruby-identifier">flags</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">rest</span>)
53:     <span class="ruby-keyword kw">end</span>
54:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>