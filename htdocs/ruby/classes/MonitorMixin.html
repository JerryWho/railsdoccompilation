  <div id="C00000353">
<div class='banner'>
  <span class="file-title-prefix">Module</span><br />MonitorMixin<br/>
  In:
<a href="#" onclick="jsHref('files/ruby-1_8_7-p22/lib/monitor_rb.html');">ruby-1.8.7-p22/lib/monitor.rb</a>

</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">

  <div class="description"><p>
Adds monitor functionality to an arbitrary object by mixing the module with
<tt>include</tt>. For example:
</p>
<pre>
   require 'monitor.rb'

   buf = []
   buf.extend(MonitorMixin)
   empty_cond = buf.new_cond

   # consumer
   Thread.start do
     loop do
       buf.synchronize do
         empty_cond.wait_while { buf.empty? }
         print buf.shift
       end
     end
   end

   # producer
   while line = ARGF.gets
     buf.synchronize do
       buf.push(line)
       empty_cond.signal
     end
   end
</pre>
<p>
The consumer thread waits for the producer thread to push a line to buf
while buf.empty?, and the producer thread (main thread) reads a line from
ARGF and push it to buf, then call empty_cond.signal.
</p>
</div>



  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M003205&name=extend_object" >extend_object</a></li>
  <li><a href="index.html?a=M003208&name=mon_enter" >mon_enter</a></li>
  <li><a href="index.html?a=M003209&name=mon_exit" >mon_exit</a></li>
  <li><a href="index.html?a=M003210&name=mon_synchronize" >mon_synchronize</a></li>
  <li><a href="index.html?a=M003206&name=mon_try_enter" >mon_try_enter</a></li>
  <li><a href="index.html?a=M003213&name=new" >new</a></li>
  <li><a href="index.html?a=M003212&name=new_cond" >new_cond</a></li>
  <li><a href="index.html?a=M003211&name=synchronize" >synchronize</a></li>
  <li><a href="index.html?a=M003207&name=try_mon_enter" >try_mon_enter</a></li>
  </ul>



  <div class="sectiontitle">Classes and Modules</div>
  Class "<a href="#" onclick="jsHref('classes/MonitorMixin/ConditionVariable.html');" class="link">MonitorMixin::ConditionVariable</a>"<br />




<div class="sectiontitle">Public Class methods</div>
<div id="M003205" class="method">
  <div id="M003205_title" class="title">
    <b>extend_object</b>(obj)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003205_source')" id="l_M003205_source">show source</a> ]</p>
  <div id="M003205_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/monitor.rb, line 185</span>
185:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">extend_object</span>(<span class="ruby-identifier">obj</span>)
186:     <span class="ruby-keyword kw">super</span>(<span class="ruby-identifier">obj</span>)
187:     <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">instance_eval</span> {<span class="ruby-identifier">mon_initialize</span>()}
188:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003213" class="method">
  <div id="M003213_title" class="title">
    <b>new</b>(*args)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003213_source')" id="l_M003213_source">show source</a> ]</p>
  <div id="M003213_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/monitor.rb, line 261</span>
261:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
262:     <span class="ruby-keyword kw">super</span>
263:     <span class="ruby-identifier">mon_initialize</span>
264:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="sectiontitle">Public Instance methods</div>
<div id="M003208" class="method">
  <div id="M003208_title" class="title">
    <b>mon_enter</b>()
  </div>
  <div class="description">
  <p>
Enters exclusive section.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003208_source')" id="l_M003208_source">show source</a> ]</p>
  <div id="M003208_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/monitor.rb, line 212</span>
212:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mon_enter</span>
213:     <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">critical</span> = <span class="ruby-keyword kw">true</span>
214:     <span class="ruby-identifier">mon_acquire</span>(<span class="ruby-ivar">@mon_entering_queue</span>)
215:     <span class="ruby-ivar">@mon_count</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
216:   <span class="ruby-keyword kw">ensure</span>
217:     <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">critical</span> = <span class="ruby-keyword kw">false</span>
218:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003209" class="method">
  <div id="M003209_title" class="title">
    <b>mon_exit</b>()
  </div>
  <div class="description">
  <p>
Leaves exclusive section.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003209_source')" id="l_M003209_source">show source</a> ]</p>
  <div id="M003209_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/monitor.rb, line 223</span>
223:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mon_exit</span>
224:     <span class="ruby-identifier">mon_check_owner</span>
225:     <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">critical</span> = <span class="ruby-keyword kw">true</span>
226:     <span class="ruby-ivar">@mon_count</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
227:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@mon_count</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
228:       <span class="ruby-identifier">mon_release</span>
229:     <span class="ruby-keyword kw">end</span>
230:     <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">critical</span> = <span class="ruby-keyword kw">false</span>
231:     <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">pass</span>
232:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003210" class="method">
  <div id="M003210_title" class="title">
    <b>mon_synchronize</b>() {|| ...}
  </div>
  <div class="description">
  <p>
Enters exclusive section and executes the block. Leaves the exclusive
section automatically when the block exits. See example under <tt><a
href="index.html?a=C00000353&name=MonitorMixin">MonitorMixin</a></tt>.
</p>
  </div>
<div class="aka">
  This method is also aliased as
  <a href="index.html?a=M003211&name=synchronize">synchronize</a>
</div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003210_source')" id="l_M003210_source">show source</a> ]</p>
  <div id="M003210_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/monitor.rb, line 239</span>
239:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mon_synchronize</span>
240:     <span class="ruby-identifier">mon_enter</span>
241:     <span class="ruby-keyword kw">begin</span>
242:       <span class="ruby-keyword kw">yield</span>
243:     <span class="ruby-keyword kw">ensure</span>
244:       <span class="ruby-identifier">mon_exit</span>
245:     <span class="ruby-keyword kw">end</span>
246:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003206" class="method">
  <div id="M003206_title" class="title">
    <b>mon_try_enter</b>()
  </div>
  <div class="description">
  <p>
Attempts to enter exclusive section. Returns <tt>false</tt> if lock fails.
</p>
  </div>
<div class="aka">
  This method is also aliased as
  <a href="index.html?a=M003207&name=try_mon_enter">try_mon_enter</a>
</div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003206_source')" id="l_M003206_source">show source</a> ]</p>
  <div id="M003206_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/monitor.rb, line 193</span>
193:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mon_try_enter</span>
194:     <span class="ruby-identifier">result</span> = <span class="ruby-keyword kw">false</span>
195:     <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">critical</span> = <span class="ruby-keyword kw">true</span>
196:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@mon_owner</span>.<span class="ruby-identifier">nil?</span>
197:       <span class="ruby-ivar">@mon_owner</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>
198:     <span class="ruby-keyword kw">end</span>
199:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@mon_owner</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>
200:       <span class="ruby-ivar">@mon_count</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
201:       <span class="ruby-identifier">result</span> = <span class="ruby-keyword kw">true</span>
202:     <span class="ruby-keyword kw">end</span>
203:     <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">critical</span> = <span class="ruby-keyword kw">false</span>
204:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span>
205:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003212" class="method">
  <div id="M003212_title" class="title">
    <b>new_cond</b>()
  </div>
  <div class="description">
  <p>
FIXME: This isn&#8217;t documented in Nutshell.
</p>
<p>
Create a new condition variable for this monitor. This facilitates control
of the monitor with signal and wait.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003212_source')" id="l_M003212_source">show source</a> ]</p>
  <div id="M003212_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/monitor.rb, line 255</span>
255:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">new_cond</span>
256:     <span class="ruby-keyword kw">return</span> <span class="ruby-constant">ConditionVariable</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>)
257:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003211" class="method">
  <div id="M003211_title" class="title">
    <b>synchronize</b>()
  </div>
  <div class="description">
  <p>
Alias for <a
href="index.html?a=M003210&name=mon_synchronize">mon_synchronize</a>
</p>
  </div>
</div>
<div id="M003207" class="method">
  <div id="M003207_title" class="title">
    <b>try_mon_enter</b>()
  </div>
  <div class="description">
  <p>
Alias for <a
href="index.html?a=M003206&name=mon_try_enter">mon_try_enter</a>
</p>
  </div>
</div>
</div>

  </div>