  <div id="C00001384">
<div class='banner'>
  <span class="file-title-prefix">Module</span><br />Mutex_m<br/>
  In:
<a href="#" onclick="jsHref('files/ruby-1_8_7-p22/lib/mutex_m_rb.html');">ruby-1.8.7-p22/lib/mutex_m.rb</a>

</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">

  <div class="description"><h2>Usage</h2>
<p>
Extend an object and use it like a <a
href="index.html?a=C00000064&name=Mutex">Mutex</a> object:
</p>
<pre>
  require &quot;mutex_m.rb&quot;
  obj = Object.new
  obj.extend Mutex_m
  # ...
</pre>
<p>
Or, include <a href="index.html?a=C00001384&name=Mutex_m">Mutex_m</a> in a
class to have its instances behave like a <a
href="index.html?a=C00000064&name=Mutex">Mutex</a> object:
</p>
<pre>
  class Foo
    include Mutex_m
    # ...
  end

  obj = Foo.new
</pre>
</div>



  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M007020&name=append_features" >append_features</a></li>
  <li><a href="index.html?a=M007019&name=define_aliases" >define_aliases</a></li>
  <li><a href="index.html?a=M007021&name=extend_object" >extend_object</a></li>
  <li><a href="index.html?a=M007022&name=mu_extended" >mu_extended</a></li>
  <li><a href="index.html?a=M007026&name=mu_lock" >mu_lock</a></li>
  <li><a href="index.html?a=M007024&name=mu_locked?" >mu_locked?</a></li>
  <li><a href="index.html?a=M007023&name=mu_synchronize" >mu_synchronize</a></li>
  <li><a href="index.html?a=M007025&name=mu_try_lock" >mu_try_lock</a></li>
  <li><a href="index.html?a=M007027&name=mu_unlock" >mu_unlock</a></li>
  <li><a href="index.html?a=M007028&name=new" >new</a></li>
  </ul>






<div class="sectiontitle">Public Class methods</div>
<div id="M007020" class="method">
  <div id="M007020_title" class="title">
    <b>append_features</b>(cl)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007020_source')" id="l_M007020_source">show source</a> ]</p>
  <div id="M007020_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/mutex_m.rb, line 42</span>
42:   <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Mutex_m</span>.<span class="ruby-identifier">append_features</span>(<span class="ruby-identifier">cl</span>)
43:     <span class="ruby-keyword kw">super</span>
44:     <span class="ruby-identifier">define_aliases</span>(<span class="ruby-identifier">cl</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">cl</span>.<span class="ruby-identifier">instance_of?</span>(<span class="ruby-constant">Module</span>)
45:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007019" class="method">
  <div id="M007019_title" class="title">
    <b>define_aliases</b>(cl)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007019_source')" id="l_M007019_source">show source</a> ]</p>
  <div id="M007019_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/mutex_m.rb, line 32</span>
32:   <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Mutex_m</span>.<span class="ruby-identifier">define_aliases</span>(<span class="ruby-identifier">cl</span>)
33:     <span class="ruby-identifier">cl</span>.<span class="ruby-identifier">module_eval</span> <span class="ruby-value str">%q{
34:       alias locked? mu_locked?
35:       alias lock mu_lock
36:       alias unlock mu_unlock
37:       alias try_lock mu_try_lock
38:       alias synchronize mu_synchronize
39:     }</span>
40:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007021" class="method">
  <div id="M007021_title" class="title">
    <b>extend_object</b>(obj)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007021_source')" id="l_M007021_source">show source</a> ]</p>
  <div id="M007021_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/mutex_m.rb, line 47</span>
47:   <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Mutex_m</span>.<span class="ruby-identifier">extend_object</span>(<span class="ruby-identifier">obj</span>)
48:     <span class="ruby-keyword kw">super</span>
49:     <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">mu_extended</span>
50:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007028" class="method">
  <div id="M007028_title" class="title">
    <b>new</b>(*args)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007028_source')" id="l_M007028_source">show source</a> ]</p>
  <div id="M007028_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/mutex_m.rb, line 118</span>
118:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
119:     <span class="ruby-identifier">mu_initialize</span>
120:     <span class="ruby-keyword kw">super</span>
121:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="sectiontitle">Public Instance methods</div>
<div id="M007022" class="method">
  <div id="M007022_title" class="title">
    <b>mu_extended</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007022_source')" id="l_M007022_source">show source</a> ]</p>
  <div id="M007022_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/mutex_m.rb, line 52</span>
52:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mu_extended</span>
53:     <span class="ruby-keyword kw">unless</span> (<span class="ruby-keyword kw">defined?</span> <span class="ruby-identifier">locked?</span> <span class="ruby-keyword kw">and</span>
54:             <span class="ruby-keyword kw">defined?</span> <span class="ruby-identifier">lock</span> <span class="ruby-keyword kw">and</span>
55:             <span class="ruby-keyword kw">defined?</span> <span class="ruby-identifier">unlock</span> <span class="ruby-keyword kw">and</span>
56:             <span class="ruby-keyword kw">defined?</span> <span class="ruby-identifier">try_lock</span> <span class="ruby-keyword kw">and</span>
57:             <span class="ruby-keyword kw">defined?</span> <span class="ruby-identifier">synchronize</span>)
58:       <span class="ruby-constant">Mutex_m</span>.<span class="ruby-identifier">define_aliases</span>(<span class="ruby-keyword kw">class</span><span class="ruby-operator">&lt;&lt;</span><span class="ruby-keyword kw">self</span>;<span class="ruby-keyword kw">self</span>;<span class="ruby-keyword kw">end</span>)
59:     <span class="ruby-keyword kw">end</span>
60:     <span class="ruby-identifier">mu_initialize</span>
61:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007026" class="method">
  <div id="M007026_title" class="title">
    <b>mu_lock</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007026_source')" id="l_M007026_source">show source</a> ]</p>
  <div id="M007026_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/mutex_m.rb, line 88</span>
88:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mu_lock</span>
89:     <span class="ruby-keyword kw">while</span> (<span class="ruby-constant">Thread</span>.<span class="ruby-identifier">critical</span> = <span class="ruby-keyword kw">true</span>; <span class="ruby-ivar">@mu_locked</span>)
90:       <span class="ruby-ivar">@mu_waiting</span>.<span class="ruby-identifier">push</span> <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>
91:       <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">stop</span>
92:     <span class="ruby-keyword kw">end</span>
93:     <span class="ruby-ivar">@mu_locked</span> = <span class="ruby-keyword kw">true</span>
94:     <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">critical</span> = <span class="ruby-keyword kw">false</span>
95:     <span class="ruby-keyword kw">self</span>
96:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007024" class="method">
  <div id="M007024_title" class="title">
    <b>mu_locked?</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007024_source')" id="l_M007024_source">show source</a> ]</p>
  <div id="M007024_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/mutex_m.rb, line 73</span>
73:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mu_locked?</span>
74:     <span class="ruby-ivar">@mu_locked</span>
75:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007023" class="method">
  <div id="M007023_title" class="title">
    <b>mu_synchronize</b>() {|| ...}
  </div>
  <div class="description">
  <p>
locking
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007023_source')" id="l_M007023_source">show source</a> ]</p>
  <div id="M007023_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/mutex_m.rb, line 64</span>
64:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mu_synchronize</span>
65:     <span class="ruby-keyword kw">begin</span>
66:       <span class="ruby-identifier">mu_lock</span>
67:       <span class="ruby-keyword kw">yield</span>
68:     <span class="ruby-keyword kw">ensure</span>
69:       <span class="ruby-identifier">mu_unlock</span>
70:     <span class="ruby-keyword kw">end</span>
71:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007025" class="method">
  <div id="M007025_title" class="title">
    <b>mu_try_lock</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007025_source')" id="l_M007025_source">show source</a> ]</p>
  <div id="M007025_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/mutex_m.rb, line 77</span>
77:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mu_try_lock</span>
78:     <span class="ruby-identifier">result</span> = <span class="ruby-keyword kw">false</span>
79:     <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">critical</span> = <span class="ruby-keyword kw">true</span>
80:     <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@mu_locked</span>
81:       <span class="ruby-ivar">@mu_locked</span> = <span class="ruby-keyword kw">true</span>
82:       <span class="ruby-identifier">result</span> = <span class="ruby-keyword kw">true</span>
83:     <span class="ruby-keyword kw">end</span>
84:     <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">critical</span> = <span class="ruby-keyword kw">false</span>
85:     <span class="ruby-identifier">result</span>
86:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007027" class="method">
  <div id="M007027_title" class="title">
    <b>mu_unlock</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007027_source')" id="l_M007027_source">show source</a> ]</p>
  <div id="M007027_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/mutex_m.rb, line 98</span>
 98:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mu_unlock</span>
 99:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@mu_locked</span>
100:     <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">critical</span> = <span class="ruby-keyword kw">true</span>
101:     <span class="ruby-identifier">wait</span> = <span class="ruby-ivar">@mu_waiting</span>
102:     <span class="ruby-ivar">@mu_waiting</span> = []
103:     <span class="ruby-ivar">@mu_locked</span> = <span class="ruby-keyword kw">false</span>
104:     <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">critical</span> = <span class="ruby-keyword kw">false</span>
105:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">w</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">wait</span>
106:       <span class="ruby-identifier">w</span>.<span class="ruby-identifier">run</span>
107:     <span class="ruby-keyword kw">end</span>
108:     <span class="ruby-keyword kw">self</span>
109:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>