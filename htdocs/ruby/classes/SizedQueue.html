  <div id="C00000007">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />SizedQueue<br/>
  In:
<a href="#" onclick="jsHref('files/ruby-1_8_7-p22/lib/thread_rb.html');">ruby-1.8.7-p22/lib/thread.rb</a>

Parent:&nbsp;
        <a href="#" onclick="jsHref('classes/Queue.html');">
Queue
         </a>
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">

  <div class="description"><p>
This class represents queues of specified size capacity. The push operation
may be blocked if the capacity is full.
</p>
<p>
See <a href="index.html?a=C00000208&name=Queue">Queue</a> for an example of
how a <a href="index.html?a=C00000007&name=SizedQueue">SizedQueue</a>
works.
</p>
</div>



  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M000117&name=&lt;&lt;" >&lt;&lt;</a></li>
  <li><a href="index.html?a=M000121&name=deq" >deq</a></li>
  <li><a href="index.html?a=M000118&name=enq" >enq</a></li>
  <li><a href="index.html?a=M000114&name=max" >max</a></li>
  <li><a href="index.html?a=M000115&name=max=" >max=</a></li>
  <li><a href="index.html?a=M000113&name=new" >new</a></li>
  <li><a href="index.html?a=M000122&name=num_waiting" >num_waiting</a></li>
  <li><a href="index.html?a=M000119&name=pop" >pop</a></li>
  <li><a href="index.html?a=M000116&name=push" >push</a></li>
  <li><a href="index.html?a=M000120&name=shift" >shift</a></li>
  </ul>






<div class="sectiontitle">Public Class methods</div>
<div id="M000113" class="method">
  <div id="M000113_title" class="title">
    <b>new</b>(max)
  </div>
  <div class="description">
  <p>
Creates a fixed-length queue with a maximum size of <tt>max</tt>.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000113_source')" id="l_M000113_source">show source</a> ]</p>
  <div id="M000113_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/thread.rb, line 374</span>
374:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">max</span>)
375:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">&quot;queue size must be positive&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">max</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
376:     <span class="ruby-ivar">@max</span> = <span class="ruby-identifier">max</span>
377:     <span class="ruby-ivar">@queue_wait</span> = []
378:     <span class="ruby-ivar">@queue_wait</span>.<span class="ruby-identifier">taint</span>           <span class="ruby-comment cmt"># enable tainted comunication</span>
379:     <span class="ruby-keyword kw">super</span>()
380:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="sectiontitle">Public Instance methods</div>
<div id="M000117" class="method">
  <div id="M000117_title" class="title">
    <b>&lt;&lt;</b>(obj)
  </div>
  <div class="description">
  <p>
Alias for <a href="index.html?a=M000116&name=push">push</a>
</p>
  </div>
</div>
<div id="M000121" class="method">
  <div id="M000121_title" class="title">
    <b>deq</b>(*args)
  </div>
  <div class="description">
  <p>
Alias for <a href="index.html?a=M000119&name=pop">pop</a>
</p>
  </div>
</div>
<div id="M000118" class="method">
  <div id="M000118_title" class="title">
    <b>enq</b>(obj)
  </div>
  <div class="description">
  <p>
Alias for <a href="index.html?a=M000116&name=push">push</a>
</p>
  </div>
</div>
<div id="M000114" class="method">
  <div id="M000114_title" class="title">
    <b>max</b>()
  </div>
  <div class="description">
  <p>
Returns the maximum size of the queue.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000114_source')" id="l_M000114_source">show source</a> ]</p>
  <div id="M000114_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/thread.rb, line 385</span>
385:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">max</span>
386:     <span class="ruby-ivar">@max</span>
387:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000115" class="method">
  <div id="M000115_title" class="title">
    <b>max=</b>(max)
  </div>
  <div class="description">
  <p>
Sets the maximum size of the queue.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000115_source')" id="l_M000115_source">show source</a> ]</p>
  <div id="M000115_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/thread.rb, line 392</span>
392:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">max=</span>(<span class="ruby-identifier">max</span>)
393:     <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">critical</span> = <span class="ruby-keyword kw">true</span>
394:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">max</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-ivar">@max</span>
395:       <span class="ruby-ivar">@max</span> = <span class="ruby-identifier">max</span>
396:       <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">critical</span> = <span class="ruby-keyword kw">false</span>
397:     <span class="ruby-keyword kw">else</span>
398:       <span class="ruby-identifier">diff</span> = <span class="ruby-identifier">max</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@max</span>
399:       <span class="ruby-ivar">@max</span> = <span class="ruby-identifier">max</span>
400:       <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">critical</span> = <span class="ruby-keyword kw">false</span>
401:       <span class="ruby-identifier">diff</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword kw">do</span>
402:         <span class="ruby-keyword kw">begin</span>
403:           <span class="ruby-identifier">t</span> = <span class="ruby-ivar">@queue_wait</span>.<span class="ruby-identifier">shift</span>
404:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">run</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t</span>
405:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">ThreadError</span>
406:           <span class="ruby-keyword kw">retry</span>
407:         <span class="ruby-keyword kw">end</span>
408:       <span class="ruby-keyword kw">end</span>
409:     <span class="ruby-keyword kw">end</span>
410:     <span class="ruby-identifier">max</span>
411:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000122" class="method">
  <div id="M000122_title" class="title">
    <b>num_waiting</b>()
  </div>
  <div class="description">
  <p>
Returns the number of threads waiting on the queue.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000122_source')" id="l_M000122_source">show source</a> ]</p>
  <div id="M000122_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/thread.rb, line 473</span>
473:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">num_waiting</span>
474:     <span class="ruby-ivar">@waiting</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@queue_wait</span>.<span class="ruby-identifier">size</span>
475:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000119" class="method">
  <div id="M000119_title" class="title">
    <b>pop</b>(*args)
  </div>
  <div class="description">
  <p>
Retrieves data from the queue and runs a waiting thread, if any.
</p>
  </div>
<div class="aka">
  This method is also aliased as
  <a href="index.html?a=M000120&name=shift">shift</a>
  <a href="index.html?a=M000121&name=deq">deq</a>
</div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000119_source')" id="l_M000119_source">show source</a> ]</p>
  <div id="M000119_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/thread.rb, line 440</span>
440:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">pop</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
441:     <span class="ruby-identifier">retval</span> = <span class="ruby-keyword kw">super</span>
442:     <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">critical</span> = <span class="ruby-keyword kw">true</span>
443:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@que</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@max</span>
444:       <span class="ruby-keyword kw">begin</span>
445:         <span class="ruby-identifier">t</span> = <span class="ruby-ivar">@queue_wait</span>.<span class="ruby-identifier">shift</span>
446:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">wakeup</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t</span>
447:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">ThreadError</span>
448:         <span class="ruby-keyword kw">retry</span>
449:       <span class="ruby-keyword kw">ensure</span>
450:         <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">critical</span> = <span class="ruby-keyword kw">false</span>
451:       <span class="ruby-keyword kw">end</span>
452:       <span class="ruby-keyword kw">begin</span>
453:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">run</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t</span>
454:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">ThreadError</span>
455:       <span class="ruby-keyword kw">end</span>
456:     <span class="ruby-keyword kw">end</span>
457:     <span class="ruby-identifier">retval</span>
458:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000116" class="method">
  <div id="M000116_title" class="title">
    <b>push</b>(obj)
  </div>
  <div class="description">
  <p>
Pushes <tt>obj</tt> to the queue. If there is no space left in the queue,
waits until space becomes available.
</p>
  </div>
<div class="aka">
  This method is also aliased as
  <a href="index.html?a=M000117&name=<<"><<</a>
  <a href="index.html?a=M000118&name=enq">enq</a>
</div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000116_source')" id="l_M000116_source">show source</a> ]</p>
  <div id="M000116_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/thread.rb, line 417</span>
417:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">push</span>(<span class="ruby-identifier">obj</span>)
418:     <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">critical</span> = <span class="ruby-keyword kw">true</span>
419:     <span class="ruby-keyword kw">while</span> <span class="ruby-ivar">@que</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-ivar">@max</span>
420:       <span class="ruby-ivar">@queue_wait</span>.<span class="ruby-identifier">push</span> <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>
421:       <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">stop</span>
422:       <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">critical</span> = <span class="ruby-keyword kw">true</span>
423:     <span class="ruby-keyword kw">end</span>
424:     <span class="ruby-keyword kw">super</span>
425:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000120" class="method">
  <div id="M000120_title" class="title">
    <b>shift</b>(*args)
  </div>
  <div class="description">
  <p>
Alias for <a href="index.html?a=M000119&name=pop">pop</a>
</p>
  </div>
</div>
</div>

  </div>