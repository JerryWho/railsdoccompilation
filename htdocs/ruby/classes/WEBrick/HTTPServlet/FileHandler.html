  <div id="C00001145">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />FileHandler<br/>
  In:
<a href="#" onclick="jsHref('files/ruby-1_8_7-p22/lib/webrick/httpservlet/filehandler_rb.html');">ruby-1.8.7-p22/lib/webrick/httpservlet/filehandler.rb</a>

Parent:&nbsp;
        <a href="#" onclick="jsHref('classes/WEBrick/HTTPServlet/AbstractServlet.html');">
AbstractServlet
         </a>
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">




  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M005985&name=add_handler" >add_handler</a></li>
  <li><a href="index.html?a=M005989&name=do_GET" >do_GET</a></li>
  <li><a href="index.html?a=M005991&name=do_OPTIONS" >do_OPTIONS</a></li>
  <li><a href="index.html?a=M005990&name=do_POST" >do_POST</a></li>
  <li><a href="index.html?a=M005987&name=new" >new</a></li>
  <li><a href="index.html?a=M005986&name=remove_handler" >remove_handler</a></li>
  <li><a href="index.html?a=M005988&name=service" >service</a></li>
  </ul>




  <div class="sectiontitle">Constants</div>
  <table border='0' cellpadding='5'>
  <tr valign='top'>
    <td class="attr-name">HandlerTable</td>
    <td>=</td>
    <td class="attr-value">Hash.new</td>
  </tr>
  </table>


<div class="sectiontitle">Public Class methods</div>
<div id="M005985" class="method">
  <div id="M005985_title" class="title">
    <b>add_handler</b>(suffix, handler)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005985_source')" id="l_M005985_source">show source</a> ]</p>
  <div id="M005985_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/webrick/httpservlet/filehandler.rb, line 131</span>
131:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">add_handler</span>(<span class="ruby-identifier">suffix</span>, <span class="ruby-identifier">handler</span>)
132:         <span class="ruby-constant">HandlerTable</span>[<span class="ruby-identifier">suffix</span>] = <span class="ruby-identifier">handler</span>
133:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005987" class="method">
  <div id="M005987_title" class="title">
    <b>new</b>(server, root, options={}, default=Config::FileHandler)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005987_source')" id="l_M005987_source">show source</a> ]</p>
  <div id="M005987_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/webrick/httpservlet/filehandler.rb, line 139</span>
139:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">server</span>, <span class="ruby-identifier">root</span>, <span class="ruby-identifier">options</span>={}, <span class="ruby-identifier">default</span>=<span class="ruby-constant">Config</span><span class="ruby-operator">::</span><span class="ruby-constant">FileHandler</span>)
140:         <span class="ruby-ivar">@config</span> = <span class="ruby-identifier">server</span>.<span class="ruby-identifier">config</span>
141:         <span class="ruby-ivar">@logger</span> = <span class="ruby-ivar">@config</span>[<span class="ruby-identifier">:Logger</span>]
142:         <span class="ruby-ivar">@root</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">root</span>)
143:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">options</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">false</span>
144:           <span class="ruby-identifier">options</span> = { <span class="ruby-identifier">:FancyIndexing</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span> }
145:         <span class="ruby-keyword kw">end</span>
146:         <span class="ruby-ivar">@options</span> = <span class="ruby-identifier">default</span>.<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">options</span>)
147:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005986" class="method">
  <div id="M005986_title" class="title">
    <b>remove_handler</b>(suffix)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005986_source')" id="l_M005986_source">show source</a> ]</p>
  <div id="M005986_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/webrick/httpservlet/filehandler.rb, line 135</span>
135:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">remove_handler</span>(<span class="ruby-identifier">suffix</span>)
136:         <span class="ruby-constant">HandlerTable</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">suffix</span>)
137:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="sectiontitle">Public Instance methods</div>
<div id="M005989" class="method">
  <div id="M005989_title" class="title">
    <b>do_GET</b>(req, res)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005989_source')" id="l_M005989_source">show source</a> ]</p>
  <div id="M005989_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/webrick/httpservlet/filehandler.rb, line 170</span>
170:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">do_GET</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
171:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">exec_handler</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
172:           <span class="ruby-identifier">set_dir_list</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
173:         <span class="ruby-keyword kw">end</span>
174:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005991" class="method">
  <div id="M005991_title" class="title">
    <b>do_OPTIONS</b>(req, res)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005991_source')" id="l_M005991_source">show source</a> ]</p>
  <div id="M005991_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/webrick/httpservlet/filehandler.rb, line 182</span>
182:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">do_OPTIONS</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
183:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">exec_handler</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
184:           <span class="ruby-keyword kw">super</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
185:         <span class="ruby-keyword kw">end</span>
186:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005990" class="method">
  <div id="M005990_title" class="title">
    <b>do_POST</b>(req, res)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005990_source')" id="l_M005990_source">show source</a> ]</p>
  <div id="M005990_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/webrick/httpservlet/filehandler.rb, line 176</span>
176:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">do_POST</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
177:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">exec_handler</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
178:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">HTTPStatus</span><span class="ruby-operator">::</span><span class="ruby-constant">NotFound</span>, <span class="ruby-node">&quot;`#{req.path}' not found.&quot;</span>
179:         <span class="ruby-keyword kw">end</span>
180:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005988" class="method">
  <div id="M005988_title" class="title">
    <b>service</b>(req, res)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005988_source')" id="l_M005988_source">show source</a> ]</p>
  <div id="M005988_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/webrick/httpservlet/filehandler.rb, line 149</span>
149:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">service</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
150:         <span class="ruby-comment cmt"># if this class is mounted on &quot;/&quot; and /~username is requested.</span>
151:         <span class="ruby-comment cmt"># we're going to override path informations before invoking service.</span>
152:         <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-constant">Etc</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:UserDir</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">req</span>.<span class="ruby-identifier">script_name</span>.<span class="ruby-identifier">empty?</span>
153:           <span class="ruby-keyword kw">if</span> <span class="ruby-regexp re">%r|^(/~([^/]+))|</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">req</span>.<span class="ruby-identifier">path_info</span>
154:             <span class="ruby-identifier">script_name</span>, <span class="ruby-identifier">user</span> = <span class="ruby-identifier">$1</span>, <span class="ruby-identifier">$2</span>
155:             <span class="ruby-identifier">path_info</span> = <span class="ruby-identifier">$'</span>
156:             <span class="ruby-keyword kw">begin</span>
157:               <span class="ruby-identifier">passwd</span> = <span class="ruby-constant">Etc</span><span class="ruby-operator">::</span><span class="ruby-identifier">getpwnam</span>(<span class="ruby-identifier">user</span>)
158:               <span class="ruby-ivar">@root</span> = <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-identifier">join</span>(<span class="ruby-identifier">passwd</span>.<span class="ruby-identifier">dir</span>, <span class="ruby-ivar">@options</span>[<span class="ruby-identifier">:UserDir</span>])
159:               <span class="ruby-identifier">req</span>.<span class="ruby-identifier">script_name</span> = <span class="ruby-identifier">script_name</span>
160:               <span class="ruby-identifier">req</span>.<span class="ruby-identifier">path_info</span> = <span class="ruby-identifier">path_info</span>
161:             <span class="ruby-keyword kw">rescue</span>
162:               <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-node">&quot;#{self.class}#do_GET: getpwnam(#{user}) failed&quot;</span>
163:             <span class="ruby-keyword kw">end</span>
164:           <span class="ruby-keyword kw">end</span>
165:         <span class="ruby-keyword kw">end</span>
166:         <span class="ruby-identifier">prevent_directory_traversal</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
167:         <span class="ruby-keyword kw">super</span>(<span class="ruby-identifier">req</span>, <span class="ruby-identifier">res</span>)
168:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>