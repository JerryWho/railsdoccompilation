  <div id="C00000100">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />Iconv<br/>
  In:
<a href="#" onclick="jsHref('files/ruby-1_8_7-p22/ext/iconv/iconv_c.html');">ruby-1.8.7-p22/ext/iconv/iconv.c</a>

Parent:&nbsp;
        <a href="#" onclick="jsHref('classes/Data.html');">
Data
         </a>
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">

  <div class="description"><p>
Document-class: <a
href="index.html?a=C00000104&name=Iconv::BrokenLibrary">Iconv::BrokenLibrary</a>
</p>
<p>
Detected a bug of underlying iconv(3) libray.
</p>
<ul>
<li>returns an error without setting errno properly

</li>
</ul>
</div>



  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M001180&name=charset_map" >charset_map</a></li>
  <li><a href="index.html?a=M001178&name=close" >close</a></li>
  <li><a href="index.html?a=M001176&name=conv" >conv</a></li>
  <li><a href="index.html?a=M001179&name=iconv" >iconv</a></li>
  <li><a href="index.html?a=M001175&name=iconv" >iconv</a></li>
  <li><a href="index.html?a=M001177&name=new" >new</a></li>
  <li><a href="index.html?a=M001174&name=open" >open</a></li>
  </ul>



  <div class="sectiontitle">Classes and Modules</div>
  Module "<a href="#" onclick="jsHref('classes/Iconv/Failure.html');" class="link">Iconv::Failure</a>"<br />
Class "<a href="#" onclick="jsHref('classes/Iconv/BrokenLibrary.html');" class="link">Iconv::BrokenLibrary</a>"<br />
Class "<a href="#" onclick="jsHref('classes/Iconv/IllegalSequence.html');" class="link">Iconv::IllegalSequence</a>"<br />
Class "<a href="#" onclick="jsHref('classes/Iconv/InvalidCharacter.html');" class="link">Iconv::InvalidCharacter</a>"<br />
Class "<a href="#" onclick="jsHref('classes/Iconv/InvalidEncoding.html');" class="link">Iconv::InvalidEncoding</a>"<br />
Class "<a href="#" onclick="jsHref('classes/Iconv/OutOfRange.html');" class="link">Iconv::OutOfRange</a>"<br />




<div class="sectiontitle">Public Class methods</div>
<div id="M001180" class="method">
  <div id="M001180_title" class="title">
    <b> Iconv.charset_map<br />
</b>
  </div>
  <div class="description">
  <p>
Returns the map from canonical name to system dependent name.
</p>
  </div>
</div>
<div id="M001176" class="method">
  <div id="M001176_title" class="title">
    <b> Iconv.conv(to, from, str)<br />
</b>
  </div>
  <div class="description">
  <p>
Document-method: Iconv::conv
</p>
<p>
Shorthand for
</p>
<pre>
  Iconv.iconv(to, from, str).join
</pre>
<p>
See <a href="index.html?a=M001175&name=Iconv.iconv">Iconv.iconv</a>.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001176_source')" id="l_M001176_source">show source</a> ]</p>
  <div id="M001176_source" class="dyn-source">
<pre>
/*
 * Document-method: Iconv::conv
 * call-seq: Iconv.conv(to, from, str)
 *
 * Shorthand for
 *   Iconv.iconv(to, from, str).join
 * See Iconv.iconv.
 */
static VALUE
iconv_s_conv
    (self, to, from, str)
    VALUE self, to, from, str;
{
    struct iconv_env_t arg;

    arg.argc = 1;
    arg.argv = &amp;str;
    arg.append = rb_str_append;
    arg.ret = rb_str_new(0, 0);
    arg.cd = iconv_create(to, from);
    return rb_ensure(iconv_s_convert, (VALUE)&amp;arg, iconv_free, ICONV2VALUE(arg.cd));
}
</pre>
  </div>
</div>
</div>
<div id="M001175" class="method">
  <div id="M001175_title" class="title">
    <b> Iconv.iconv(to, from, *strs)<br />
</b>
  </div>
  <div class="description">
  <p>
Document-method: Iconv::iconv
</p>
<p>
Shorthand for
</p>
<pre>
  Iconv.open(to, from) { |cd|
    (strs + [nil]).collect { |s| cd.iconv(s) }
  }
</pre>
<h3>Parameters</h3>
<table>
<tr><td valign="top"><tt>to, from</tt>:</td><td>see <a href="index.html?a=M001177&name=Iconv.new">Iconv.new</a>

</td></tr>
<tr><td valign="top"><tt>strs</tt>:</td><td>strings to be converted

</td></tr>
</table>
<h3>Exceptions</h3>
<p>
Exceptions thrown by <a
href="index.html?a=M001177&name=Iconv.new">Iconv.new</a>, <a
href="index.html?a=M001174&name=Iconv.open">Iconv.open</a> and <a
href="index.html?a=M001175&name=Iconv#iconv">Iconv#iconv</a>.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001175_source')" id="l_M001175_source">show source</a> ]</p>
  <div id="M001175_source" class="dyn-source">
<pre>
/*
 * Document-method: Iconv::iconv
 * call-seq: Iconv.iconv(to, from, *strs)
 *
 * Shorthand for
 *   Iconv.open(to, from) { |cd|
 *     (strs + [nil]).collect { |s| cd.iconv(s) }
 *   }
 *
 * === Parameters
 *
 * &lt;tt&gt;to, from&lt;/tt&gt;:: see Iconv.new
 * &lt;tt&gt;strs&lt;/tt&gt;:: strings to be converted
 *
 * === Exceptions
 *
 * Exceptions thrown by Iconv.new, Iconv.open and Iconv#iconv.
 */
static VALUE
iconv_s_iconv
    (argc, argv, self)
    int argc;
    VALUE *argv;
    VALUE self;
{
    struct iconv_env_t arg;

    if (argc &lt; 2)               /* needs `to' and `from' arguments at least */
        rb_raise(rb_eArgError, &quot;wrong number of arguments (%d for %d)&quot;, argc, 2);

    arg.argc = argc -= 2;
    arg.argv = argv + 2;
    arg.append = rb_ary_push;
    arg.ret = rb_ary_new2(argc);
    arg.cd = iconv_create(argv[0], argv[1]);
    return rb_ensure(iconv_s_convert, (VALUE)&amp;arg, iconv_free, ICONV2VALUE(arg.cd));
}
</pre>
  </div>
</div>
</div>
<div id="M001177" class="method">
  <div id="M001177_title" class="title">
    <b> Iconv.new(to, from)<br />
</b>
  </div>
  <div class="description">
  <p>
Creates new code converter from a coding-system designated with
<tt>from</tt> to another one designated with <tt>to</tt>.
</p>
<h3>Parameters</h3>
<table>
<tr><td valign="top"><tt>to</tt>:</td><td>encoding name for destination

</td></tr>
<tr><td valign="top"><tt>from</tt>:</td><td>encoding name for source

</td></tr>
</table>
<h3>Exceptions</h3>
<table>
<tr><td valign="top"><a href="index.html?a=C00000091&name=TypeError">TypeError</a>:</td><td>if <tt>to</tt> or <tt>from</tt> aren&#8217;t <a
href="index.html?a=C00000055&name=String">String</a>

</td></tr>
<tr><td valign="top"><a href="index.html?a=C00000106&name=InvalidEncoding">InvalidEncoding</a>:</td><td>if designated converter couldn&#8217;t find out

</td></tr>
<tr><td valign="top"><a href="index.html?a=C00000005&name=SystemCallError">SystemCallError</a>:</td><td>if <tt>iconv_open(3)</tt> fails

</td></tr>
</table>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001177_source')" id="l_M001177_source">show source</a> ]</p>
  <div id="M001177_source" class="dyn-source">
<pre>
/*
 * Document-method: new
 * call-seq: Iconv.new(to, from)
 *
 * Creates new code converter from a coding-system designated with +from+
 * to another one designated with +to+.
 * 
 * === Parameters
 *
 * +to+::   encoding name for destination
 * +from+:: encoding name for source
 *
 * === Exceptions
 *
 * TypeError::       if +to+ or +from+ aren't String
 * InvalidEncoding:: if designated converter couldn't find out
 * SystemCallError:: if &lt;tt&gt;iconv_open(3)&lt;/tt&gt; fails
 */
static VALUE
iconv_initialize
    (self, to, from)
    VALUE self;
    VALUE to;
    VALUE from;
{
    iconv_free(check_iconv(self));
    DATA_PTR(self) = NULL;
    DATA_PTR(self) = (void *)ICONV2VALUE(iconv_create(to, from));
    return self;
}
</pre>
  </div>
</div>
</div>
<div id="M001174" class="method">
  <div id="M001174_title" class="title">
    <b> Iconv.open(to, from) { |iconv| ... }<br />
</b>
  </div>
  <div class="description">
  <p>
Equivalent to <a href="index.html?a=M001177&name=Iconv.new">Iconv.new</a>
except that when it is called with a block, it yields with the new instance
and closes it, and returns the result which returned from the block.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001174_source')" id="l_M001174_source">show source</a> ]</p>
  <div id="M001174_source" class="dyn-source">
<pre>
/*
 * Document-method: open
 * call-seq: Iconv.open(to, from) { |iconv| ... }
 *
 * Equivalent to Iconv.new except that when it is called with a block, it
 * yields with the new instance and closes it, and returns the result which
 * returned from the block.
 */
static VALUE
iconv_s_open
    (self, to, from)
    VALUE self;
    VALUE to;
    VALUE from;
{
    VALUE cd = ICONV2VALUE(iconv_create(to, from));

    self = Data_Wrap_Struct(self, NULL, ICONV_FREE, (void *)cd);
    if (rb_block_given_p()) {
        return rb_ensure(rb_yield, self, (VALUE(*)())iconv_finish, self);
    }
    else {
        return self;
    }
}
</pre>
  </div>
</div>
</div>
<div class="sectiontitle">Public Instance methods</div>
<div id="M001178" class="method">
  <div id="M001178_title" class="title">
    <b>close</b>()
  </div>
  <div class="description">
  <p>
Finishes conversion.
</p>
<p>
After calling this, calling <a
href="index.html?a=M001175&name=Iconv#iconv">Iconv#iconv</a> will cause an
exception, but multiple calls of <a
href="index.html?a=M001178&name=close">close</a> are guaranteed to end
successfully.
</p>
<p>
Returns a string containing the byte sequence to change the output buffer
to its initial shift state.
</p>
  </div>
</div>
<div id="M001179" class="method">
  <div id="M001179_title" class="title">
    <b> iconv(str, start=0, length=-1)<br />
</b>
  </div>
  <div class="description">
  <p>
Document-method: <a
href="index.html?a=M001175&name=Iconv#iconv">Iconv#iconv</a>
</p>
<p>
Converts string and returns the result.
</p>
<ul>
<li>If <tt>str</tt> is a <a
href="index.html?a=C00000055&name=String">String</a>, converts
<tt>str[start, length]</tt> and returns the converted string.

</li>
<li>If <tt>str</tt> is <tt>nil</tt>, places converter itself into initial shift
state and just returns a string containing the byte sequence to change the
output buffer to its initial shift state.

</li>
<li>Otherwise, raises an exception.

</li>
</ul>
<h3>Parameters</h3>
<table>
<tr><td valign="top">str:</td><td>string to be converted, or nil

</td></tr>
<tr><td valign="top">start:</td><td>starting offset

</td></tr>
<tr><td valign="top">length:</td><td>conversion length; nil or -1 means whole the string from start

</td></tr>
</table>
<h3>Exceptions</h3>
<ul>
<li>IconvIllegalSequence

</li>
<li>IconvInvalidCharacter

</li>
<li>IconvOutOfRange

</li>
</ul>
<h3>Examples</h3>
<p>
See the <a href="index.html?a=C00000100&name=Iconv">Iconv</a>
documentation.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001179_source')" id="l_M001179_source">show source</a> ]</p>
  <div id="M001179_source" class="dyn-source">
<pre>
/*
 * Document-method: Iconv#iconv
 * call-seq: iconv(str, start=0, length=-1)
 *
 * Converts string and returns the result.
 * * If +str+ is a String, converts &lt;tt&gt;str[start, length]&lt;/tt&gt; and returns the converted string.
 * * If +str+ is +nil+, places converter itself into initial shift state and
 *   just returns a string containing the byte sequence to change the output
 *   buffer to its initial shift state.
 * * Otherwise, raises an exception.
 *
 * === Parameters
 *
 * str::    string to be converted, or nil
 * start::  starting offset
 * length:: conversion length; nil or -1 means whole the string from start
 *
 * === Exceptions
 *
 * * IconvIllegalSequence
 * * IconvInvalidCharacter
 * * IconvOutOfRange
 *
 * === Examples
 *
 * See the Iconv documentation.
 */
static VALUE
iconv_iconv
    (argc, argv, self)
    int argc;
    VALUE *argv;
    VALUE self;
{
    VALUE str, n1, n2;
    VALUE cd = check_iconv(self);
    long start = 0, length = 0, slen = 0;

    rb_scan_args(argc, argv, &quot;12&quot;, &amp;str, &amp;n1, &amp;n2);
    if (!NIL_P(str)) slen = RSTRING_LEN(StringValue(str));
    if (argc != 2 || !RTEST(rb_range_beg_len(n1, &amp;start, &amp;length, slen, 0))) {
        if (NIL_P(n1) || ((start = NUM2LONG(n1)) &lt; 0 ? (start += slen) &gt;= 0 : start &lt; slen)) {
            if (NIL_P(n2)) {
                length = -1;
            }
            else if ((length = NUM2LONG(n2)) &gt;= slen - start) {
                length = slen - start;
            }
        }
    }

    return iconv_convert(VALUE2ICONV(cd), str, start, length, NULL);
}
</pre>
  </div>
</div>
</div>
</div>

  </div>