  <div id="C00001629">
<div class='banner'>
  <span class="file-title-prefix">Module</span><br />Singleton<br/>
  In:
<a href="#" onclick="jsHref('files/ruby-1_8_7-p22/lib/singleton_rb.html');">ruby-1.8.7-p22/lib/singleton.rb</a>

</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">

  <div class="description"><p>
The <a href="index.html?a=C00001629&name=Singleton">Singleton</a> module
implements the <a
href="index.html?a=C00001629&name=Singleton">Singleton</a> pattern.
</p>
<p>
Usage:
</p>
<pre>
   class Klass
      include Singleton
      # ...
   end
</pre>
<ul>
<li>this ensures that only one instance of Klass lets call it ``the
instance&#8217;&#8217; can be created.

<p>
a,b = Klass.instance, Klass.instance a == b # =&gt; true a.new # <a
href="index.html?a=C00000069&name=NoMethodError">NoMethodError</a> - new is
private &#8230;
</p>
</li>
<li>``The instance&#8217;&#8217; is created at instantiation time, in other
words the first call of Klass.instance(), thus

<pre>
  class OtherKlass
    include Singleton
    # ...
  end
  ObjectSpace.each_object(OtherKlass){} # =&gt; 0.
</pre>
</li>
<li>This behavior is preserved under inheritance and cloning.

</li>
</ul>
<p>
This is achieved by marking
</p>
<ul>
<li>Klass.new and Klass.allocate - as private

</li>
</ul>
<p>
Providing (or modifying) the class methods
</p>
<ul>
<li>Klass.inherited(sub_klass) and Klass.clone() - to ensure that the <a
href="index.html?a=C00001629&name=Singleton">Singleton</a> pattern is
properly inherited and cloned.

</li>
<li>Klass.instance() - returning ``the instance&#8217;&#8217;. After a
successful self modifying (normally the first) call the method body is a
simple:

<pre>
   def Klass.instance()
     return @__instance__
   end
</pre>
</li>
<li>Klass._load(str) - calling Klass.instance()

</li>
<li>Klass._instantiate?() - returning ``the instance&#8217;&#8217; or nil. This
hook method puts a second (or nth) thread calling Klass.instance() on a
waiting loop. The return value signifies the successful completion or
premature termination of the first, or more generally, current
&quot;instantiation thread&quot;.

</li>
</ul>
<p>
The instance method of <a
href="index.html?a=C00001629&name=Singleton">Singleton</a> are
</p>
<ul>
<li>clone and dup - raising TypeErrors to prevent cloning or duping

</li>
<li>_dump(depth) - returning the empty string. Marshalling strips by default
all state information, e.g. instance variables and taint state, from ``the
instance&#8217;&#8217;. Providing custom _load(str) and _dump(depth) hooks
allows the (partially) resurrections of a previous state of ``the
instance&#8217;&#8217;.

</li>
</ul>
</div>



  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M008063&name=clone" >clone</a></li>
  <li><a href="index.html?a=M008064&name=dup" >dup</a></li>
  </ul>






<div class="sectiontitle">Public Instance methods</div>
<div id="M008063" class="method">
  <div id="M008063_title" class="title">
    <b>clone</b>()
  </div>
  <div class="description">
  <p>
disable build-in copying methods
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008063_source')" id="l_M008063_source">show source</a> ]</p>
  <div id="M008063_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/singleton.rb, line 67</span>
67:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">clone</span>
68:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-node">&quot;can't clone instance of singleton #{self.class}&quot;</span>
69:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008064" class="method">
  <div id="M008064_title" class="title">
    <b>dup</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008064_source')" id="l_M008064_source">show source</a> ]</p>
  <div id="M008064_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/singleton.rb, line 70</span>
70:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">dup</span>
71:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-node">&quot;can't dup instance of singleton #{self.class}&quot;</span>
72:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>