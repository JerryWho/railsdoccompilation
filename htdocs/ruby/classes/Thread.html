  <div id="C00000029">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />Thread<br/>
  In:
<a href="#" onclick="jsHref('files/ruby-1_8_7-p22/eval_c.html');">ruby-1.8.7-p22/eval.c</a>
<a href="#" onclick="jsHref('files/ruby-1_8_7-p22/lib/thread_rb.html');">ruby-1.8.7-p22/lib/thread.rb</a>

Parent:&nbsp;
        <a href="#" onclick="jsHref('classes/YAML/Object.html');">
Object
         </a>
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">

  <div class="description"><p>
<tt><a href="index.html?a=C00000029&name=Thread">Thread</a></tt>
encapsulates the behavior of a thread of execution, including the main
thread of the Ruby script.
</p>
<p>
In the descriptions of the methods in this class, the parameter
<em>sym</em> refers to a symbol, which is either a quoted string or a
<tt><a href="index.html?a=C00000284&name=Symbol">Symbol</a></tt> (such as
<tt>:name</tt>).
</p>
</div>



  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M000449&name=[]" >[]</a></li>
  <li><a href="index.html?a=M000450&name=[]=" >[]=</a></li>
  <li><a href="index.html?a=M000443&name=abort_on_exception" >abort_on_exception</a></li>
  <li><a href="index.html?a=M000427&name=abort_on_exception" >abort_on_exception</a></li>
  <li><a href="index.html?a=M000428&name=abort_on_exception=" >abort_on_exception=</a></li>
  <li><a href="index.html?a=M000444&name=abort_on_exception=" >abort_on_exception=</a></li>
  <li><a href="index.html?a=M000440&name=alive?" >alive?</a></li>
  <li><a href="index.html?a=M000425&name=critical" >critical</a></li>
  <li><a href="index.html?a=M000426&name=critical=" >critical=</a></li>
  <li><a href="index.html?a=M000422&name=current" >current</a></li>
  <li><a href="index.html?a=M000454&name=exclusive" >exclusive</a></li>
  <li><a href="index.html?a=M000433&name=exit" >exit</a></li>
  <li><a href="index.html?a=M000420&name=exit" >exit</a></li>
  <li><a href="index.html?a=M000436&name=exit!" >exit!</a></li>
  <li><a href="index.html?a=M000417&name=fork" >fork</a></li>
  <li><a href="index.html?a=M000448&name=group" >group</a></li>
  <li><a href="index.html?a=M000453&name=inspect" >inspect</a></li>
  <li><a href="index.html?a=M000439&name=join" >join</a></li>
  <li><a href="index.html?a=M000451&name=key?" >key?</a></li>
  <li><a href="index.html?a=M000452&name=keys" >keys</a></li>
  <li><a href="index.html?a=M000419&name=kill" >kill</a></li>
  <li><a href="index.html?a=M000431&name=kill" >kill</a></li>
  <li><a href="index.html?a=M000434&name=kill!" >kill!</a></li>
  <li><a href="index.html?a=M000424&name=list" >list</a></li>
  <li><a href="index.html?a=M000423&name=main" >main</a></li>
  <li><a href="index.html?a=M000414&name=new" >new</a></li>
  <li><a href="index.html?a=M000415&name=new" >new</a></li>
  <li><a href="index.html?a=M000421&name=pass" >pass</a></li>
  <li><a href="index.html?a=M000445&name=priority" >priority</a></li>
  <li><a href="index.html?a=M000446&name=priority=" >priority=</a></li>
  <li><a href="index.html?a=M000442&name=raise" >raise</a></li>
  <li><a href="index.html?a=M000429&name=run" >run</a></li>
  <li><a href="index.html?a=M000447&name=safe_level" >safe_level</a></li>
  <li><a href="index.html?a=M000416&name=start" >start</a></li>
  <li><a href="index.html?a=M000438&name=status" >status</a></li>
  <li><a href="index.html?a=M000418&name=stop" >stop</a></li>
  <li><a href="index.html?a=M000441&name=stop?" >stop?</a></li>
  <li><a href="index.html?a=M000432&name=terminate" >terminate</a></li>
  <li><a href="index.html?a=M000435&name=terminate!" >terminate!</a></li>
  <li><a href="index.html?a=M000437&name=value" >value</a></li>
  <li><a href="index.html?a=M000430&name=wakeup" >wakeup</a></li>
  </ul>






<div class="sectiontitle">Public Class methods</div>
<div id="M000427" class="method">
  <div id="M000427_title" class="title">
    <b>Thread.abort_on_exception   => true or false<br />
</b>
  </div>
  <div class="description">
  <p>
Returns the status of the global ``abort on exception&#8217;&#8217;
condition. The default is <tt>false</tt>. When set to <tt>true</tt>, or if
the global <tt>$DEBUG</tt> flag is <tt>true</tt> (perhaps because the
command line option <tt>-d</tt> was specified) all threads will abort (the
process will <tt>exit(0)</tt>) if an exception is raised in any thread. See
also <tt>Thread::abort_on_exception=</tt>.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000427_source')" id="l_M000427_source">show source</a> ]</p>
  <div id="M000427_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     Thread.abort_on_exception   =&gt; true or false
 *  
 *  Returns the status of the global ``abort on exception'' condition.  The
 *  default is &lt;code&gt;false&lt;/code&gt;. When set to &lt;code&gt;true&lt;/code&gt;, or if the
 *  global &lt;code&gt;$DEBUG&lt;/code&gt; flag is &lt;code&gt;true&lt;/code&gt; (perhaps because the
 *  command line option &lt;code&gt;-d&lt;/code&gt; was specified) all threads will abort
 *  (the process will &lt;code&gt;exit(0)&lt;/code&gt;) if an exception is raised in any
 *  thread. See also &lt;code&gt;Thread::abort_on_exception=&lt;/code&gt;.
 */

static VALUE
rb_thread_s_abort_exc()
{
    return ruby_thread_abort?Qtrue:Qfalse;
}
</pre>
  </div>
</div>
</div>
<div id="M000428" class="method">
  <div id="M000428_title" class="title">
    <b>Thread.abort_on_exception= boolean   => true or false<br />
</b>
  </div>
  <div class="description">
  <p>
When set to <tt>true</tt>, all threads will abort if an exception is
raised. Returns the new state.
</p>
<pre>
   Thread.abort_on_exception = true
   t1 = Thread.new do
     puts  &quot;In new thread&quot;
     raise &quot;Exception from thread&quot;
   end
   sleep(1)
   puts &quot;not reached&quot;
</pre>
<p>
<em>produces:</em>
</p>
<pre>
   In new thread
   prog.rb:4: Exception from thread (RuntimeError)
    from prog.rb:2:in `initialize'
    from prog.rb:2:in `new'
    from prog.rb:2
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000428_source')" id="l_M000428_source">show source</a> ]</p>
  <div id="M000428_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     Thread.abort_on_exception= boolean   =&gt; true or false
 *  
 *  When set to &lt;code&gt;true&lt;/code&gt;, all threads will abort if an exception is
 *  raised. Returns the new state.
 *     
 *     Thread.abort_on_exception = true
 *     t1 = Thread.new do
 *       puts  &quot;In new thread&quot;
 *       raise &quot;Exception from thread&quot;
 *     end
 *     sleep(1)
 *     puts &quot;not reached&quot;
 *     
 *  &lt;em&gt;produces:&lt;/em&gt;
 *     
 *     In new thread
 *     prog.rb:4: Exception from thread (RuntimeError)
 *      from prog.rb:2:in `initialize'
 *      from prog.rb:2:in `new'
 *      from prog.rb:2
 */

static VALUE
rb_thread_s_abort_exc_set(self, val)
    VALUE self, val;
{
    rb_secure(4);
    ruby_thread_abort = RTEST(val);
    return val;
}
</pre>
  </div>
</div>
</div>
<div id="M000425" class="method">
  <div id="M000425_title" class="title">
    <b>Thread.critical   => true or false<br />
</b>
  </div>
  <div class="description">
  <p>
Returns the status of the global ``thread critical&#8217;&#8217; condition.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000425_source')" id="l_M000425_source">show source</a> ]</p>
  <div id="M000425_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     Thread.critical   =&gt; true or false
 *  
 *  Returns the status of the global ``thread critical'' condition.
 */

static VALUE
rb_thread_critical_get()
{
    return rb_thread_critical?Qtrue:Qfalse;
}
</pre>
  </div>
</div>
</div>
<div id="M000426" class="method">
  <div id="M000426_title" class="title">
    <b>Thread.critical= boolean   => true or false<br />
</b>
  </div>
  <div class="description">
  <p>
Sets the status of the global ``thread critical&#8217;&#8217; condition and
returns it. When set to <tt>true</tt>, prohibits scheduling of any existing
thread. Does not block new threads from being created and run. Certain
thread operations (such as stopping or killing a thread, sleeping in the
current thread, and raising an exception) may cause a thread to be
scheduled even when in a critical section. <tt>Thread::critical</tt> is not
intended for daily use: it is primarily there to support folks writing
threading libraries.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000426_source')" id="l_M000426_source">show source</a> ]</p>
  <div id="M000426_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     Thread.critical= boolean   =&gt; true or false
 *  
 *  Sets the status of the global ``thread critical'' condition and returns
 *  it. When set to &lt;code&gt;true&lt;/code&gt;, prohibits scheduling of any existing
 *  thread. Does not block new threads from being created and run. Certain
 *  thread operations (such as stopping or killing a thread, sleeping in the
 *  current thread, and raising an exception) may cause a thread to be scheduled
 *  even when in a critical section.  &lt;code&gt;Thread::critical&lt;/code&gt; is not
 *  intended for daily use: it is primarily there to support folks writing
 *  threading libraries.
 */

static VALUE
rb_thread_critical_set(obj, val)
    VALUE obj, val;
{
    rb_thread_critical = RTEST(val);
    return val;
}
</pre>
  </div>
</div>
</div>
<div id="M000422" class="method">
  <div id="M000422_title" class="title">
    <b>Thread.current   => thread<br />
</b>
  </div>
  <div class="description">
  <p>
Returns the currently executing thread.
</p>
<pre>
   Thread.current   #=&gt; #&lt;Thread:0x401bdf4c run&gt;
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000422_source')" id="l_M000422_source">show source</a> ]</p>
  <div id="M000422_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     Thread.current   =&gt; thread
 *  
 *  Returns the currently executing thread.
 *     
 *     Thread.current   #=&gt; #&lt;Thread:0x401bdf4c run&gt;
 */

VALUE
rb_thread_current()
{
    return curr_thread-&gt;thread;
}
</pre>
  </div>
</div>
</div>
<div id="M000454" class="method">
  <div id="M000454_title" class="title">
    <b>exclusive</b>() {|| ...}
  </div>
  <div class="description">
  <p>
Wraps a block in <a
href="index.html?a=M000425&name=Thread.critical">Thread.critical</a>,
restoring the original value upon exit from the critical section.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000454_source')" id="l_M000454_source">show source</a> ]</p>
  <div id="M000454_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/thread.rb, line 24</span>
24:   <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">exclusive</span>
25:     <span class="ruby-identifier">_old</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">critical</span>
26:     <span class="ruby-keyword kw">begin</span>
27:       <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">critical</span> = <span class="ruby-keyword kw">true</span>
28:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">yield</span>
29:     <span class="ruby-keyword kw">ensure</span>
30:       <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">critical</span> = <span class="ruby-identifier">_old</span>
31:     <span class="ruby-keyword kw">end</span>
32:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000420" class="method">
  <div id="M000420_title" class="title">
    <b>Thread.exit   => thread<br />
</b>
  </div>
  <div class="description">
  <p>
Terminates the currently running thread and schedules another thread to be
run. If this thread is already marked to be killed, <tt>exit</tt> returns
the <tt><a href="index.html?a=C00000029&name=Thread">Thread</a></tt>. If
this is the main thread, or the last thread, exit the process.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000420_source')" id="l_M000420_source">show source</a> ]</p>
  <div id="M000420_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     Thread.exit   =&gt; thread
 *  
 *  Terminates the currently running thread and schedules another thread to be
 *  run. If this thread is already marked to be killed, &lt;code&gt;exit&lt;/code&gt;
 *  returns the &lt;code&gt;Thread&lt;/code&gt;. If this is the main thread, or the last
 *  thread, exit the process.
 */

static VALUE
rb_thread_exit()
{
    return rb_thread_kill(curr_thread-&gt;thread);
}
</pre>
  </div>
</div>
</div>
<div id="M000417" class="method">
  <div id="M000417_title" class="title">
    <b>Thread.start([args]*) {|args| block }   => thread<br />
Thread.fork([args]*) {|args| block }    => thread<br />
</b>
  </div>
  <div class="description">
  <p>
Basically the same as <tt>Thread::new</tt>. However, if class <tt><a
href="index.html?a=C00000029&name=Thread">Thread</a></tt> is subclassed,
then calling <tt>start</tt> in that subclass will not invoke the
subclass&#8217;s <tt>initialize</tt> method.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000417_source')" id="l_M000417_source">show source</a> ]</p>
  <div id="M000417_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     Thread.start([args]*) {|args| block }   =&gt; thread
 *     Thread.fork([args]*) {|args| block }    =&gt; thread
 *  
 *  Basically the same as &lt;code&gt;Thread::new&lt;/code&gt;. However, if class
 *  &lt;code&gt;Thread&lt;/code&gt; is subclassed, then calling &lt;code&gt;start&lt;/code&gt; in that
 *  subclass will not invoke the subclass's &lt;code&gt;initialize&lt;/code&gt; method.
 */

static VALUE
rb_thread_start(klass, args)
    VALUE klass, args;
{
    if (!rb_block_given_p()) {
        rb_raise(rb_eThreadError, &quot;must be called with a block&quot;);
    }
    return rb_thread_start_0(rb_thread_yield, args, rb_thread_alloc(klass));
}
</pre>
  </div>
</div>
</div>
<div id="M000419" class="method">
  <div id="M000419_title" class="title">
    <b>Thread.kill(thread)   => thread<br />
</b>
  </div>
  <div class="description">
  <p>
Causes the given <em>thread</em> to exit (see <tt>Thread::exit</tt>).
</p>
<pre>
   count = 0
   a = Thread.new { loop { count += 1 } }
   sleep(0.1)       #=&gt; 0
   Thread.kill(a)   #=&gt; #&lt;Thread:0x401b3d30 dead&gt;
   count            #=&gt; 93947
   a.alive?         #=&gt; false
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000419_source')" id="l_M000419_source">show source</a> ]</p>
  <div id="M000419_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     Thread.kill(thread)   =&gt; thread
 *  
 *  Causes the given &lt;em&gt;thread&lt;/em&gt; to exit (see &lt;code&gt;Thread::exit&lt;/code&gt;).
 *     
 *     count = 0
 *     a = Thread.new { loop { count += 1 } }
 *     sleep(0.1)       #=&gt; 0
 *     Thread.kill(a)   #=&gt; #&lt;Thread:0x401b3d30 dead&gt;
 *     count            #=&gt; 93947
 *     a.alive?         #=&gt; false
 */

static VALUE
rb_thread_s_kill(obj, th)
    VALUE obj, th;
{
    return rb_thread_kill(th);
}
</pre>
  </div>
</div>
</div>
<div id="M000424" class="method">
  <div id="M000424_title" class="title">
    <b>Thread.list   => array<br />
</b>
  </div>
  <div class="description">
  <p>
Returns an array of <tt><a
href="index.html?a=C00000029&name=Thread">Thread</a></tt> objects for all
threads that are either runnable or stopped.
</p>
<pre>
   Thread.new { sleep(200) }
   Thread.new { 1000000.times {|i| i*i } }
   Thread.new { Thread.stop }
   Thread.list.each {|t| p t}
</pre>
<p>
<em>produces:</em>
</p>
<pre>
   #&lt;Thread:0x401b3e84 sleep&gt;
   #&lt;Thread:0x401b3f38 run&gt;
   #&lt;Thread:0x401b3fb0 sleep&gt;
   #&lt;Thread:0x401bdf4c run&gt;
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000424_source')" id="l_M000424_source">show source</a> ]</p>
  <div id="M000424_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     Thread.list   =&gt; array
 *  
 *  Returns an array of &lt;code&gt;Thread&lt;/code&gt; objects for all threads that are
 *  either runnable or stopped.
 *     
 *     Thread.new { sleep(200) }
 *     Thread.new { 1000000.times {|i| i*i } }
 *     Thread.new { Thread.stop }
 *     Thread.list.each {|t| p t}
 *     
 *  &lt;em&gt;produces:&lt;/em&gt;
 *     
 *     #&lt;Thread:0x401b3e84 sleep&gt;
 *     #&lt;Thread:0x401b3f38 run&gt;
 *     #&lt;Thread:0x401b3fb0 sleep&gt;
 *     #&lt;Thread:0x401bdf4c run&gt;
 */

VALUE
rb_thread_list()
{
    rb_thread_t th;
    VALUE ary = rb_ary_new();

    FOREACH_THREAD(th) {
        switch (th-&gt;status) {
          case THREAD_RUNNABLE:
          case THREAD_STOPPED:
          case THREAD_TO_KILL:
            rb_ary_push(ary, th-&gt;thread);
          default:
            break;
        }
    }
    END_FOREACH(th);

    return ary;
}
</pre>
  </div>
</div>
</div>
<div id="M000423" class="method">
  <div id="M000423_title" class="title">
    <b>Thread.main   => thread<br />
</b>
  </div>
  <div class="description">
  <p>
Returns the main thread for the process.
</p>
<pre>
   Thread.main   #=&gt; #&lt;Thread:0x401bdf4c run&gt;
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000423_source')" id="l_M000423_source">show source</a> ]</p>
  <div id="M000423_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     Thread.main   =&gt; thread
 *  
 *  Returns the main thread for the process.
 *     
 *     Thread.main   #=&gt; #&lt;Thread:0x401bdf4c run&gt;
 */

VALUE
rb_thread_main()
{
    return main_thread-&gt;thread;
}
</pre>
  </div>
</div>
</div>
<div id="M000414" class="method">
  <div id="M000414_title" class="title">
    <b>Thread.new([arg]*) {|args| block }   => thread<br />
</b>
  </div>
  <div class="description">
  <p>
Creates and runs a new thread to execute the instructions given in
<em>block</em>. Any arguments passed to <tt>Thread::new</tt> are passed
into the block.
</p>
<pre>
   x = Thread.new { sleep 0.1; print &quot;x&quot;; print &quot;y&quot;; print &quot;z&quot; }
   a = Thread.new { print &quot;a&quot;; print &quot;b&quot;; sleep 0.2; print &quot;c&quot; }
   x.join # Let the threads finish before
   a.join # main thread exits...
</pre>
<p>
<em>produces:</em>
</p>
<pre>
   abxyzc
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000414_source')" id="l_M000414_source">show source</a> ]</p>
  <div id="M000414_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     Thread.new([arg]*) {|args| block }   =&gt; thread
 *  
 *  Creates and runs a new thread to execute the instructions given in
 *  &lt;i&gt;block&lt;/i&gt;. Any arguments passed to &lt;code&gt;Thread::new&lt;/code&gt; are passed
 *  into the block.
 *     
 *     x = Thread.new { sleep 0.1; print &quot;x&quot;; print &quot;y&quot;; print &quot;z&quot; }
 *     a = Thread.new { print &quot;a&quot;; print &quot;b&quot;; sleep 0.2; print &quot;c&quot; }
 *     x.join # Let the threads finish before
 *     a.join # main thread exits...
 *     
 *  &lt;em&gt;produces:&lt;/em&gt;
 *     
 *     abxyzc
 */

static VALUE
rb_thread_s_new(argc, argv, klass)
    int argc;
    VALUE *argv;
    VALUE klass;
{
    rb_thread_t th = rb_thread_alloc(klass);
    volatile VALUE *pos;

    pos = th-&gt;stk_pos;
    rb_obj_call_init(th-&gt;thread, argc, argv);
    if (th-&gt;stk_pos == 0) {
        rb_raise(rb_eThreadError, &quot;uninitialized thread - check `%s#initialize'&quot;,
                 rb_class2name(klass));
    }

    return th-&gt;thread;
}
</pre>
  </div>
</div>
</div>
<div id="M000415" class="method">
  <div id="M000415_title" class="title">
    <b>Thread.new([arg]*) {|args| block }   => thread<br />
</b>
  </div>
  <div class="description">
  <p>
Creates and runs a new thread to execute the instructions given in
<em>block</em>. Any arguments passed to <tt>Thread::new</tt> are passed
into the block.
</p>
<pre>
   x = Thread.new { sleep 0.1; print &quot;x&quot;; print &quot;y&quot;; print &quot;z&quot; }
   a = Thread.new { print &quot;a&quot;; print &quot;b&quot;; sleep 0.2; print &quot;c&quot; }
   x.join # Let the threads finish before
   a.join # main thread exits...
</pre>
<p>
<em>produces:</em>
</p>
<pre>
   abxyzc
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000415_source')" id="l_M000415_source">show source</a> ]</p>
  <div id="M000415_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     Thread.new([arg]*) {|args| block }   =&gt; thread
 *  
 *  Creates and runs a new thread to execute the instructions given in
 *  &lt;i&gt;block&lt;/i&gt;. Any arguments passed to &lt;code&gt;Thread::new&lt;/code&gt; are passed
 *  into the block.
 *     
 *     x = Thread.new { sleep 0.1; print &quot;x&quot;; print &quot;y&quot;; print &quot;z&quot; }
 *     a = Thread.new { print &quot;a&quot;; print &quot;b&quot;; sleep 0.2; print &quot;c&quot; }
 *     x.join # Let the threads finish before
 *     a.join # main thread exits...
 *     
 *  &lt;em&gt;produces:&lt;/em&gt;
 *     
 *     abxyzc
 */

static VALUE
rb_thread_initialize(thread, args)
    VALUE thread, args;
{
    rb_thread_t th;

    if (!rb_block_given_p()) {
        rb_raise(rb_eThreadError, &quot;must be called with a block&quot;);
    }
    th = rb_thread_check(thread);
    if (th-&gt;stk_max) {
        NODE *node = th-&gt;node;
        if (!node) {
            rb_raise(rb_eThreadError, &quot;already initialized thread&quot;);
        }
        rb_raise(rb_eThreadError, &quot;already initialized thread - %s:%d&quot;,
                 node-&gt;nd_file, nd_line(node));
    }
    return rb_thread_start_0(rb_thread_yield, args, th);
}
</pre>
  </div>
</div>
</div>
<div id="M000421" class="method">
  <div id="M000421_title" class="title">
    <b>Thread.pass   => nil<br />
</b>
  </div>
  <div class="description">
  <p>
Invokes the thread scheduler to pass execution to another thread.
</p>
<pre>
   a = Thread.new { print &quot;a&quot;; Thread.pass;
                    print &quot;b&quot;; Thread.pass;
                    print &quot;c&quot; }
   b = Thread.new { print &quot;x&quot;; Thread.pass;
                    print &quot;y&quot;; Thread.pass;
                    print &quot;z&quot; }
   a.join
   b.join
</pre>
<p>
<em>produces:</em>
</p>
<pre>
   axbycz
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000421_source')" id="l_M000421_source">show source</a> ]</p>
  <div id="M000421_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     Thread.pass   =&gt; nil
 *  
 *  Invokes the thread scheduler to pass execution to another thread.
 *     
 *     a = Thread.new { print &quot;a&quot;; Thread.pass;
 *                      print &quot;b&quot;; Thread.pass;
 *                      print &quot;c&quot; }
 *     b = Thread.new { print &quot;x&quot;; Thread.pass;
 *                      print &quot;y&quot;; Thread.pass;
 *                      print &quot;z&quot; }
 *     a.join
 *     b.join
 *     
 *  &lt;em&gt;produces:&lt;/em&gt;
 *     
 *     axbycz
 */

static VALUE
rb_thread_pass()
{
    rb_thread_schedule();
    return Qnil;
}
</pre>
  </div>
</div>
</div>
<div id="M000416" class="method">
  <div id="M000416_title" class="title">
    <b>Thread.start([args]*) {|args| block }   => thread<br />
Thread.fork([args]*) {|args| block }    => thread<br />
</b>
  </div>
  <div class="description">
  <p>
Basically the same as <tt>Thread::new</tt>. However, if class <tt><a
href="index.html?a=C00000029&name=Thread">Thread</a></tt> is subclassed,
then calling <tt>start</tt> in that subclass will not invoke the
subclass&#8217;s <tt>initialize</tt> method.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000416_source')" id="l_M000416_source">show source</a> ]</p>
  <div id="M000416_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     Thread.start([args]*) {|args| block }   =&gt; thread
 *     Thread.fork([args]*) {|args| block }    =&gt; thread
 *  
 *  Basically the same as &lt;code&gt;Thread::new&lt;/code&gt;. However, if class
 *  &lt;code&gt;Thread&lt;/code&gt; is subclassed, then calling &lt;code&gt;start&lt;/code&gt; in that
 *  subclass will not invoke the subclass's &lt;code&gt;initialize&lt;/code&gt; method.
 */

static VALUE
rb_thread_start(klass, args)
    VALUE klass, args;
{
    if (!rb_block_given_p()) {
        rb_raise(rb_eThreadError, &quot;must be called with a block&quot;);
    }
    return rb_thread_start_0(rb_thread_yield, args, rb_thread_alloc(klass));
}
</pre>
  </div>
</div>
</div>
<div id="M000418" class="method">
  <div id="M000418_title" class="title">
    <b>Thread.stop   => nil<br />
</b>
  </div>
  <div class="description">
  <p>
Stops execution of the current thread, putting it into a
``sleep&#8217;&#8217; state, and schedules execution of another thread.
Resets the ``critical&#8217;&#8217; condition to <tt>false</tt>.
</p>
<pre>
   a = Thread.new { print &quot;a&quot;; Thread.stop; print &quot;c&quot; }
   Thread.pass
   print &quot;b&quot;
   a.run
   a.join
</pre>
<p>
<em>produces:</em>
</p>
<pre>
   abc
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000418_source')" id="l_M000418_source">show source</a> ]</p>
  <div id="M000418_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     Thread.stop   =&gt; nil
 *  
 *  Stops execution of the current thread, putting it into a ``sleep'' state,
 *  and schedules execution of another thread. Resets the ``critical'' condition
 *  to &lt;code&gt;false&lt;/code&gt;.
 *     
 *     a = Thread.new { print &quot;a&quot;; Thread.stop; print &quot;c&quot; }
 *     Thread.pass
 *     print &quot;b&quot;
 *     a.run
 *     a.join
 *     
 *  &lt;em&gt;produces:&lt;/em&gt;
 *     
 *     abc
 */

VALUE
rb_thread_stop()
{
    enum rb_thread_status last_status = THREAD_RUNNABLE;

    rb_thread_critical = 0;
    if (curr_thread == curr_thread-&gt;next) {
        rb_raise(rb_eThreadError, &quot;stopping only thread\n\tnote: use sleep to stop forever&quot;);
    }
    if (curr_thread-&gt;status == THREAD_TO_KILL)
        last_status = THREAD_TO_KILL;
    curr_thread-&gt;status = THREAD_STOPPED;
    rb_thread_schedule();
    curr_thread-&gt;status = last_status;

    return Qnil;
}
</pre>
  </div>
</div>
</div>
<div class="sectiontitle">Public Instance methods</div>
<div id="M000449" class="method">
  <div id="M000449_title" class="title">
    <b>thr[sym]   => obj or nil<br />
</b>
  </div>
  <div class="description">
  <p>
Attribute Reference&#8212;Returns the value of a thread-local variable,
using either a symbol or a string name. If the specified variable does not
exist, returns <tt>nil</tt>.
</p>
<pre>
   a = Thread.new { Thread.current[&quot;name&quot;] = &quot;A&quot;; Thread.stop }
   b = Thread.new { Thread.current[:name]  = &quot;B&quot;; Thread.stop }
   c = Thread.new { Thread.current[&quot;name&quot;] = &quot;C&quot;; Thread.stop }
   Thread.list.each {|x| puts &quot;#{x.inspect}: #{x[:name]}&quot; }
</pre>
<p>
<em>produces:</em>
</p>
<pre>
   #&lt;Thread:0x401b3b3c sleep&gt;: C
   #&lt;Thread:0x401b3bc8 sleep&gt;: B
   #&lt;Thread:0x401b3c68 sleep&gt;: A
   #&lt;Thread:0x401bdf4c run&gt;:
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000449_source')" id="l_M000449_source">show source</a> ]</p>
  <div id="M000449_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *      thr[sym]   =&gt; obj or nil
 *  
 *  Attribute Reference---Returns the value of a thread-local variable, using
 *  either a symbol or a string name. If the specified variable does not exist,
 *  returns &lt;code&gt;nil&lt;/code&gt;.
 *     
 *     a = Thread.new { Thread.current[&quot;name&quot;] = &quot;A&quot;; Thread.stop }
 *     b = Thread.new { Thread.current[:name]  = &quot;B&quot;; Thread.stop }
 *     c = Thread.new { Thread.current[&quot;name&quot;] = &quot;C&quot;; Thread.stop }
 *     Thread.list.each {|x| puts &quot;#{x.inspect}: #{x[:name]}&quot; }
 *     
 *  &lt;em&gt;produces:&lt;/em&gt;
 *     
 *     #&lt;Thread:0x401b3b3c sleep&gt;: C
 *     #&lt;Thread:0x401b3bc8 sleep&gt;: B
 *     #&lt;Thread:0x401b3c68 sleep&gt;: A
 *     #&lt;Thread:0x401bdf4c run&gt;:
 */

static VALUE
rb_thread_aref(thread, id)
    VALUE thread, id;
{
    return rb_thread_local_aref(thread, rb_to_id(id));
}
</pre>
  </div>
</div>
</div>
<div id="M000450" class="method">
  <div id="M000450_title" class="title">
    <b>thr[sym] = obj   => obj<br />
</b>
  </div>
  <div class="description">
  <p>
Attribute Assignment&#8212;Sets or creates the value of a thread-local
variable, using either a symbol or a string. See also <tt><a
href="index.html?a=C00000029&name=Thread">Thread</a>#[]</tt>.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000450_source')" id="l_M000450_source">show source</a> ]</p>
  <div id="M000450_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *      thr[sym] = obj   =&gt; obj
 *  
 *  Attribute Assignment---Sets or creates the value of a thread-local variable,
 *  using either a symbol or a string. See also &lt;code&gt;Thread#[]&lt;/code&gt;.
 */

static VALUE
rb_thread_aset(thread, id, val)
    VALUE thread, id, val;
{
    return rb_thread_local_aset(thread, rb_to_id(id), val);
}
</pre>
  </div>
</div>
</div>
<div id="M000443" class="method">
  <div id="M000443_title" class="title">
    <b>thr.abort_on_exception   => true or false<br />
</b>
  </div>
  <div class="description">
  <p>
Returns the status of the thread-local ``abort on exception&#8217;&#8217;
condition for <em>thr</em>. The default is <tt>false</tt>. See also
<tt>Thread::abort_on_exception=</tt>.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000443_source')" id="l_M000443_source">show source</a> ]</p>
  <div id="M000443_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     thr.abort_on_exception   =&gt; true or false
 *  
 *  Returns the status of the thread-local ``abort on exception'' condition for
 *  &lt;i&gt;thr&lt;/i&gt;. The default is &lt;code&gt;false&lt;/code&gt;. See also
 *  &lt;code&gt;Thread::abort_on_exception=&lt;/code&gt;.
 */

static VALUE
rb_thread_abort_exc(thread)
    VALUE thread;
{
    return rb_thread_check(thread)-&gt;abort?Qtrue:Qfalse;
}
</pre>
  </div>
</div>
</div>
<div id="M000444" class="method">
  <div id="M000444_title" class="title">
    <b>thr.abort_on_exception= boolean   => true or false<br />
</b>
  </div>
  <div class="description">
  <p>
When set to <tt>true</tt>, causes all threads (including the main program)
to abort if an exception is raised in <em>thr</em>. The process will
effectively <tt>exit(0)</tt>.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000444_source')" id="l_M000444_source">show source</a> ]</p>
  <div id="M000444_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     thr.abort_on_exception= boolean   =&gt; true or false
 *  
 *  When set to &lt;code&gt;true&lt;/code&gt;, causes all threads (including the main
 *  program) to abort if an exception is raised in &lt;i&gt;thr&lt;/i&gt;. The process will
 *  effectively &lt;code&gt;exit(0)&lt;/code&gt;.
 */

static VALUE
rb_thread_abort_exc_set(thread, val)
    VALUE thread, val;
{
    rb_secure(4);
    rb_thread_check(thread)-&gt;abort = RTEST(val);
    return val;
}
</pre>
  </div>
</div>
</div>
<div id="M000440" class="method">
  <div id="M000440_title" class="title">
    <b>thr.alive?   => true or false<br />
</b>
  </div>
  <div class="description">
  <p>
Returns <tt>true</tt> if <em>thr</em> is running or sleeping.
</p>
<pre>
   thr = Thread.new { }
   thr.join                #=&gt; #&lt;Thread:0x401b3fb0 dead&gt;
   Thread.current.alive?   #=&gt; true
   thr.alive?              #=&gt; false
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000440_source')" id="l_M000440_source">show source</a> ]</p>
  <div id="M000440_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     thr.alive?   =&gt; true or false
 *  
 *  Returns &lt;code&gt;true&lt;/code&gt; if &lt;i&gt;thr&lt;/i&gt; is running or sleeping.
 *     
 *     thr = Thread.new { }
 *     thr.join                #=&gt; #&lt;Thread:0x401b3fb0 dead&gt;
 *     Thread.current.alive?   #=&gt; true
 *     thr.alive?              #=&gt; false
 */

VALUE
rb_thread_alive_p(thread)
    VALUE thread;
{
    rb_thread_t th = rb_thread_check(thread);

    if (rb_thread_dead(th)) return Qfalse;
    return Qtrue;
}
</pre>
  </div>
</div>
</div>
<div id="M000433" class="method">
  <div id="M000433_title" class="title">
    <b>thr.exit        => thr<br />
thr.kill        => thr<br />
thr.terminate   => thr<br />
</b>
  </div>
  <div class="description">
  <p>
Terminates <em>thr</em> and schedules another thread to be run, returning
the terminated <tt><a
href="index.html?a=C00000029&name=Thread">Thread</a></tt>. If this is the
main thread, or the last thread, exits the process.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000433_source')" id="l_M000433_source">show source</a> ]</p>
  <div id="M000433_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     thr.exit        =&gt; thr
 *     thr.kill        =&gt; thr
 *     thr.terminate   =&gt; thr
 *  
 *  Terminates &lt;i&gt;thr&lt;/i&gt; and schedules another thread to be run, returning
 *  the terminated &lt;code&gt;Thread&lt;/code&gt;.  If this is the main thread, or the
 *  last thread, exits the process.
 */

VALUE
rb_thread_kill(thread)
    VALUE thread;
{
    rb_thread_t th = rb_thread_check(thread);

    rb_kill_thread(th, 0);
    return thread;
}
</pre>
  </div>
</div>
</div>
<div id="M000436" class="method">
  <div id="M000436_title" class="title">
    <b>thr.exit!        => thr<br />
thr.kill!        => thr<br />
thr.terminate!   => thr<br />
</b>
  </div>
  <div class="description">
  <p>
Terminates <em>thr</em> without calling ensure clauses and schedules
another thread to be run, returning the terminated <tt><a
href="index.html?a=C00000029&name=Thread">Thread</a></tt>. If this is the
main thread, or the last thread, exits the process.
</p>
<p>
See <tt><a
href="index.html?a=M000420&name=Thread#exit">Thread#exit</a></tt> for the
safer version.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000436_source')" id="l_M000436_source">show source</a> ]</p>
  <div id="M000436_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     thr.exit!        =&gt; thr
 *     thr.kill!        =&gt; thr
 *     thr.terminate!   =&gt; thr
 *  
 *  Terminates &lt;i&gt;thr&lt;/i&gt; without calling ensure clauses and schedules
 *  another thread to be run, returning the terminated &lt;code&gt;Thread&lt;/code&gt;.
 *  If this is the main thread, or the last thread, exits the process.
 *
 *  See &lt;code&gt;Thread#exit&lt;/code&gt; for the safer version.
 */

static VALUE
rb_thread_kill_bang(thread)
    VALUE thread;
{
    rb_thread_t th = rb_thread_check(thread);
    rb_kill_thread(th, THREAD_NO_ENSURE);
    return thread;
}
</pre>
  </div>
</div>
</div>
<div id="M000448" class="method">
  <div id="M000448_title" class="title">
    <b>thr.group   => thgrp or nil<br />
</b>
  </div>
  <div class="description">
  <p>
Returns the <tt><a
href="index.html?a=C00000226&name=ThreadGroup">ThreadGroup</a></tt> which
contains <em>thr</em>, or nil if the thread is not a member of any group.
</p>
<pre>
   Thread.main.group   #=&gt; #&lt;ThreadGroup:0x4029d914&gt;
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000448_source')" id="l_M000448_source">show source</a> ]</p>
  <div id="M000448_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     thr.group   =&gt; thgrp or nil
 *  
 *  Returns the &lt;code&gt;ThreadGroup&lt;/code&gt; which contains &lt;i&gt;thr&lt;/i&gt;, or nil if
 *  the thread is not a member of any group.
 *     
 *     Thread.main.group   #=&gt; #&lt;ThreadGroup:0x4029d914&gt;
 */

VALUE
rb_thread_group(thread)
    VALUE thread;
{
    VALUE group = rb_thread_check(thread)-&gt;thgroup;
    if (!group) {
        group = Qnil;
    }
    return group;
}
</pre>
  </div>
</div>
</div>
<div id="M000453" class="method">
  <div id="M000453_title" class="title">
    <b>thr.inspect   => string<br />
</b>
  </div>
  <div class="description">
  <p>
Dump the name, id, and status of <em>thr</em> to a string.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000453_source')" id="l_M000453_source">show source</a> ]</p>
  <div id="M000453_source" class="dyn-source">
<pre>
/*
 * call-seq:
 *   thr.inspect   =&gt; string
 *
 * Dump the name, id, and status of _thr_ to a string.
 */

static VALUE
rb_thread_inspect(thread)
    VALUE thread;
{
    const char *cname = rb_obj_classname(thread);
    rb_thread_t th = rb_thread_check(thread);
    const char *status = thread_status_name(th-&gt;status);
    VALUE str;
    size_t len = strlen(cname)+7+16+9+1;

    str = rb_str_new(0, len); /* 7:tags 16:addr 9:status 1:nul */
    snprintf(RSTRING(str)-&gt;ptr, len, &quot;#&lt;%s:0x%lx %s&gt;&quot;, cname, thread, status);
    RSTRING(str)-&gt;len = strlen(RSTRING(str)-&gt;ptr);
    OBJ_INFECT(str, thread);

    return str;
}
</pre>
  </div>
</div>
</div>
<div id="M000439" class="method">
  <div id="M000439_title" class="title">
    <b>thr.join          => thr<br />
thr.join(limit)   => thr<br />
</b>
  </div>
  <div class="description">
  <p>
The calling thread will suspend execution and run <em>thr</em>. Does not
return until <em>thr</em> exits or until <em>limit</em> seconds have
passed. If the time limit expires, <tt>nil</tt> will be returned, otherwise
<em>thr</em> is returned.
</p>
<p>
Any threads not joined will be killed when the main program exits. If
<em>thr</em> had previously raised an exception and the <tt><a
href="index.html?a=M000427&name=abort_on_exception">abort_on_exception</a></tt>
and <tt>$DEBUG</tt> flags are not set (so the exception has not yet been
processed) it will be processed at this time.
</p>
<pre>
   a = Thread.new { print &quot;a&quot;; sleep(10); print &quot;b&quot;; print &quot;c&quot; }
   x = Thread.new { print &quot;x&quot;; Thread.pass; print &quot;y&quot;; print &quot;z&quot; }
   x.join # Let x thread finish, a will be killed on exit.
</pre>
<p>
<em>produces:</em>
</p>
<pre>
   axyz
</pre>
<p>
The following example illustrates the <em>limit</em> parameter.
</p>
<pre>
   y = Thread.new { 4.times { sleep 0.1; puts 'tick... ' }}
   puts &quot;Waiting&quot; until y.join(0.15)
</pre>
<p>
<em>produces:</em>
</p>
<pre>
   tick...
   Waiting
   tick...
   Waitingtick...

   tick...
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000439_source')" id="l_M000439_source">show source</a> ]</p>
  <div id="M000439_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     thr.join          =&gt; thr
 *     thr.join(limit)   =&gt; thr
 *  
 *  The calling thread will suspend execution and run &lt;i&gt;thr&lt;/i&gt;. Does not
 *  return until &lt;i&gt;thr&lt;/i&gt; exits or until &lt;i&gt;limit&lt;/i&gt; seconds have passed. If
 *  the time limit expires, &lt;code&gt;nil&lt;/code&gt; will be returned, otherwise
 *  &lt;i&gt;thr&lt;/i&gt; is returned.
 *     
 *  Any threads not joined will be killed when the main program exits.  If
 *  &lt;i&gt;thr&lt;/i&gt; had previously raised an exception and the
 *  &lt;code&gt;abort_on_exception&lt;/code&gt; and &lt;code&gt;$DEBUG&lt;/code&gt; flags are not set
 *  (so the exception has not yet been processed) it will be processed at this
 *  time.
 *     
 *     a = Thread.new { print &quot;a&quot;; sleep(10); print &quot;b&quot;; print &quot;c&quot; }
 *     x = Thread.new { print &quot;x&quot;; Thread.pass; print &quot;y&quot;; print &quot;z&quot; }
 *     x.join # Let x thread finish, a will be killed on exit.
 *     
 *  &lt;em&gt;produces:&lt;/em&gt;
 *     
 *     axyz
 *     
 *  The following example illustrates the &lt;i&gt;limit&lt;/i&gt; parameter.
 *     
 *     y = Thread.new { 4.times { sleep 0.1; puts 'tick... ' }}
 *     puts &quot;Waiting&quot; until y.join(0.15)
 *     
 *  &lt;em&gt;produces:&lt;/em&gt;
 *     
 *     tick...
 *     Waiting
 *     tick...
 *     Waitingtick...
 *     
 *     
 *     tick...
 */

static VALUE
rb_thread_join_m(argc, argv, thread)
    int argc;
    VALUE *argv;
    VALUE thread;
{
    VALUE limit;
    double delay = DELAY_INFTY;
    rb_thread_t th = rb_thread_check(thread);

    rb_scan_args(argc, argv, &quot;01&quot;, &amp;limit);
    if (!NIL_P(limit)) delay = rb_num2dbl(limit);
    if (!rb_thread_join(th, delay))
        return Qnil;
    return thread;
}
</pre>
  </div>
</div>
</div>
<div id="M000451" class="method">
  <div id="M000451_title" class="title">
    <b>thr.key?(sym)   => true or false<br />
</b>
  </div>
  <div class="description">
  <p>
Returns <tt>true</tt> if the given string (or symbol) exists as a
thread-local variable.
</p>
<pre>
   me = Thread.current
   me[:oliver] = &quot;a&quot;
   me.key?(:oliver)    #=&gt; true
   me.key?(:stanley)   #=&gt; false
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000451_source')" id="l_M000451_source">show source</a> ]</p>
  <div id="M000451_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     thr.key?(sym)   =&gt; true or false
 *  
 *  Returns &lt;code&gt;true&lt;/code&gt; if the given string (or symbol) exists as a
 *  thread-local variable.
 *     
 *     me = Thread.current
 *     me[:oliver] = &quot;a&quot;
 *     me.key?(:oliver)    #=&gt; true
 *     me.key?(:stanley)   #=&gt; false
 */

static VALUE
rb_thread_key_p(thread, id)
    VALUE thread, id;
{
    rb_thread_t th = rb_thread_check(thread);

    if (!th-&gt;locals) return Qfalse;
    if (st_lookup(th-&gt;locals, rb_to_id(id), 0))
        return Qtrue;
    return Qfalse;
}
</pre>
  </div>
</div>
</div>
<div id="M000452" class="method">
  <div id="M000452_title" class="title">
    <b>thr.keys   => array<br />
</b>
  </div>
  <div class="description">
  <p>
Returns an an array of the names of the thread-local variables (as
Symbols).
</p>
<pre>
   thr = Thread.new do
     Thread.current[:cat] = 'meow'
     Thread.current[&quot;dog&quot;] = 'woof'
   end
   thr.join   #=&gt; #&lt;Thread:0x401b3f10 dead&gt;
   thr.keys   #=&gt; [:dog, :cat]
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000452_source')" id="l_M000452_source">show source</a> ]</p>
  <div id="M000452_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     thr.keys   =&gt; array
 *  
 *  Returns an an array of the names of the thread-local variables (as Symbols).
 *     
 *     thr = Thread.new do
 *       Thread.current[:cat] = 'meow'
 *       Thread.current[&quot;dog&quot;] = 'woof'
 *     end
 *     thr.join   #=&gt; #&lt;Thread:0x401b3f10 dead&gt;
 *     thr.keys   #=&gt; [:dog, :cat]
 */

static VALUE
rb_thread_keys(thread)
    VALUE thread;
{
    rb_thread_t th = rb_thread_check(thread);
    VALUE ary = rb_ary_new();

    if (th-&gt;locals) {
        st_foreach(th-&gt;locals, thread_keys_i, ary);
    }
    return ary;
}
</pre>
  </div>
</div>
</div>
<div id="M000431" class="method">
  <div id="M000431_title" class="title">
    <b>thr.exit        => thr<br />
thr.kill        => thr<br />
thr.terminate   => thr<br />
</b>
  </div>
  <div class="description">
  <p>
Terminates <em>thr</em> and schedules another thread to be run, returning
the terminated <tt><a
href="index.html?a=C00000029&name=Thread">Thread</a></tt>. If this is the
main thread, or the last thread, exits the process.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000431_source')" id="l_M000431_source">show source</a> ]</p>
  <div id="M000431_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     thr.exit        =&gt; thr
 *     thr.kill        =&gt; thr
 *     thr.terminate   =&gt; thr
 *  
 *  Terminates &lt;i&gt;thr&lt;/i&gt; and schedules another thread to be run, returning
 *  the terminated &lt;code&gt;Thread&lt;/code&gt;.  If this is the main thread, or the
 *  last thread, exits the process.
 */

VALUE
rb_thread_kill(thread)
    VALUE thread;
{
    rb_thread_t th = rb_thread_check(thread);

    rb_kill_thread(th, 0);
    return thread;
}
</pre>
  </div>
</div>
</div>
<div id="M000434" class="method">
  <div id="M000434_title" class="title">
    <b>thr.exit!        => thr<br />
thr.kill!        => thr<br />
thr.terminate!   => thr<br />
</b>
  </div>
  <div class="description">
  <p>
Terminates <em>thr</em> without calling ensure clauses and schedules
another thread to be run, returning the terminated <tt><a
href="index.html?a=C00000029&name=Thread">Thread</a></tt>. If this is the
main thread, or the last thread, exits the process.
</p>
<p>
See <tt><a
href="index.html?a=M000420&name=Thread#exit">Thread#exit</a></tt> for the
safer version.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000434_source')" id="l_M000434_source">show source</a> ]</p>
  <div id="M000434_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     thr.exit!        =&gt; thr
 *     thr.kill!        =&gt; thr
 *     thr.terminate!   =&gt; thr
 *  
 *  Terminates &lt;i&gt;thr&lt;/i&gt; without calling ensure clauses and schedules
 *  another thread to be run, returning the terminated &lt;code&gt;Thread&lt;/code&gt;.
 *  If this is the main thread, or the last thread, exits the process.
 *
 *  See &lt;code&gt;Thread#exit&lt;/code&gt; for the safer version.
 */

static VALUE
rb_thread_kill_bang(thread)
    VALUE thread;
{
    rb_thread_t th = rb_thread_check(thread);
    rb_kill_thread(th, THREAD_NO_ENSURE);
    return thread;
}
</pre>
  </div>
</div>
</div>
<div id="M000445" class="method">
  <div id="M000445_title" class="title">
    <b>thr.priority   => integer<br />
</b>
  </div>
  <div class="description">
  <p>
Returns the priority of <em>thr</em>. Default is inherited from the current
thread which creating the new thread, or zero for the initial main thread;
higher-priority threads will run before lower-priority threads.
</p>
<pre>
   Thread.current.priority   #=&gt; 0
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000445_source')" id="l_M000445_source">show source</a> ]</p>
  <div id="M000445_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     thr.priority   =&gt; integer
 *
 *  Returns the priority of &lt;i&gt;thr&lt;/i&gt;. Default is inherited from the
 *  current thread which creating the new thread, or zero for the
 *  initial main thread; higher-priority threads will run before
 *  lower-priority threads.
 *
 *     Thread.current.priority   #=&gt; 0
 */

static VALUE
rb_thread_priority(thread)
    VALUE thread;
{
    return INT2NUM(rb_thread_check(thread)-&gt;priority);
}
</pre>
  </div>
</div>
</div>
<div id="M000446" class="method">
  <div id="M000446_title" class="title">
    <b>thr.priority= integer   => thr<br />
</b>
  </div>
  <div class="description">
  <p>
Sets the priority of <em>thr</em> to <em>integer</em>. Higher-priority
threads will run before lower-priority threads.
</p>
<pre>
   count1 = count2 = 0
   a = Thread.new do
         loop { count1 += 1 }
       end
   a.priority = -1

   b = Thread.new do
         loop { count2 += 1 }
       end
   b.priority = -2
   sleep 1   #=&gt; 1
   Thread.critical = 1
   count1    #=&gt; 622504
   count2    #=&gt; 5832
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000446_source')" id="l_M000446_source">show source</a> ]</p>
  <div id="M000446_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     thr.priority= integer   =&gt; thr
 *
 *  Sets the priority of &lt;i&gt;thr&lt;/i&gt; to &lt;i&gt;integer&lt;/i&gt;. Higher-priority threads
 *  will run before lower-priority threads.
 *
 *     count1 = count2 = 0
 *     a = Thread.new do
 *           loop { count1 += 1 }
 *         end
 *     a.priority = -1
 *     
 *     b = Thread.new do
 *           loop { count2 += 1 }
 *         end
 *     b.priority = -2
 *     sleep 1   #=&gt; 1
 *     Thread.critical = 1
 *     count1    #=&gt; 622504
 *     count2    #=&gt; 5832
 */

static VALUE
rb_thread_priority_set(thread, prio)
    VALUE thread, prio;
{
    rb_thread_t th;

    rb_secure(4);
    th = rb_thread_check(thread);

    th-&gt;priority = NUM2INT(prio);
    rb_thread_schedule();
    return prio;
}
</pre>
  </div>
</div>
</div>
<div id="M000442" class="method">
  <div id="M000442_title" class="title">
    <b>thr.raise(exception)<br />
</b>
  </div>
  <div class="description">
  <p>
Raises an exception (see <tt>Kernel::raise</tt>) from <em>thr</em>. The
caller does not have to be <em>thr</em>.
</p>
<pre>
   Thread.abort_on_exception = true
   a = Thread.new { sleep(200) }
   a.raise(&quot;Gotcha&quot;)
</pre>
<p>
<em>produces:</em>
</p>
<pre>
   prog.rb:3: Gotcha (RuntimeError)
    from prog.rb:2:in `initialize'
    from prog.rb:2:in `new'
    from prog.rb:2
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000442_source')" id="l_M000442_source">show source</a> ]</p>
  <div id="M000442_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     thr.raise(exception)
 *  
 *  Raises an exception (see &lt;code&gt;Kernel::raise&lt;/code&gt;) from &lt;i&gt;thr&lt;/i&gt;. The
 *  caller does not have to be &lt;i&gt;thr&lt;/i&gt;.
 *     
 *     Thread.abort_on_exception = true
 *     a = Thread.new { sleep(200) }
 *     a.raise(&quot;Gotcha&quot;)
 *     
 *  &lt;em&gt;produces:&lt;/em&gt;
 *     
 *     prog.rb:3: Gotcha (RuntimeError)
 *      from prog.rb:2:in `initialize'
 *      from prog.rb:2:in `new'
 *      from prog.rb:2
 */

static VALUE
rb_thread_raise_m(argc, argv, thread)
    int argc;
    VALUE *argv;
    VALUE thread;
{
    rb_thread_t th = rb_thread_check(thread);

    if (ruby_safe_level &gt; th-&gt;safe) {
        rb_secure(4);
    }
    rb_thread_raise(argc, argv, th);
    return Qnil;                /* not reached */
}
</pre>
  </div>
</div>
</div>
<div id="M000429" class="method">
  <div id="M000429_title" class="title">
    <b>thr.run   => thr<br />
</b>
  </div>
  <div class="description">
  <p>
Wakes up <em>thr</em>, making it eligible for scheduling. If not in a
critical section, then invokes the scheduler.
</p>
<pre>
   a = Thread.new { puts &quot;a&quot;; Thread.stop; puts &quot;c&quot; }
   Thread.pass
   puts &quot;Got here&quot;
   a.run
   a.join
</pre>
<p>
<em>produces:</em>
</p>
<pre>
   a
   Got here
   c
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000429_source')" id="l_M000429_source">show source</a> ]</p>
  <div id="M000429_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     thr.run   =&gt; thr
 *  
 *  Wakes up &lt;i&gt;thr&lt;/i&gt;, making it eligible for scheduling. If not in a critical
 *  section, then invokes the scheduler.
 *     
 *     a = Thread.new { puts &quot;a&quot;; Thread.stop; puts &quot;c&quot; }
 *     Thread.pass
 *     puts &quot;Got here&quot;
 *     a.run
 *     a.join
 *     
 *  &lt;em&gt;produces:&lt;/em&gt;
 *     
 *     a
 *     Got here
 *     c
 */

VALUE
rb_thread_run(thread)
    VALUE thread;
{
    rb_thread_wakeup(thread);
    if (!rb_thread_critical) rb_thread_schedule();

    return thread;
}
</pre>
  </div>
</div>
</div>
<div id="M000447" class="method">
  <div id="M000447_title" class="title">
    <b>thr.safe_level   => integer<br />
</b>
  </div>
  <div class="description">
  <p>
Returns the safe level in effect for <em>thr</em>. Setting thread-local
safe levels can help when implementing sandboxes which run insecure code.
</p>
<pre>
   thr = Thread.new { $SAFE = 3; sleep }
   Thread.current.safe_level   #=&gt; 0
   thr.safe_level              #=&gt; 3
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000447_source')" id="l_M000447_source">show source</a> ]</p>
  <div id="M000447_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     thr.safe_level   =&gt; integer
 *  
 *  Returns the safe level in effect for &lt;i&gt;thr&lt;/i&gt;. Setting thread-local safe
 *  levels can help when implementing sandboxes which run insecure code.
 *     
 *     thr = Thread.new { $SAFE = 3; sleep }
 *     Thread.current.safe_level   #=&gt; 0
 *     thr.safe_level              #=&gt; 3
 */

static VALUE
rb_thread_safe_level(thread)
    VALUE thread;
{
    rb_thread_t th;

    th = rb_thread_check(thread);
    if (th == curr_thread) {
        return INT2NUM(ruby_safe_level);
    }
    return INT2NUM(th-&gt;safe);
}
</pre>
  </div>
</div>
</div>
<div id="M000438" class="method">
  <div id="M000438_title" class="title">
    <b>thr.status   => string, false or nil<br />
</b>
  </div>
  <div class="description">
  <p>
Returns the status of <em>thr</em>: ``<tt>sleep</tt>&#8217;&#8217; if
<em>thr</em> is sleeping or waiting on I/O, ``<tt>run</tt>&#8217;&#8217; if
<em>thr</em> is executing, ``<tt>aborting</tt>&#8217;&#8217; if
<em>thr</em> is aborting, <tt>false</tt> if <em>thr</em> terminated
normally, and <tt>nil</tt> if <em>thr</em> terminated with an exception.
</p>
<pre>
   a = Thread.new { raise(&quot;die now&quot;) }
   b = Thread.new { Thread.stop }
   c = Thread.new { Thread.exit }
   d = Thread.new { sleep }
   Thread.critical = true
   d.kill                  #=&gt; #&lt;Thread:0x401b3678 aborting&gt;
   a.status                #=&gt; nil
   b.status                #=&gt; &quot;sleep&quot;
   c.status                #=&gt; false
   d.status                #=&gt; &quot;aborting&quot;
   Thread.current.status   #=&gt; &quot;run&quot;
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000438_source')" id="l_M000438_source">show source</a> ]</p>
  <div id="M000438_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     thr.status   =&gt; string, false or nil
 *  
 *  Returns the status of &lt;i&gt;thr&lt;/i&gt;: ``&lt;code&gt;sleep&lt;/code&gt;'' if &lt;i&gt;thr&lt;/i&gt; is
 *  sleeping or waiting on I/O, ``&lt;code&gt;run&lt;/code&gt;'' if &lt;i&gt;thr&lt;/i&gt; is executing,
 *  ``&lt;code&gt;aborting&lt;/code&gt;'' if &lt;i&gt;thr&lt;/i&gt; is aborting, &lt;code&gt;false&lt;/code&gt; if
 *  &lt;i&gt;thr&lt;/i&gt; terminated normally, and &lt;code&gt;nil&lt;/code&gt; if &lt;i&gt;thr&lt;/i&gt;
 *  terminated with an exception.
 *     
 *     a = Thread.new { raise(&quot;die now&quot;) }
 *     b = Thread.new { Thread.stop }
 *     c = Thread.new { Thread.exit }
 *     d = Thread.new { sleep }
 *     Thread.critical = true
 *     d.kill                  #=&gt; #&lt;Thread:0x401b3678 aborting&gt;
 *     a.status                #=&gt; nil
 *     b.status                #=&gt; &quot;sleep&quot;
 *     c.status                #=&gt; false
 *     d.status                #=&gt; &quot;aborting&quot;
 *     Thread.current.status   #=&gt; &quot;run&quot;
 */

static VALUE
rb_thread_status(thread)
    VALUE thread;
{
    rb_thread_t th = rb_thread_check(thread);

    if (rb_thread_dead(th)) {
        if (!NIL_P(th-&gt;errinfo) &amp;&amp; (th-&gt;flags &amp; THREAD_RAISED))
            return Qnil;
        return Qfalse;
    }

    return rb_str_new2(thread_status_name(th-&gt;status));
}
</pre>
  </div>
</div>
</div>
<div id="M000441" class="method">
  <div id="M000441_title" class="title">
    <b>thr.stop?   => true or false<br />
</b>
  </div>
  <div class="description">
  <p>
Returns <tt>true</tt> if <em>thr</em> is dead or sleeping.
</p>
<pre>
   a = Thread.new { Thread.stop }
   b = Thread.current
   a.stop?   #=&gt; true
   b.stop?   #=&gt; false
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000441_source')" id="l_M000441_source">show source</a> ]</p>
  <div id="M000441_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     thr.stop?   =&gt; true or false
 *  
 *  Returns &lt;code&gt;true&lt;/code&gt; if &lt;i&gt;thr&lt;/i&gt; is dead or sleeping.
 *     
 *     a = Thread.new { Thread.stop }
 *     b = Thread.current
 *     a.stop?   #=&gt; true
 *     b.stop?   #=&gt; false
 */

static VALUE
rb_thread_stop_p(thread)
    VALUE thread;
{
    rb_thread_t th = rb_thread_check(thread);

    if (rb_thread_dead(th)) return Qtrue;
    if (th-&gt;status == THREAD_STOPPED) return Qtrue;
    return Qfalse;
}
</pre>
  </div>
</div>
</div>
<div id="M000432" class="method">
  <div id="M000432_title" class="title">
    <b>thr.exit        => thr<br />
thr.kill        => thr<br />
thr.terminate   => thr<br />
</b>
  </div>
  <div class="description">
  <p>
Terminates <em>thr</em> and schedules another thread to be run, returning
the terminated <tt><a
href="index.html?a=C00000029&name=Thread">Thread</a></tt>. If this is the
main thread, or the last thread, exits the process.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000432_source')" id="l_M000432_source">show source</a> ]</p>
  <div id="M000432_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     thr.exit        =&gt; thr
 *     thr.kill        =&gt; thr
 *     thr.terminate   =&gt; thr
 *  
 *  Terminates &lt;i&gt;thr&lt;/i&gt; and schedules another thread to be run, returning
 *  the terminated &lt;code&gt;Thread&lt;/code&gt;.  If this is the main thread, or the
 *  last thread, exits the process.
 */

VALUE
rb_thread_kill(thread)
    VALUE thread;
{
    rb_thread_t th = rb_thread_check(thread);

    rb_kill_thread(th, 0);
    return thread;
}
</pre>
  </div>
</div>
</div>
<div id="M000435" class="method">
  <div id="M000435_title" class="title">
    <b>thr.exit!        => thr<br />
thr.kill!        => thr<br />
thr.terminate!   => thr<br />
</b>
  </div>
  <div class="description">
  <p>
Terminates <em>thr</em> without calling ensure clauses and schedules
another thread to be run, returning the terminated <tt><a
href="index.html?a=C00000029&name=Thread">Thread</a></tt>. If this is the
main thread, or the last thread, exits the process.
</p>
<p>
See <tt><a
href="index.html?a=M000420&name=Thread#exit">Thread#exit</a></tt> for the
safer version.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000435_source')" id="l_M000435_source">show source</a> ]</p>
  <div id="M000435_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     thr.exit!        =&gt; thr
 *     thr.kill!        =&gt; thr
 *     thr.terminate!   =&gt; thr
 *  
 *  Terminates &lt;i&gt;thr&lt;/i&gt; without calling ensure clauses and schedules
 *  another thread to be run, returning the terminated &lt;code&gt;Thread&lt;/code&gt;.
 *  If this is the main thread, or the last thread, exits the process.
 *
 *  See &lt;code&gt;Thread#exit&lt;/code&gt; for the safer version.
 */

static VALUE
rb_thread_kill_bang(thread)
    VALUE thread;
{
    rb_thread_t th = rb_thread_check(thread);
    rb_kill_thread(th, THREAD_NO_ENSURE);
    return thread;
}
</pre>
  </div>
</div>
</div>
<div id="M000437" class="method">
  <div id="M000437_title" class="title">
    <b>thr.value   => obj<br />
</b>
  </div>
  <div class="description">
  <p>
Waits for <em>thr</em> to complete (via <tt><a
href="index.html?a=M000439&name=Thread#join">Thread#join</a></tt>) and
returns its value.
</p>
<pre>
   a = Thread.new { 2 + 2 }
   a.value   #=&gt; 4
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000437_source')" id="l_M000437_source">show source</a> ]</p>
  <div id="M000437_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     thr.value   =&gt; obj
 *  
 *  Waits for &lt;i&gt;thr&lt;/i&gt; to complete (via &lt;code&gt;Thread#join&lt;/code&gt;) and returns
 *  its value.
 *     
 *     a = Thread.new { 2 + 2 }
 *     a.value   #=&gt; 4
 */

static VALUE
rb_thread_value(thread)
    VALUE thread;
{
    rb_thread_t th = rb_thread_check(thread);

    while (!rb_thread_join(th, DELAY_INFTY));

    return th-&gt;result;
}
</pre>
  </div>
</div>
</div>
<div id="M000430" class="method">
  <div id="M000430_title" class="title">
    <b>thr.wakeup   => thr<br />
</b>
  </div>
  <div class="description">
  <p>
Marks <em>thr</em> as eligible for scheduling (it may still remain blocked
on I/O, however). Does not invoke the scheduler (see <tt><a
href="index.html?a=M000429&name=Thread#run">Thread#run</a></tt>).
</p>
<pre>
   c = Thread.new { Thread.stop; puts &quot;hey!&quot; }
   c.wakeup
</pre>
<p>
<em>produces:</em>
</p>
<pre>
   hey!
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000430_source')" id="l_M000430_source">show source</a> ]</p>
  <div id="M000430_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *     thr.wakeup   =&gt; thr
 *  
 *  Marks &lt;i&gt;thr&lt;/i&gt; as eligible for scheduling (it may still remain blocked on
 *  I/O, however). Does not invoke the scheduler (see &lt;code&gt;Thread#run&lt;/code&gt;).
 *     
 *     c = Thread.new { Thread.stop; puts &quot;hey!&quot; }
 *     c.wakeup
 *     
 *  &lt;em&gt;produces:&lt;/em&gt;
 *     
 *     hey!
 */

VALUE
rb_thread_wakeup(thread)
    VALUE thread;
{
    if (!RTEST(rb_thread_wakeup_alive(thread)))
        rb_raise(rb_eThreadError, &quot;killed thread&quot;);
    return thread;
}
</pre>
  </div>
</div>
</div>
</div>

  </div>