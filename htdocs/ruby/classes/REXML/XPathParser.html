  <div id="C00001113">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />XPathParser<br/>
  In:
<a href="#" onclick="jsHref('files/ruby-1_8_7-p22/lib/rexml/xpath_parser_rb.html');">ruby-1.8.7-p22/lib/rexml/xpath_parser.rb</a>

Parent:&nbsp;
        <a href="#" onclick="jsHref('classes/YAML/Object.html');">
Object
         </a>
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">

  <div class="description"><p>
You don&#8217;t want to use this class. Really. Use <a
href="index.html?a=C00001116&name=XPath">XPath</a>, which is a wrapper for
this class. Believe me. You don&#8217;t want to poke around in here. There
is strange, dark magic at work in this code. Beware. Go back! Go back while
you still can!
</p>
</div>



  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M005791&name=[]=" >[]=</a></li>
  <li><a href="index.html?a=M005792&name=first" >first</a></li>
  <li><a href="index.html?a=M005789&name=get_first" >get_first</a></li>
  <li><a href="index.html?a=M005793&name=match" >match</a></li>
  <li><a href="index.html?a=M005786&name=namespaces=" >namespaces=</a></li>
  <li><a href="index.html?a=M005785&name=new" >new</a></li>
  <li><a href="index.html?a=M005788&name=parse" >parse</a></li>
  <li><a href="index.html?a=M005790&name=predicate" >predicate</a></li>
  <li><a href="index.html?a=M005787&name=variables=" >variables=</a></li>
  </ul>

<div class="sectiontitle">Included Modules</div>
<ul>
  <li><a href="#" onclick="jsHref('classes/REXML/XMLTokens.html');">XMLTokens</a></li>
</ul>



  <div class="sectiontitle">Constants</div>
  <table border='0' cellpadding='5'>
  <tr valign='top'>
    <td class="attr-name">LITERAL</td>
    <td>=</td>
    <td class="attr-value">/^'([^']*)'|^&quot;([^&quot;]*)&quot;/u</td>
  </tr>
  <tr valign='top'>
    <td class="attr-name">ALL</td>
    <td>=</td>
    <td class="attr-value">[ :attribute, :element, :text, :processing_instruction, :comment ]</td>
  </tr>
  <tr valign='top'>
    <td>&nbsp;</td>
    <td colspan="2" class="attr-desc">
Expr takes a stack of path elements and a set of nodes (either a <a
href="index.html?a=C00001102&name=Parent">Parent</a> or an <a
href="index.html?a=C00000243&name=Array">Array</a> and returns an <a
href="index.html?a=C00000243&name=Array">Array</a> of matching nodes

</td>
  </tr>
  <tr valign='top'>
    <td class="attr-name">ELEMENTS</td>
    <td>=</td>
    <td class="attr-value">[ :element ]</td>
  </tr>
  </table>


<div class="sectiontitle">Public Class methods</div>
<div id="M005785" class="method">
  <div id="M005785_title" class="title">
    <b>new</b>( )
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005785_source')" id="l_M005785_source">show source</a> ]</p>
  <div id="M005785_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/rexml/xpath_parser.rb, line 39</span>
39:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>( )
40:       <span class="ruby-ivar">@parser</span> = <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">Parsers</span><span class="ruby-operator">::</span><span class="ruby-constant">XPathParser</span>.<span class="ruby-identifier">new</span>
41:       <span class="ruby-ivar">@namespaces</span> = <span class="ruby-keyword kw">nil</span>
42:       <span class="ruby-ivar">@variables</span> = {}
43:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="sectiontitle">Public Instance methods</div>
<div id="M005791" class="method">
  <div id="M005791_title" class="title">
    <b>[]=</b>( variable_name, value )
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005791_source')" id="l_M005791_source">show source</a> ]</p>
  <div id="M005791_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/rexml/xpath_parser.rb, line 76</span>
76:     <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]=</span>( <span class="ruby-identifier">variable_name</span>, <span class="ruby-identifier">value</span> )
77:       <span class="ruby-ivar">@variables</span>[ <span class="ruby-identifier">variable_name</span> ] = <span class="ruby-identifier">value</span>
78:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005792" class="method">
  <div id="M005792_title" class="title">
    <b>first</b>( path_stack, node )
  </div>
  <div class="description">
  <p>
Performs a depth-first (document order) <a
href="index.html?a=C00001116&name=XPath">XPath</a> search, and returns the
first match. This is the fastest, lightest way to return a single result.
</p>
<p>
FIXME: This method is incomplete!
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005792_source')" id="l_M005792_source">show source</a> ]</p>
  <div id="M005792_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/rexml/xpath_parser.rb, line 85</span>
 85:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">first</span>( <span class="ruby-identifier">path_stack</span>, <span class="ruby-identifier">node</span> )
 86:       <span class="ruby-comment cmt">#puts &quot;#{depth}) Entering match( #{path.inspect}, #{tree.inspect} )&quot;</span>
 87:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
 88: 
 89:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">path</span>[<span class="ruby-value">0</span>]
 90:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:document</span>
 91:         <span class="ruby-comment cmt"># do nothing </span>
 92:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">first</span>( <span class="ruby-identifier">path</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>], <span class="ruby-identifier">node</span> )
 93:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:child</span>
 94:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">children</span>
 95:           <span class="ruby-comment cmt">#puts &quot;#{depth}) CHILD checking #{name(c)}&quot;</span>
 96:           <span class="ruby-identifier">r</span> = <span class="ruby-identifier">first</span>( <span class="ruby-identifier">path</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>], <span class="ruby-identifier">c</span> )
 97:           <span class="ruby-comment cmt">#puts &quot;#{depth}) RETURNING #{r.inspect}&quot; if r</span>
 98:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">r</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">r</span>
 99:         <span class="ruby-keyword kw">end</span>
100:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:qname</span>
101:         <span class="ruby-identifier">name</span> = <span class="ruby-identifier">path</span>[<span class="ruby-value">2</span>]
102:         <span class="ruby-comment cmt">#puts &quot;#{depth}) QNAME #{name(tree)} == #{name} (path =&gt; #{path.size})&quot;</span>
103:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">name</span>
104:           <span class="ruby-comment cmt">#puts &quot;#{depth}) RETURNING #{tree.inspect}&quot; if path.size == 3</span>
105:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">node</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">3</span>
106:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">first</span>( <span class="ruby-identifier">path</span>[<span class="ruby-value">3</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>], <span class="ruby-identifier">node</span> )
107:         <span class="ruby-keyword kw">else</span>
108:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
109:         <span class="ruby-keyword kw">end</span>
110:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:descendant_or_self</span>
111:         <span class="ruby-identifier">r</span> = <span class="ruby-identifier">first</span>( <span class="ruby-identifier">path</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>], <span class="ruby-identifier">node</span> )
112:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">r</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">r</span>
113:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">node</span>.<span class="ruby-identifier">children</span>
114:           <span class="ruby-identifier">r</span> = <span class="ruby-identifier">first</span>( <span class="ruby-identifier">path</span>, <span class="ruby-identifier">c</span> )
115:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">r</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">r</span>
116:         <span class="ruby-keyword kw">end</span>
117:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:node</span>
118:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">first</span>( <span class="ruby-identifier">path</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>], <span class="ruby-identifier">node</span> )
119:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:any</span>
120:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">first</span>( <span class="ruby-identifier">path</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>], <span class="ruby-identifier">node</span> )
121:       <span class="ruby-keyword kw">end</span>
122:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
123:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005789" class="method">
  <div id="M005789_title" class="title">
    <b>get_first</b>(path, nodeset)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005789_source')" id="l_M005789_source">show source</a> ]</p>
  <div id="M005789_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/rexml/xpath_parser.rb, line 63</span>
63:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_first</span> <span class="ruby-identifier">path</span>, <span class="ruby-identifier">nodeset</span>
64:      <span class="ruby-comment cmt">#puts &quot;#&quot;*40</span>
65:      <span class="ruby-identifier">path_stack</span> = <span class="ruby-ivar">@parser</span>.<span class="ruby-identifier">parse</span>( <span class="ruby-identifier">path</span> )
66:      <span class="ruby-comment cmt">#puts &quot;PARSE: #{path} =&gt; #{path_stack.inspect}&quot;</span>
67:      <span class="ruby-comment cmt">#puts &quot;PARSE: nodeset = #{nodeset.inspect}&quot;</span>
68:      <span class="ruby-identifier">first</span>( <span class="ruby-identifier">path_stack</span>, <span class="ruby-identifier">nodeset</span> )
69:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005793" class="method">
  <div id="M005793_title" class="title">
    <b>match</b>( path_stack, nodeset )
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005793_source')" id="l_M005793_source">show source</a> ]</p>
  <div id="M005793_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/rexml/xpath_parser.rb, line 126</span>
126:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">match</span>( <span class="ruby-identifier">path_stack</span>, <span class="ruby-identifier">nodeset</span> ) 
127:       <span class="ruby-comment cmt">#puts &quot;MATCH: path_stack = #{path_stack.inspect}&quot;</span>
128:       <span class="ruby-comment cmt">#puts &quot;MATCH: nodeset = #{nodeset.inspect}&quot;</span>
129:       <span class="ruby-identifier">r</span> = <span class="ruby-identifier">expr</span>( <span class="ruby-identifier">path_stack</span>, <span class="ruby-identifier">nodeset</span> )
130:       <span class="ruby-comment cmt">#puts &quot;MAIN EXPR =&gt; #{r.inspect}&quot;</span>
131:       <span class="ruby-identifier">r</span>
132:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005786" class="method">
  <div id="M005786_title" class="title">
    <b>namespaces=</b>( namespaces={} )
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005786_source')" id="l_M005786_source">show source</a> ]</p>
  <div id="M005786_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/rexml/xpath_parser.rb, line 45</span>
45:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">namespaces=</span>( <span class="ruby-identifier">namespaces</span>={} )
46:       <span class="ruby-constant">Functions</span><span class="ruby-operator">::</span><span class="ruby-identifier">namespace_context</span> = <span class="ruby-identifier">namespaces</span>
47:       <span class="ruby-ivar">@namespaces</span> = <span class="ruby-identifier">namespaces</span>
48:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005788" class="method">
  <div id="M005788_title" class="title">
    <b>parse</b>(path, nodeset)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005788_source')" id="l_M005788_source">show source</a> ]</p>
  <div id="M005788_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/rexml/xpath_parser.rb, line 55</span>
55:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse</span> <span class="ruby-identifier">path</span>, <span class="ruby-identifier">nodeset</span>
56:      <span class="ruby-comment cmt">#puts &quot;#&quot;*40</span>
57:      <span class="ruby-identifier">path_stack</span> = <span class="ruby-ivar">@parser</span>.<span class="ruby-identifier">parse</span>( <span class="ruby-identifier">path</span> )
58:      <span class="ruby-comment cmt">#puts &quot;PARSE: #{path} =&gt; #{path_stack.inspect}&quot;</span>
59:      <span class="ruby-comment cmt">#puts &quot;PARSE: nodeset = #{nodeset.inspect}&quot;</span>
60:      <span class="ruby-identifier">match</span>( <span class="ruby-identifier">path_stack</span>, <span class="ruby-identifier">nodeset</span> )
61:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005790" class="method">
  <div id="M005790_title" class="title">
    <b>predicate</b>(path, nodeset)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005790_source')" id="l_M005790_source">show source</a> ]</p>
  <div id="M005790_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/rexml/xpath_parser.rb, line 71</span>
71:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">predicate</span> <span class="ruby-identifier">path</span>, <span class="ruby-identifier">nodeset</span>
72:       <span class="ruby-identifier">path_stack</span> = <span class="ruby-ivar">@parser</span>.<span class="ruby-identifier">parse</span>( <span class="ruby-identifier">path</span> )
73:       <span class="ruby-identifier">expr</span>( <span class="ruby-identifier">path_stack</span>, <span class="ruby-identifier">nodeset</span> )
74:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005787" class="method">
  <div id="M005787_title" class="title">
    <b>variables=</b>( vars={} )
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005787_source')" id="l_M005787_source">show source</a> ]</p>
  <div id="M005787_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/rexml/xpath_parser.rb, line 50</span>
50:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">variables=</span>( <span class="ruby-identifier">vars</span>={} )
51:       <span class="ruby-constant">Functions</span><span class="ruby-operator">::</span><span class="ruby-identifier">variables</span> = <span class="ruby-identifier">vars</span>
52:       <span class="ruby-ivar">@variables</span> = <span class="ruby-identifier">vars</span>
53:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>