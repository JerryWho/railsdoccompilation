  <div id="C00001626">
<div class='banner'>
  <span class="file-title-prefix">Module</span><br />Timeout<br/>
  In:
<a href="#" onclick="jsHref('files/ruby-1_8_7-p22/lib/timeout_rb.html');">ruby-1.8.7-p22/lib/timeout.rb</a>

</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">

  <div class="description"><h1>Description</h1>
<p>
A way of performing a potentially long-running operation in a thread, and
terminating it&#8217;s execution if it hasn&#8217;t finished within fixed
amount of time.
</p>
<p>
Previous versions of timeout didn&#8217;t use a module for namespace. This
version provides both <a
href="index.html?a=M008062&name=Timeout.timeout">Timeout.timeout</a>, and a
backwards-compatible <a
href="index.html?a=M008062&name=timeout">timeout</a>.
</p>
<h1>Synopsis</h1>
<pre>
  require 'timeout'
  status = Timeout::timeout(5) {
    # Something that should be interrupted if it takes too much time...
  }
</pre>
</div>



  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M008062&name=timeout" >timeout</a></li>
  </ul>



  <div class="sectiontitle">Classes and Modules</div>
  Class "<a href="#" onclick="jsHref('classes/Timeout/Error.html');" class="link">Timeout::Error</a>"<br />


  <div class="sectiontitle">Constants</div>
  <table border='0' cellpadding='5'>
  <tr valign='top'>
    <td class="attr-name">THIS_FILE</td>
    <td>=</td>
    <td class="attr-value">/\A#{Regexp.quote(__FILE__)}:/o</td>
  </tr>
  <tr valign='top'>
    <td class="attr-name">CALLER_OFFSET</td>
    <td>=</td>
    <td class="attr-value">((c = caller[0]) &amp;&amp; THIS_FILE =~ c) ? 1 : 0</td>
  </tr>
  </table>


<div class="sectiontitle">Public Instance methods</div>
<div id="M008062" class="method">
  <div id="M008062_title" class="title">
    <b>timeout</b>(sec, klass = nil) {|if sec == nil or sec.zero?| ...}
  </div>
  <div class="description">
  <p>
Executes the method&#8217;s block. If the block execution terminates before
<tt>sec</tt> seconds has passed, it returns true. If not, it terminates the
execution and raises <tt>exception</tt> (which defaults to <a
href="index.html?a=C00001627&name=Timeout::Error">Timeout::Error</a>).
</p>
<p>
Note that this is both a method of module <a
href="index.html?a=C00001626&name=Timeout">Timeout</a>, so you can
&#8216;include <a
href="index.html?a=C00001626&name=Timeout">Timeout</a>&#8217; into your
classes so they have a <a
href="index.html?a=M008062&name=timeout">timeout</a> method, as well as a
module method, so you can call it directly as <a
href="index.html?a=M008062&name=Timeout.timeout">Timeout.timeout</a>().
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008062_source')" id="l_M008062_source">show source</a> ]</p>
  <div id="M008062_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/timeout.rb, line 52</span>
52:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">timeout</span>(<span class="ruby-identifier">sec</span>, <span class="ruby-identifier">klass</span> = <span class="ruby-keyword kw">nil</span>)
53:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">yield</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sec</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">sec</span>.<span class="ruby-identifier">zero?</span>
54:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">ThreadError</span>, <span class="ruby-value str">&quot;timeout within critical session&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">critical</span>
55:     <span class="ruby-identifier">exception</span> = <span class="ruby-identifier">klass</span> <span class="ruby-operator">||</span> <span class="ruby-constant">Class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">ExitException</span>)
56:     <span class="ruby-keyword kw">begin</span>
57:       <span class="ruby-identifier">x</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>
58:       <span class="ruby-identifier">y</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">start</span> {
59:         <span class="ruby-identifier">sleep</span> <span class="ruby-identifier">sec</span>
60:         <span class="ruby-identifier">x</span>.<span class="ruby-identifier">raise</span> <span class="ruby-identifier">exception</span>, <span class="ruby-value str">&quot;execution expired&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">alive?</span>
61:       }
62:       <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">sec</span>
63:       <span class="ruby-comment cmt">#    return true</span>
64:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-identifier">exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
65:       <span class="ruby-identifier">rej</span> = <span class="ruby-node">/\A#{Regexp.quote(__FILE__)}:#{__LINE__-4}\z/o</span>
66:       (<span class="ruby-identifier">bt</span> = <span class="ruby-identifier">e</span>.<span class="ruby-identifier">backtrace</span>).<span class="ruby-identifier">reject!</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span> <span class="ruby-identifier">rej</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">m</span>}
67:       <span class="ruby-identifier">level</span> = <span class="ruby-operator">-</span><span class="ruby-identifier">caller</span>(<span class="ruby-constant">CALLER_OFFSET</span>).<span class="ruby-identifier">size</span>
68:       <span class="ruby-keyword kw">while</span> <span class="ruby-constant">THIS_FILE</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">bt</span>[<span class="ruby-identifier">level</span>]
69:         <span class="ruby-identifier">bt</span>.<span class="ruby-identifier">delete_at</span>(<span class="ruby-identifier">level</span>)
70:         <span class="ruby-identifier">level</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
71:       <span class="ruby-keyword kw">end</span>
72:       <span class="ruby-identifier">raise</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">klass</span>            <span class="ruby-comment cmt"># if exception class is specified, it</span>
73:                                 <span class="ruby-comment cmt"># would be expected outside.</span>
74:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">e</span>.<span class="ruby-identifier">message</span>, <span class="ruby-identifier">e</span>.<span class="ruby-identifier">backtrace</span>
75:     <span class="ruby-keyword kw">ensure</span>
76:       <span class="ruby-identifier">y</span>.<span class="ruby-identifier">kill</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">y</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">y</span>.<span class="ruby-identifier">alive?</span>
77:     <span class="ruby-keyword kw">end</span>
78:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>