  <div id="C00000991">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />C_Parser<br/>
  In:
<a href="#" onclick="jsHref('files/ruby-1_8_7-p22/lib/rdoc/parsers/parse_c_rb.html');">ruby-1.8.7-p22/lib/rdoc/parsers/parse_c.rb</a>

Parent:&nbsp;
        <a href="#" onclick="jsHref('classes/YAML/Object.html');">
Object
         </a>
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">

  <div class="description"><p>
We attempt to parse C extension files. Basically we look for the standard
patterns that you find in extensions: <tt>rb_define_class,
rb_define_method</tt> and so on. We also try to find the corresponding C
source for the methods and extract comments, but if we fail we don&#8217;t
worry too much.
</p>
<p>
The comments associated with a Ruby method are extracted from the C comment
block associated with the routine that <em>implements</em> that method,
that is to say the method whose name is given in the
<tt>rb_define_method</tt> call. For example, you might write:
</p>
<pre>
 /*
  * Returns a new array that is a one-dimensional flattening of this
  * array (recursively). That is, for every element that is an array,
  * extract its elements into the new array.
  *
  *    s = [ 1, 2, 3 ]           #=&gt; [1, 2, 3]
  *    t = [ 4, 5, 6, [7, 8] ]   #=&gt; [4, 5, 6, [7, 8]]
  *    a = [ s, t, 9, 10 ]       #=&gt; [[1, 2, 3], [4, 5, 6, [7, 8]], 9, 10]
  *    a.flatten                 #=&gt; [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
  */
  static VALUE
  rb_ary_flatten(ary)
      VALUE ary;
  {
      ary = rb_obj_dup(ary);
      rb_ary_flatten_bang(ary);
      return ary;
  }

  ...

  void
  Init_Array()
  {
    ...
    rb_define_method(rb_cArray, &quot;flatten&quot;, rb_ary_flatten, 0);
</pre>
<p>
Here <a href="index.html?a=C00000966&name=RDoc">RDoc</a> will determine
from the rb_define_method line that there&#8217;s a method called
&quot;flatten&quot; in class <a
href="index.html?a=C00000243&name=Array">Array</a>, and will look for the
implementation in the method rb_ary_flatten. It will then use the comment
from that method in the HTML output. This method must be in the same source
file as the rb_define_method.
</p>
<p>
C classes can be diagrammed (see /tc/dl/ruby/ruby/error.c), and <a
href="index.html?a=C00000966&name=RDoc">RDoc</a> integrates C and Ruby
source into one tree
</p>
<p>
The comment blocks may include special directives:
</p>
<dl>
<dt>Document-class: <em>name</em></dt><dd>This comment block is documentation for the given class. Use this when the
<tt>Init_xxx</tt> method is not named after the class.

</dd>
<dt>Document-method: <em>name</em></dt><dd>This comment documents the named method. Use when <a
href="index.html?a=C00000966&name=RDoc">RDoc</a> cannot automatically find
the method from it&#8217;s declaration

</dd>
<dt>call-seq:  <em>text up to an empty line</em></dt><dd>Because C source doesn&#8217;t give descriptive names to Ruby-level
parameters, you need to document the calling sequence explicitly

</dd>
</dl>
<p>
In addition, <a href="index.html?a=C00000966&name=RDoc">RDoc</a> assumes by
default that the C method implementing a Ruby function is in the same
source file as the rb_define_method call. If this isn&#8217;t the case, add
the comment
</p>
<pre>
   rb_define_method(....);  // in: filename
</pre>
<p>
As an example, we might have an extension that defines multiple classes in
its Init_xxx method. We could document them using
</p>
<pre>
 /*
  * Document-class:  MyClass
  *
  * Encapsulate the writing and reading of the configuration
  * file. ...
  */

 /*
  * Document-method: read_value
  *
  * call-seq:
  *   cfg.read_value(key)            -&gt; value
  *   cfg.read_value(key} { |key| }  -&gt; value
  *
  * Return the value corresponding to +key+ from the configuration.
  * In the second form, if the key isn't found, invoke the
  * block and return its value.
  */
</pre>
</div>



  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M005054&name=new" >new</a></li>
  <li><a href="index.html?a=M005055&name=scan" >scan</a></li>
  </ul>





  <div class="sectiontitle">Attributes</div>
  <table border='0' cellpadding='5'>
  <tr valign='top'>
    <td class='attr-rw'>
[RW]
    </td>
    <td class='attr-name'>progress</td>
    <td class='attr-desc'></td>
  </tr>
  </table>

<div class="sectiontitle">Public Class methods</div>
<div id="M005054" class="method">
  <div id="M005054_title" class="title">
    <b>new</b>(top_level, file_name, body, options, stats)
  </div>
  <div class="description">
  <p>
prepare to parse a C file
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005054_source')" id="l_M005054_source">show source</a> ]</p>
  <div id="M005054_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/rdoc/parsers/parse_c.rb, line 177</span>
177:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">top_level</span>, <span class="ruby-identifier">file_name</span>, <span class="ruby-identifier">body</span>, <span class="ruby-identifier">options</span>, <span class="ruby-identifier">stats</span>)
178:       <span class="ruby-ivar">@known_classes</span> = <span class="ruby-constant">KNOWN_CLASSES</span>.<span class="ruby-identifier">dup</span>
179:       <span class="ruby-ivar">@body</span> = <span class="ruby-identifier">handle_tab_width</span>(<span class="ruby-identifier">handle_ifdefs_in</span>(<span class="ruby-identifier">body</span>))
180:       <span class="ruby-ivar">@options</span> = <span class="ruby-identifier">options</span>
181:       <span class="ruby-ivar">@stats</span>   = <span class="ruby-identifier">stats</span>
182:       <span class="ruby-ivar">@top_level</span> = <span class="ruby-identifier">top_level</span>
183:       <span class="ruby-ivar">@classes</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
184:       <span class="ruby-ivar">@file_dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">file_name</span>)
185:       <span class="ruby-ivar">@progress</span> = <span class="ruby-identifier">$stderr</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">quiet</span>
186:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="sectiontitle">Public Instance methods</div>
<div id="M005055" class="method">
  <div id="M005055_title" class="title">
    <b>scan</b>()
  </div>
  <div class="description">
  <p>
Extract the classes/modules and methods from a C file and return the
corresponding top-level object
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005055_source')" id="l_M005055_source">show source</a> ]</p>
  <div id="M005055_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File ruby-1.8.7-p22/lib/rdoc/parsers/parse_c.rb, line 190</span>
190:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">scan</span>
191:       <span class="ruby-identifier">remove_commented_out_lines</span>
192:       <span class="ruby-identifier">do_classes</span>
193:       <span class="ruby-identifier">do_constants</span>
194:       <span class="ruby-identifier">do_methods</span>
195:       <span class="ruby-identifier">do_includes</span>
196:       <span class="ruby-identifier">do_aliases</span>
197:       <span class="ruby-ivar">@top_level</span>
198:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>