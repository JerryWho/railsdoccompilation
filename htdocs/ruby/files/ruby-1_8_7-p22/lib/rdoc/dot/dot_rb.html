  <div id="fileHeader">
    <h1>dot.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>ruby-1.8.7-p22/lib/rdoc/dot/dot.rb
      </td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Feb 12 17:01:19 -0600 2007</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>module DOT

    # these glogal vars are used to make nice graph source
    $tab = '    '
    $tab2 = $tab * 2

    # if we don't like 4 spaces, we can change it any time
    def change_tab( t )
        $tab = t
        $tab2 = t * 2
    end

    # options for node declaration
    NODE_OPTS = [
        'bgcolor',
        'color',
        'fontcolor',
        'fontname',
        'fontsize',
        'height',
        'width',
        'label',
        'layer',
        'rank',
        'shape',
        'shapefile',
        'style',
        'URL',
    ]

    # options for edge declaration
    EDGE_OPTS = [
        'color',
        'decorate',
        'dir',
        'fontcolor',
        'fontname',
        'fontsize',
        'id',
        'label',
        'layer',
        'lhead',
        'ltail',
        'minlen',
        'style',
        'weight'
    ]

    # options for graph declaration
    GRAPH_OPTS = [
        'bgcolor',
        'center',
        'clusterrank',
        'color',
        'compound',
        'concentrate',
        'fillcolor',
        'fontcolor',
        'fontname',
        'fontsize',
        'label',
        'layerseq',
        'margin',
        'mclimit',
        'nodesep',
        'nslimit',
        'ordering',
        'orientation',
        'page',
        'rank',
        'rankdir',
        'ranksep',
        'ratio',
        'size',
        'style',
        'URL'
    ]

    # a root class for any element in dot notation
    class DOTSimpleElement
        attr_accessor :name

        def initialize( params = {} )
            @label = params['name'] ? params['name'] : ''
        end

        def to_s
            @name
        end
    end

    # an element that has options ( node, edge or graph )
    class DOTElement &lt; DOTSimpleElement
        #attr_reader :parent
        attr_accessor :name, :options

        def initialize( params = {}, option_list = [] )
            super( params )
            @name = params['name'] ? params['name'] : nil
            @parent = params['parent'] ? params['parent'] : nil
            @options = {}
            option_list.each{ |i|
                @options[i] = params[i] if params[i]
            }
            @options['label'] ||= @name if @name != 'node'
        end

        def each_option
            @options.each{ |i| yield i }
        end

        def each_option_pair
            @options.each_pair{ |key, val| yield key, val }
        end

        #def parent=( thing )
        #    @parent.delete( self ) if defined?( @parent ) and @parent
        #    @parent = thing
        #end
    end


    # this is used when we build nodes that have shape=record
    # ports don't have options :)
    class DOTPort &lt; DOTSimpleElement
        attr_accessor :label

        def initialize( params = {} )
            super( params )
            @name = params['label'] ? params['label'] : ''
        end
        def to_s
            ( @name &amp;&amp; @name != &quot;&quot; ? &quot;&lt;#{@name}&gt;&quot; : &quot;&quot; ) + &quot;#{@label}&quot;
        end
    end

    # node element
    class DOTNode &lt; DOTElement

        def initialize( params = {}, option_list = NODE_OPTS )
            super( params, option_list )
            @ports = params['ports'] ? params['ports'] : []
        end

        def each_port
            @ports.each{ |i| yield i }
        end

        def &lt;&lt; ( thing )
            @ports &lt;&lt; thing
        end

        def push ( thing )
            @ports.push( thing )
        end

        def pop
            @ports.pop
        end

        def to_s( t = '' )

            label = @options['shape'] != 'record' &amp;&amp; @ports.length == 0 ?
                @options['label'] ?
                    t + $tab + &quot;label = \&quot;#{@options['label']}\&quot;\n&quot; :
                    '' :
                t + $tab + 'label = &quot;' + &quot; \\\n&quot; +
                t + $tab2 + &quot;#{@options['label']}| \\\n&quot; +
                @ports.collect{ |i|
                    t + $tab2 + i.to_s
                }.join( &quot;| \\\n&quot; ) + &quot; \\\n&quot; +
                t + $tab + '&quot;' + &quot;\n&quot;

            t + &quot;#{@name} [\n&quot; +
            @options.to_a.collect{ |i|
                i[1] &amp;&amp; i[0] != 'label' ?
                    t + $tab + &quot;#{i[0]} = #{i[1]}&quot; : nil
            }.compact.join( &quot;,\n&quot; ) + ( label != '' ? &quot;,\n&quot; : &quot;\n&quot; ) +
            label +
            t + &quot;]\n&quot;
        end
    end

    # subgraph element is the same to graph, but has another header in dot
    # notation
    class DOTSubgraph &lt; DOTElement

        def initialize( params = {}, option_list = GRAPH_OPTS )
            super( params, option_list )
            @nodes = params['nodes'] ? params['nodes'] : []
            @dot_string = 'subgraph'
        end

        def each_node
            @nodes.each{ |i| yield i }
        end

        def &lt;&lt; ( thing )
            @nodes &lt;&lt; thing
        end

        def push( thing )
            @nodes.push( thing )
        end

        def pop
            @nodes.pop
        end

        def to_s( t = '' )
          hdr = t + &quot;#{@dot_string} #{@name} {\n&quot;

          options = @options.to_a.collect{ |name, val|
            val &amp;&amp; name != 'label' ?
            t + $tab + &quot;#{name} = #{val}&quot; :
              name ? t + $tab + &quot;#{name} = \&quot;#{val}\&quot;&quot; : nil
          }.compact.join( &quot;\n&quot; ) + &quot;\n&quot;

          nodes = @nodes.collect{ |i|
            i.to_s( t + $tab )
          }.join( &quot;\n&quot; ) + &quot;\n&quot;
          hdr + options + nodes + t + &quot;}\n&quot;
        end
    end

    # this is graph
    class DOTDigraph &lt; DOTSubgraph
        def initialize( params = {}, option_list = GRAPH_OPTS )
            super( params, option_list )
            @dot_string = 'digraph'
        end
    end

    # this is edge
    class DOTEdge &lt; DOTElement
        attr_accessor :from, :to
        def initialize( params = {}, option_list = EDGE_OPTS )
            super( params, option_list )
            @from = params['from'] ? params['from'] : nil
            @to = params['to'] ? params['to'] : nil
        end

        def to_s( t = '' )
            t + &quot;#{@from} -&gt; #{to} [\n&quot; +
            @options.to_a.collect{ |i|
                i[1] &amp;&amp; i[0] != 'label' ?
                    t + $tab + &quot;#{i[0]} = #{i[1]}&quot; :
                    i[1] ? t + $tab + &quot;#{i[0]} = \&quot;#{i[1]}\&quot;&quot; : nil
            }.compact.join( &quot;\n&quot; ) + &quot;\n&quot; + t + &quot;]\n&quot;
        end
    end
end



</pre>
    </div>