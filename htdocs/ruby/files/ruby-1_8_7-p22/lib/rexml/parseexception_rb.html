  <div id="fileHeader">
    <h1>parseexception.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>ruby-1.8.7-p22/lib/rexml/parseexception.rb
      </td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Feb 12 17:01:19 -0600 2007</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>module REXML
  class ParseException &lt; RuntimeError
    attr_accessor :source, :parser, :continued_exception

    def initialize( message, source=nil, parser=nil, exception=nil )
      super(message)
      @source = source
      @parser = parser
      @continued_exception = exception
    end

    def to_s
      # Quote the original exception, if there was one
      if @continued_exception
        err = @continued_exception.inspect
        err &lt;&lt; &quot;\n&quot;
        err &lt;&lt; @continued_exception.backtrace.join(&quot;\n&quot;)
        err &lt;&lt; &quot;\n...\n&quot;
      else
        err = &quot;&quot;
      end

      # Get the stack trace and error message
      err &lt;&lt; super

      # Add contextual information
      if @source
        err &lt;&lt; &quot;\nLine: #{line}\n&quot;
        err &lt;&lt; &quot;Position: #{position}\n&quot;
        err &lt;&lt; &quot;Last 80 unconsumed characters:\n&quot;
        err &lt;&lt; @source.buffer[0..80].gsub(/\n/, ' ')
      end
      
      err
    end

    def position
      @source.current_line[0] if @source and defined? @source.current_line and
      @source.current_line
    end

    def line
      @source.current_line[2] if @source and defined? @source.current_line and 
      @source.current_line
    end

    def context
      @source.current_line
    end
  end  
end
</pre>
    </div>