  <div id="fileHeader">
    <h1>feed.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>ruby-1.8.7-p22/lib/rss/maker/feed.rb
      </td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Feb 11 02:26:47 -0600 2008</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require &quot;rss/maker/atom&quot;

module RSS
  module Maker
    module Atom
      class Feed &lt; RSSBase
        def initialize(feed_version=&quot;1.0&quot;)
          super
          @feed_type = &quot;atom&quot;
          @feed_subtype = &quot;feed&quot;
        end

        private
        def make_feed
          ::RSS::Atom::Feed.new(@version, @encoding, @standalone)
        end

        def setup_elements(feed)
          setup_channel(feed)
          setup_image(feed)
          setup_items(feed)
        end

        class Channel &lt; ChannelBase
          def to_feed(feed)
            set_default_values do
              setup_values(feed)
              feed.dc_dates.clear
              setup_other_elements(feed)
              if image_favicon.about
                icon = feed.class::Icon.new
                icon.content = image_favicon.about
                feed.icon = icon
              end
              unless have_required_values?
                raise NotSetError.new(&quot;maker.channel&quot;,
                                      not_set_required_variables)
              end
            end
          end

          def have_required_values?
            super and
              (!authors.empty? or
               @maker.items.any? {|item| !item.authors.empty?})
          end

          private
          def required_variable_names
            %w(id updated)
          end

          def variables
            super + %w(id updated)
          end

          def variable_is_set?
            super or !authors.empty?
          end

          def not_set_required_variables
            vars = super
            if authors.empty? and
                @maker.items.all? {|item| item.author.to_s.empty?}
              vars &lt;&lt; &quot;author&quot;
            end
            vars &lt;&lt; &quot;title&quot; unless title {|t| t.have_required_values?}
            vars
          end

          def _set_default_values(&amp;block)
            keep = {
              :id =&gt; id,
              :updated =&gt; updated,
            }
            self.id ||= about
            self.updated ||= dc_date
            super(&amp;block)
          ensure
            self.id = keep[:id]
            self.updated = keep[:updated]
          end

          class SkipDays &lt; SkipDaysBase
            def to_feed(*args)
            end

            class Day &lt; DayBase
            end
          end

          class SkipHours &lt; SkipHoursBase
            def to_feed(*args)
            end

            class Hour &lt; HourBase
            end
          end

          class Cloud &lt; CloudBase
            def to_feed(*args)
            end
          end

          class Categories &lt; CategoriesBase
            class Category &lt; CategoryBase
              include AtomCategory

              def self.not_set_name
                &quot;maker.channel.category&quot;
              end
            end
          end

          class Links &lt; LinksBase
            class Link &lt; LinkBase
              include AtomLink

              def self.not_set_name
                &quot;maker.channel.link&quot;
              end
            end
          end

          AtomPersons.def_atom_persons(self, &quot;author&quot;, &quot;maker.channel.author&quot;)
          AtomPersons.def_atom_persons(self, &quot;contributor&quot;,
                                       &quot;maker.channel.contributor&quot;)

          class Generator &lt; GeneratorBase
            include AtomGenerator

            def self.not_set_name
              &quot;maker.channel.generator&quot;
            end
          end

          AtomTextConstruct.def_atom_text_construct(self, &quot;rights&quot;,
                                                    &quot;maker.channel.copyright&quot;,
                                                    &quot;Copyright&quot;)
          AtomTextConstruct.def_atom_text_construct(self, &quot;subtitle&quot;,
                                                    &quot;maker.channel.description&quot;,
                                                    &quot;Description&quot;)
          AtomTextConstruct.def_atom_text_construct(self, &quot;title&quot;,
                                                    &quot;maker.channel.title&quot;)
        end

        class Image &lt; ImageBase
          def to_feed(feed)
            logo = feed.class::Logo.new
            class &lt;&lt; logo
              alias_method(:url=, :content=)
            end
            set = setup_values(logo)
            class &lt;&lt; logo
              remove_method(:url=)
            end
            if set
              feed.logo = logo
              set_parent(logo, feed)
              setup_other_elements(feed, logo)
            elsif variable_is_set?
              raise NotSetError.new(&quot;maker.image&quot;, not_set_required_variables)
            end
          end

          private
          def required_variable_names
            %w(url)
          end
        end

        class Items &lt; ItemsBase
          def to_feed(feed)
            normalize.each do |item|
              item.to_feed(feed)
            end
            setup_other_elements(feed, feed.entries)
          end

          class Item &lt; ItemBase
            def to_feed(feed)
              set_default_values do
                entry = feed.class::Entry.new
                set = setup_values(entry)
                setup_other_elements(feed, entry)
                if set
                  feed.entries &lt;&lt; entry
                  set_parent(entry, feed)
                elsif variable_is_set?
                  raise NotSetError.new(&quot;maker.item&quot;, not_set_required_variables)
                end
              end
            end

            def have_required_values?
              set_default_values do
                super and title {|t| t.have_required_values?}
              end
            end

            private
            def required_variable_names
              %w(id updated)
            end

            def variables
              super + [&quot;updated&quot;]
            end

            def not_set_required_variables
              vars = super
              vars &lt;&lt; &quot;title&quot; unless title {|t| t.have_required_values?}
              vars
            end

            def _set_default_values(&amp;block)
              keep = {
                :id =&gt; id,
                :updated =&gt; updated,
              }
              self.id ||= link
              self.updated ||= dc_date
              super(&amp;block)
            ensure
              self.id = keep[:id]
              self.updated = keep[:updated]
            end

            class Guid &lt; GuidBase
              def to_feed(feed, current)
              end
            end

            class Enclosure &lt; EnclosureBase
              def to_feed(feed, current)
              end
            end

            class Source &lt; SourceBase
              def to_feed(feed, current)
                source = current.class::Source.new
                setup_values(source)
                current.source = source
                set_parent(source, current)
                setup_other_elements(feed, source)
                current.source = nil if source.to_s == &quot;&lt;source/&gt;&quot;
              end

              private
              def required_variable_names
                []
              end

              def variables
                super + [&quot;updated&quot;]
              end

              AtomPersons.def_atom_persons(self, &quot;author&quot;,
                                           &quot;maker.item.source.author&quot;)
              AtomPersons.def_atom_persons(self, &quot;contributor&quot;,
                                           &quot;maker.item.source.contributor&quot;)

              class Categories &lt; CategoriesBase
                class Category &lt; CategoryBase
                  include AtomCategory

                  def self.not_set_name
                    &quot;maker.item.source.category&quot;
                  end
                end
              end

              class Generator &lt; GeneratorBase
                include AtomGenerator

                def self.not_set_name
                  &quot;maker.item.source.generator&quot;
                end
              end

              class Icon &lt; IconBase
                def to_feed(feed, current)
                  icon = current.class::Icon.new
                  class &lt;&lt; icon
                    alias_method(:url=, :content=)
                  end
                  set = setup_values(icon)
                  class &lt;&lt; icon
                    remove_method(:url=)
                  end
                  if set
                    current.icon = icon
                    set_parent(icon, current)
                    setup_other_elements(feed, icon)
                  elsif variable_is_set?
                    raise NotSetError.new(&quot;maker.item.source.icon&quot;,
                                          not_set_required_variables)
                  end
                end

                private
                def required_variable_names
                  %w(url)
                end
              end

              class Links &lt; LinksBase
                class Link &lt; LinkBase
                  include AtomLink

                  def self.not_set_name
                    &quot;maker.item.source.link&quot;
                  end
                end
              end

              class Logo &lt; LogoBase
                include AtomLogo

                def self.not_set_name
                  &quot;maker.item.source.logo&quot;
                end
              end

              maker_name_base = &quot;maker.item.source.&quot;
              maker_name = &quot;#{maker_name_base}rights&quot;
              AtomTextConstruct.def_atom_text_construct(self, &quot;rights&quot;,
                                                        maker_name)
              maker_name = &quot;#{maker_name_base}subtitle&quot;
              AtomTextConstruct.def_atom_text_construct(self, &quot;subtitle&quot;,
                                                        maker_name)
              maker_name = &quot;#{maker_name_base}title&quot;
              AtomTextConstruct.def_atom_text_construct(self, &quot;title&quot;,
                                                        maker_name)
            end

            class Categories &lt; CategoriesBase
              class Category &lt; CategoryBase
                include AtomCategory

                def self.not_set_name
                  &quot;maker.item.category&quot;
                end
              end
            end

            AtomPersons.def_atom_persons(self, &quot;author&quot;, &quot;maker.item.author&quot;)
            AtomPersons.def_atom_persons(self, &quot;contributor&quot;,
                                         &quot;maker.item.contributor&quot;)

            class Links &lt; LinksBase
              class Link &lt; LinkBase
                include AtomLink

                def self.not_set_name
                  &quot;maker.item.link&quot;
                end
              end
            end

            AtomTextConstruct.def_atom_text_construct(self, &quot;rights&quot;,
                                                      &quot;maker.item.rights&quot;)
            AtomTextConstruct.def_atom_text_construct(self, &quot;summary&quot;,
                                                      &quot;maker.item.description&quot;,
                                                      &quot;Description&quot;)
            AtomTextConstruct.def_atom_text_construct(self, &quot;title&quot;,
                                                      &quot;maker.item.title&quot;)

            class Content &lt; ContentBase
              def to_feed(feed, current)
                content = current.class::Content.new
                if setup_values(content)
                  content.src = nil if content.src and content.content
                  current.content = content
                  set_parent(content, current)
                  setup_other_elements(feed, content)
                elsif variable_is_set?
                  raise NotSetError.new(&quot;maker.item.content&quot;,
                                        not_set_required_variables)
                end
              end

              alias_method(:xml, :xml_content)

              private
              def required_variable_names
                if out_of_line?
                  %w(type)
                elsif xml_type?
                  %w(xml_content)
                else
                  %w(content)
                end
              end

              def variables
                if out_of_line?
                  super
                elsif xml_type?
                  super + %w(xml)
                else
                  super
                end
              end

              def xml_type?
                _type = type
                return false if _type.nil?
                _type == &quot;xhtml&quot; or
                  /(?:\+xml|\/xml)$/i =~ _type or
                  %w(text/xml-external-parsed-entity
                     application/xml-external-parsed-entity
                     application/xml-dtd).include?(_type.downcase)
              end
            end
          end
        end

        class Textinput &lt; TextinputBase
        end
      end
    end

    add_maker(&quot;atom&quot;, &quot;1.0&quot;, Atom::Feed)
    add_maker(&quot;atom:feed&quot;, &quot;1.0&quot;, Atom::Feed)
    add_maker(&quot;atom1.0&quot;, &quot;1.0&quot;, Atom::Feed)
    add_maker(&quot;atom1.0:feed&quot;, &quot;1.0&quot;, Atom::Feed)
  end
end
</pre>
    </div>