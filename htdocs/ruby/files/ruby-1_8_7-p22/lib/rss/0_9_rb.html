  <div id="fileHeader">
    <h1>0.9.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>ruby-1.8.7-p22/lib/rss/0.9.rb
      </td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sun Oct 21 07:19:43 -0500 2007</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require &quot;rss/parser&quot;

module RSS

  module RSS09
    NSPOOL = {}
    ELEMENTS = []

    def self.append_features(klass)
      super
      
      klass.install_must_call_validator('', &quot;&quot;)
    end
  end

  class Rss &lt; Element

    include RSS09
    include RootElementMixin

    %w(channel).each do |name|
      install_have_child_element(name, &quot;&quot;, nil)
    end

    attr_writer :feed_version
    alias_method(:rss_version, :feed_version)
    alias_method(:rss_version=, :feed_version=)

    def initialize(feed_version, version=nil, encoding=nil, standalone=nil)
      super
      @feed_type = &quot;rss&quot;
    end

    def items
      if @channel
        @channel.items
      else
        []
      end
    end

    def image
      if @channel
        @channel.image
      else
        nil
      end
    end

    def textinput
      if @channel
        @channel.textInput
      else
        nil
      end
    end

    def setup_maker_elements(maker)
      super
      items.each do |item|
        item.setup_maker(maker.items)
      end
      image.setup_maker(maker) if image
      textinput.setup_maker(maker) if textinput
    end

    private
    def _attrs
      [
        [&quot;version&quot;, true, &quot;feed_version&quot;],
      ]
    end

    class Channel &lt; Element

      include RSS09

      [
        [&quot;title&quot;, nil, :text],
        [&quot;link&quot;, nil, :text],
        [&quot;description&quot;, nil, :text],
        [&quot;language&quot;, nil, :text],
        [&quot;copyright&quot;, &quot;?&quot;, :text],
        [&quot;managingEditor&quot;, &quot;?&quot;, :text],
        [&quot;webMaster&quot;, &quot;?&quot;, :text],
        [&quot;rating&quot;, &quot;?&quot;, :text],
        [&quot;pubDate&quot;, &quot;?&quot;, :date, :rfc822],
        [&quot;lastBuildDate&quot;, &quot;?&quot;, :date, :rfc822],
        [&quot;docs&quot;, &quot;?&quot;, :text],
        [&quot;cloud&quot;, &quot;?&quot;, :have_attribute],
        [&quot;skipDays&quot;, &quot;?&quot;, :have_child],
        [&quot;skipHours&quot;, &quot;?&quot;, :have_child],
        [&quot;image&quot;, nil, :have_child],
        [&quot;item&quot;, &quot;*&quot;, :have_children],
        [&quot;textInput&quot;, &quot;?&quot;, :have_child],
      ].each do |name, occurs, type, *args|
        __send__(&quot;install_#{type}_element&quot;, name, &quot;&quot;, occurs, name, *args)
      end
      alias date pubDate
      alias date= pubDate=

      private
      def maker_target(maker)
        maker.channel
      end

      def setup_maker_elements(channel)
        super
        [
          [skipDays, &quot;day&quot;],
          [skipHours, &quot;hour&quot;],
        ].each do |skip, key|
          if skip
            skip.__send__(&quot;#{key}s&quot;).each do |val|
              target_skips = channel.__send__(&quot;skip#{key.capitalize}s&quot;)
              new_target = target_skips.__send__(&quot;new_#{key}&quot;)
              new_target.content = val.content
            end
          end
        end
      end

      def not_need_to_call_setup_maker_variables
        %w(image textInput)
      end
    
      class SkipDays &lt; Element
        include RSS09

        [
          [&quot;day&quot;, &quot;*&quot;]
        ].each do |name, occurs|
          install_have_children_element(name, &quot;&quot;, occurs)
        end

        class Day &lt; Element
          include RSS09

          content_setup

          def initialize(*args)
            if Utils.element_initialize_arguments?(args)
              super
            else
              super()
              self.content = args[0]
            end
          end
      
        end
        
      end
      
      class SkipHours &lt; Element
        include RSS09

        [
          [&quot;hour&quot;, &quot;*&quot;]
        ].each do |name, occurs|
          install_have_children_element(name, &quot;&quot;, occurs)
        end

        class Hour &lt; Element
          include RSS09

          content_setup(:integer)

          def initialize(*args)
            if Utils.element_initialize_arguments?(args)
              super
            else
              super()
              self.content = args[0]
            end
          end
        end
        
      end
      
      class Image &lt; Element

        include RSS09
        
        %w(url title link).each do |name|
          install_text_element(name, &quot;&quot;, nil)
        end
        [
          [&quot;width&quot;, :integer],
          [&quot;height&quot;, :integer],
          [&quot;description&quot;],
        ].each do |name, type|
          install_text_element(name, &quot;&quot;, &quot;?&quot;, name, type)
        end

        def initialize(*args)
          if Utils.element_initialize_arguments?(args)
            super
          else
            super()
            self.url = args[0]
            self.title = args[1]
            self.link = args[2]
            self.width = args[3]
            self.height = args[4]
            self.description = args[5]
          end
        end

        private
        def maker_target(maker)
          maker.image
        end
      end

      class Cloud &lt; Element

        include RSS09

        [
          [&quot;domain&quot;, &quot;&quot;, true],
          [&quot;port&quot;, &quot;&quot;, true, :integer],
          [&quot;path&quot;, &quot;&quot;, true],
          [&quot;registerProcedure&quot;, &quot;&quot;, true],
          [&quot;protocol&quot;, &quot;&quot;, true],
        ].each do |name, uri, required, type|
          install_get_attribute(name, uri, required, type)
        end

        def initialize(*args)
          if Utils.element_initialize_arguments?(args)
            super
          else
            super()
            self.domain = args[0]
            self.port = args[1]
            self.path = args[2]
            self.registerProcedure = args[3]
            self.protocol = args[4]
          end
        end
      end
      
      class Item &lt; Element
        
        include RSS09

        [
          [&quot;title&quot;, '?', :text],
          [&quot;link&quot;, '?', :text],
          [&quot;description&quot;, '?', :text],
          [&quot;category&quot;, '*', :have_children, &quot;categories&quot;],
          [&quot;source&quot;, '?', :have_child],
          [&quot;enclosure&quot;, '?', :have_child],
        ].each do |tag, occurs, type, *args|
          __send__(&quot;install_#{type}_element&quot;, tag, &quot;&quot;, occurs, tag, *args)
        end

        private
        def maker_target(items)
          if items.respond_to?(&quot;items&quot;)
            # For backward compatibility
            items = items.items
          end
          items.new_item
        end

        def setup_maker_element(item)
          super
          @enclosure.setup_maker(item) if @enclosure
          @source.setup_maker(item) if @source
        end
        
        class Source &lt; Element

          include RSS09

          [
            [&quot;url&quot;, &quot;&quot;, true]
          ].each do |name, uri, required|
            install_get_attribute(name, uri, required)
          end
          
          content_setup

          def initialize(*args)
            if Utils.element_initialize_arguments?(args)
              super
            else
              super()
              self.url = args[0]
              self.content = args[1]
            end
          end

          private
          def maker_target(item)
            item.source
          end

          def setup_maker_attributes(source)
            source.url = url
            source.content = content
          end
        end

        class Enclosure &lt; Element

          include RSS09

          [
            [&quot;url&quot;, &quot;&quot;, true],
            [&quot;length&quot;, &quot;&quot;, true, :integer],
            [&quot;type&quot;, &quot;&quot;, true],
          ].each do |name, uri, required, type|
            install_get_attribute(name, uri, required, type)
          end

          def initialize(*args)
            if Utils.element_initialize_arguments?(args)
              super
            else
              super()
              self.url = args[0]
              self.length = args[1]
              self.type = args[2]
            end
          end

          private
          def maker_target(item)
            item.enclosure
          end

          def setup_maker_attributes(enclosure)
            enclosure.url = url
            enclosure.length = length
            enclosure.type = type
          end
        end

        class Category &lt; Element

          include RSS09
          
          [
            [&quot;domain&quot;, &quot;&quot;, false]
          ].each do |name, uri, required|
            install_get_attribute(name, uri, required)
          end

          content_setup

          def initialize(*args)
            if Utils.element_initialize_arguments?(args)
              super
            else
              super()
              self.domain = args[0]
              self.content = args[1]
            end
          end

          private
          def maker_target(item)
            item.new_category
          end

          def setup_maker_attributes(category)
            category.domain = domain
            category.content = content
          end
          
        end

      end
      
      class TextInput &lt; Element

        include RSS09

        %w(title description name link).each do |name|
          install_text_element(name, &quot;&quot;, nil)
        end

        def initialize(*args)
          if Utils.element_initialize_arguments?(args)
            super
          else
            super()
            self.title = args[0]
            self.description = args[1]
            self.name = args[2]
            self.link = args[3]
          end
        end

        private
        def maker_target(maker)
          maker.textinput
        end
      end
      
    end
    
  end

  RSS09::ELEMENTS.each do |name|
    BaseListener.install_get_text_element(&quot;&quot;, name, name)
  end

  module ListenerMixin
    private
    def initial_start_rss(tag_name, prefix, attrs, ns)
      check_ns(tag_name, prefix, ns, &quot;&quot;)
      
      @rss = Rss.new(attrs['version'], @version, @encoding, @standalone)
      @rss.do_validate = @do_validate
      @rss.xml_stylesheets = @xml_stylesheets
      @last_element = @rss
      pr = Proc.new do |text, tags|
        @rss.validate_for_stream(tags, @ignore_unknown_element) if @do_validate
      end
      @proc_stack.push(pr)
    end
    
  end

end
</pre>
    </div>