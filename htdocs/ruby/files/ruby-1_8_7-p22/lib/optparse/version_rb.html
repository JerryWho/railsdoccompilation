  <div id="fileHeader">
    <h1>version.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>ruby-1.8.7-p22/lib/optparse/version.rb
      </td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Feb 12 17:01:19 -0600 2007</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre># OptionParser internal utility

class &lt;&lt; OptionParser
  def show_version(*pkg)
    progname = ARGV.options.program_name
    result = false
    show = proc do |klass, cname, version|
      str = &quot;#{progname}&quot;
      unless klass == ::Object and cname == :VERSION
        version = version.join(&quot;.&quot;) if Array === version
        str &lt;&lt; &quot;: #{klass}&quot; unless klass == Object
        str &lt;&lt; &quot; version #{version}&quot;
      end
      [:Release, :RELEASE].find do |rel|
        if klass.const_defined?(rel)
          str &lt;&lt; &quot; (#{klass.const_get(rel)})&quot;
        end
      end
      puts str
      result = true
    end
    if pkg.size == 1 and pkg[0] == &quot;all&quot;
      self.search_const(::Object, /\AV(?:ERSION|ersion)\z/) do |klass, cname, version|
        unless cname[1] == ?e and klass.const_defined?(:Version)
          show.call(klass, cname.intern, version)
        end
      end
    else
      pkg.each do |pkg|
        begin
          pkg = pkg.split(/::|\//).inject(::Object) {|m, c| m.const_get(c)}
          v = case
              when pkg.const_defined?(:Version)
                pkg.const_get(n = :Version)
              when pkg.const_defined?(:VERSION)
                pkg.const_get(n = :VERSION)
              else
                n = nil
                &quot;unknown&quot;
              end
          show.call(pkg, n, v)
        rescue NameError
        end
      end
    end
    result
  end

  def each_const(path, klass = ::Object)
    path.split(/::|\//).inject(klass) do |klass, name|
      raise NameError, path unless Module === klass
      klass.constants.grep(/#{name}/i) do |c|
        klass.const_defined?(c) or next
        c = klass.const_get(c)
      end
    end
  end

  def search_const(klass, name)
    klasses = [klass]
    while klass = klasses.shift
      klass.constants.each do |cname|
        klass.const_defined?(cname) or next
        const = klass.const_get(cname)
        yield klass, cname, const if name === cname
        klasses &lt;&lt; const if Module === const and const != ::Object
      end
    end
  end
end
</pre>
    </div>