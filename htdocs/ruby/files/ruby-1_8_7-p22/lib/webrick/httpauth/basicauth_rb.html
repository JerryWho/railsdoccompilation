  <div id="fileHeader">
    <h1>basicauth.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>ruby-1.8.7-p22/lib/webrick/httpauth/basicauth.rb
      </td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Feb 12 17:01:19 -0600 2007</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>#
# httpauth/basicauth.rb -- HTTP basic access authentication
#
# Author: IPR -- Internet Programming with Ruby -- writers
# Copyright (c) 2003 Internet Programming with Ruby writers. All rights
# reserved.
#
# $IPR: basicauth.rb,v 1.5 2003/02/20 07:15:47 gotoyuzo Exp $

require 'webrick/config'
require 'webrick/httpstatus'
require 'webrick/httpauth/authenticator'

module WEBrick
  module HTTPAuth
    class BasicAuth
      include Authenticator

      AuthScheme = &quot;Basic&quot;

      def self.make_passwd(realm, user, pass)
        pass ||= &quot;&quot;
        pass.crypt(Utils::random_string(2))
      end

      attr_reader :realm, :userdb, :logger

      def initialize(config, default=Config::BasicAuth)
        check_init(config)
        @config = default.dup.update(config)
      end

      def authenticate(req, res)
        unless basic_credentials = check_scheme(req)
          challenge(req, res)
        end
        userid, password = basic_credentials.unpack(&quot;m*&quot;)[0].split(&quot;:&quot;, 2) 
        password ||= &quot;&quot;
        if userid.empty?
          error(&quot;user id was not given.&quot;)
          challenge(req, res)
        end
        unless encpass = @userdb.get_passwd(@realm, userid, @reload_db)
          error(&quot;%s: the user is not allowed.&quot;, userid)
          challenge(req, res)
        end
        if password.crypt(encpass) != encpass
          error(&quot;%s: password unmatch.&quot;, userid)
          challenge(req, res)
        end
        info(&quot;%s: authentication succeeded.&quot;, userid)
        req.user = userid
      end

      def challenge(req, res)
        res[@response_field] = &quot;#{@auth_scheme} realm=\&quot;#{@realm}\&quot;&quot;
        raise @auth_exception
      end
    end

    class ProxyBasicAuth &lt; BasicAuth
      include ProxyAuthenticator
    end
  end
end
</pre>
    </div>