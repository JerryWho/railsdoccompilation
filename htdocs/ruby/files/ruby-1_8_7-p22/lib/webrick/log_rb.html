  <div id="fileHeader">
    <h1>log.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>ruby-1.8.7-p22/lib/webrick/log.rb
      </td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Feb 12 17:01:19 -0600 2007</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>#
# log.rb -- Log Class
#
# Author: IPR -- Internet Programming with Ruby -- writers
# Copyright (c) 2000, 2001 TAKAHASHI Masayoshi, GOTOU Yuuzou
# Copyright (c) 2002 Internet Programming with Ruby writers. All rights
# reserved.
#
# $IPR: log.rb,v 1.26 2002/10/06 17:06:10 gotoyuzo Exp $

module WEBrick
  class BasicLog
    # log-level constant
    FATAL, ERROR, WARN, INFO, DEBUG = 1, 2, 3, 4, 5

    attr_accessor :level

    def initialize(log_file=nil, level=nil)
      @level = level || INFO
      case log_file
      when String
        @log = open(log_file, &quot;a+&quot;)
        @log.sync = true
        @opened = true
      when NilClass
        @log = $stderr
      else
        @log = log_file  # requires &quot;&lt;&lt;&quot;. (see BasicLog#log)
      end
    end

    def close
      @log.close if @opened
      @log = nil
    end

    def log(level, data)
      if @log &amp;&amp; level &lt;= @level
        data += &quot;\n&quot; if /\n\Z/ !~ data
        @log &lt;&lt; data
      end
    end

    def &lt;&lt;(obj)
      log(INFO, obj.to_s)
    end

    def fatal(msg) log(FATAL, &quot;FATAL &quot; &lt;&lt; format(msg)); end
    def error(msg) log(ERROR, &quot;ERROR &quot; &lt;&lt; format(msg)); end
    def warn(msg)  log(WARN,  &quot;WARN  &quot; &lt;&lt; format(msg)); end
    def info(msg)  log(INFO,  &quot;INFO  &quot; &lt;&lt; format(msg)); end
    def debug(msg) log(DEBUG, &quot;DEBUG &quot; &lt;&lt; format(msg)); end

    def fatal?; @level &gt;= FATAL; end
    def error?; @level &gt;= ERROR; end
    def warn?;  @level &gt;= WARN; end
    def info?;  @level &gt;= INFO; end
    def debug?; @level &gt;= DEBUG; end

    private

    def format(arg)
      str = if arg.is_a?(Exception)
        &quot;#{arg.class}: #{arg.message}\n\t&quot; &lt;&lt;
        arg.backtrace.join(&quot;\n\t&quot;) &lt;&lt; &quot;\n&quot;
      elsif arg.respond_to?(:to_str)
        arg.to_str
      else
        arg.inspect
      end
    end
  end

  class Log &lt; BasicLog
    attr_accessor :time_format 

    def initialize(log_file=nil, level=nil)
      super(log_file, level)
      @time_format = &quot;[%Y-%m-%d %H:%M:%S]&quot;
    end

    def log(level, data)
      tmp = Time.now.strftime(@time_format)
      tmp &lt;&lt; &quot; &quot; &lt;&lt; data
      super(level, tmp)
    end
  end
end
</pre>
    </div>