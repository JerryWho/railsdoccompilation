  <div id="fileHeader">
    <h1>accesslog.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>ruby-1.8.7-p22/lib/webrick/accesslog.rb
      </td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Feb 12 17:01:19 -0600 2007</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>#
# accesslog.rb -- Access log handling utilities
#
# Author: IPR -- Internet Programming with Ruby -- writers
# Copyright (c) 2002 keita yamaguchi
# Copyright (c) 2002 Internet Programming with Ruby writers
#
# $IPR: accesslog.rb,v 1.1 2002/10/01 17:16:32 gotoyuzo Exp $

module WEBrick
  module AccessLog
    class AccessLogError &lt; StandardError; end

    CLF_TIME_FORMAT     = &quot;[%d/%b/%Y:%H:%M:%S %Z]&quot;
    COMMON_LOG_FORMAT   = &quot;%h %l %u %t \&quot;%r\&quot; %s %b&quot;
    CLF                 = COMMON_LOG_FORMAT
    REFERER_LOG_FORMAT  = &quot;%{Referer}i -&gt; %U&quot;
    AGENT_LOG_FORMAT    = &quot;%{User-Agent}i&quot;
    COMBINED_LOG_FORMAT = &quot;#{CLF} \&quot;%{Referer}i\&quot; \&quot;%{User-agent}i\&quot;&quot;

    module_function

    # This format specification is a subset of mod_log_config of Apache.
    #   http://httpd.apache.org/docs/mod/mod_log_config.html#formats
    def setup_params(config, req, res)
      params = Hash.new(&quot;&quot;)
      params[&quot;a&quot;] = req.peeraddr[3]
      params[&quot;b&quot;] = res.sent_size
      params[&quot;e&quot;] = ENV
      params[&quot;f&quot;] = res.filename || &quot;&quot;
      params[&quot;h&quot;] = req.peeraddr[2]
      params[&quot;i&quot;] = req
      params[&quot;l&quot;] = &quot;-&quot;
      params[&quot;m&quot;] = req.request_method
      params[&quot;n&quot;] = req.attributes
      params[&quot;o&quot;] = res
      params[&quot;p&quot;] = req.port
      params[&quot;q&quot;] = req.query_string
      params[&quot;r&quot;] = req.request_line.sub(/\x0d?\x0a\z/o, '')
      params[&quot;s&quot;] = res.status       # won't support &quot;%&gt;s&quot;
      params[&quot;t&quot;] = req.request_time
      params[&quot;T&quot;] = Time.now - req.request_time
      params[&quot;u&quot;] = req.user || &quot;-&quot;
      params[&quot;U&quot;] = req.unparsed_uri
      params[&quot;v&quot;] = config[:ServerName]
      params
    end

    def format(format_string, params)
      format_string.gsub(/\%(?:\{(.*?)\})?&gt;?([a-zA-Z%])/){
         param, spec = $1, $2
         case spec[0]
         when ?e, ?i, ?n, ?o
           raise AccessLogError,
             &quot;parameter is required for \&quot;#{spec}\&quot;&quot; unless param
           params[spec][param] || &quot;-&quot;
         when ?t
           params[spec].strftime(param || CLF_TIME_FORMAT)
         when ?%
           &quot;%&quot;
         else
           params[spec]
         end
      }
    end
  end
end
</pre>
    </div>