  <div id="fileHeader">
    <h1>https.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>ruby-1.8.7-p22/lib/webrick/https.rb
      </td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Feb 12 17:01:19 -0600 2007</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>#
# https.rb -- SSL/TLS enhancement for HTTPServer
#
# Author: IPR -- Internet Programming with Ruby -- writers
# Copyright (c) 2001 GOTOU Yuuzou
# Copyright (c) 2002 Internet Programming with Ruby writers. All rights
# reserved.
#
# $IPR: https.rb,v 1.15 2003/07/22 19:20:42 gotoyuzo Exp $

require 'webrick/ssl'

module WEBrick
  module Config
    HTTP.update(SSL)
  end

  class HTTPRequest
    attr_reader :cipher, :server_cert, :client_cert

    alias orig_parse parse

    def parse(socket=nil)
      if socket.respond_to?(:cert)
        @server_cert = socket.cert || @config[:SSLCertificate]
        @client_cert = socket.peer_cert
        @client_cert_chain = socket.peer_cert_chain
        @cipher      = socket.cipher
      end
      orig_parse(socket)
    end

    alias orig_parse_uri parse_uri

    def parse_uri(str, scheme=&quot;https&quot;)
      if @server_cert
        return orig_parse_uri(str, scheme)
      end
      return orig_parse_uri(str)
    end

    alias orig_meta_vars meta_vars

    def meta_vars
      meta = orig_meta_vars
      if @server_cert
        meta[&quot;HTTPS&quot;] = &quot;on&quot;
        meta[&quot;SSL_SERVER_CERT&quot;] = @server_cert.to_pem
        meta[&quot;SSL_CLIENT_CERT&quot;] = @client_cert ? @client_cert.to_pem : &quot;&quot;
        if @client_cert_chain
          @client_cert_chain.each_with_index{|cert, i|
            meta[&quot;SSL_CLIENT_CERT_CHAIN_#{i}&quot;] = cert.to_pem
          }
        end
        meta[&quot;SSL_CIPHER&quot;] = @cipher[0]
        meta[&quot;SSL_PROTOCOL&quot;] = @cipher[1]
        meta[&quot;SSL_CIPHER_USEKEYSIZE&quot;] = @cipher[2].to_s
        meta[&quot;SSL_CIPHER_ALGKEYSIZE&quot;] = @cipher[3].to_s
      end
      meta
    end
  end
end
</pre>
    </div>