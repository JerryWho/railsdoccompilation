  <div id="fileHeader">
    <h1>proc.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>lib/cucumber/core_ext/proc.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sun Jul 25 18:21:09 +0200 2010</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre># Proc extension to get more location info out of a proc
class Proc #:nodoc:
  PROC_PATTERN = /[\d\w]+@(.+):(\d+).*&gt;/
  
  def to_comment_line
    &quot;# #{file_colon_line}&quot;
  end

  def backtrace_line(name)
    &quot;#{file_colon_line}:in `#{name}'&quot;
  end

  if Proc.new{}.to_s =~ PROC_PATTERN
    def file_colon_line
      path, line = *to_s.match(PROC_PATTERN)[1..2]
      path = File.expand_path(path)
      pwd = File.expand_path(Dir.pwd)
      if path.index(pwd)
        path = path[pwd.length+1..-1]
      elsif path =~ /.*\/gems\/(.*\.rb)$/
        path = $1
      end
      &quot;#{path}:#{line}&quot;
    end
  else
    # This Ruby implementation doesn't implement Proc#to_s correctly
    STDERR.puts &quot;*** THIS RUBY IMPLEMENTATION DOESN'T REPORT FILE AND LINE FOR PROCS ***&quot;
    
    def file_colon_line
      &quot;UNKNOWN:-1&quot;
    end
  end
end 
</pre>
    </div>