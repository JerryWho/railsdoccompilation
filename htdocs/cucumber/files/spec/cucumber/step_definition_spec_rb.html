  <div id="fileHeader">
    <h1>step_definition_spec.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>spec/cucumber/step_definition_spec.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sat Mar 28 20:11:24 +0100 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require File.dirname(__FILE__) + '/../spec_helper'

require 'cucumber/ast'
require 'cucumber/step_mother'
require 'cucumber/step_definition'

module Cucumber
  describe StepDefinition do
    before do
      extend StepMother
      @world = new_world!
      $inside = nil
    end

    it &quot;should allow calling of other steps&quot; do
      Given /Outside/ do
        Given &quot;Inside&quot;
      end
      Given /Inside/ do
        $inside = true
      end

      step_match(&quot;Outside&quot;).invoke(@world, nil)
      $inside.should == true
    end

    it &quot;should allow calling of other steps with inline arg&quot; do
      Given /Outside/ do
        Given &quot;Inside&quot;, Ast::Table.new([['inside']])
      end
      Given /Inside/ do |table|
        $inside = table.raw[0][0]
      end

      step_match(&quot;Outside&quot;).invoke(@world, nil)
      $inside.should == 'inside'
    end

    it &quot;should raise Undefined when inside step is not defined&quot; do
      Given /Outside/ do
        Given 'Inside'
      end

      step = mock('Step')
      step.should_receive(:exception=)
      lambda do
        @world.__cucumber_current_step = step
        step_match('Outside').invoke(@world, nil)
      end.should raise_error(Undefined, 'Undefined step: &quot;Inside&quot;')
    end

    it &quot;should allow forced pending&quot; do
      Given /Outside/ do
        pending(&quot;Do me!&quot;)
      end

      lambda do
        step_match(&quot;Outside&quot;).invoke(@world, nil)
      end.should raise_error(Pending, &quot;Do me!&quot;)
    end

    it &quot;should allow announce&quot; do
      v = mock('visitor')
      v.should_receive(:announce).with('wasup')
      self.visitor = v
      world = new_world!
      Given /Loud/ do
        announce 'wasup'
      end
      step_match(&quot;Loud&quot;).invoke(world, nil)
    end
    
    def unindented(s)
      s.split(&quot;\n&quot;)[1..-2].join(&quot;\n&quot;).indent(-8)
    end
    
    it &quot;should recognise quotes in name and make according regexp&quot; do
      StepDefinition.snippet_text('Given', 'A &quot;first&quot; arg').should == unindented(%{
        Given /^A &quot;([^\\&quot;]*)&quot; arg$/ do |arg1|
          pending
        end
      })
    end

    it &quot;should not use quote group when there are no quotes&quot; do
      StepDefinition.snippet_text('Given', 'A first arg').should == unindented(%{
        Given /^A first arg$/ do
          pending
        end
      })
    end
  end
end
</pre>
    </div>