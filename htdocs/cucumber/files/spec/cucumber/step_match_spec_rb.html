  <div id="fileHeader">
    <h1>step_match_spec.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>spec/cucumber/step_match_spec.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sun Jul 25 18:21:09 +0200 2010</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre># encoding: utf-8
require File.expand_path(File.dirname(__FILE__) + '/../spec_helper')
require 'cucumber/rb_support/rb_step_definition'
require 'cucumber/rb_support/rb_language'

module Cucumber
  describe StepMatch do
    before do
      @rb_language = RbSupport::RbLanguage.new(nil)
    end

    def stepdef(regexp)
      RbSupport::RbStepDefinition.new(@rb_language, regexp, lambda{})
    end

    def step_match(regexp, name)
      stepdef = stepdef(regexp)
      StepMatch.new(stepdef, name, nil, stepdef.arguments_from(name))
    end

    it &quot;should format one group when we use Unicode&quot; do
      m = step_match(/I (\w+) ok/, &quot;I æøåÆØÅæøåÆØÅæøåÆØÅæøåÆØÅ ok&quot;)
      m.format_args(&quot;&lt;span&gt;%s&lt;/span&gt;&quot;).should == &quot;I &lt;span&gt;æøåÆØÅæøåÆØÅæøåÆØÅæøåÆØÅ&lt;/span&gt; ok&quot;
    end

    it &quot;should format several groups when we use Unicode&quot; do
      m = step_match(/I (\w+) (\w+) (\w+) this (\w+)/, &quot;I ate æøåÆØÅæøåÆØÅæøåÆØÅæøåÆØÅ egg this morning&quot;)
      m.format_args(&quot;&lt;span&gt;%s&lt;/span&gt;&quot;).should == &quot;I &lt;span&gt;ate&lt;/span&gt; &lt;span&gt;æøåÆØÅæøåÆØÅæøåÆØÅæøåÆØÅ&lt;/span&gt; &lt;span&gt;egg&lt;/span&gt; this &lt;span&gt;morning&lt;/span&gt;&quot;
    end

    it &quot;should deal with Unicode both inside and outside arguments&quot; do
      &quot;Jæ vø ålsker døtte løndet&quot;.should =~ /Jæ (\w+) ålsker (\w+) løndet/
      m = step_match(/Jæ (\w+) ålsker (\w+) løndet/, &quot;Jæ vø ålsker døtte løndet&quot;)
      m.format_args(&quot;&lt;span&gt;%s&lt;/span&gt;&quot;).should == &quot;Jæ &lt;span&gt;vø&lt;/span&gt; ålsker &lt;span&gt;døtte&lt;/span&gt; løndet&quot;
    end

    it &quot;should format groups with format string&quot; do
      m = step_match(/I (\w+) (\d+) (\w+) this (\w+)/, &quot;I ate 1 egg this morning&quot;)
      m.format_args(&quot;&lt;span&gt;%s&lt;/span&gt;&quot;).should == &quot;I &lt;span&gt;ate&lt;/span&gt; &lt;span&gt;1&lt;/span&gt; &lt;span&gt;egg&lt;/span&gt; this &lt;span&gt;morning&lt;/span&gt;&quot;
    end

    it &quot;should format groups with format string when there are dupes&quot; do
      m = step_match(/I (\w+) (\d+) (\w+) this (\w+)/, &quot;I bob 1 bo this bobs&quot;)
      m.format_args(&quot;&lt;span&gt;%s&lt;/span&gt;&quot;).should == &quot;I &lt;span&gt;bob&lt;/span&gt; &lt;span&gt;1&lt;/span&gt; &lt;span&gt;bo&lt;/span&gt; this &lt;span&gt;bobs&lt;/span&gt;&quot;
    end

    it &quot;should format groups with block&quot; do
      m = step_match(/I (\w+) (\d+) (\w+) this (\w+)/, &quot;I ate 1 egg this morning&quot;)
      m.format_args(&amp;lambda{|m| &quot;&lt;span&gt;#{m}&lt;/span&gt;&quot;}).should == &quot;I &lt;span&gt;ate&lt;/span&gt; &lt;span&gt;1&lt;/span&gt; &lt;span&gt;egg&lt;/span&gt; this &lt;span&gt;morning&lt;/span&gt;&quot;
    end

    it &quot;should format groups with proc object&quot; do
      m = step_match(/I (\w+) (\d+) (\w+) this (\w+)/, &quot;I ate 1 egg this morning&quot;)
      m.format_args(lambda{|m| &quot;&lt;span&gt;#{m}&lt;/span&gt;&quot;}).should == &quot;I &lt;span&gt;ate&lt;/span&gt; &lt;span&gt;1&lt;/span&gt; &lt;span&gt;egg&lt;/span&gt; this &lt;span&gt;morning&lt;/span&gt;&quot;
    end

    it &quot;should format groups even when first group is optional and not matched&quot; do
      m = step_match(/should( not)? be flashed '([^']*?)'$/, &quot;I should be flashed 'Login failed.'&quot;)
      m.format_args(&quot;&lt;span&gt;%s&lt;/span&gt;&quot;).should == &quot;I should be flashed '&lt;span&gt;Login failed.&lt;/span&gt;'&quot;
    end

    it &quot;should format embedded groups&quot; do
      m = step_match(/running( (\d+) times)? (\d+) meters/, &quot;running 5 times 10 meters&quot;)
      m.format_args(&quot;&lt;span&gt;%s&lt;/span&gt;&quot;).should == &quot;running&lt;span&gt; 5 times&lt;/span&gt; &lt;span&gt;10&lt;/span&gt; meters&quot;
    end
  end
end</pre>
    </div>