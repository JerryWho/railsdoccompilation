  <div id="fileHeader">
    <h1>rb_step_definition_spec.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>spec/cucumber/rb_support/rb_step_definition_spec.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sun Jul 25 18:21:09 +0200 2010</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require File.expand_path(File.dirname(__FILE__) + '/../../spec_helper')

require 'cucumber/ast'
require 'cucumber/step_mother'
require 'cucumber/rb_support/rb_language'

module Cucumber
  module RbSupport
    describe RbStepDefinition do
      before do      
        @step_mother = Cucumber::StepMother.new
        @rb = @step_mother.load_programming_language('rb')
        @dsl = Object.new 
        @dsl.extend Cucumber::RbSupport::RbDsl
        @step_mother.before(mock('scenario').as_null_object)

        $inside = nil
      end
      
      it &quot;should allow calling of other steps&quot; do
        @dsl.Given /Outside/ do
          Given &quot;Inside&quot;
        end
        @dsl.Given /Inside/ do
          $inside = true
        end

        @step_mother.step_match(&quot;Outside&quot;).invoke(nil)
        $inside.should == true
      end

      it &quot;should allow calling of other steps with inline arg&quot; do
        @dsl.Given /Outside/ do
          Given &quot;Inside&quot;, Cucumber::Ast::Table.new([['inside']])
        end
        @dsl.Given /Inside/ do |table|
          $inside = table.raw[0][0]
        end

        @step_mother.step_match(&quot;Outside&quot;).invoke(nil)
        $inside.should == 'inside'
      end

      it &quot;should raise Undefined when inside step is not defined&quot; do
        @dsl.Given /Outside/ do
          Given 'Inside'
        end

        lambda do
          @step_mother.step_match('Outside').invoke(nil)
        end.should raise_error(Cucumber::Undefined, 'Undefined step: &quot;Inside&quot;')
      end

      it &quot;should allow forced pending&quot; do
        @dsl.Given /Outside/ do
          pending(&quot;Do me!&quot;)
        end

        lambda do
          @step_mother.step_match(&quot;Outside&quot;).invoke(nil)
        end.should raise_error(Cucumber::Pending, &quot;Do me!&quot;)
      end

      it &quot;should raise ArityMismatchError when the number of capture groups differs from the number of step arguments&quot; do
        @dsl.Given /No group: \w+/ do |arg|
        end

        lambda do
          @step_mother.step_match(&quot;No group: arg&quot;).invoke(nil)
        end.should raise_error(Cucumber::ArityMismatchError)
      end

      it &quot;should allow announce&quot; do
        v = mock('visitor')
        v.should_receive(:announce).with('wasup')
        @step_mother.visitor = v
        @dsl.Given /Loud/ do
          announce 'wasup'
        end
        
        @step_mother.step_match(&quot;Loud&quot;).invoke(nil)
      end
      
      it &quot;should recognize $arg style captures&quot; do
        @dsl.Given &quot;capture this: $arg&quot; do |arg|
          arg.should == 'this'
        end

       @step_mother.step_match('capture this: this').invoke(nil)
      end
    end
  end
end
</pre>
    </div>