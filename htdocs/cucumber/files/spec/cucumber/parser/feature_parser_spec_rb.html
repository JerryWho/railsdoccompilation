  <div id="fileHeader">
    <h1>feature_parser_spec.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>spec/cucumber/parser/feature_parser_spec.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sat Mar 28 20:11:24 +0100 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require File.dirname(__FILE__) + '/../../spec_helper'
require 'cucumber/parser'

module Cucumber
  module Parser
    describe Feature do
      before do
        @parser = FeatureParser.new
      end

      def parse(text)
        feature = @parser.parse_or_fail(text)
      end

      def parse_file(file)
        @parser.parse_file(File.dirname(__FILE__) + &quot;/../treetop_parser/&quot; + file)
      end

      def parse_example_file(file)
        @parser.parse_file(File.dirname(__FILE__) + &quot;/../../../examples/&quot; + file)
      end

      describe &quot;Header&quot; do
        it &quot;should parse Feature with blurb&quot; do
          parse(%{Feature: hi
with blurb
})
        end
      end

      describe &quot;Comments&quot; do
        it &quot;should parse a file with only a one line comment&quot; do
          parse(%{# My comment
Feature: hi
}).to_sexp.should ==
          [:feature, nil, &quot;Feature: hi\n&quot;,
            [:comment, &quot;# My comment\n&quot;]]
        end
        
        it &quot;should parse a comment within a scenario&quot; do
          pending &quot;Store comment in node and output it in pretty formatter&quot;
          parse(%{Feature: Hi
  Scenario: Hello
    Given foo
    # When bar
    Then baz
}).to_sexp.should == 
          [:feature, nil, &quot;Feature: Hi&quot;, 
            [:scenario, 2, &quot;Scenario:&quot;, &quot;Hello&quot;, 
              [:step, 3, &quot;Given&quot;, &quot;foo&quot;],
              [:comment, &quot;# When bar\n&quot;], 
              [:step, 5, &quot;Then&quot;, &quot;baz&quot;] 
            ]
          ]
        end

        it &quot;should parse a file with only a multiline comment&quot; do
          parse(%{# Hello
# World
Feature: hi
}).to_sexp.should ==
          [:feature, nil, &quot;Feature: hi\n&quot;,
            [:comment, &quot;# Hello\n# World\n&quot;]]
        end

        it &quot;should parse a file with no comments&quot; do
          parse(&quot;Feature: hi\n&quot;).to_sexp.should ==
          [:feature, nil, &quot;Feature: hi\n&quot;]
        end

        it &quot;should parse a file with only a multiline comment with newlines&quot; do
          parse(&quot;# Hello\n\n# World\n&quot;).to_sexp.should == 
          [:feature, nil, &quot;&quot;, 
            [:comment, &quot;# Hello\n\n# World\n&quot;]]
        end
      end

      describe &quot;Tags&quot; do
        it &quot;should parse a file with tags on a feature&quot; do
          parse(&quot;# My comment\n@hello @world Feature: hi\n&quot;).to_sexp.should ==
          [:feature, nil, &quot;Feature: hi\n&quot;,
            [:comment, &quot;# My comment\n&quot;],
            [:tag, &quot;hello&quot;],
            [:tag, &quot;world&quot;]]
        end

        it &quot;should parse a file with tags on a scenario&quot; do
          parse(%{# FC
  @ft
Feature: hi

  @st1 @st2   
  Scenario: First
    Given Pepper

@st3 
   @st4    @ST5  @#^%&amp;ST6**!
  Scenario: Second}).to_sexp.should ==
          [:feature, nil, &quot;Feature: hi&quot;,
            [:comment, &quot;# FC\n  &quot;],
            [:tag, &quot;ft&quot;],
            [:scenario, 6, 'Scenario:', 'First',
              [:tag, &quot;st1&quot;], [:tag, &quot;st2&quot;],
              [:step_invocation, 7, &quot;Given&quot;, &quot;Pepper&quot;]
            ],
            [:scenario, 11, 'Scenario:', 'Second',
              [:tag, &quot;st3&quot;], [:tag, &quot;st4&quot;], [:tag, &quot;ST5&quot;], [:tag, &quot;#^%&amp;ST6**!&quot;]]]
        end
      end
      
      describe &quot;Background&quot; do
        it &quot;should have steps&quot; do
          parse(&quot;Feature: Hi\nBackground:\nGiven I am a step\n&quot;).to_sexp.should ==
          [:feature, nil, &quot;Feature: Hi&quot;,
            [:background, 2, &quot;Background:&quot;,
              [:step, 3, &quot;Given&quot;, &quot;I am a step&quot;]]]
        end
      end

      describe &quot;Scenarios&quot; do
        it &quot;can be empty&quot; do
          parse(&quot;Feature: Hi\n\nScenario: Hello\n&quot;).to_sexp.should ==
          [:feature, nil, &quot;Feature: Hi&quot;,
            [:scenario, 3, &quot;Scenario:&quot;, &quot;Hello&quot;]]
        end

        it &quot;should allow whitespace lines after the Scenario line&quot; do
          parse(%{Feature: Foo

Scenario: bar

  Given baz})
        end
            
        it &quot;should have steps&quot; do
          parse(&quot;Feature: Hi\nScenario: Hello\nGiven I am a step\n&quot;).to_sexp.should ==
          [:feature, nil, &quot;Feature: Hi&quot;,
            [:scenario, 2, &quot;Scenario:&quot;, &quot;Hello&quot;,
              [:step_invocation, 3, &quot;Given&quot;, &quot;I am a step&quot;]]]
        end

        it &quot;should have steps with inline table&quot; do
          parse(%{Feature: Hi
Scenario: Hello
Given I have a table
|a|b|
}).to_sexp.should ==
          [:feature, nil, &quot;Feature: Hi&quot;,
            [:scenario, 2, &quot;Scenario:&quot;, &quot;Hello&quot;,
              [:step_invocation, 3, &quot;Given&quot;, &quot;I have a table&quot;,
                [:table,
                  [:row,
                    [:cell, &quot;a&quot;],
                    [:cell, &quot;b&quot;]]]]]]
        end

        it &quot;should have steps with inline py_string&quot; do
          parse(%{Feature: Hi
Scenario: Hello
Given I have a string


   &quot;&quot;&quot;
  hello
  world
  &quot;&quot;&quot;

}).to_sexp.should ==
          [:feature, nil, &quot;Feature: Hi&quot;,
            [:scenario, 2, &quot;Scenario:&quot;, &quot;Hello&quot;,
              [:step_invocation, 3, &quot;Given&quot;, &quot;I have a string&quot;,
                [:py_string, &quot;hello\nworld&quot;]]]]
        end
      end

      describe &quot;Scenario Outlines&quot; do
        it &quot;can be empty&quot; do
          parse(%{Feature: Hi
Scenario Outline: Hello
Given a &lt;what&gt; cucumber
Examples:
|what|
|green|
}).to_sexp.should ==
          [:feature, nil, &quot;Feature: Hi&quot;,
            [:scenario_outline, &quot;Scenario Outline:&quot;, &quot;Hello&quot;,
              [:step, 3, &quot;Given&quot;, &quot;a &lt;what&gt; cucumber&quot;],
              [:examples, &quot;Examples:&quot;, &quot;&quot;,
                [:table, 
                  [:row, 
                    [:cell, &quot;what&quot;]], 
                    [:row, [:cell, &quot;green&quot;]]]]]]
        end

        it &quot;should have line numbered steps with inline table&quot; do
          parse(%{Feature: Hi
Scenario Outline: Hello

Given I have a table

|&lt;a&gt;|&lt;b&gt;|
Examples:
|a|b|
|c|d|
}).to_sexp.should ==
          [:feature, nil, &quot;Feature: Hi&quot;,
            [:scenario_outline, &quot;Scenario Outline:&quot;, &quot;Hello&quot;,
              [:step, 4, &quot;Given&quot;, &quot;I have a table&quot;,
                [:table, 
                  [:row, 
                    [:cell, &quot;&lt;a&gt;&quot;], 
                    [:cell, &quot;&lt;b&gt;&quot;]]]],
            [:examples, &quot;Examples:&quot;, &quot;&quot;,
              [:table,
                [:row, 
                  [:cell, &quot;a&quot;], 
                  [:cell, &quot;b&quot;]],
                [:row, 
                  [:cell, &quot;c&quot;], 
                  [:cell, &quot;d&quot;]]]]]]
        end

        it &quot;should have examples&quot; do
          parse(&quot;Feature: Hi

  Scenario Outline: Hello

  Given I have a table
    |1|2|

  Examples:
|x|y|
|5|6|

&quot;).to_sexp.should ==
          [:feature, nil, &quot;Feature: Hi&quot;,
            [:scenario_outline, &quot;Scenario Outline:&quot;, &quot;Hello&quot;,
              [:step, 5, &quot;Given&quot;, &quot;I have a table&quot;,
                [:table,
                  [:row,
                    [:cell, &quot;1&quot;],
                    [:cell, &quot;2&quot;]]]],
              [:examples, &quot;Examples:&quot;, &quot;&quot;,
                [:table,
                  [:row,
                    [:cell, &quot;x&quot;],
                    [:cell, &quot;y&quot;]],
                  [:row,
                    [:cell, &quot;5&quot;],
                    [:cell, &quot;6&quot;]]]]]]
        end

        it &quot;should set line numbers on feature&quot; do
          feature = parse_file(&quot;empty_feature.feature:11:12&quot;)
          feature.instance_variable_get('@lines').should == [11, 12]
        end
      end

      describe &quot;Syntax&quot; do
        it &quot;should parse empty_feature&quot; do
          parse_file(&quot;empty_feature.feature&quot;)
        end

        it &quot;should parse empty_scenario&quot; do
          parse_file(&quot;empty_scenario.feature&quot;)
        end

        it &quot;should parse empty_scenario_outline&quot; do
          parse_file(&quot;empty_scenario_outline.feature&quot;)
        end

        it &quot;should parse fit_scenario&quot; do
          parse_file(&quot;multiline_steps.feature&quot;)
        end

        it &quot;should parse scenario_outline&quot; do
          parse_file(&quot;scenario_outline.feature&quot;)
        end
      end
    end
  end
end
</pre>
    </div>