  <div id="C00000016">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />Exception<br/>
  In:
<a href="#" onclick="jsHref('files/lib/cucumber/core_ext/exception_rb.html');">lib/cucumber/core_ext/exception.rb</a>

Parent:&nbsp;
        <a href="#" onclick="jsHref('classes/Object.html');">
Object
         </a>
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">

  <div class="description"><p>
<a href="index.html?a=C00000016&name=Exception">Exception</a> extension
that tweaks <a href="index.html?a=C00000016&name=Exception">Exception</a>
backtraces:
</p>
<ul>
<li>The line of the failing .feature line is appended to the backtrace

</li>
<li>The line that calls cucumber_instance_exec is replaced with the
StepDefinition&#8217;s regexp

</li>
<li>Non intersting lines are stripped out

</li>
</ul>
<p>
The result is that backtraces look like this:
</p>
<pre>
  features/step_definitions/the_step_definition.rb:in `/some step/'
  features/the_feature_file.feature:41:in `Given some step'
</pre>
<p>
or if the exception is raised in the tested code:
</p>
<pre>
  lib/myapp/some_file.rb:in `/some_method/'
  lib/myapp/some_other_file.rb:in `/some_other_method/'
  features/step_definitions/the_step_definition.rb:in `/some step/'
  features/the_feature_file.feature:41:in `Given some step'
</pre>
<p>
All backtrace munging can be turned off with the <tt>&#8212;backtrace</tt>
switch
</p>
</div>



  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M000048&name=cucumber_full_backtrace=" >cucumber_full_backtrace=</a></li>
  <li><a href="index.html?a=M000049&name=cucumber_strip_backtrace!" >cucumber_strip_backtrace!</a></li>
  </ul>




  <div class="sectiontitle">Constants</div>
  <table border='0' cellpadding='5'>
  <tr valign='top'>
    <td class="attr-name">CUCUMBER_FILTER_PATTERNS</td>
    <td>=</td>
    <td class="attr-value">[     /vendor\/rails|lib\/cucumber|bin\/cucumber:|lib\/rspec|gems\//</td>
  </tr>
  <tr valign='top'>
    <td class="attr-name">INSTANCE_EXEC_OFFSET</td>
    <td>=</td>
    <td class="attr-value">(Cucumber::RUBY_1_9 || Cucumber::JRUBY) ? -3 : -4</td>
  </tr>
  </table>


<div class="sectiontitle">Public Class methods</div>
<div id="M000048" class="method">
  <div id="M000048_title" class="title">
    <b>cucumber_full_backtrace=</b>(v)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000048_source')" id="l_M000048_source">show source</a> ]</p>
  <div id="M000048_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File lib/cucumber/core_ext/exception.rb, line 28</span>
28:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cucumber_full_backtrace=</span>(<span class="ruby-identifier">v</span>)
29:     <span class="ruby-ivar">@@cucumber_full_backtrace</span> = <span class="ruby-identifier">v</span>
30:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000049" class="method">
  <div id="M000049_title" class="title">
    <b>cucumber_strip_backtrace!</b>(backtrace, instance_exec_invocation_line, pseudo_method)
  </div>
  <div class="description">
  <p>
Strips the backtrace from <tt>line</tt> and down
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000049_source')" id="l_M000049_source">show source</a> ]</p>
  <div id="M000049_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File lib/cucumber/core_ext/exception.rb, line 34</span>
34:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cucumber_strip_backtrace!</span>(<span class="ruby-identifier">backtrace</span>, <span class="ruby-identifier">instance_exec_invocation_line</span>, <span class="ruby-identifier">pseudo_method</span>)
35:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@@cucumber_full_backtrace</span>
36: 
37:     <span class="ruby-identifier">instance_exec_pos</span> = <span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">instance_exec_invocation_line</span>)
38:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">instance_exec_pos</span>
39:       <span class="ruby-identifier">replacement_line</span> = <span class="ruby-identifier">instance_exec_pos</span> <span class="ruby-operator">+</span> <span class="ruby-constant">INSTANCE_EXEC_OFFSET</span>
40:       <span class="ruby-identifier">backtrace</span>[<span class="ruby-identifier">replacement_line</span>].<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/`.*'/</span>, <span class="ruby-node">&quot;`#{pseudo_method}'&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pseudo_method</span>
41:       <span class="ruby-identifier">backtrace</span>[<span class="ruby-identifier">replacement_line</span><span class="ruby-operator">+</span><span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>] = <span class="ruby-keyword kw">nil</span>
42: 
43:       <span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">compact!</span>
44:     <span class="ruby-keyword kw">else</span>
45:       <span class="ruby-comment cmt"># This happens with rails, because they screw up the backtrace</span>
46:       <span class="ruby-comment cmt"># before we get here (injecting erb stacktrace and such)</span>
47:     <span class="ruby-keyword kw">end</span>
48: 
49:     <span class="ruby-identifier">backtrace</span>.<span class="ruby-identifier">reject!</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
50:       <span class="ruby-constant">CUCUMBER_FILTER_PATTERNS</span>.<span class="ruby-identifier">detect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">p</span>}
51:     <span class="ruby-keyword kw">end</span>
52:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>