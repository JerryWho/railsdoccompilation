  <div id="fileHeader">
    <h1>spec_server_spec.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>spec/spec/rails/spec_server_spec.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Dec 29 13:13:00 +0100 2008</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre># require File.dirname(__FILE__) + '/../../spec_helper'
# 
# describe &quot;script/spec_server file&quot;, :shared =&gt; true do
#   attr_accessor :tmbundle_install_directory
#   attr_reader :animals_yml_path, :original_animals_content
# 
#   before do
#     @animals_yml_path = File.expand_path(&quot;#{RAILS_ROOT}/spec/fixtures/animals.yml&quot;)
#     @original_animals_content = File.read(animals_yml_path)
#   end
# 
#   after do
#     File.open(animals_yml_path, &quot;w&quot;) do |f|
#       f.write original_animals_content
#     end
#   end
# 
#   after(:each) do
#     system &quot;lsof -i tcp:8989 | sed /COMMAND/d | awk '{print $2}' | xargs kill&quot;
#   end
# 
#   it &quot;runs a spec&quot; do
#     dir = File.dirname(__FILE__)
#     output = &quot;&quot;
#     Timeout.timeout(10) do
#       loop do
#         output = `#{RAILS_ROOT}/script/spec #{dir}/sample_spec.rb --drb 2&gt;&amp;1`
#         break unless output.include?(&quot;No server is running&quot;)
#       end
#     end
# 
#     if $?.exitstatus != 0 || output !~ /0 failures/
#       flunk &quot;command 'script/spec spec/sample_spec' failed\n#{output}&quot;
#     end
# 
#     fixtures = YAML.load(@original_animals_content)
#     fixtures['pig']['name'] = &quot;Piggy&quot;
# 
#     File.open(animals_yml_path, &quot;w&quot;) do |f|
#       f.write YAML.dump(fixtures)
#     end
# 
#     Timeout.timeout(10) do
#       loop do
#         output = `#{RAILS_ROOT}/script/spec #{dir}/sample_modified_fixture.rb --drb 2&gt;&amp;1`
#         break unless output.include?(&quot;No server is running&quot;)
#       end
#     end
# 
#     if $?.exitstatus != 0 || output !~ /0 failures/
#       flunk &quot;command 'script/spec spec/sample_modified_fixture' failed\n#{output}&quot;
#     end
#   end
# 
#   def start_spec_server
#     dir = File.dirname(__FILE__)
#     Thread.start do
#       system &quot;cd #{RAILS_ROOT}; script/spec_server&quot;
#     end
# 
#     file_content = &quot;&quot;
#   end
# end
# 
# describe &quot;script/spec_server file without TextMate bundle&quot; do
#   it_should_behave_like &quot;script/spec_server file&quot;
#   before(:each) do
#     start_spec_server
#   end
# end
# 
# describe &quot;script/spec_server file with TextMate bundle&quot; do
#   it_should_behave_like &quot;script/spec_server file&quot;
#   before(:each) do
#     dir = File.dirname(__FILE__)
#     @tmbundle_install_directory = File.expand_path(&quot;#{Dir.tmpdir}/Library/Application Support/TextMate/Bundles&quot;)
#     @bundle_name = &quot;RSpec.tmbundle&quot;
#     FileUtils.mkdir_p(tmbundle_install_directory)
#     bundle_dir = File.expand_path(&quot;#{dir}/../../../../../../#{@bundle_name}&quot;)
#     File.directory?(bundle_dir).should be_true
#     unless system(%Q|ln -s #{bundle_dir} &quot;#{tmbundle_install_directory}&quot;|)
#       raise &quot;Creating link to Textmate Bundle&quot;
#     end
#     start_spec_server
#   end
# 
#   after(:each) do
#     bundle_file_to_remove = &quot;#{tmbundle_install_directory}/#{@bundle_name}&quot;
#     if bundle_file_to_remove == &quot;/&quot;
#       raise &quot;bundle file path resolved to '/' - could not call rm&quot;
#     end
#     unless system(%Q|rm &quot;#{bundle_file_to_remove}&quot;|)
#       raise &quot;Removing Textmate bundle link failed&quot;
#     end
#   end
# end
</pre>
    </div>