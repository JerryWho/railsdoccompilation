  <div id="fileHeader">
    <h1>stub_model_spec.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>spec/spec/rails/mocks/stub_model_spec.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Dec 29 13:13:00 +0100 2008</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require File.dirname(__FILE__) + '/../../../spec_helper'
require File.dirname(__FILE__) + '/ar_classes'

describe &quot;stub_model&quot; do
  describe &quot;defaults&quot; do
    it &quot;should have an id&quot; do
      stub_model(MockableModel).id.should be &gt; 0
    end
  
    it &quot;should say it is not a new record&quot; do
      stub_model(MockableModel).should_not be_new_record
    end
  end
  
  it &quot;should accept a stub id&quot; do
    stub_model(MockableModel, :id =&gt; 37).id.should == 37
  end
  
  it &quot;should say it is a new record when id is set to nil&quot; do
    stub_model(MockableModel, :id =&gt; nil).should be_new_record
  end
  
  it &quot;should accept any arbitrary stub&quot; do
    stub_model(MockableModel, :foo =&gt; &quot;bar&quot;).foo.should == &quot;bar&quot;
  end
  
  it &quot;should accept a stub for save&quot; do
    stub_model(MockableModel, :save =&gt; false).save.should be(false)
  end
  
  describe &quot;#as_new_record&quot; do
    it &quot;should say it is a new record&quot; do
      stub_model(MockableModel).as_new_record.should be_new_record
    end

    it &quot;should have a nil id&quot; do
      stub_model(MockableModel).as_new_record.id.should be(nil)
    end
  end
  
  it &quot;should raise when hitting the db&quot; do
    lambda do
      model = stub_model(MockableModel, :changed =&gt; true, :attributes_with_quotes =&gt; {'this' =&gt; 'that'})
      model.save
    end.should raise_error(Spec::Rails::IllegalDataAccessException, /stubbed models are not allowed to access the database/)
  end
  
  it &quot;should increment the id&quot; do
    first = stub_model(MockableModel)
    second = stub_model(MockableModel)
    second.id.should == (first.id + 1)
  end
  
  describe &quot;as association&quot; do
    before(:each) do
      @real = AssociatedModel.create!
      @stub_model = stub_model(MockableModel)
      @real.mockable_model = @stub_model
    end

    it &quot;should pass associated_model == mock&quot; do
        @stub_model.should == @real.mockable_model
    end

    it &quot;should pass mock == associated_model&quot; do
        @real.mockable_model.should == @stub_model
    end
  end

  describe &quot;with a block&quot; do
    it &quot;should yield the model&quot; do
      model = stub_model(MockableModel) do |block_arg|
        @block_arg = block_arg
      end
      model.should be(@block_arg)
    end
  end
end


</pre>
    </div>