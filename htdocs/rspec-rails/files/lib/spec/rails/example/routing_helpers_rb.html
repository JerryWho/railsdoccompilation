  <div id="fileHeader">
    <h1>routing_helpers.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>lib/spec/rails/example/routing_helpers.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sat Mar 28 20:09:13 +0100 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>module Spec
  module Rails
    module Example
      module RoutingHelpers
        
        module ParamsFromQueryString # :nodoc:
          def params_from_querystring(querystring) # :nodoc:
            params = {}
            querystring.split('&amp;').each do |piece|
              key, value = piece.split('=')
              params[key.to_sym] = value
            end
            params
          end
        end
        
        class RouteFor
          include ::Spec::Rails::Example::RoutingHelpers::ParamsFromQueryString
          def initialize(example, options)
            @example, @options = example, options
          end
  
          def ==(expected)
            if Hash === expected
              path, querystring = expected[:path].split('?')
              path = expected.merge(:path =&gt; path)
            else
              path, querystring = expected.split('?')
            end
            params = querystring.blank? ? {} : @example.params_from_querystring(querystring)
            @example.assert_recognizes(@options, path, params)
            true
          end
        end

        # Uses ActionController::Routing::Routes to generate
        # the correct route for a given set of options.
        # == Examples
        #   route_for(:controller =&gt; 'registrations', :action =&gt; 'edit', :id =&gt; '1')
        #     =&gt; '/registrations/1/edit'
        #   route_for(:controller =&gt; 'registrations', :action =&gt; 'create')
        #     =&gt; {:path =&gt; &quot;/registrations&quot;, :method =&gt; :post}
        def route_for(options)
          RouteFor.new(self, options)
        end

        # Uses ActionController::Routing::Routes to parse
        # an incoming path so the parameters it generates can be checked
        # == Example
        #   params_from(:get, '/registrations/1/edit')
        #     =&gt; :controller =&gt; 'registrations', :action =&gt; 'edit', :id =&gt; '1'
        def params_from(method, path)
          ensure_that_routes_are_loaded
          path, querystring = path.split('?')
          params = ActionController::Routing::Routes.recognize_path(path, :method =&gt; method)
          querystring.blank? ? params : params.merge(params_from_querystring(querystring))
        end

      private

        include ParamsFromQueryString

        def ensure_that_routes_are_loaded
          ActionController::Routing::Routes.reload if ActionController::Routing::Routes.empty?
        end

      end
    end
  end
end
</pre>
    </div>