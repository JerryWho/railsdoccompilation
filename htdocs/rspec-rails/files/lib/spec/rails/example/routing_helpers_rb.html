  <div id="fileHeader">
    <h1>routing_helpers.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>lib/spec/rails/example/routing_helpers.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Oct 12 14:57:39 +0200 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require 'rack/utils'

module Spec
  module Rails
    module Example
      module RoutingHelpers
        
        class RouteFor
          def initialize(example, options)
            @example, @options = example, options
          end

          def ==(expected)
            if Hash === expected
              path, querystring = expected[:path].split('?')
              path_string = path
              path = expected.merge(:path =&gt; path)
            else
              path, querystring = expected.split('?')
              path_string = path
              path = { :path =&gt; path, :method =&gt; :get }
            end
            params = querystring.blank? ? {} : Rack::Utils.parse_query(querystring).symbolize_keys!
            begin
              @example.assert_routing(path, @options, {}, params)
              true
            rescue ActionController::RoutingError, ::Test::Unit::AssertionFailedError =&gt; e
              raise e.class, &quot;#{e}\nIf you're expecting this failure, we suggest {:#{path[:method]}=&gt;\&quot;#{path[:path]}\&quot;}.should_not be_routable&quot;
            end
          end
        end
        # Uses ActionController::Routing::Routes to generate
        # the correct route for a given set of options.
        # == Examples
        #   route_for(:controller =&gt; 'registrations', :action =&gt; 'edit', :id =&gt; '1')
        #     =&gt; '/registrations/1/edit'
        #   route_for(:controller =&gt; 'registrations', :action =&gt; 'create')
        #     =&gt; {:path =&gt; &quot;/registrations&quot;, :method =&gt; :post}
        def route_for(options)
          RouteFor.new(self, options)
        end

        # Uses ActionController::Routing::Routes to parse
        # an incoming path so the parameters it generates can be checked
        #
        # Note that this method is obsoleted by the route_to matcher.
        # == Example
        #   params_from(:get, '/registrations/1/edit')
        #     =&gt; :controller =&gt; 'registrations', :action =&gt; 'edit', :id =&gt; '1'
        def params_from(method, path)
          ensure_that_routes_are_loaded
          path, querystring = path.split('?')
          params = ActionController::Routing::Routes.recognize_path(path, :method =&gt; method)
          querystring.blank? ? params : params.merge(Rack::Utils.parse_query(querystring).symbolize_keys!)
        end

      private

        def ensure_that_routes_are_loaded
          ActionController::Routing::Routes.reload if ActionController::Routing::Routes.empty?
        end

      end
    end
  end
end
</pre>
    </div>