<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Module: Spec::Rails::Mocks</title>
<link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (M)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../Spec.html" title="Spec (module)">Spec</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Rails.html" title="Spec::Rails (module)">Rails</a></span></span>
     &raquo; 
    <span class="title">Mocks</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Module: Spec::Rails::Mocks
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
    <dt class="r1">Included in:</dt>
    <dd class="r1"><span class='object_link'><a href="../../ActiveSupport/TestCase.html" title="ActiveSupport::TestCase (class)">ActiveSupport::TestCase</a></span></dd>
    
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/spec/rails/mocks.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Defined Under Namespace</h2>
<p class="children">
   
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="Mocks/ModelStubber.html" title="Spec::Rails::Mocks::ModelStubber (module)">ModelStubber</a></span>
    
   
    
  
</p>

  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="model_id-classvariable" class="">@@model_id =
          
        </dt>
        <dd><pre class="code"><span class='int'>1000</span></pre></dd>
      
    </dl>
  



  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_stubs-instance_method" title="#add_stubs (instance method)">- (Object) <strong>add_stubs</strong>(object, stubs = {}) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
DEPRECATED - use object.stub!(:method => value, :method2 => value).
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#mock_model-instance_method" title="#mock_model (instance method)">- (Object) <strong>mock_model</strong>(model_class, options_and_stubs = {}) {|m| ... }</a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Creates a mock object instance for a <tt>model_class</tt> with common
methods stubbed out.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stub_model-instance_method" title="#stub_model (instance method)">- (Object) <strong>stub_model</strong>(model_class, stubs = {}) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
:call-seq:.
</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="add_stubs-instance_method">
  
    - (<tt>Object</tt>) <strong>add_stubs</strong>(object, stubs = {}) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
DEPRECATED - use object.stub!(:method => value, :method2 => value)
</p>
<p>
Stubs methods on <tt>object</tt> (if <tt>object</tt> is a symbol or string
a new mock with that name will be created). <tt>stubs</tt> is a Hash of
<tt>method=&gt;value</tt>
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


121
122
123
124
125
126
127
128
129
130</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spec/rails/mocks.rb', line 121</span>

<span class='kw'>def</span> <span class='id add_stubs'>add_stubs</span><span class='lparen'>(</span><span class='id object'>object</span><span class='comma'>,</span> <span class='id stubs'>stubs</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span> <span class='comment'>#:nodoc:
</span>  <span class='const'>Kernel</span><span class='period'>.</span><span class='id warn'>warn</span> <span class='heredoc_beg'>&lt;&lt;-WARNING</span><span class='tstring_content'>DEPRECATION NOTICE: add_stubs is deprecated and will be removed
from a future version of rspec-rails. Use this instead:
  
  object.stub!(:method =&gt; value, :method2 =&gt; value)
  
</span><span class='heredoc_end'>WARNING
</span>
  <span class='id object'>object</span><span class='period'>.</span><span class='id stub!'>stub!</span><span class='lparen'>(</span><span class='id stubs'>stubs</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="mock_model-instance_method">
  
    - (<tt>Object</tt>) <strong>mock_model</strong>(model_class, options_and_stubs = {}) {|m| ... }
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Creates a mock object instance for a <tt>model_class</tt> with common
methods stubbed out. Additional methods may be easily stubbed (via
add_stubs) if <tt>stubs</tt> is passed.
</p>


  </div>
</div>
<div class="tags">
  <h3>Yields:</h3>
<ul class="yield">
  
    <li>
      
        <span class='type'>(<tt>m</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spec/rails/mocks.rb', line 11</span>

<span class='kw'>def</span> <span class='id mock_model'>mock_model</span><span class='lparen'>(</span><span class='id model_class'>model_class</span><span class='comma'>,</span> <span class='id options_and_stubs'>options_and_stubs</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id id'>id</span> <span class='op'>=</span> <span class='id options_and_stubs'>options_and_stubs</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id next_id'>next_id</span>
  <span class='id options_and_stubs'>options_and_stubs</span> <span class='op'>=</span> <span class='id options_and_stubs'>options_and_stubs</span><span class='period'>.</span><span class='id reverse_merge'>reverse_merge</span><span class='lparen'>(</span><span class='lbrace'>{</span>
    <span class='symbol'>:id</span> <span class='op'>=&gt;</span> <span class='id id'>id</span><span class='comma'>,</span>
    <span class='symbol'>:to_param</span> <span class='op'>=&gt;</span> <span class='id id'>id</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='comma'>,</span>
    <span class='symbol'>:new_record?</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
    <span class='symbol'>:destroyed?</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
    <span class='symbol'>:marked_for_destruction?</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
    <span class='symbol'>:errors</span> <span class='op'>=&gt;</span> <span class='id stub'>stub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>errors</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:count</span> <span class='op'>=&gt;</span> <span class='int'>0</span><span class='rparen'>)</span>
  <span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id m'>m</span> <span class='op'>=</span> <span class='id mock'>mock</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id model_class'>model_class</span><span class='period'>.</span><span class='id name'>name</span><span class='rbrace'>}</span><span class='tstring_content'>_</span><span class='embexpr_beg'>#{</span><span class='id id'>id</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id options_and_stubs'>options_and_stubs</span><span class='rparen'>)</span>
  <span class='id m'>m</span><span class='period'>.</span><span class='id __send__'>__send__</span><span class='lparen'>(</span><span class='symbol'>:__mock_proxy</span><span class='rparen'>)</span><span class='period'>.</span><span class='id instance_eval'>instance_eval</span> <span class='heredoc_beg'>&lt;&lt;-CODE</span><span class='tstring_content'>    def @target.as_new_record
      self.stub(:id).and_return nil
      self.stub(:to_param).and_return nil
      self.stub(:new_record?).and_return true
      self
    end
    def @target.to_str
      self.to_s
    end
    def @target.is_a?(other)
</span><span class='tstring_content'>      </span><span class='embexpr_beg'>#{</span><span class='id model_class'>model_class</span><span class='rbrace'>}</span><span class='tstring_content'>.ancestors.include?(other)
    end
    def @target.kind_of?(other)
</span><span class='tstring_content'>      </span><span class='embexpr_beg'>#{</span><span class='id model_class'>model_class</span><span class='rbrace'>}</span><span class='tstring_content'>.ancestors.include?(other)
    end
    def @target.instance_of?(other)
</span><span class='tstring_content'>      other == </span><span class='embexpr_beg'>#{</span><span class='id model_class'>model_class</span><span class='rbrace'>}</span><span class='tstring_content'>
    end
    def @target.class
</span><span class='tstring_content'>      </span><span class='embexpr_beg'>#{</span><span class='id model_class'>model_class</span><span class='rbrace'>}</span><span class='tstring_content'>
    end
</span><span class='heredoc_end'>  CODE
</span>
  <span class='kw'>yield</span> <span class='id m'>m</span> <span class='kw'>if</span> <span class='id block_given?'>block_given?</span>
  <span class='id m'>m</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="stub_model-instance_method">
  
    - (<tt>Object</tt>) <strong>stub_model</strong>(model_class, stubs = {}) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
:call-seq:
</p>
<pre class="code">
  <span class='id stub_model'>stub_model</span><span class='lparen'>(</span><span class='const'>Model</span><span class='rparen'>)</span>
  <span class='id stub_model'>stub_model</span><span class='lparen'>(</span><span class='const'>Model</span><span class='rparen'>)</span><span class='period'>.</span><span class='id as_new_record'>as_new_record</span>
  <span class='id stub_model'>stub_model</span><span class='lparen'>(</span><span class='const'>Model</span><span class='comma'>,</span> <span class='id hash_of_stubs'>hash_of_stubs</span><span class='rparen'>)</span>
  <span class='id stub_model'>stub_model</span><span class='lparen'>(</span><span class='const'>Model</span><span class='comma'>,</span> <span class='id instance_variable_name'>instance_variable_name</span><span class='comma'>,</span> <span class='id hash_of_stubs'>hash_of_stubs</span><span class='rparen'>)</span>
</pre>
<p>
Creates an instance of <tt>Model</tt> that is prohibited from accessing the
database*. For each key in <tt>hash_of_stubs</tt>, if the model has a
matching attribute (determined by asking it) are simply assigned the
submitted values. If the model does not have a matching attribute, the
key/value pair is assigned as a stub return value using RSpec&#8217;s
mocking/stubbing framework.
</p>
<p>
<tt>new_record?</tt> is overridden to return the result of id.nil? This
means that by default new_record? will return false. If  you want the
object to behave as a new record, sending it <tt>as_new_record</tt> will
set the id to nil. You can also explicitly set :id => nil, in which case
new_record? will return true, but using <tt>as_new_record</tt> makes the
example a bit more descriptive.
</p>
<p>
While you can use stub_model in any example (model, view, controller,
helper), it is especially useful in view examples, which are inherently
more state-based than interaction-based.
</p>
<h2>Database Independence</h2>
<p>
<tt>stub_model</tt> does not make your examples entirely
database-independent. It does not stop the model class itself from loading
up its columns from the database. It just prevents data access from the
object itself. To completely decouple from the database, take a look at
libraries like unit_record or NullDB.
</p>
<h2>Examples</h2>
<pre class="code">
  <span class='id stub_model'>stub_model</span><span class='lparen'>(</span><span class='const'>Person</span><span class='rparen'>)</span>
  <span class='id stub_model'>stub_model</span><span class='lparen'>(</span><span class='const'>Person</span><span class='rparen'>)</span><span class='period'>.</span><span class='id as_new_record'>as_new_record</span>
  <span class='id stub_model'>stub_model</span><span class='lparen'>(</span><span class='const'>Person</span><span class='comma'>,</span> <span class='symbol'>:id</span> <span class='op'>=&gt;</span> <span class='int'>37</span><span class='rparen'>)</span>
  <span class='id stub_model'>stub_model</span><span class='lparen'>(</span><span class='const'>Person</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id person'>person</span><span class='op'>|</span>
    <span class='id person'>person</span><span class='period'>.</span><span class='id first_name'>first_name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>David</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span></pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


102
103
104
105
106
107
108
109
110
111
112
113
114
115</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/spec/rails/mocks.rb', line 102</span>

<span class='kw'>def</span> <span class='id stub_model'>stub_model</span><span class='lparen'>(</span><span class='id model_class'>model_class</span><span class='comma'>,</span> <span class='id stubs'>stubs</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id stubs'>stubs</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='symbol'>:id</span> <span class='op'>=&gt;</span> <span class='id next_id'>next_id</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id merge'>merge</span><span class='lparen'>(</span><span class='id stubs'>stubs</span><span class='rparen'>)</span>
  <span class='id model_class'>model_class</span><span class='period'>.</span><span class='id new'>new</span><span class='period'>.</span><span class='id tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id model'>model</span><span class='op'>|</span>
    <span class='id model'>model</span><span class='period'>.</span><span class='id id'>id</span> <span class='op'>=</span> <span class='id stubs'>stubs</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='rparen'>)</span>
    <span class='id model'>model</span><span class='period'>.</span><span class='id extend'>extend</span> <span class='const'>ModelStubber</span>
    <span class='id stubs'>stubs</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id k'>k</span><span class='comma'>,</span><span class='id v'>v</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id model'>model</span><span class='period'>.</span><span class='id has_attribute?'>has_attribute?</span><span class='lparen'>(</span><span class='id k'>k</span><span class='rparen'>)</span>
        <span class='id model'>model</span><span class='lbracket'>[</span><span class='id k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id stubs'>stubs</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='id k'>k</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id model'>model</span><span class='period'>.</span><span class='id stub!'>stub!</span><span class='lparen'>(</span><span class='id stubs'>stubs</span><span class='rparen'>)</span>
    <span class='kw'>yield</span> <span class='id model'>model</span> <span class='kw'>if</span> <span class='id block_given?'>block_given?</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Thu Nov  4 19:18:34 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.1 (ruby-1.9.2).
</div>

  </body>
</html>