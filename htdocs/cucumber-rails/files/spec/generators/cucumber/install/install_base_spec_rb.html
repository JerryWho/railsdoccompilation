  <div id="fileHeader">
    <h1>install_base_spec.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>spec/generators/cucumber/install/install_base_spec.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sun Jul 25 18:23:21 +0200 2010</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require File.expand_path(File.dirname(__FILE__) + &quot;/../../../spec_helper&quot;)

# TODO using this seam as an interim way to get the file to load
module Config
  CONFIG = {
    'bindir' =&gt; 'foo',
    'ruby_install_name' =&gt; 'bar'
  }
end
require 'generators/cucumber/install/install_base'

module Cucumber
  module Generators
    describe InstallBase do
      def instance_of_class_including(mixin)
        Class.new do
          include mixin
        end.new
      end
      
      before(:each) do
        Kernel.stub(:require =&gt; nil)
        
        @generator = instance_of_class_including(Cucumber::Generators::InstallBase)
      end
      
      # This is a private method, but there was a bug in it where it
      # defaulted to :testunit (the framework) when called to identify
      # the driver
      describe &quot;#first_loadable&quot; do
        it &quot;detects loadable libraries&quot; do
          Gem.should_receive(:available?).with('capybara').and_return(true)
          @generator.send(:first_loadable, [['capybara', :capybara], ['webrat', :webrat ]]).should == :capybara
        end        

        it &quot;tries the given libraries in order&quot; do
          Gem.stub(:available?).with('capybara').and_return(false)
          Gem.should_receive(:available?).with('webrat').and_return(true)
          @generator.send(:first_loadable, [['capybara', :capybara], ['webrat', :webrat ]]).should == :webrat
        end
        
        it &quot;returns nil if no libraries are available&quot; do
          Gem.stub(:available? =&gt; false)
          @generator.send(:first_loadable, [['capybara', :capybara], ['webrat', :webrat ]]).should be_nil
        end
      end
      
      # This is a private method, but there may have been a bug in it where
      # it defaulted to :testunit (the framework) when called to identify
      # the driver
      describe &quot;#detect_in_env&quot; do
        describe &quot;when env.rb doesn't exist&quot; do
          it &quot;returns nil&quot; do
            File.should_receive(:file?).with(&quot;features/support/env.rb&quot;).and_return(false)
            @generator.send(:detect_in_env, [['capybara', :capybara], ['webrat', :webrat]]).should be_nil
          end
        end
        
        describe &quot;when env.rb exists&quot; do
          before(:each) do
            File.stub(:file =&gt; true)
          end
          
          it &quot;detects loadable libraries, choosing the first in the argument list&quot; do
            IO.should_receive(:read).with(&quot;features/support/env.rb&quot;).and_return(&quot;blah webrat capybara blah&quot;)
            @generator.send(:detect_in_env, [['capybara', :capybara], ['webrat', :webrat]]).should == :capybara
          end        

          it &quot;tries the given libraries in order&quot; do
            IO.should_receive(:read).with(&quot;features/support/env.rb&quot;).and_return(&quot;blah webrat blah&quot;)
            @generator.send(:detect_in_env, [['capybara', :capybara], ['webrat', :webrat]]).should == :webrat
          end
        
          it &quot;returns nil if no libraries are available&quot; do
            IO.should_receive(:read).with(&quot;features/support/env.rb&quot;).and_return(&quot;blah blah&quot;)
            @generator.send(:detect_in_env, [['capybara', :capybara], ['webrat', :webrat]]).should be_nil
          end
        end
        
      end
      
    end
  end
end</pre>
    </div>