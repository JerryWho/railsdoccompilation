  <div id="C00000017">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />XPathContext<br/>
  In:
<a href="#" onclick="jsHref('files/ext/nokogiri/html_document_c.html');">ext/nokogiri/html_document.c</a>
<a href="#" onclick="jsHref('files/lib/nokogiri/ffi/xml/xpath_context_rb.html');">lib/nokogiri/ffi/xml/xpath_context.rb</a>

Parent:&nbsp;
Object
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">

  <div class="description"><p>
<a href="index.html?a=C00000017&name=XPathContext">XPathContext</a> is the
entry point for searching a <a
href="index.html?a=C00000054&name=Document">Document</a> by using <a
href="index.html?a=C00000042&name=XPath">XPath</a>.
</p>
</div>



  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M000274&name=evaluate" >evaluate</a></li>
  <li><a href="index.html?a=M000273&name=new" >new</a></li>
  <li><a href="index.html?a=M000275&name=register_ns" >register_ns</a></li>
  </ul>






<div class="sectiontitle">Public Class methods</div>
<div id="M000273" class="method">
  <div id="M000273_title" class="title">
    <b>new(node)<br />
</b>
  </div>
  <div class="description">
  <p>
Create a new <a
href="index.html?a=C00000017&name=XPathContext">XPathContext</a> with
<tt>node</tt> as the reference point.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000273_source')" id="l_M000273_source">show source</a> ]</p>
  <div id="M000273_source" class="dyn-source">
<pre>
/*
 * call-seq:
 *  new(node)
 *
 * Create a new XPathContext with +node+ as the reference point.
 */
static VALUE new(VALUE klass, VALUE nodeobj)
{
  xmlNodePtr node;
  xmlXPathContextPtr ctx;
  VALUE self;

  xmlXPathInit();

  Data_Get_Struct(nodeobj, xmlNode, node);

  ctx = xmlXPathNewContext(node-&gt;doc);
  ctx-&gt;node = node;
  self = Data_Wrap_Struct(klass, 0, deallocate, ctx);
  /*rb_iv_set(self, &quot;@xpath_handler&quot;, Qnil); */
  return self;
}
</pre>
  </div>
</div>
</div>
<div class="sectiontitle">Public Instance methods</div>
<div id="M000274" class="method">
  <div id="M000274_title" class="title">
    <b>evaluate(search_path)<br />
</b>
  </div>
  <div class="description">
  <p>
Evaluate the <tt>search_path</tt> returning an <a
href="index.html?a=C00000042&name=XML::XPath">XML::XPath</a> object.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000274_source')" id="l_M000274_source">show source</a> ]</p>
  <div id="M000274_source" class="dyn-source">
<pre>
/*
 * call-seq:
 *  evaluate(search_path)
 *
 * Evaluate the +search_path+ returning an XML::XPath object.
 */
static VALUE evaluate(int argc, VALUE *argv, VALUE self)
{
  VALUE search_path, xpath_handler;
  VALUE thing = Qnil;
  xmlXPathContextPtr ctx;
  xmlXPathObjectPtr xpath;
  xmlChar *query;

  Data_Get_Struct(self, xmlXPathContext, ctx);

  if(rb_scan_args(argc, argv, &quot;11&quot;, &amp;search_path, &amp;xpath_handler) == 1)
    xpath_handler = Qnil;

  query = (xmlChar *)StringValuePtr(search_path);

  if(Qnil != xpath_handler) {
    /* FIXME: not sure if this is the correct place to shove private data. */
    ctx-&gt;userData = (void *)xpath_handler;
    xmlXPathRegisterFuncLookup(ctx, lookup, (void *)xpath_handler);
  }

  xmlResetLastError();
  xmlSetStructuredErrorFunc(NULL, xpath_exception_handler);

  /* For some reason, xmlXPathEvalExpression will blow up with a generic error */
  /* when there is a non existent function. */
  xmlSetGenericErrorFunc(NULL, xpath_generic_exception_handler);

  xpath = xmlXPathEvalExpression(query, ctx);
  xmlSetStructuredErrorFunc(NULL, NULL);
  xmlSetGenericErrorFunc(NULL, NULL);

  if(xpath == NULL) {
    VALUE xpath = rb_const_get(mNokogiriXml, rb_intern(&quot;XPath&quot;));
    VALUE klass = rb_const_get(xpath, rb_intern(&quot;SyntaxError&quot;));

    xmlErrorPtr error = xmlGetLastError();
    rb_exc_raise(Nokogiri_wrap_xml_syntax_error(klass, error));
  }

  assert(ctx-&gt;doc);
  assert(DOC_RUBY_OBJECT_TEST(ctx-&gt;doc));

  switch(xpath-&gt;type) {
    case XPATH_STRING:
      thing = NOKOGIRI_STR_NEW2(xpath-&gt;stringval);
      break;
    case XPATH_NODESET:
      if(NULL == xpath-&gt;nodesetval) {
        thing = Nokogiri_wrap_xml_node_set(xmlXPathNodeSetCreate(NULL),
          DOC_RUBY_OBJECT(ctx-&gt;doc));
      } else {
        thing = Nokogiri_wrap_xml_node_set(xpath-&gt;nodesetval,
            DOC_RUBY_OBJECT(ctx-&gt;doc));
      }
      break;
    case XPATH_NUMBER:
      thing = rb_float_new(xpath-&gt;floatval);
      break;
    case XPATH_BOOLEAN:
      thing = xpath-&gt;boolval == 1 ? Qtrue : Qfalse;
      break;
    default:
      thing = Nokogiri_wrap_xml_node_set(xmlXPathNodeSetCreate(NULL),
        DOC_RUBY_OBJECT(ctx-&gt;doc));
  }

  return thing;
}
</pre>
  </div>
</div>
</div>
<div id="M000275" class="method">
  <div id="M000275_title" class="title">
    <b>register_ns(prefix, uri)<br />
</b>
  </div>
  <div class="description">
  <p>
Register the namespace with <tt>prefix</tt> and <tt>uri</tt>.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000275_source')" id="l_M000275_source">show source</a> ]</p>
  <div id="M000275_source" class="dyn-source">
<pre>
/*
 * call-seq:
 *  register_ns(prefix, uri)
 *
 * Register the namespace with +prefix+ and +uri+.
 */
static VALUE register_ns(VALUE self, VALUE prefix, VALUE uri)
{
  xmlXPathContextPtr ctx;
  Data_Get_Struct(self, xmlXPathContext, ctx);

  xmlXPathRegisterNs( ctx,
                      (const xmlChar *)StringValuePtr(prefix),
                      (const xmlChar *)StringValuePtr(uri)
  );
  return self;
}
</pre>
  </div>
</div>
</div>
</div>

  </div>