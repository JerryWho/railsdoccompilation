  <div id="C00000075">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />Stylesheet<br/>
  In:
<a href="#" onclick="jsHref('files/ext/nokogiri/xslt_stylesheet_c.html');">ext/nokogiri/xslt_stylesheet.c</a>
<a href="#" onclick="jsHref('files/lib/nokogiri/ffi/xslt/stylesheet_rb.html');">lib/nokogiri/ffi/xslt/stylesheet.rb</a>

Parent:&nbsp;
Object
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">

  <div class="description"><p>
handle hashes as arguments.
</p>
</div>



  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M001077&name=parse_stylesheet_doc" >parse_stylesheet_doc</a></li>
  <li><a href="index.html?a=M001078&name=serialize" >serialize</a></li>
  <li><a href="index.html?a=M001079&name=transform" >transform</a></li>
  </ul>






<div class="sectiontitle">Public Class methods</div>
<div id="M001077" class="method">
  <div id="M001077_title" class="title">
    <b>parse_stylesheet_doc(document)<br />
</b>
  </div>
  <div class="description">
  <p>
Parse a stylesheet from <tt>document</tt>.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001077_source')" id="l_M001077_source">show source</a> ]</p>
  <div id="M001077_source" class="dyn-source">
<pre>
/*
 * call-seq:
 *   parse_stylesheet_doc(document)
 *
 * Parse a stylesheet from +document+.
 */
static VALUE parse_stylesheet_doc(VALUE klass, VALUE xmldocobj)
{
    xmlDocPtr xml ;
    xsltStylesheetPtr ss ;
    Data_Get_Struct(xmldocobj, xmlDoc, xml);
    exsltRegisterAll();

    xsltSetGenericErrorFunc(NULL, xslt_generic_error_handler);

    ss = xsltParseStylesheetDoc(xmlCopyDoc(xml, 1)); /* 1 =&gt; recursive */

    xsltSetGenericErrorFunc(NULL, NULL);

    return Data_Wrap_Struct(klass, NULL, dealloc, ss);
}
</pre>
  </div>
</div>
</div>
<div class="sectiontitle">Public Instance methods</div>
<div id="M001078" class="method">
  <div id="M001078_title" class="title">
    <b>serialize(document)<br />
</b>
  </div>
  <div class="description">
  <p>
Serialize <tt>document</tt> to an xml string.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001078_source')" id="l_M001078_source">show source</a> ]</p>
  <div id="M001078_source" class="dyn-source">
<pre>
/*
 * call-seq:
 *   serialize(document)
 *
 * Serialize +document+ to an xml string.
 */
static VALUE serialize(VALUE self, VALUE xmlobj)
{
    xmlDocPtr xml ;
    xsltStylesheetPtr ss ;
    xmlChar* doc_ptr ;
    int doc_len ;
    VALUE rval ;

    Data_Get_Struct(xmlobj, xmlDoc, xml);
    Data_Get_Struct(self, xsltStylesheet, ss);
    xsltSaveResultToString(&amp;doc_ptr, &amp;doc_len, xml, ss);
    rval = NOKOGIRI_STR_NEW(doc_ptr, doc_len);
    xmlFree(doc_ptr);
    return rval ;
}
</pre>
  </div>
</div>
</div>
<div id="M001079" class="method">
  <div id="M001079_title" class="title">
    <b>transform(document, params = [])<br />
</b>
  </div>
  <div class="description">
  <p>
Apply an <a href="index.html?a=C00000074&name=XSLT">XSLT</a> stylesheet to
an <a href="index.html?a=C00000054&name=XML::Document">XML::Document</a>.
<tt>params</tt> is an array of strings used as <a
href="index.html?a=C00000074&name=XSLT">XSLT</a> parameters. returns <a
href="index.html?a=C00000054&name=Nokogiri::XML::Document">Nokogiri::XML::Document</a>
</p>
<p>
Example:
</p>
<pre>
  doc   = Nokogiri::XML(File.read(ARGV[0]))
  xslt  = Nokogiri::XSLT(File.read(ARGV[1]))
  puts xslt.transform(doc, ['key', 'value'])
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001079_source')" id="l_M001079_source">show source</a> ]</p>
  <div id="M001079_source" class="dyn-source">
<pre>
/*
 *  call-seq:
 *    transform(document, params = [])
 *
 *  Apply an XSLT stylesheet to an XML::Document.
 *  +params+ is an array of strings used as XSLT parameters.
 *  returns Nokogiri::XML::Document
 *
 *  Example:
 * 
 *    doc   = Nokogiri::XML(File.read(ARGV[0]))
 *    xslt  = Nokogiri::XSLT(File.read(ARGV[1]))
 *    puts xslt.transform(doc, ['key', 'value'])
 *
 */
static VALUE transform(int argc, VALUE* argv, VALUE self)
{
    VALUE xmldoc, paramobj ;
    xmlDocPtr xml ;
    xmlDocPtr result ;
    xsltStylesheetPtr ss ;
    const char** params ;
    long param_len, j ;

    rb_scan_args(argc, argv, &quot;11&quot;, &amp;xmldoc, &amp;paramobj);
    if (NIL_P(paramobj)) { paramobj = rb_ary_new2(0) ; }

    /* handle hashes as arguments. */
    if(T_HASH == TYPE(paramobj)) {
      paramobj = rb_funcall(paramobj, rb_intern(&quot;to_a&quot;), 0);
      paramobj = rb_funcall(paramobj, rb_intern(&quot;flatten&quot;), 0);
    }

    Check_Type(paramobj, T_ARRAY);

    Data_Get_Struct(xmldoc, xmlDoc, xml);
    Data_Get_Struct(self, xsltStylesheet, ss);

    param_len = RARRAY_LEN(paramobj);
    params = calloc((size_t)param_len+1, sizeof(char*));
    for (j = 0 ; j &lt; param_len ; j++) {
      VALUE entry = rb_ary_entry(paramobj, j);
      const char * ptr = StringValuePtr(entry);
      params[j] = ptr;
    }
    params[param_len] = 0 ;

    result = xsltApplyStylesheet(ss, xml, params);
    free(params);

    if (!result) rb_raise(rb_eRuntimeError, &quot;could not perform xslt transform on document&quot;);

    return Nokogiri_wrap_xml_document(0, result) ;
}
</pre>
  </div>
</div>
</div>
</div>

  </div>