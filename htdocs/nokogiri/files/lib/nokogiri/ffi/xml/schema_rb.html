  <div id="fileHeader">
    <h1>schema.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>lib/nokogiri/ffi/xml/schema.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Oct 12 14:56:40 +0200 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>module Nokogiri
  module XML
    class Schema
      # :stopdoc:

      attr_accessor :cstruct

      def validate_document document
        errors = []

        ctx = LibXML.xmlSchemaNewValidCtxt(cstruct)
        raise RuntimeError.new(&quot;Could not create a validation context&quot;) if ctx.null?

        LibXML.xmlSchemaSetValidStructuredErrors(ctx,
          SyntaxError.error_array_pusher(errors), nil) unless Nokogiri.is_2_6_16?

        LibXML.xmlSchemaValidateDoc(ctx, document.cstruct)

        LibXML.xmlSchemaFreeValidCtxt(ctx)

        errors
      end
      private :validate_document

      def self.read_memory content
        content_copy = FFI::MemoryPointer.from_string(content)
        ctx = LibXML.xmlSchemaNewMemParserCtxt(content_copy, content.length)

        errors = []

        LibXML.xmlSetStructuredErrorFunc(nil, SyntaxError.error_array_pusher(errors))
        LibXML.xmlSchemaSetParserStructuredErrors(ctx, SyntaxError.error_array_pusher(errors), nil) unless Nokogiri.is_2_6_16?

        schema_ptr = LibXML.xmlSchemaParse(ctx)

        LibXML.xmlSetStructuredErrorFunc(nil, nil)
        LibXML.xmlSchemaFreeParserCtxt(ctx)

        if schema_ptr.null?
          error = LibXML.xmlGetLastError
          if error
            raise SyntaxError.wrap(error)
          else
            raise RuntimeError, &quot;Could not parse document&quot;
          end
        end

        schema = allocate
        schema.cstruct = LibXML::XmlSchema.new schema_ptr
        schema.errors = errors
        schema
      end

      def self.from_document document
        ctx = LibXML.xmlSchemaNewDocParserCtxt(document.document.cstruct)

        errors = []

        LibXML.xmlSetStructuredErrorFunc(nil, SyntaxError.error_array_pusher(errors))
        unless Nokogiri.is_2_6_16?
          LibXML.xmlSchemaSetParserStructuredErrors(
            ctx,
            SyntaxError.error_array_pusher(errors),
            nil
          )
        end

        schema_ptr = LibXML.xmlSchemaParse(ctx)

        LibXML.xmlSetStructuredErrorFunc(nil, nil)
        LibXML.xmlSchemaFreeParserCtxt(ctx)

        if schema_ptr.null?
          error = LibXML.xmlGetLastError
          if error
            raise SyntaxError.wrap(error)
          else
            raise RuntimeError, &quot;Could not parse document&quot;
          end
        end

        schema = allocate
        schema.cstruct = LibXML::XmlSchema.new schema_ptr
        schema.errors = errors
        schema
      end

      # :startdoc:
    end
  end
end

</pre>
    </div>