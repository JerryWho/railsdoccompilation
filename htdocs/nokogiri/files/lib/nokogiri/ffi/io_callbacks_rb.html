  <div id="fileHeader">
    <h1>io_callbacks.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>lib/nokogiri/ffi/io_callbacks.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sun Jul 25 20:15:09 +0200 2010</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre># :stopdoc:
module Nokogiri
  module IoCallbacks

    class &lt;&lt; self

      def plain_old_reader(io)
        lambda do |ctx, buffer, len|
          string = io.read(len)
          return 0 if string.nil?
          buffer.put_bytes(0, string, 0, string.length)
          string.length
        end
      end

      if defined?(FFI::IO.native_read)
        def ffi_io_native_reader(io)
          if io.is_a?(StringIO)
            plain_old_reader(io)
          else
            lambda do |ctx, buffer, len|
              rcode = FFI::IO.native_read(io, buffer, len)
              (rcode &lt; 0) ? 0 : rcode
            end
          end
        end
        alias :reader :ffi_io_native_reader
      else
        alias :reader :plain_old_reader
      end

      def writer(io)
        lambda do |context, buffer, len|
          io.write buffer
          len
        end
      end
    end

  end
end
# :startdoc:
</pre>
    </div>