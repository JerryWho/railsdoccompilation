  <div id="fileHeader">
    <h1>nokogiri.h</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>ext/nokogiri/nokogiri.h</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Oct 12 19:03:28 +0200 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>#ifndef NOKOGIRI_NATIVE
#define NOKOGIRI_NATIVE

#include &lt;stdlib.h&gt;
#include &lt;assert.h&gt;
#include &lt;ruby.h&gt;
#include &lt;libxml/parser.h&gt;
#include &lt;libxml/xpath.h&gt;
#include &lt;libxml/xpathInternals.h&gt;
#include &lt;libxml/xmlreader.h&gt;
#include &lt;libxml/xmlsave.h&gt;
#include &lt;libxml/xmlschemas.h&gt;
#include &lt;libxml/HTMLparser.h&gt;
#include &lt;libxml/HTMLtree.h&gt;
#include &lt;libxml/relaxng.h&gt;

#ifdef USE_INCLUDED_VASPRINTF
int vasprintf (char **strp, const char *fmt, va_list ap);
#else

#ifndef _GNU_SOURCE
#define _GNU_SOURCE
#endif

#  include &lt;stdio.h&gt;

#endif

int is_2_6_16(void) ;

#ifndef UNUSED
# if defined(__GNUC__)
#  define MAYBE_UNUSED(name) name __attribute__((unused))
#  define UNUSED(name) MAYBE_UNUSED(UNUSED_ ## name)
# else
#  define MAYBE_UNUSED(name) name
#  define UNUSED(name) name
# endif
#endif

#ifdef HAVE_RUBY_ENCODING_H

#include &lt;ruby/encoding.h&gt;

#define NOKOGIRI_STR_NEW2(str, encoding) \
  ({ \
    VALUE _string = rb_str_new2((const char *)str); \
    if(NULL != encoding) { \
      int _enc = rb_enc_find_index(&quot;UTF-8&quot;); \
      if(_enc == -1) \
        rb_enc_associate_index(_string, rb_enc_find_index(&quot;ASCII&quot;)); \
      else \
        rb_enc_associate_index(_string, _enc); \
    } \
    _string; \
  })

#define NOKOGIRI_STR_NEW(str, len, encoding) \
  ({ \
    VALUE _string = rb_str_new((const char *)str, (long)len); \
    if(NULL != encoding) { \
      int _enc = rb_enc_find_index(&quot;UTF-8&quot;); \
      if(_enc == -1) \
        rb_enc_associate_index(_string, rb_enc_find_index(&quot;ASCII&quot;)); \
      else \
        rb_enc_associate_index(_string, _enc); \
    } \
    _string; \
  })

#else

#define NOKOGIRI_STR_NEW2(str, doc) \
  rb_str_new2((const char *)str)

#define NOKOGIRI_STR_NEW(str, len, doc) \
  rb_str_new((const char *)str, (long)len)
#endif

#include &lt;xml_io.h&gt;
#include &lt;xml_document.h&gt;
#include &lt;html_entity_lookup.h&gt;
#include &lt;html_document.h&gt;
#include &lt;xml_node.h&gt;
#include &lt;xml_text.h&gt;
#include &lt;xml_cdata.h&gt;
#include &lt;xml_attr.h&gt;
#include &lt;xml_processing_instruction.h&gt;
#include &lt;xml_entity_reference.h&gt;
#include &lt;xml_document_fragment.h&gt;
#include &lt;xml_comment.h&gt;
#include &lt;xml_node_set.h&gt;
#include &lt;xml_xpath.h&gt;
#include &lt;xml_dtd.h&gt;
#include &lt;xml_xpath_context.h&gt;
#include &lt;xml_sax_parser.h&gt;
#include &lt;xml_sax_push_parser.h&gt;
#include &lt;xml_reader.h&gt;
#include &lt;html_sax_parser.h&gt;
#include &lt;xslt_stylesheet.h&gt;
#include &lt;xml_syntax_error.h&gt;
#include &lt;xml_schema.h&gt;
#include &lt;xml_relax_ng.h&gt;
#include &lt;html_element_description.h&gt;
#include &lt;xml_namespace.h&gt;

extern VALUE mNokogiri ;
extern VALUE mNokogiriXml ;
extern VALUE mNokogiriXmlSax ;
extern VALUE mNokogiriHtml ;
extern VALUE mNokogiriHtmlSax ;
extern VALUE mNokogiriXslt ;

#define NOKOGIRI_ROOT_NODE(_node) \
  ({ \
    nokogiriTuplePtr tuple = (nokogiriTuplePtr)(_node-&gt;doc-&gt;_private);       \
    st_insert(tuple-&gt;unlinkedNodes, (st_data_t)_node, (st_data_t)_node);     \
    _node; \
  })

#ifdef DEBUG

#define NOKOGIRI_DEBUG_START(p) if (getenv(&quot;NOKOGIRI_NO_FREE&quot;)) return ; if (getenv(&quot;NOKOGIRI_DEBUG&quot;)) fprintf(stderr,&quot;nokogiri: %s:%d %p start\n&quot;, __FILE__, __LINE__, p);
#define NOKOGIRI_DEBUG_END(p) if (getenv(&quot;NOKOGIRI_DEBUG&quot;)) fprintf(stderr,&quot;nokogiri: %s:%d %p end\n&quot;, __FILE__, __LINE__, p);

#else

#define NOKOGIRI_DEBUG_START(p)
#define NOKOGIRI_DEBUG_END(p)

#ifndef RSTRING_PTR
#define RSTRING_PTR(s) (RSTRING(s)-&gt;ptr)
#endif

#ifndef RSTRING_LEN
#define RSTRING_LEN(s) (RSTRING(s)-&gt;len)
#endif

#ifndef RARRAY_PTR
#define RARRAY_PTR(a) RARRAY(a)-&gt;ptr
#endif

#ifndef RARRAY_LEN
#define RARRAY_LEN(a) RARRAY(a)-&gt;len
#endif

#endif

#endif
</pre>
    </div>