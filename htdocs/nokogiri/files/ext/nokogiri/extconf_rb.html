  <div id="fileHeader">
    <h1>extconf.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>ext/nokogiri/extconf.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sun Jul 25 20:15:09 +0200 2010</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>ENV['RC_ARCHS'] = '' if RUBY_PLATFORM =~ /darwin/

# :stopdoc:

require 'mkmf'

RbConfig::MAKEFILE_CONFIG['CC'] = ENV['CC'] if ENV['CC']

ROOT = File.expand_path(File.join(File.dirname(__FILE__), '..', '..'))
LIBDIR = Config::CONFIG['libdir']
INCLUDEDIR = Config::CONFIG['includedir']

if defined?(RUBY_ENGINE) &amp;&amp; RUBY_ENGINE == 'macruby'
  $LIBRUBYARG_STATIC.gsub!(/-static/, '')
end

$CFLAGS &lt;&lt; &quot; #{ENV[&quot;CFLAGS&quot;]}&quot;
$LIBS &lt;&lt; &quot; #{ENV[&quot;LIBS&quot;]}&quot;

if Config::CONFIG['target_os'] == 'mingw32'
  $CFLAGS &lt;&lt; &quot; -DXP_WIN -DXP_WIN32 -DUSE_INCLUDED_VASPRINTF&quot;
elsif Config::CONFIG['target_os'] =~ /solaris/
  $CFLAGS &lt;&lt; &quot; -DUSE_INCLUDED_VASPRINTF&quot;
else
  $CFLAGS &lt;&lt; &quot; -g -DXP_UNIX&quot;
end

if RbConfig::MAKEFILE_CONFIG['CC'] =~ /mingw/
  $CFLAGS &lt;&lt; &quot; -DIN_LIBXML&quot;
end

$CFLAGS &lt;&lt; &quot; -O3 -Wall -Wcast-qual -Wwrite-strings -Wconversion -Wmissing-noreturn -Winline&quot;

HEADER_DIRS = [
  # First search /opt/local for macports
  '/opt/local/include',

  # Then search /usr/local for people that installed from source
  '/usr/local/include',

  # Check the ruby install locations
  INCLUDEDIR,

  # Finally fall back to /usr
  '/usr/include',
  '/usr/include/libxml2',
]

LIB_DIRS = [
  # First search /opt/local for macports
  '/opt/local/lib',

  # Then search /usr/local for people that installed from source
  '/usr/local/lib',

  # Check the ruby install locations
  LIBDIR,

  # Finally fall back to /usr
  '/usr/lib',
]

dir_config('zlib', HEADER_DIRS, LIB_DIRS)
dir_config('iconv', HEADER_DIRS, LIB_DIRS)
dir_config('xml2', [
           '/opt/local/include/libxml2',
           '/usr/local/include/libxml2',
           File.join(INCLUDEDIR, &quot;libxml2&quot;)] + HEADER_DIRS, LIB_DIRS)
dir_config('xslt', HEADER_DIRS, LIB_DIRS)

def asplode(lib)
  abort &quot;-----\n#{lib} is missing.  please visit http://nokogiri.org/tutorials/installing_nokogiri.html for help with installing dependencies.\n-----&quot;
end

asplode &quot;iconv&quot;    unless find_header('iconv.h')
asplode &quot;libxml2&quot;  unless find_header('libxml/parser.h')
asplode &quot;libxslt&quot;  unless find_header('libxslt/xslt.h')
asplode &quot;libexslt&quot; unless find_header('libexslt/exslt.h')
asplode &quot;zlib&quot;     unless find_library('z', 'gzopen')
asplode &quot;libxml2&quot;  unless find_library('xml2', 'xmlParseDoc')
asplode &quot;libxslt&quot;  unless find_library('xslt', 'xsltParseStylesheetDoc')
asplode &quot;libexslt&quot; unless find_library('exslt', 'exsltFuncRegister')

have_func('xmlRelaxNGSetParserStructuredErrors')
have_func('xmlRelaxNGSetParserStructuredErrors')
have_func('xmlRelaxNGSetValidStructuredErrors')
have_func('xmlSchemaSetValidStructuredErrors')
have_func('xmlSchemaSetParserStructuredErrors')

if ENV['CPUPROFILE']
  unless find_library('profiler', 'ProfilerEnable', *LIB_DIRS)
    abort &quot;google performance tools are not installed&quot;
  end
end

create_makefile('nokogiri/nokogiri')
# :startdoc:
</pre>
    </div>