  <div id="fileHeader">
    <h1>xml_xpath.c</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>ext/nokogiri/xml_xpath.c</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Thu Nov 26 17:53:40 +0100 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>#include &lt;xml_xpath.h&gt;

static void deallocate(xmlXPathObjectPtr xpath)
{
  NOKOGIRI_DEBUG_START(xpath);
  xmlXPathFreeNodeSetList(xpath); // despite the name, this frees the xpath but not the contained node set
  NOKOGIRI_DEBUG_END(xpath);
}

VALUE Nokogiri_wrap_xml_xpath(xmlXPathObjectPtr xpath)
{
  return Data_Wrap_Struct(cNokogiriXmlXpath, 0, deallocate, xpath);
}

/*
 * call-seq:
 *  node_set
 *
 * Fetch the node set associated with this xpath context.
 */
static VALUE node_set(VALUE self)
{
  xmlXPathObjectPtr xpath;
  Data_Get_Struct(self, xmlXPathObject, xpath);

  VALUE node_set = Qnil;

  if (xpath-&gt;nodesetval)
    node_set = Nokogiri_wrap_xml_node_set(xpath-&gt;nodesetval);

  if(NIL_P(node_set))
    node_set = Nokogiri_wrap_xml_node_set(xmlXPathNodeSetCreate(NULL));

  rb_funcall(node_set, rb_intern(&quot;document=&quot;), 1, rb_iv_get(self, &quot;@document&quot;));

  return node_set;
}

VALUE cNokogiriXmlXpath;
void init_xml_xpath(void)
{
  VALUE module = rb_define_module(&quot;Nokogiri&quot;);
  VALUE xml = rb_define_module_under(module, &quot;XML&quot;);

  /*
   * This class wraps an XPath object and should only be instantiated from
   * XPathContext.
   */
  VALUE klass = rb_define_class_under(xml, &quot;XPath&quot;, rb_cObject);

  cNokogiriXmlXpath = klass;
  rb_define_method(klass, &quot;node_set&quot;, node_set, 0);
}
</pre>
    </div>