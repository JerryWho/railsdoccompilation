  <div id="fileHeader">
    <h1>test_reader_encoding.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>test/xml/test_reader_encoding.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Oct 12 19:03:28 +0200 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre># -*- coding: utf-8 -*-
require File.expand_path(File.join(File.dirname(__FILE__), '..', &quot;helper&quot;))

module Nokogiri
  module XML
    if RUBY_VERSION =~ /^1\.9/
      class TestReaderEncoding &lt; Nokogiri::TestCase
        def setup
          super
          @reader = Nokogiri::XML::Reader(
            File.read(XML_FILE),
            XML_FILE,
            'UTF-8'
          )
        end

        def test_attribute_at
          @reader.each do |node|
            next unless attribute = node.attribute_at(0)
            assert_equal @reader.encoding, attribute.encoding.name
          end
        end

        def test_attributes
          @reader.each do |node|
            node.attributes.each do |k,v|
              assert_equal @reader.encoding, k.encoding.name
              assert_equal @reader.encoding, v.encoding.name
            end
          end
        end

        def test_attribute
          xml = &lt;&lt;-eoxml
    &lt;x xmlns:tenderlove='http://tenderlovemaking.com/'&gt;
      &lt;tenderlove:foo awesome='true'&gt;snuggles!&lt;/tenderlove:foo&gt;
    &lt;/x&gt;
          eoxml
          reader = Nokogiri::XML::Reader(xml, nil, 'UTF-8')
          reader.each do |node|
            next unless attribute = node.attribute('awesome')
            assert_equal reader.encoding, attribute.encoding.name
          end
        end

        def test_xml_version
          @reader.each do |node|
            next unless version = node.xml_version
            assert_equal @reader.encoding, version.encoding.name
          end
        end

        def test_lang
          xml = &lt;&lt;-eoxml
    &lt;awesome&gt;
      &lt;p xml:lang=&quot;en&quot;&gt;The quick brown fox jumps over the lazy dog.&lt;/p&gt;
      &lt;p xml:lang=&quot;ja&quot;&gt;日本語が上手です&lt;/p&gt;
    &lt;/awesome&gt;
          eoxml

          reader = Nokogiri::XML::Reader(xml, nil, 'UTF-8')
          reader.each do |node|
            next unless lang = node.lang
            assert_equal reader.encoding, lang.encoding.name
          end
        end

        def test_value
          called = false
          @reader.each do |node|
            next unless value = node.value
            assert_equal @reader.encoding, value.encoding.name
            called = true
          end
          assert called
        end

        def test_prefix
          xml = &lt;&lt;-eoxml
    &lt;x xmlns:edi='http://ecommerce.example.org/schema'&gt;
      &lt;edi:foo&gt;hello&lt;/edi:foo&gt;
    &lt;/x&gt;
          eoxml
          reader = Nokogiri::XML::Reader(xml, nil, 'UTF-8')
          reader.each do |node|
            next unless prefix = node.prefix
            assert_equal reader.encoding, prefix.encoding.name
          end
        end

        def test_ns_uri
          xml = &lt;&lt;-eoxml
    &lt;x xmlns:edi='http://ecommerce.example.org/schema'&gt;
      &lt;edi:foo&gt;hello&lt;/edi:foo&gt;
    &lt;/x&gt;
          eoxml
          reader = Nokogiri::XML::Reader(xml, nil, 'UTF-8')
          reader.each do |node|
            next unless uri = node.namespace_uri
            assert_equal reader.encoding, uri.encoding.name
          end
        end

        def test_local_name
          xml = &lt;&lt;-eoxml
    &lt;x xmlns:edi='http://ecommerce.example.org/schema'&gt;
      &lt;edi:foo&gt;hello&lt;/edi:foo&gt;
    &lt;/x&gt;
          eoxml
          reader = Nokogiri::XML::Reader(xml, nil, 'UTF-8')
          reader.each do |node|
            next unless lname = node.local_name
            assert_equal reader.encoding, lname.encoding.name
          end
        end

        def test_name
          @reader.each do |node|
            next unless name = node.name
            assert_equal @reader.encoding, name.encoding.name
          end
        end
      end
    end
  end
end
</pre>
    </div>