  <div id="fileHeader">
    <h1>test_entity_decl.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>test/xml/test_entity_decl.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sun Jul 25 20:15:09 +0200 2010</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require &quot;helper&quot;

module Nokogiri
  module XML
    class TestEntityDecl &lt; Nokogiri::TestCase
      def setup
        super
        @xml = Nokogiri::XML(&lt;&lt;-eoxml)
&lt;?xml version=&quot;1.0&quot;?&gt;&lt;?TEST-STYLE PIDATA?&gt;
&lt;!DOCTYPE staff SYSTEM &quot;staff.dtd&quot; [
   &lt;!ENTITY ent1 &quot;es&quot;&gt;
   &lt;!ENTITY nocontent &gt;
]&gt;
&lt;root /&gt;
        eoxml

        @entities = @xml.internal_subset.children
        @entity_decl = @entities.first
      end

      def test_constants # for libffi implementation. *sigh* sorry Mike. :-(
        assert_equal 1, EntityDecl::INTERNAL_GENERAL
        assert_equal 2, EntityDecl::EXTERNAL_GENERAL_PARSED
        assert_equal 3, EntityDecl::EXTERNAL_GENERAL_UNPARSED
        assert_equal 4, EntityDecl::INTERNAL_PARAMETER
        assert_equal 5, EntityDecl::EXTERNAL_PARAMETER
        assert_equal 6, EntityDecl::INTERNAL_PREDEFINED

        # While I'm here, another problem with libffi comes to mind.  If someone
        # upgrades their version of any particular C library, and the constants
        # change values, the client using Ruby code is fucked.  That sucks.
        # Basically anything to do with the preprocessor fucks someone using
        # libffi.  :-(
      end

      def test_create_typed_entity
        entity = @xml.create_entity(
          'foo', EntityDecl::INTERNAL_GENERAL, nil, nil, nil
        )
        assert_equal EntityDecl::INTERNAL_GENERAL, entity.entity_type
        assert_equal 'foo', entity.name
      end

      def test_new
        entity = Nokogiri::XML::EntityDecl.new(
          'foo', @xml, EntityDecl::INTERNAL_GENERAL, nil, nil, nil
        )
        assert_equal EntityDecl::INTERNAL_GENERAL, entity.entity_type
        assert_equal 'foo', entity.name
      end

      def test_create_default_args
        entity = @xml.create_entity('foo')
        assert_equal EntityDecl::INTERNAL_GENERAL, entity.entity_type
        assert_equal 'foo', entity.name
      end

      def test_external_id
        assert_nil @entity_decl.external_id
      end

      def test_system_id
        assert_nil @entity_decl.system_id
      end

      def test_entity_type
        assert_equal 1, @entity_decl.entity_type
      end

      def test_original_content
        assert_equal &quot;es&quot;, @entity_decl.original_content
        assert_nil @entities[1].original_content
      end

      def test_content
        assert_equal &quot;es&quot;, @entity_decl.content
        assert_nil @entities[1].content
      end

      def test_type
        assert_equal 17, @entities.first.type
      end

      def test_class
        assert_instance_of Nokogiri::XML::EntityDecl, @entities.first
      end

      def test_attributes
        assert_raise NoMethodError do
          @entity_decl.attributes
        end
      end

      def test_namespace
        assert_raise NoMethodError do
          @entity_decl.namespace
        end
      end

      def test_namespace_definitions
        assert_raise NoMethodError do
          @entity_decl.namespace_definitions
        end
      end

      def test_line
        assert_raise NoMethodError do
          @entity_decl.line
        end
      end

      def test_inspect
        assert_equal(
          &quot;#&lt;#{@entity_decl.class.name}:#{sprintf(&quot;0x%x&quot;, @entity_decl.object_id)} #{@entity_decl.to_s.inspect}&gt;&quot;,
          @entity_decl.inspect
        )
      end
    end
  end
end
</pre>
    </div>