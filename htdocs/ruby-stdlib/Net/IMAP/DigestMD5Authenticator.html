<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Class: Net::IMAP::DigestMD5Authenticator</title>
<link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (D)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../Net.html" title="Net (module)">Net</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../IMAP.html" title="Net::IMAP (class)">IMAP</a></span></span>
     &raquo; 
    <span class="title">DigestMD5Authenticator</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Net::IMAP::DigestMD5Authenticator
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">Net::IMAP::DigestMD5Authenticator</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/net/imap.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
Authenticator for the &#8220;DIGEST-MD5&#8221; authentication type.  See
#authenticate().
</p>


  </div>
</div>
<div class="tags">
  
</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="STAGE_ONE-constant" class="">STAGE_ONE =
          
        </dt>
        <dd><pre class="code"><span class='symbol'>:stage_one</span></pre></dd>
      
        <dt id="STAGE_TWO-constant" class="">STAGE_TWO =
          
        </dt>
        <dd><pre class="code"><span class='symbol'>:stage_two</span></pre></dd>
      
    </dl>
  



  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (DigestMD5Authenticator) <strong>initialize</strong>(user, password, authname = nil) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
A new instance of DigestMD5Authenticator.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process-instance_method" title="#process (instance method)">- (Object) <strong>process</strong>(challenge) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Net::IMAP::DigestMD5Authenticator (class)">DigestMD5Authenticator</a></span></tt>) <strong>initialize</strong>(user, password, authname = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
A new instance of DigestMD5Authenticator
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


3383
3384
3385
3386</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/net/imap.rb', line 3383</span>

<span class='kw'>def</span> <span class='id initialize'>initialize</span><span class='lparen'>(</span><span class='id user'>user</span><span class='comma'>,</span> <span class='id password'>password</span><span class='comma'>,</span> <span class='id authname'>authname</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
	<span class='ivar'>@user</span><span class='comma'>,</span> <span class='ivar'>@password</span><span class='comma'>,</span> <span class='ivar'>@authname</span> <span class='op'>=</span> <span class='id user'>user</span><span class='comma'>,</span> <span class='id password'>password</span><span class='comma'>,</span> <span class='id authname'>authname</span>
	<span class='ivar'>@nc</span><span class='comma'>,</span> <span class='ivar'>@stage</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='const'>STAGE_ONE</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="process-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>process</strong>(challenge) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


3318
3319
3320
3321
3322
3323
3324
3325
3326
3327
3328
3329
3330
3331
3332
3333
3334
3335
3336
3337
3338
3339
3340
3341
3342
3343
3344
3345
3346
3347
3348
3349
3350
3351
3352
3353
3354
3355
3356
3357
3358
3359
3360
3361
3362
3363
3364
3365
3366
3367
3368
3369
3370
3371
3372
3373
3374
3375
3376
3377
3378
3379
3380
3381</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/net/imap.rb', line 3318</span>

<span class='kw'>def</span> <span class='id process'>process</span><span class='lparen'>(</span><span class='id challenge'>challenge</span><span class='rparen'>)</span>
	<span class='kw'>case</span> <span class='ivar'>@stage</span>
	<span class='kw'>when</span> <span class='const'>STAGE_ONE</span>
	  <span class='ivar'>@stage</span> <span class='op'>=</span> <span class='const'>STAGE_TWO</span>
	  <span class='id sparams'>sparams</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
	  <span class='id c'>c</span> <span class='op'>=</span> <span class='const'>StringScanner</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id challenge'>challenge</span><span class='rparen'>)</span>
	  <span class='kw'>while</span> <span class='id c'>c</span><span class='period'>.</span><span class='id scan'>scan</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>(?:\s*,)?\s*(\w+)=(&quot;(?:[^\\&quot;]+|\\.)*&quot;|[^,]+)\s*</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
	    <span class='id k'>k</span><span class='comma'>,</span> <span class='id v'>v</span> <span class='op'>=</span> <span class='id c'>c</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id c'>c</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span>
	    <span class='kw'>if</span> <span class='id v'>v</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^&quot;(.*)&quot;$</span><span class='regexp_end'>/</span></span>
 <span class='id v'>v</span> <span class='op'>=</span> <span class='backref'>$1</span>
 <span class='kw'>if</span> <span class='id v'>v</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>,</span><span class='regexp_end'>/</span></span>
		<span class='id v'>v</span> <span class='op'>=</span> <span class='id v'>v</span><span class='period'>.</span><span class='id split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>,</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
 <span class='kw'>end</span>
	    <span class='kw'>end</span>
	    <span class='id sparams'>sparams</span><span class='lbracket'>[</span><span class='id k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id v'>v</span>
	  <span class='kw'>end</span>

	  <span class='id raise'>raise</span> <span class='const'>DataFormatError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Bad Challenge: '</span><span class='embexpr_beg'>#{</span><span class='id challenge'>challenge</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id c'>c</span><span class='period'>.</span><span class='id rest'>rest</span><span class='period'>.</span><span class='id size'>size</span> <span class='op'>==</span> <span class='int'>0</span>
	  <span class='id raise'>raise</span> <span class='const'>Error</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Server does not support auth (qop = </span><span class='embexpr_beg'>#{</span><span class='id sparams'>sparams</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>qop</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>,</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id sparams'>sparams</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>qop</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>auth</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

	  <span class='id response'>response</span> <span class='op'>=</span> <span class='lbrace'>{</span>
	    <span class='symbol'>:nonce</span> <span class='op'>=&gt;</span> <span class='id sparams'>sparams</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>nonce</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
	    <span class='symbol'>:username</span> <span class='op'>=&gt;</span> <span class='ivar'>@user</span><span class='comma'>,</span>
	    <span class='symbol'>:realm</span> <span class='op'>=&gt;</span> <span class='id sparams'>sparams</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>realm</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
	    <span class='symbol'>:cnonce</span> <span class='op'>=&gt;</span> <span class='const'>Digest</span><span class='op'>::</span><span class='const'>MD5</span><span class='period'>.</span><span class='id hexdigest'>hexdigest</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%.15f:%.15f:%d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='lbracket'>[</span><span class='const'>Time</span><span class='period'>.</span><span class='id now'>now</span><span class='period'>.</span><span class='id to_f'>to_f</span><span class='comma'>,</span> <span class='id rand'>rand</span><span class='comma'>,</span> <span class='const'>Process</span><span class='period'>.</span><span class='id pid'>pid</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='comma'>,</span>
	    <span class='symbol'>:digest-uri</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>imap/</span><span class='tstring_end'>'</span></span> <span class='op'>+</span> <span class='id sparams'>sparams</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>realm</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
	    <span class='symbol'>:qop</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>auth</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
	    <span class='symbol'>:maxbuf</span> <span class='op'>=&gt;</span> <span class='int'>65535</span><span class='comma'>,</span>
	    <span class='symbol'>:nc</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%08d</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id nc'>nc</span><span class='lparen'>(</span><span class='id sparams'>sparams</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>nonce</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='comma'>,</span>
	    <span class='symbol'>:charset</span> <span class='op'>=&gt;</span> <span class='id sparams'>sparams</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>charset</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
	  <span class='rbrace'>}</span>

	  <span class='id response'>response</span><span class='lbracket'>[</span><span class='symbol'>:authzid</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@authname</span> <span class='kw'>unless</span> <span class='ivar'>@authname</span><span class='period'>.</span><span class='id nil?'>nil?</span>

	  <span class='comment'># now, the real thing
</span>	  <span class='id a0'>a0</span> <span class='op'>=</span> <span class='const'>Digest</span><span class='op'>::</span><span class='const'>MD5</span><span class='period'>.</span><span class='id digest'>digest</span><span class='lparen'>(</span> <span class='lbracket'>[</span> <span class='id response'>response</span><span class='period'>.</span><span class='id values_at'>values_at</span><span class='lparen'>(</span><span class='symbol'>:username</span><span class='comma'>,</span> <span class='symbol'>:realm</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='ivar'>@password</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>:</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='rparen'>)</span>

	  <span class='id a1'>a1</span> <span class='op'>=</span> <span class='lbracket'>[</span> <span class='id a0'>a0</span><span class='comma'>,</span> <span class='id response'>response</span><span class='period'>.</span><span class='id values_at'>values_at</span><span class='lparen'>(</span><span class='symbol'>:nonce</span><span class='comma'>,</span><span class='symbol'>:cnonce</span><span class='rparen'>)</span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>:</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
	  <span class='id a1'>a1</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>:</span><span class='tstring_end'>'</span></span> <span class='op'>+</span> <span class='id response'>response</span><span class='lbracket'>[</span><span class='symbol'>:authzid</span><span class='rbracket'>]</span> <span class='kw'>unless</span> <span class='id response'>response</span><span class='lbracket'>[</span><span class='symbol'>:authzid</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id nil?'>nil?</span>

	  <span class='id a2'>a2</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AUTHENTICATE:</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id response'>response</span><span class='lbracket'>[</span><span class='symbol'>:digest-uri</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
	  <span class='id a2'>a2</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:00000000000000000000000000000000</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id response'>response</span><span class='lbracket'>[</span><span class='symbol'>:qop</span><span class='rbracket'>]</span> <span class='kw'>and</span> <span class='id response'>response</span><span class='lbracket'>[</span><span class='symbol'>:qop</span><span class='rbracket'>]</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^auth-(?:conf|int)$</span><span class='regexp_end'>/</span></span>

	  <span class='id response'>response</span><span class='lbracket'>[</span><span class='symbol'>:response</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Digest</span><span class='op'>::</span><span class='const'>MD5</span><span class='period'>.</span><span class='id hexdigest'>hexdigest</span><span class='lparen'>(</span>
	    <span class='lbracket'>[</span>
<span class='const'>Digest</span><span class='op'>::</span><span class='const'>MD5</span><span class='period'>.</span><span class='id hexdigest'>hexdigest</span><span class='lparen'>(</span><span class='id a1'>a1</span><span class='rparen'>)</span><span class='comma'>,</span>
<span class='id response'>response</span><span class='period'>.</span><span class='id values_at'>values_at</span><span class='lparen'>(</span><span class='symbol'>:nonce</span><span class='comma'>,</span> <span class='symbol'>:nc</span><span class='comma'>,</span> <span class='symbol'>:cnonce</span><span class='comma'>,</span> <span class='symbol'>:qop</span><span class='rparen'>)</span><span class='comma'>,</span>
<span class='const'>Digest</span><span class='op'>::</span><span class='const'>MD5</span><span class='period'>.</span><span class='id hexdigest'>hexdigest</span><span class='lparen'>(</span><span class='id a2'>a2</span><span class='rparen'>)</span>
	    <span class='rbracket'>]</span><span class='period'>.</span><span class='id join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>:</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
	  <span class='rparen'>)</span>

	  <span class='kw'>return</span> <span class='id response'>response</span><span class='period'>.</span><span class='id keys'>keys</span><span class='period'>.</span><span class='id map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id key'>key</span><span class='op'>|</span> <span class='id qdval'>qdval</span><span class='lparen'>(</span><span class='id key'>key</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='comma'>,</span> <span class='id response'>response</span><span class='lbracket'>[</span><span class='id key'>key</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>,</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
	<span class='kw'>when</span> <span class='const'>STAGE_TWO</span>
	  <span class='ivar'>@stage</span> <span class='op'>=</span> <span class='kw'>nil</span>
	  <span class='comment'># if at the second stage, return an empty string
</span>	  <span class='kw'>if</span> <span class='id challenge'>challenge</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>rspauth=</span><span class='regexp_end'>/</span></span>
	    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>
	  <span class='kw'>else</span>
	    <span class='id raise'>raise</span> <span class='const'>ResponseParseError</span><span class='comma'>,</span> <span class='id challenge'>challenge</span>
	  <span class='kw'>end</span>
	<span class='kw'>else</span>
	  <span class='id raise'>raise</span> <span class='const'>ResponseParseError</span><span class='comma'>,</span> <span class='id challenge'>challenge</span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Thu Oct 14 00:03:36 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.1 (ruby-1.9.2).
</div>

  </body>
</html>