<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Class: WIN32OLE_EVENT</title>
<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (W)</a> &raquo; 
    
    
    <span class="title">WIN32OLE_EVENT</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: WIN32OLE_EVENT
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">WIN32OLE_EVENT</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">ext/win32ole/win32ole.c</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
<tt>WIN32OLE_EVENT</tt> objects controls OLE event.
</p>


  </div>
</div>
<div class="tags">
  
</div>


  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#message_loop-class_method" title="message_loop (class method)">+ (Object) <strong>message_loop</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Translates and dispatches Windows message.
</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#handler-instance_method" title="#handler (instance method)">- (Object) <strong>handler</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
returns handler object.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#handler%3D-instance_method" title="#handler= (instance method)">- (Object) <strong>handler=</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
sets event handler object.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new-instance_method" title="#new (instance method)">- (Object) <strong>new</strong>(ole, event) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns OLE event object.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#off_event-instance_method" title="#off_event (instance method)">- (Object) <strong>off_event</strong>([event]) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
removes the callback of event.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_event-instance_method" title="#on_event (instance method)">- (Object) <strong>on_event</strong>([event]) { ... }</a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Defines the callback event.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_event_with_outargs-instance_method" title="#on_event_with_outargs (instance method)">- (Object) <strong>on_event_with_outargs</strong>([event]) { ... }</a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Defines the callback of event.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#unadvise-instance_method" title="#unadvise (instance method)">- (nil) <strong>unadvise</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
disconnects OLE server.
</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>new</strong>(ole, event) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns OLE event object. The first argument specifies WIN32OLE object. The
second argument specifies OLE event name.
</p>
<pre class="code">
   ie = WIN32OLE.new('InternetExplorer.Application')
   ev = WIN32OLE_EVENT.new(ie, 'DWebBrowserEvents')</pre>


  </div>
</div>
<div class="tags">
  
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/win32ole/win32ole.c'</span>

/*
 *  call-seq:
 *     WIN32OLE_EVENT.new(ole, event) #=&gt; WIN32OLE_EVENT object.
 *
 *  Returns OLE event object.
 *  The first argument specifies WIN32OLE object.
 *  The second argument specifies OLE event name.
 *     ie = WIN32OLE.new('InternetExplorer.Application')
 *     ev = WIN32OLE_EVENT.new(ie, 'DWebBrowserEvents')
 */
static VALUE
fev_initialize(int argc, VALUE *argv, VALUE self)
{
    ev_advise(argc, argv, self);
    evs_push(self);
    rb_ivar_set(self, id_events, rb_ary_new());
    fev_set_handler(self, Qnil);
    return self;
}</pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="message_loop-class_method">
  
    + (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>message_loop</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Translates and dispatches Windows message.
</p>


  </div>
</div>
<div class="tags">
  
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/win32ole/win32ole.c'</span>

/*
 *  call-seq:
 *     WIN32OLE_EVENT.message_loop
 *
 *  Translates and dispatches Windows message.
 */
static VALUE
fev_s_msg_loop(VALUE klass)
{
    ole_msg_loop();
    return Qnil;
}</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="handler-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>handler</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
returns handler object.
</p>


  </div>
</div>
<div class="tags">
  
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/win32ole/win32ole.c'</span>

/*
 *  call-seq:
 *     WIN32OLE_EVENT#handler
 *
 *  returns handler object.
 *
 */
static VALUE
fev_get_handler(VALUE self)
{
    return rb_ivar_get(self, rb_intern(&quot;handler&quot;));
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="handler=-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>handler=</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
sets event handler object. If handler object has onXXX method according to
XXX event, then onXXX method is called when XXX event occurs.
</p>
<p>
If handler object has method_missing and there is no method according to
the event, then method_missing called and 1-st argument is event name.
</p>
<p>
If handler object has onXXX method and there is block defined by
WIN32OLE_EVENT#on_event(&#8216;XXX&#8217;){}, then block is executed but
handler object method is not called when XXX event occurs.
</p>
<pre class="code">
    class Handler
      def onStatusTextChange(text)
        puts &quot;StatusTextChanged&quot;
      end
      def onPropertyChange(prop)
        puts &quot;PropertyChanged&quot;
      end
      def method_missing(ev, *arg)
        puts &quot;other event #{ev}&quot;
      end
    end

    handler = Handler.new
    ie = WIN32OLE.new('InternetExplorer.Application')
    ev = WIN32OLE_EVENT.new(ie)
    ev.on_event(&quot;StatusTextChange&quot;) {|*args|
      puts &quot;this block executed.&quot;
      puts &quot;handler.onStatusTextChange method is not called.&quot;
    }
    ev.handler = handler</pre>


  </div>
</div>
<div class="tags">
  
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/win32ole/win32ole.c'</span>

/*
 *  call-seq:
 *     WIN32OLE_EVENT#handler=
 *
 *  sets event handler object. If handler object has onXXX
 *  method according to XXX event, then onXXX method is called
 *  when XXX event occurs.
 *
 *  If handler object has method_missing and there is no
 *  method according to the event, then method_missing
 *  called and 1-st argument is event name.
 *
 *  If handler object has onXXX method and there is block
 *  defined by WIN32OLE_EVENT#on_event('XXX'){},
 *  then block is executed but handler object method is not called
 *  when XXX event occurs.
 *
 *      class Handler
 *        def onStatusTextChange(text)
 *          puts &quot;StatusTextChanged&quot;
 *        end
 *        def onPropertyChange(prop)
 *          puts &quot;PropertyChanged&quot;
 *        end
 *        def method_missing(ev, *arg)
 *          puts &quot;other event #{ev}&quot;
 *        end
 *      end
 *
 *      handler = Handler.new
 *      ie = WIN32OLE.new('InternetExplorer.Application')
 *      ev = WIN32OLE_EVENT.new(ie)
 *      ev.on_event(&quot;StatusTextChange&quot;) {|*args|
 *        puts &quot;this block executed.&quot;
 *        puts &quot;handler.onStatusTextChange method is not called.&quot;
 *      }
 *      ev.handler = handler
 *
 */
static VALUE
fev_set_handler(VALUE self, VALUE val)
{
    return rb_ivar_set(self, rb_intern(&quot;handler&quot;), val);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="off_event-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>off_event</strong>([event]) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
removes the callback of event.
</p>
<pre class="code">
  ie = WIN32OLE.new('InternetExplorer.Application')
  ev = WIN32OLE_EVENT.new(ie)
  ev.on_event('BeforeNavigate2') {|*args|
    args.last[6] = true
  }
    ...
  ev.off_event('BeforeNavigate2')
    ...</pre>


  </div>
</div>
<div class="tags">
  
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/win32ole/win32ole.c'</span>

/*
 *  call-seq:
 *     WIN32OLE_EVENT#off_event([event])
 *
 *  removes the callback of event.
 *
 *    ie = WIN32OLE.new('InternetExplorer.Application')
 *    ev = WIN32OLE_EVENT.new(ie)
 *    ev.on_event('BeforeNavigate2') {|*args|
 *      args.last[6] = true
 *    }
 *      ...
 *    ev.off_event('BeforeNavigate2')
 *      ...
 */
static VALUE
fev_off_event(int argc, VALUE *argv, VALUE self)
{
    VALUE event = Qnil;
    VALUE events;

    rb_secure(4);
    rb_scan_args(argc, argv, &quot;01&quot;, &amp;event);
    if(!NIL_P(event)) {
    if(TYPE(event) != T_STRING &amp;&amp; TYPE(event) != T_SYMBOL) {
        rb_raise(rb_eTypeError, &quot;wrong argument type (expected String or Symbol)&quot;);
    }
    if (TYPE(event) == T_SYMBOL) {
        event = rb_sym_to_s(event);
    }
    }
    events = rb_ivar_get(self, id_events);
    if (NIL_P(events)) {
    return Qnil;
    }
    ole_delete_event(events, event);
    return Qnil;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="on_event-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>on_event</strong>([event]) { ... }
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Defines the callback event. If argument is omitted, this method defines the
callback of all events. If you want to modify reference argument in
callback, return hash in callback. If you want to return value to OLE
server as result of callback use `return&#8217; or :return.
</p>
<pre class="code">
  ie = WIN32OLE.new('InternetExplorer.Application')
  ev = WIN32OLE_EVENT.new(ie)
  ev.on_event(&quot;NavigateComplete&quot;) {|url| puts url}
  ev.on_event() {|ev, *args| puts &quot;#{ev} fired&quot;}

  ev.on_event(&quot;BeforeNavigate2&quot;) {|*args|
    ...
    # set true to BeforeNavigate reference argument `Cancel'.
    # Cancel is 7-th argument of BeforeNavigate,
    # so you can use 6 as key of hash instead of 'Cancel'.
    # The argument is counted from 0.
    # The hash key of 0 means first argument.)
    {:Cancel =&gt; true}  # or {'Cancel' =&gt; true} or {6 =&gt; true}
  }

  ev.on_event(...) {|*args|
    {:return =&gt; 1, :xxx =&gt; yyy}
  }</pre>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <h3>Yields:</h3>
<ul class="yield">
  
    <li>
      
        <span class='type'></span>
      
      
      
      
        
        <div class='inline'></div>
      
    </li>
  
</ul>

</div>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/win32ole/win32ole.c'</span>

/*
 *  call-seq:
 *     WIN32OLE_EVENT#on_event([event]){...}
 *
 *  Defines the callback event.
 *  If argument is omitted, this method defines the callback of all events.
 *  If you want to modify reference argument in callback, return hash in
 *  callback. If you want to return value to OLE server as result of callback
 *  use `return' or :return.
 *
 *    ie = WIN32OLE.new('InternetExplorer.Application')
 *    ev = WIN32OLE_EVENT.new(ie)
 *    ev.on_event(&quot;NavigateComplete&quot;) {|url| puts url}
 *    ev.on_event() {|ev, *args| puts &quot;#{ev} fired&quot;}
 *
 *    ev.on_event(&quot;BeforeNavigate2&quot;) {|*args|
 *      ...
 *      # set true to BeforeNavigate reference argument `Cancel'.
 *      # Cancel is 7-th argument of BeforeNavigate,
 *      # so you can use 6 as key of hash instead of 'Cancel'.
 *      # The argument is counted from 0.
 *      # The hash key of 0 means first argument.)
 *      {:Cancel =&gt; true}  # or {'Cancel' =&gt; true} or {6 =&gt; true}
 *    }
 *
 *    ev.on_event(...) {|*args|
 *      {:return =&gt; 1, :xxx =&gt; yyy}
 *    }
 */
static VALUE
fev_on_event(int argc, VALUE *argv, VALUE self)
{
    return ev_on_event(argc, argv, self, Qfalse);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="on_event_with_outargs-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>on_event_with_outargs</strong>([event]) { ... }
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Defines the callback of event. If you want modify argument in callback, you
could use this method instead of WIN32OLE_EVENT#on_event.
</p>
<pre class="code">
  ie = WIN32OLE.new('InternetExplorer.Application')
  ev = WIN32OLE_EVENT.new(ie)
  ev.on_event_with_outargs('BeforeNavigate2') {|*args|
    args.last[6] = true
  }</pre>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <h3>Yields:</h3>
<ul class="yield">
  
    <li>
      
        <span class='type'></span>
      
      
      
      
        
        <div class='inline'></div>
      
    </li>
  
</ul>

</div>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/win32ole/win32ole.c'</span>

/*
 *  call-seq:
 *     WIN32OLE_EVENT#on_event_with_outargs([event]){...}
 *
 *  Defines the callback of event.
 *  If you want modify argument in callback,
 *  you could use this method instead of WIN32OLE_EVENT#on_event.
 *
 *    ie = WIN32OLE.new('InternetExplorer.Application')
 *    ev = WIN32OLE_EVENT.new(ie)
 *    ev.on_event_with_outargs('BeforeNavigate2') {|*args|
 *      args.last[6] = true
 *    }
 */
static VALUE
fev_on_event_with_outargs(int argc, VALUE *argv, VALUE self)
{
    return ev_on_event(argc, argv, self, Qtrue);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="unadvise-instance_method">
  
    - (<tt>nil</tt>) <strong>unadvise</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
disconnects OLE server. If this method called, then the WIN32OLE_EVENT
object does not receive the OLE server event any more. This method is trial
implementation.
</p>
<pre class="code">
    ie = WIN32OLE.new('InternetExplorer.Application')
    ev = WIN32OLE_EVENT.new(ie)
    ev.on_event() {...}
       ...
    ev.unadvise</pre>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/win32ole/win32ole.c'</span>

/*
 *  call-seq:
 *     WIN32OLE_EVENT#unadvise -&gt; nil
 *
 *  disconnects OLE server. If this method called, then the WIN32OLE_EVENT object
 *  does not receive the OLE server event any more.
 *  This method is trial implementation.
 *
 *      ie = WIN32OLE.new('InternetExplorer.Application')
 *      ev = WIN32OLE_EVENT.new(ie)
 *      ev.on_event() {...}
 *         ...
 *      ev.unadvise
 *
 */
static VALUE
fev_unadvise(VALUE self)
{
    struct oleeventdata *poleev;
    Data_Get_Struct(self, struct oleeventdata, poleev);
    if (poleev-&gt;pConnectionPoint) {
        ole_msg_loop();
        evs_delete(poleev-&gt;event_id);
        poleev-&gt;pConnectionPoint-&gt;lpVtbl-&gt;Unadvise(poleev-&gt;pConnectionPoint, poleev-&gt;dwCookie);
        OLE_RELEASE(poleev-&gt;pConnectionPoint);
        poleev-&gt;pConnectionPoint = NULL;
    }
    return Qnil;
}</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Thu Oct 14 00:01:49 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.1 (ruby-1.9.2).
</div>

  </body>
</html>