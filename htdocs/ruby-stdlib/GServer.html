<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Class: GServer</title>
<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (G)</a> &raquo; 
    
    
    <span class="title">GServer</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: GServer
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">GServer</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/gserver.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
GServer implements a generic server, featuring thread pool management,
simple logging, and multi-server management.  See HttpServer in
<tt>xmlrpc/httpserver.rb</tt> in the Ruby standard library for an example
of GServer in action.
</p>
<p>
Any kind of application-level server can be implemented using this class.
It accepts multiple simultaneous connections from clients, up to an
optional maximum number.  Several <em>services</em> (i.e. one service per
TCP port) can be run simultaneously, and stopped at any time through the
class method <tt>GServer.stop(port)</tt>.  All the threading issues are
handled, saving you the effort.  All events are optionally logged, but you
can provide your own event handlers if you wish.
</p>
<h3>Example</h3>
<p>
Using GServer is simple.  Below we implement a simple time server, run it,
query it, and shut it down.  Try this code in <tt>irb</tt>:
</p>
<pre class="code">
  <span class='id require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>gserver</span><span class='tstring_end'>'</span></span>

  <span class='comment'>#
</span>  <span class='comment'># A server that returns the time in seconds since 1970.
</span>  <span class='comment'>#
</span>  <span class='kw'>class</span> <span class='const'>TimeServer</span> <span class='op'>&lt;</span> <span class='const'>GServer</span>
    <span class='kw'>def</span> <span class='id initialize'>initialize</span><span class='lparen'>(</span><span class='id port'>port</span><span class='op'>=</span><span class='int'>10001</span><span class='comma'>,</span> <span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>
      <span class='kw'>super</span><span class='lparen'>(</span><span class='id port'>port</span><span class='comma'>,</span> <span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='kw'>def</span> <span class='id serve'>serve</span><span class='lparen'>(</span><span class='id io'>io</span><span class='rparen'>)</span>
      <span class='id io'>io</span><span class='period'>.</span><span class='id puts'>puts</span><span class='lparen'>(</span><span class='const'>Time</span><span class='period'>.</span><span class='id now'>now</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Run the server with logging enabled (it's a separate thread).
</span>  <span class='id server'>server</span> <span class='op'>=</span> <span class='const'>TimeServer</span><span class='period'>.</span><span class='id new'>new</span>
  <span class='id server'>server</span><span class='period'>.</span><span class='id audit'>audit</span> <span class='op'>=</span> <span class='kw'>true</span>                  <span class='comment'># Turn logging on.
</span>  <span class='id server'>server</span><span class='period'>.</span><span class='id start'>start</span>

  <span class='comment'># *** Now point your browser to http://localhost:10001 to see it working ***
</span>
  <span class='comment'># See if it's still running.
</span>  <span class='const'>GServer</span><span class='period'>.</span><span class='id in_service?'>in_service?</span><span class='lparen'>(</span><span class='int'>10001</span><span class='rparen'>)</span>           <span class='comment'># -&gt; true
</span>  <span class='id server'>server</span><span class='period'>.</span><span class='id stopped?'>stopped?</span>                      <span class='comment'># -&gt; false
</span>
  <span class='comment'># Shut the server down gracefully.
</span>  <span class='id server'>server</span><span class='period'>.</span><span class='id shutdown'>shutdown</span>

  <span class='comment'># Alternatively, stop it immediately.
</span>  <span class='const'>GServer</span><span class='period'>.</span><span class='id stop'>stop</span><span class='lparen'>(</span><span class='int'>10001</span><span class='rparen'>)</span>
  <span class='comment'># or, of course, &quot;server.stop&quot;.
</span></pre>
<p>
All the business of accepting connections and exception handling is taken
care of.  All we have to do is implement the method that actually serves
the client.
</p>
<h3>Advanced</h3>
<p>
As the example above shows, the way to use GServer is to subclass it to
create a specific server, overriding the <tt>serve</tt> method.  You can
override other methods as well if you wish, perhaps to collect statistics,
or emit more detailed logging.
</p>
<pre class="code">
  <span class='id connecting'>connecting</span>
  <span class='id disconnecting'>disconnecting</span>
  <span class='id starting'>starting</span>
  <span class='id stopping'>stopping</span>
</pre>
<p>
The above methods are only called if auditing is enabled.
</p>
<p>
You can also override <tt>log</tt> and <tt>error</tt> if, for example, you
wish to use a more sophisticated logging system.
</p>


  </div>
</div>
<div class="tags">
  
</div><div id="subclasses">
  <h2>Direct Known Subclasses</h2>
  <p class="children"><span class='object_link'><a href="HttpServer.html" title="HttpServer (class)">HttpServer</a></span></p>
</div>

  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="DEFAULT_HOST-constant" class="">DEFAULT_HOST =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
        <dt id="services-classvariable" class="">@@services =
          <div class="docstring">
  <div class="discussion">
    <p>
Hash of opened ports, i.e. services
</p>


  </div>
</div>
<div class="tags">
  
</div>
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span><span class='rbrace'>}</span></pre></dd>
      
        <dt id="servicesMutex-classvariable" class="">@@servicesMutex =
          
        </dt>
        <dd><pre class="code"><span class='const'>Mutex</span><span class='period'>.</span><span class='id new'>new</span></pre></dd>
      
    </dl>
  


  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#audit-instance_method" title="#audit (instance method)">- (Object) <strong>audit</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute audit.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#debug-instance_method" title="#debug (instance method)">- (Object) <strong>debug</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute debug.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#host-instance_method" title="#host (instance method)">- (Object) <strong>host</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute host.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#maxConnections-instance_method" title="#maxConnections (instance method)">- (Object) <strong>maxConnections</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute maxConnections.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#port-instance_method" title="#port (instance method)">- (Object) <strong>port</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute port.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#stdlog-instance_method" title="#stdlog (instance method)">- (Object) <strong>stdlog</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute stdlog.
</p>
</div></span>
  
</li>

    
  </ul>


  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#in_service%3F-class_method" title="in_service? (class method)">+ (Boolean) <strong>in_service?</strong>(port, host = DEFAULT_HOST) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stop-class_method" title="stop (class method)">+ (Object) <strong>stop</strong>(port, host = DEFAULT_HOST) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#connections-instance_method" title="#connections (instance method)">- (Object) <strong>connections</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (GServer) <strong>initialize</strong>(port, host = DEFAULT_HOST, maxConnections = 4, stdlog = $stderr, audit = false, debug = false) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
A new instance of GServer.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#join-instance_method" title="#join (instance method)">- (Object) <strong>join</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#serve-instance_method" title="#serve (instance method)">- (Object) <strong>serve</strong>(io) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#shutdown-instance_method" title="#shutdown (instance method)">- (Object) <strong>shutdown</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#start-instance_method" title="#start (instance method)">- (Object) <strong>start</strong>(maxConnections = 1) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stop-instance_method" title="#stop (instance method)">- (Object) <strong>stop</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stopped%3F-instance_method" title="#stopped? (instance method)">- (Boolean) <strong>stopped?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="GServer (class)">GServer</a></span></tt>) <strong>initialize</strong>(port, host = DEFAULT_HOST, maxConnections = 4, stdlog = $stderr, audit = false, debug = false) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
A new instance of GServer
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


171
172
173
174
175
176
177
178
179
180
181
182
183</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/gserver.rb', line 171</span>

<span class='kw'>def</span> <span class='id initialize'>initialize</span><span class='lparen'>(</span><span class='id port'>port</span><span class='comma'>,</span> <span class='id host'>host</span> <span class='op'>=</span> <span class='const'>DEFAULT_HOST</span><span class='comma'>,</span> <span class='id maxConnections'>maxConnections</span> <span class='op'>=</span> <span class='int'>4</span><span class='comma'>,</span>
  <span class='id stdlog'>stdlog</span> <span class='op'>=</span> <span class='gvar'>$stderr</span><span class='comma'>,</span> <span class='id audit'>audit</span> <span class='op'>=</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='id debug'>debug</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='ivar'>@tcpServerThread</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@port</span> <span class='op'>=</span> <span class='id port'>port</span>
  <span class='ivar'>@host</span> <span class='op'>=</span> <span class='id host'>host</span>
  <span class='ivar'>@maxConnections</span> <span class='op'>=</span> <span class='id maxConnections'>maxConnections</span>
  <span class='ivar'>@connections</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='ivar'>@connectionsMutex</span> <span class='op'>=</span> <span class='const'>Mutex</span><span class='period'>.</span><span class='id new'>new</span>
  <span class='ivar'>@connectionsCV</span> <span class='op'>=</span> <span class='const'>ConditionVariable</span><span class='period'>.</span><span class='id new'>new</span>
  <span class='ivar'>@stdlog</span> <span class='op'>=</span> <span class='id stdlog'>stdlog</span>
  <span class='ivar'>@audit</span> <span class='op'>=</span> <span class='id audit'>audit</span>
  <span class='ivar'>@debug</span> <span class='op'>=</span> <span class='id debug'>debug</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="audit=-instance_method"></span>
      <span id="audit-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="audit-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>audit</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute audit
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


132
133
134</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/gserver.rb', line 132</span>

<span class='kw'>def</span> <span class='id audit'>audit</span>
  <span class='ivar'>@audit</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="debug=-instance_method"></span>
      <span id="debug-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="debug-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>debug</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute debug
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


132
133
134</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/gserver.rb', line 132</span>

<span class='kw'>def</span> <span class='id debug'>debug</span>
  <span class='ivar'>@debug</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="host-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="host-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>host</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute host
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


131
132
133</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/gserver.rb', line 131</span>

<span class='kw'>def</span> <span class='id host'>host</span>
  <span class='ivar'>@host</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="maxConnections-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="maxConnections-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>maxConnections</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute maxConnections
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


131
132
133</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/gserver.rb', line 131</span>

<span class='kw'>def</span> <span class='id maxConnections'>maxConnections</span>
  <span class='ivar'>@maxConnections</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="port-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="port-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>port</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute port
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


131
132
133</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/gserver.rb', line 131</span>

<span class='kw'>def</span> <span class='id port'>port</span>
  <span class='ivar'>@port</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="stdlog=-instance_method"></span>
      <span id="stdlog-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="stdlog-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>stdlog</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute stdlog
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


132
133
134</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/gserver.rb', line 132</span>

<span class='kw'>def</span> <span class='id stdlog'>stdlog</span>
  <span class='ivar'>@stdlog</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="in_service?-class_method">
  
    + (<tt>Boolean</tt>) <strong>in_service?</strong>(port, host = DEFAULT_HOST) 
  

  
</p><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


102
103
104
105</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/gserver.rb', line 102</span>

<span class='kw'>def</span> <span class='const'>GServer</span><span class='period'>.</span><span class='id in_service?'>in_service?</span><span class='lparen'>(</span><span class='id port'>port</span><span class='comma'>,</span> <span class='id host'>host</span> <span class='op'>=</span> <span class='const'>DEFAULT_HOST</span><span class='rparen'>)</span>
  <span class='cvar'>@@services</span><span class='period'>.</span><span class='id has_key?'>has_key?</span><span class='lparen'>(</span><span class='id host'>host</span><span class='rparen'>)</span> <span class='kw'>and</span>
    <span class='cvar'>@@services</span><span class='lbracket'>[</span><span class='id host'>host</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id has_key?'>has_key?</span><span class='lparen'>(</span><span class='id port'>port</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="stop-class_method">
  
    + (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>stop</strong>(port, host = DEFAULT_HOST) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


96
97
98
99
100</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/gserver.rb', line 96</span>

<span class='kw'>def</span> <span class='const'>GServer</span><span class='period'>.</span><span class='id stop'>stop</span><span class='lparen'>(</span><span class='id port'>port</span><span class='comma'>,</span> <span class='id host'>host</span> <span class='op'>=</span> <span class='const'>DEFAULT_HOST</span><span class='rparen'>)</span>
  <span class='cvar'>@@servicesMutex</span><span class='period'>.</span><span class='id synchronize'>synchronize</span> <span class='lbrace'>{</span>
    <span class='cvar'>@@services</span><span class='lbracket'>[</span><span class='id host'>host</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id port'>port</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id stop'>stop</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="connections-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>connections</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


123
124
125</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/gserver.rb', line 123</span>

<span class='kw'>def</span> <span class='id connections'>connections</span>
  <span class='ivar'>@connections</span><span class='period'>.</span><span class='id size'>size</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="join-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>join</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


127
128
129</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/gserver.rb', line 127</span>

<span class='kw'>def</span> <span class='id join'>join</span>
  <span class='ivar'>@tcpServerThread</span><span class='period'>.</span><span class='id join'>join</span> <span class='kw'>if</span> <span class='ivar'>@tcpServerThread</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="serve-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>serve</strong>(io) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


90
91</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/gserver.rb', line 90</span>

<span class='kw'>def</span> <span class='id serve'>serve</span><span class='lparen'>(</span><span class='id io'>io</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="shutdown-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>shutdown</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


119
120
121</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/gserver.rb', line 119</span>

<span class='kw'>def</span> <span class='id shutdown'>shutdown</span>
  <span class='ivar'>@shutdown</span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="start-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>start</strong>(maxConnections = 1) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/gserver.rb', line 185</span>

<span class='kw'>def</span> <span class='id start'>start</span><span class='lparen'>(</span><span class='id maxConnections'>maxConnections</span> <span class='op'>=</span> <span class='op'>-</span><span class='int'>1</span><span class='rparen'>)</span>
  <span class='id raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>running</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='op'>!</span><span class='id stopped?'>stopped?</span>
  <span class='ivar'>@shutdown</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@maxConnections</span> <span class='op'>=</span> <span class='id maxConnections'>maxConnections</span> <span class='kw'>if</span> <span class='id maxConnections'>maxConnections</span> <span class='op'>&gt;</span> <span class='int'>0</span>
  <span class='cvar'>@@servicesMutex</span><span class='period'>.</span><span class='id synchronize'>synchronize</span>  <span class='lbrace'>{</span>
    <span class='kw'>if</span> <span class='const'>GServer</span><span class='period'>.</span><span class='id in_service?'>in_service?</span><span class='lparen'>(</span><span class='ivar'>@port</span><span class='comma'>,</span><span class='ivar'>@host</span><span class='rparen'>)</span>
      <span class='id raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Port already in use: </span><span class='embexpr_beg'>#{</span><span class='id host'>host</span><span class='rbrace'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='ivar'>@port</span><span class='rbrace'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='ivar'>@tcpServer</span> <span class='op'>=</span> <span class='const'>TCPServer</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='ivar'>@host</span><span class='comma'>,</span><span class='ivar'>@port</span><span class='rparen'>)</span>
    <span class='ivar'>@port</span> <span class='op'>=</span> <span class='ivar'>@tcpServer</span><span class='period'>.</span><span class='id addr'>addr</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='cvar'>@@services</span><span class='lbracket'>[</span><span class='ivar'>@host</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='kw'>unless</span> <span class='cvar'>@@services</span><span class='period'>.</span><span class='id has_key?'>has_key?</span><span class='lparen'>(</span><span class='ivar'>@host</span><span class='rparen'>)</span>
    <span class='cvar'>@@services</span><span class='lbracket'>[</span><span class='ivar'>@host</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='ivar'>@port</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>self</span><span class='semicolon'>;</span>
  <span class='rbrace'>}</span>
  <span class='ivar'>@tcpServerThread</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id new'>new</span> <span class='lbrace'>{</span>
    <span class='kw'>begin</span>
      <span class='id starting'>starting</span> <span class='kw'>if</span> <span class='ivar'>@audit</span>
      <span class='kw'>while</span> <span class='op'>!</span><span class='ivar'>@shutdown</span>
        <span class='ivar'>@connectionsMutex</span><span class='period'>.</span><span class='id synchronize'>synchronize</span>  <span class='lbrace'>{</span>
           <span class='kw'>while</span> <span class='ivar'>@connections</span><span class='period'>.</span><span class='id size'>size</span> <span class='op'>&gt;=</span> <span class='ivar'>@maxConnections</span>
             <span class='ivar'>@connectionsCV</span><span class='period'>.</span><span class='id wait'>wait</span><span class='lparen'>(</span><span class='ivar'>@connectionsMutex</span><span class='rparen'>)</span>
           <span class='kw'>end</span>
        <span class='rbrace'>}</span>
        <span class='id client'>client</span> <span class='op'>=</span> <span class='ivar'>@tcpServer</span><span class='period'>.</span><span class='id accept'>accept</span>
        <span class='ivar'>@connections</span> <span class='op'>&lt;&lt;</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id client'>client</span><span class='rparen'>)</span>  <span class='lbrace'>{</span> <span class='op'>|</span><span class='id myClient'>myClient</span><span class='op'>|</span>
          <span class='kw'>begin</span>
            <span class='id myPort'>myPort</span> <span class='op'>=</span> <span class='id myClient'>myClient</span><span class='period'>.</span><span class='id peeraddr'>peeraddr</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
            <span class='id serve'>serve</span><span class='lparen'>(</span><span class='id myClient'>myClient</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@audit</span> <span class='kw'>or</span> <span class='id connecting'>connecting</span><span class='lparen'>(</span><span class='id myClient'>myClient</span><span class='rparen'>)</span>
          <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id detail'>detail</span>
            <span class='id error'>error</span><span class='lparen'>(</span><span class='id detail'>detail</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@debug</span>
          <span class='kw'>ensure</span>
            <span class='kw'>begin</span>
              <span class='id myClient'>myClient</span><span class='period'>.</span><span class='id close'>close</span>
            <span class='kw'>rescue</span>
            <span class='kw'>end</span>
            <span class='ivar'>@connectionsMutex</span><span class='period'>.</span><span class='id synchronize'>synchronize</span> <span class='lbrace'>{</span>
              <span class='ivar'>@connections</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='const'>Thread</span><span class='period'>.</span><span class='id current'>current</span><span class='rparen'>)</span>
              <span class='ivar'>@connectionsCV</span><span class='period'>.</span><span class='id signal'>signal</span>
            <span class='rbrace'>}</span>
            <span class='id disconnecting'>disconnecting</span><span class='lparen'>(</span><span class='id myPort'>myPort</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@audit</span>
          <span class='kw'>end</span>
        <span class='rbrace'>}</span>
      <span class='kw'>end</span>
    <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id detail'>detail</span>
      <span class='id error'>error</span><span class='lparen'>(</span><span class='id detail'>detail</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@debug</span>
    <span class='kw'>ensure</span>
      <span class='kw'>begin</span>
        <span class='ivar'>@tcpServer</span><span class='period'>.</span><span class='id close'>close</span>
      <span class='kw'>rescue</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='ivar'>@shutdown</span>
        <span class='ivar'>@connectionsMutex</span><span class='period'>.</span><span class='id synchronize'>synchronize</span>  <span class='lbrace'>{</span>
           <span class='kw'>while</span> <span class='ivar'>@connections</span><span class='period'>.</span><span class='id size'>size</span> <span class='op'>&gt;</span> <span class='int'>0</span>
             <span class='ivar'>@connectionsCV</span><span class='period'>.</span><span class='id wait'>wait</span><span class='lparen'>(</span><span class='ivar'>@connectionsMutex</span><span class='rparen'>)</span>
           <span class='kw'>end</span>
        <span class='rbrace'>}</span>
      <span class='kw'>else</span>
        <span class='ivar'>@connections</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id c'>c</span><span class='op'>|</span> <span class='id c'>c</span><span class='period'>.</span><span class='id raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>stop</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
      <span class='kw'>end</span>
      <span class='ivar'>@tcpServerThread</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='cvar'>@@servicesMutex</span><span class='period'>.</span><span class='id synchronize'>synchronize</span>  <span class='lbrace'>{</span>
        <span class='cvar'>@@services</span><span class='lbracket'>[</span><span class='ivar'>@host</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='ivar'>@port</span><span class='rparen'>)</span>
      <span class='rbrace'>}</span>
      <span class='id stopping'>stopping</span> <span class='kw'>if</span> <span class='ivar'>@audit</span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="stop-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>stop</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


107
108
109
110
111
112
113</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/gserver.rb', line 107</span>

<span class='kw'>def</span> <span class='id stop'>stop</span>
  <span class='ivar'>@connectionsMutex</span><span class='period'>.</span><span class='id synchronize'>synchronize</span>  <span class='lbrace'>{</span>
    <span class='kw'>if</span> <span class='ivar'>@tcpServerThread</span>
      <span class='ivar'>@tcpServerThread</span><span class='period'>.</span><span class='id raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>stop</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="stopped?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>stopped?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


115
116
117</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/gserver.rb', line 115</span>

<span class='kw'>def</span> <span class='id stopped?'>stopped?</span>
  <span class='ivar'>@tcpServerThread</span> <span class='op'>==</span> <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Thu Oct 14 00:01:32 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.1 (ruby-1.9.2).
</div>

  </body>
</html>