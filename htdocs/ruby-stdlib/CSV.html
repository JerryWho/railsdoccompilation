<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Class: CSV</title>
<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (C)</a> &raquo; 
    
    
    <span class="title">CSV</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: CSV
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">CSV</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
      <dt class="r2">Extended by:</dt>
      <dd class="r2"><span class='object_link'><a href="Forwardable.html" title="Forwardable (module)">Forwardable</a></span></dd>
      
    
  
    
      <dt class="r1">Includes:</dt>
      <dd class="r1"><span class='object_link'><a href="Enumerable.html" title="Enumerable (module)">Enumerable</a></span></dd>
      
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/csv.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
This class provides a complete interface to CSV files and data.  It offers
tools to enable you to read and write to and from Strings or IO objects, as
needed.
</p>
<h2>Reading</h2>
<h3>From a File</h3>
<h4>A Line at a Time</h4>
<pre class="code">
  <span class='const'>CSV</span><span class='period'>.</span><span class='id foreach'>foreach</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>path/to/file.csv</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id row'>row</span><span class='op'>|</span>
    <span class='comment'># use row here...
</span>  <span class='kw'>end</span>
</pre>
<h4>All at Once</h4>
<pre class="code">
  <span class='id arr_of_arrs'>arr_of_arrs</span> <span class='op'>=</span> <span class='const'>CSV</span><span class='period'>.</span><span class='id read'>read</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>path/to/file.csv</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
</pre>
<h3>From a String</h3>
<h4>A Line at a Time</h4>
<pre class="code">
  <span class='const'>CSV</span><span class='period'>.</span><span class='id parse'>parse</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CSV,data,String</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id row'>row</span><span class='op'>|</span>
    <span class='comment'># use row here...
</span>  <span class='kw'>end</span>
</pre>
<h4>All at Once</h4>
<pre class="code">
  <span class='id arr_of_arrs'>arr_of_arrs</span> <span class='op'>=</span> <span class='const'>CSV</span><span class='period'>.</span><span class='id parse'>parse</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CSV,data,String</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
</pre>
<h2>Writing</h2>
<h3>To a File</h3>
<pre class="code">
  <span class='const'>CSV</span><span class='period'>.</span><span class='id open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>path/to/file.csv</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wb</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id csv'>csv</span><span class='op'>|</span>
    <span class='id csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>row</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>of</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CSV</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>data</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='id csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>another</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>row</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='comment'># ...
</span>  <span class='kw'>end</span>
</pre>
<h3>To a String</h3>
<pre class="code">
  <span class='id csv_string'>csv_string</span> <span class='op'>=</span> <span class='const'>CSV</span><span class='period'>.</span><span class='id generate'>generate</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id csv'>csv</span><span class='op'>|</span>
    <span class='id csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>row</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>of</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CSV</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>data</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='id csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>another</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>row</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='comment'># ...
</span>  <span class='kw'>end</span>
</pre>
<h2>Convert a Single Line</h2>
<pre class="code">
  <span class='id csv_string'>csv_string</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CSV</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>data</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id to_csv'>to_csv</span>   <span class='comment'># to CSV
</span>  <span class='id csv_array'>csv_array</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CSV,String</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id parse_csv'>parse_csv</span>   <span class='comment'># from CSV
</span></pre>
<h2>Shortcut Interface</h2>
<pre class="code">
  <span class='const'>CSV</span>             <span class='lbrace'>{</span> <span class='op'>|</span><span class='id csv_out'>csv_out</span><span class='op'>|</span> <span class='id csv_out'>csv_out</span> <span class='op'>&lt;&lt;</span> <span class='qwords_beg'>%w{</span><span class='tstring_content'>my</span><span class='words_sep'> </span><span class='tstring_content'>data</span><span class='words_sep'> </span><span class='tstring_content'>here</span><span class='words_sep'>}</span> <span class='rbrace'>}</span>  <span class='comment'># to $stdout
</span>  <span class='const'>CSV</span><span class='lparen'>(</span><span class='id csv'>csv</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>   <span class='lbrace'>{</span> <span class='op'>|</span><span class='id csv_str'>csv_str</span><span class='op'>|</span> <span class='id csv_str'>csv_str</span> <span class='op'>&lt;&lt;</span> <span class='qwords_beg'>%w{</span><span class='tstring_content'>my</span><span class='words_sep'> </span><span class='tstring_content'>data</span><span class='words_sep'> </span><span class='tstring_content'>here</span><span class='words_sep'>}</span> <span class='rbrace'>}</span>  <span class='comment'># to a String
</span>  <span class='const'>CSV</span><span class='lparen'>(</span><span class='gvar'>$stderr</span><span class='rparen'>)</span>    <span class='lbrace'>{</span> <span class='op'>|</span><span class='id csv_err'>csv_err</span><span class='op'>|</span> <span class='id csv_err'>csv_err</span> <span class='op'>&lt;&lt;</span> <span class='qwords_beg'>%w{</span><span class='tstring_content'>my</span><span class='words_sep'> </span><span class='tstring_content'>data</span><span class='words_sep'> </span><span class='tstring_content'>here</span><span class='words_sep'>}</span> <span class='rbrace'>}</span>  <span class='comment'># to $stderr
</span></pre>
<h2>CSV and Character Encodings (M17n or Multilingualization)</h2>
<p>
This new CSV parser is m17n savvy.  The parser works in the Encoding of the
IO or String object being read from or written to.  Your data is never
transcoded (unless you ask Ruby to transcode it for you) and will literally
be parsed in the Encoding it is in.  Thus CSV will return Arrays or Rows of
Strings in the Encoding of your data.  This is accomplished by transcoding
the parser itself into your Encoding.
</p>
<p>
Some transcoding must take place, of course, to accomplish this
multiencoding support.  For example, <tt>:col_sep</tt>, <tt>:row_sep</tt>,
and <tt>:quote_char</tt> must be transcoded to match your data.  Hopefully
this makes the entire process feel transparent, since CSV&#8217;s defaults
should just magically work for you data.  However, you can set these values
manually in the target Encoding to avoid the translation.
</p>
<p>
It&#8217;s also important to note that while all of CSV&#8217;s core parser
is now Encoding agnostic, some features are not.  For example, the built-in
converters will try to transcode data to UTF-8 before making conversions.
Again, you can provide custom converters that are aware of your Encodings
to avoid this translation.  It&#8217;s just too hard for me to support
native conversions in all of Ruby&#8217;s Encodings.
</p>
<p>
Anyway, the practical side of this is simple:  make sure IO and String
objects passed into CSV have the proper Encoding set and everything should
just work. CSV methods that allow you to open IO objects (CSV::foreach(),
CSV::open(), CSV::read(), and CSV::readlines()) do allow you to specify the
Encoding.
</p>
<p>
One minor exception comes when generating CSV into a String with an
Encoding that is not ASCII compatible.  There&#8217;s no existing data for
CSV to use to prepare itself and thus you will probably need to manually
specify the desired Encoding for most of those cases.  It will try to guess
using the fields in a row of output though, when using CSV::generate_line()
or Array#to_csv().
</p>
<p>
I try to point out any other Encoding issues in the documentation of
methods as they come up.
</p>
<p>
This has been tested to the best of my ability with all
non-&#8220;dummy&#8221; Encodings Ruby ships with.  However, it is brave
new code and may have some bugs. Please feel free to <a
href="mailto:james@grayproductions.net">report</a> any issues you find with
it.
</p>


  </div>
</div>
<div class="tags">
  
</div><h2>Defined Under Namespace</h2>
<p class="children">
   
    
   
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="CSV/FieldInfo.html" title="CSV::FieldInfo (class)">FieldInfo</a></span>, <span class='object_link'><a href="CSV/MalformedCSVError.html" title="CSV::MalformedCSVError (class)">MalformedCSVError</a></span>, <span class='object_link'><a href="CSV/Row.html" title="CSV::Row (class)">Row</a></span>, <span class='object_link'><a href="CSV/Table.html" title="CSV::Table (class)">Table</a></span>
    
  
</p>

  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="VERSION-constant" class="">VERSION =
          <div class="docstring">
  <div class="discussion">
    <p>
The version of the installed library.
</p>


  </div>
</div>
<div class="tags">
  
</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>2.4.7</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id freeze'>freeze</span></pre></dd>
      
        <dt id="DateMatcher-constant" class="">DateMatcher =
          <div class="docstring">
  <div class="discussion">
    <p>
A Regexp used to find and convert some common Date formats.
</p>


  </div>
</div>
<div class="tags">
  
</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'> \A(?: (\w+,?\s+)?\w+\s+\d{1,2},?\s+\d{2,4} |
</span><span class='tstring_content'>\d{4}-\d{2}-\d{2} )\z </span><span class='regexp_end'>/x</span></span></pre></dd>
      
        <dt id="DateTimeMatcher-constant" class="">DateTimeMatcher =
          <div class="docstring">
  <div class="discussion">
    <p>
A Regexp used to find and convert some common DateTime formats.
</p>


  </div>
</div>
<div class="tags">
  
</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'> \A(?: (\w+,?\s+)?\w+\s+\d{1,2}\s+\d{1,2}:\d{1,2}:\d{1,2},?\s+\d{2,4} |
</span><span class='tstring_content'>\d{4}-\d{2}-\d{2}\s\d{2}:\d{2}:\d{2} )\z </span><span class='regexp_end'>/x</span></span></pre></dd>
      
        <dt id="ConverterEncoding-constant" class="">ConverterEncoding =
          <div class="docstring">
  <div class="discussion">
    <p>
The encoding used by all converters.
</p>


  </div>
</div>
<div class="tags">
  
</div>
        </dt>
        <dd><pre class="code"><span class='const'>Encoding</span><span class='period'>.</span><span class='id find'>find</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UTF-8</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span></pre></dd>
      
        <dt id="Converters-constant" class="">Converters =
          <div class="docstring">
  <div class="discussion">
    <p>
This Hash holds the built-in converters of CSV that can be accessed by
name. You can select Converters with CSV.convert() or through the
<tt>options</tt> Hash passed to CSV::new().
</p>
<table>
<tr><td valign="top"><b><tt>:integer</tt></b></td><td><p>
Converts any field Integer() accepts.
</p>
</td></tr>
<tr><td valign="top"><b><tt>:float</tt></b></td><td><p>
Converts any field Float() accepts.
</p>
</td></tr>
<tr><td valign="top"><b><tt>:numeric</tt></b></td><td><p>
A combination of <tt>:integer</tt> and <tt>:float</tt>.
</p>
</td></tr>
<tr><td valign="top"><b><tt>:date</tt></b></td><td><p>
Converts any field Date::parse() accepts.
</p>
</td></tr>
<tr><td valign="top"><b><tt>:date_time</tt></b></td><td><p>
Converts any field DateTime::parse() accepts.
</p>
</td></tr>
<tr><td valign="top"><b><tt>:all</tt></b></td><td><p>
All built-in converters.  A combination of <tt>:date_time</tt> and
<tt>:numeric</tt>.
</p>
</td></tr>
</table>
<p>
All built-in converters transcode field data to UTF-8 before attempting a
conversion.  If your data cannot be transcoded to UTF-8 the conversion will
fail and the field will remain unchanged.
</p>
<p>
This Hash is intentionally left unfrozen and users should feel free to add
values to it that can be accessed by all CSV objects.
</p>
<p>
To add a combo field, the value should be an Array of names.  Combo fields
can be nested with other combo fields.
</p>


  </div>
</div>
<div class="tags">
  
</div>
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span> <span class='label'>integer:</span>   <span class='id lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id f'>f</span><span class='op'>|</span>
  <span class='const'>Integer</span><span class='lparen'>(</span><span class='id f'>f</span><span class='period'>.</span><span class='id encode'>encode</span><span class='lparen'>(</span><span class='const'>ConverterEncoding</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='kw'>rescue</span> <span class='id f'>f</span>
<span class='rbrace'>}</span><span class='comma'>,</span>
<span class='label'>float:</span>     <span class='id lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id f'>f</span><span class='op'>|</span>
  <span class='const'>Float</span><span class='lparen'>(</span><span class='id f'>f</span><span class='period'>.</span><span class='id encode'>encode</span><span class='lparen'>(</span><span class='const'>ConverterEncoding</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='kw'>rescue</span> <span class='id f'>f</span>
<span class='rbrace'>}</span><span class='comma'>,</span>
<span class='label'>numeric:</span>   <span class='lbracket'>[</span><span class='symbol'>:integer</span><span class='comma'>,</span> <span class='symbol'>:float</span><span class='rbracket'>]</span><span class='comma'>,</span>
<span class='label'>date:</span>      <span class='id lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id f'>f</span><span class='op'>|</span>
  <span class='kw'>begin</span>
    <span class='id e'>e</span> <span class='op'>=</span> <span class='id f'>f</span><span class='period'>.</span><span class='id encode'>encode</span><span class='lparen'>(</span><span class='const'>ConverterEncoding</span><span class='rparen'>)</span>
    <span class='id e'>e</span> <span class='op'>=~</span> <span class='const'>DateMatcher</span> <span class='op'>?</span> <span class='const'>Date</span><span class='period'>.</span><span class='id parse'>parse</span><span class='lparen'>(</span><span class='id e'>e</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id f'>f</span>
  <span class='kw'>rescue</span>  <span class='comment'># encoding conversion or date parse errors
</span>    <span class='id f'>f</span>
  <span class='kw'>end</span>
<span class='rbrace'>}</span><span class='comma'>,</span>
<span class='label'>date_time:</span> <span class='id lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id f'>f</span><span class='op'>|</span>
  <span class='kw'>begin</span>
    <span class='id e'>e</span> <span class='op'>=</span> <span class='id f'>f</span><span class='period'>.</span><span class='id encode'>encode</span><span class='lparen'>(</span><span class='const'>ConverterEncoding</span><span class='rparen'>)</span>
    <span class='id e'>e</span> <span class='op'>=~</span> <span class='const'>DateTimeMatcher</span> <span class='op'>?</span> <span class='const'>DateTime</span><span class='period'>.</span><span class='id parse'>parse</span><span class='lparen'>(</span><span class='id e'>e</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id f'>f</span>
  <span class='kw'>rescue</span>  <span class='comment'># encoding conversion or date parse errors
</span>    <span class='id f'>f</span>
  <span class='kw'>end</span>
<span class='rbrace'>}</span><span class='comma'>,</span>
<span class='label'>all:</span>       <span class='lbracket'>[</span><span class='symbol'>:date_time</span><span class='comma'>,</span> <span class='symbol'>:numeric</span><span class='rbracket'>]</span> <span class='rbrace'>}</span></pre></dd>
      
        <dt id="HeaderConverters-constant" class="">HeaderConverters =
          <div class="docstring">
  <div class="discussion">
    <p>
This Hash holds the built-in header converters of CSV that can be accessed
by name.  You can select HeaderConverters with CSV.header_convert() or
through the <tt>options</tt> Hash passed to CSV::new().
</p>
<table>
<tr><td valign="top"><b><tt>:downcase</tt></b></td><td><p>
Calls downcase() on the header String.
</p>
</td></tr>
<tr><td valign="top"><b><tt>:symbol</tt></b></td><td><p>
The header String is downcased, spaces are replaced with underscores,
non-word characters are dropped, and finally to_sym() is called.
</p>
</td></tr>
</table>
<p>
All built-in header converters transcode header data to UTF-8 before
attempting a conversion.  If your data cannot be transcoded to UTF-8 the
conversion will fail and the header will remain unchanged.
</p>
<p>
This Hash is intetionally left unfrozen and users should feel free to add
values to it that can be accessed by all CSV objects.
</p>
<p>
To add a combo field, the value should be an Array of names.  Combo fields
can be nested with other combo fields.
</p>


  </div>
</div>
<div class="tags">
  
</div>
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span>
  <span class='label'>downcase:</span> <span class='id lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id h'>h</span><span class='op'>|</span> <span class='id h'>h</span><span class='period'>.</span><span class='id encode'>encode</span><span class='lparen'>(</span><span class='const'>ConverterEncoding</span><span class='rparen'>)</span><span class='period'>.</span><span class='id downcase'>downcase</span> <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='label'>symbol:</span>   <span class='id lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id h'>h</span><span class='op'>|</span>
    <span class='id h'>h</span><span class='period'>.</span><span class='id encode'>encode</span><span class='lparen'>(</span><span class='const'>ConverterEncoding</span><span class='rparen'>)</span><span class='period'>.</span><span class='id downcase'>downcase</span><span class='period'>.</span><span class='id gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\s+</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span>
                                         <span class='id gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\W+</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id to_sym'>to_sym</span>
  <span class='rbrace'>}</span>
<span class='rbrace'>}</span></pre></dd>
      
        <dt id="DEFAULT_OPTIONS-constant" class="">DEFAULT_OPTIONS =
          <div class="docstring">
  <div class="discussion">
    <p>
The options used when no overrides are given by calling code.  They are:
</p>
<table>
<tr><td valign="top"><b><tt>:col_sep</tt></b></td><td><p>
<tt>&quot;,&quot;</tt>
</p>
</td></tr>
<tr><td valign="top"><b><tt>:row_sep</tt></b></td><td><p>
<tt>:auto</tt>
</p>
</td></tr>
<tr><td valign="top"><b><tt>:quote_char</tt></b></td><td><p>
<tt>'&quot;'</tt>
</p>
</td></tr>
<tr><td valign="top"><b><tt>:field_size_limit</tt></b></td><td><p>
<tt>nil</tt>
</p>
</td></tr>
<tr><td valign="top"><b><tt>:converters</tt></b></td><td><p>
<tt>nil</tt>
</p>
</td></tr>
<tr><td valign="top"><b><tt>:unconverted_fields</tt></b></td><td><p>
<tt>nil</tt>
</p>
</td></tr>
<tr><td valign="top"><b><tt>:headers</tt></b></td><td><p>
<tt>false</tt>
</p>
</td></tr>
<tr><td valign="top"><b><tt>:return_headers</tt></b></td><td><p>
<tt>false</tt>
</p>
</td></tr>
<tr><td valign="top"><b><tt>:header_converters</tt></b></td><td><p>
<tt>nil</tt>
</p>
</td></tr>
<tr><td valign="top"><b><tt>:skip_blanks</tt></b></td><td><p>
<tt>false</tt>
</p>
</td></tr>
<tr><td valign="top"><b><tt>:force_quotes</tt></b></td><td><p>
<tt>false</tt>
</p>
</td></tr>
</table>


  </div>
</div>
<div class="tags">
  
</div>
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span> <span class='label'>col_sep:</span>            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>,</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
<span class='label'>row_sep:</span>            <span class='symbol'>:auto</span><span class='comma'>,</span>
<span class='label'>quote_char:</span>         <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
<span class='label'>field_size_limit:</span>   <span class='kw'>nil</span><span class='comma'>,</span>
<span class='label'>converters:</span>         <span class='kw'>nil</span><span class='comma'>,</span>
<span class='label'>unconverted_fields:</span> <span class='kw'>nil</span><span class='comma'>,</span>
<span class='label'>headers:</span>            <span class='kw'>false</span><span class='comma'>,</span>
<span class='label'>return_headers:</span>     <span class='kw'>false</span><span class='comma'>,</span>
<span class='label'>header_converters:</span>  <span class='kw'>nil</span><span class='comma'>,</span>
<span class='label'>skip_blanks:</span>        <span class='kw'>false</span><span class='comma'>,</span>
<span class='label'>force_quotes:</span>       <span class='kw'>false</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id freeze'>freeze</span></pre></dd>
      
    </dl>
  


  
  
  
  
  <h3 class="inherited">Constants included from <span class='object_link'><a href="Forwardable.html" title="Forwardable (module)">Forwardable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Forwardable.html#FORWARDABLE_VERSION-constant" title="Forwardable::FORWARDABLE_VERSION (constant)">FORWARDABLE_VERSION</a></span></p>

  
  
  
  
  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#col_sep-instance_method" title="#col_sep (instance method)">- (Object) <strong>col_sep</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The encoded <tt>:col_sep</tt> used in parsing and writing.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#encoding-instance_method" title="#encoding (instance method)">- (Object) <strong>encoding</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The Encoding CSV is parsing or writing in.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#field_size_limit-instance_method" title="#field_size_limit (instance method)">- (Object) <strong>field_size_limit</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The limit for field size, if any.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#lineno-instance_method" title="#lineno (instance method)">- (Object) <strong>lineno</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The line number of the last row read from this file.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#quote_char-instance_method" title="#quote_char (instance method)">- (Object) <strong>quote_char</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The encoded <tt>:quote_char</tt> used in parsing and writing.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#row_sep-instance_method" title="#row_sep (instance method)">- (Object) <strong>row_sep</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The encoded <tt>:row_sep</tt> used in parsing and writing.
</p>
</div></span>
  
</li>

    
  </ul>


  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#dump-class_method" title="dump (class method)">+ (Object) <strong>dump</strong>(ary_of_objs, io = &quot;&quot;, options = Hash.new) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
This method allows you to serialize an Array of Ruby objects to a String or
File of CSV data.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#filter-class_method" title="filter (class method)">+ (Object) <strong>filter</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
:call-seq:.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#foreach-class_method" title="foreach (class method)">+ (Object) <strong>foreach</strong>(path, options = Hash.new, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
This method is intended as the primary interface for reading CSV files.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#generate-class_method" title="generate (class method)">+ (Object) <strong>generate</strong>(*args) {|csv| ... }</a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
:call-seq:.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#generate_line-class_method" title="generate_line (class method)">+ (Object) <strong>generate_line</strong>(row, options = Hash.new) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
This method is a shortcut for converting a single row (Array) into a CSV
String.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#instance-class_method" title="instance (class method)">+ (Object) <strong>instance</strong>(data = $stdout, options = Hash.new) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
This method will return a CSV instance, just like CSV::new(), but the
instance will be cached and returned for all future calls to this method
for the same <tt>data</tt> object (tested by Object#object_id()) with the
same <tt>options</tt>.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#load-class_method" title="load (class method)">+ (Object) <strong>load</strong>(io_or_str, options = Hash.new) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
This method is the reading counterpart to CSV::dump().
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#open-class_method" title="open (class method)">+ (Object) <strong>open</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
:call-seq:.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parse-class_method" title="parse (class method)">+ (Object) <strong>parse</strong>(*args, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
:call-seq:.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parse_line-class_method" title="parse_line (class method)">+ (Object) <strong>parse_line</strong>(line, options = Hash.new) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
This method is a shortcut for converting a single line of a CSV String into
a into an Array.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#read-class_method" title="read (class method)">+ (Object) <strong>read</strong>(path, options = Hash.new) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Use to slurp a CSV file into an Array of Arrays.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#readlines-class_method" title="readlines (class method)">+ (Object) <strong>readlines</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Alias for CSV::read().
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#table-class_method" title="table (class method)">+ (Object) <strong>table</strong>(path, options = Hash.new) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
A shortcut for:.
</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#%3C%3C-instance_method" title="#&lt;&lt; (instance method)">- (Object) <strong>&lt;&lt;</strong>(row) </a>
    

    
      (also: #add_row, #puts)
    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The primary write method for wrapped Strings and IOs, <tt>row</tt> (an
Array or CSV::Row) is converted to CSV and appended to the data source.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#convert-instance_method" title="#convert (instance method)">- (Object) <strong>convert</strong>(name = nil, &amp;converter) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
:call-seq:.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#converters-instance_method" title="#converters (instance method)">- (Object) <strong>converters</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the current list of converters in effect.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#each-instance_method" title="#each (instance method)">- (Object) <strong>each</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Yields each row of the data source in turn.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#force_quotes%3F-instance_method" title="#force_quotes? (instance method)">- (Boolean) <strong>force_quotes?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns <tt>true</tt> if all output fields are quoted.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#header_convert-instance_method" title="#header_convert (instance method)">- (Object) <strong>header_convert</strong>(name = nil, &amp;converter) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
:call-seq:.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#header_converters-instance_method" title="#header_converters (instance method)">- (Object) <strong>header_converters</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the current list of converters in effect for headers.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#header_row%3F-instance_method" title="#header_row? (instance method)">- (Boolean) <strong>header_row?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns <tt>true</tt> if the next row read will be a header row.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#headers-instance_method" title="#headers (instance method)">- (Object) <strong>headers</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns <tt>nil</tt> if headers will not be used, <tt>true</tt> if they
will but have not yet been read, or the actual headers after they have been
read.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (CSV) <strong>initialize</strong>(data, options = Hash.new) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
This constructor will wrap either a String or IO object passed in
<tt>data</tt> for reading and/or writing.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#inspect-instance_method" title="#inspect (instance method)">- (Object) <strong>inspect</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns a simplified description of the key FasterCSV attributes in an
ASCII compatible String.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#read-instance_method" title="#read (instance method)">- (Object) <strong>read</strong> </a>
    

    
      (also: #readlines)
    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Slurps the remaining rows and returns an Array of Arrays.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#return_headers%3F-instance_method" title="#return_headers? (instance method)">- (Boolean) <strong>return_headers?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns <tt>true</tt> if headers will be returned as a row of results.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#rewind-instance_method" title="#rewind (instance method)">- (Object) <strong>rewind</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Rewinds the underlying IO object and resets CSV&#8217;s lineno() counter.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#shift-instance_method" title="#shift (instance method)">- (Object) <strong>shift</strong> </a>
    

    
      (also: #gets, #readline)
    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The primary read method for wrapped Strings and IOs, a single row is pulled
from the data source, parsed and returned as an Array of fields (if header
rows are not used) or a CSV::Row (when header rows are used).
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#skip_blanks%3F-instance_method" title="#skip_blanks? (instance method)">- (Boolean) <strong>skip_blanks?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns <tt>true</tt> blank lines are skipped by the parser.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#unconverted_fields%3F-instance_method" title="#unconverted_fields? (instance method)">- (Boolean) <strong>unconverted_fields?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns <tt>true</tt> if unconverted_fields() to parsed results.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#write_headers%3F-instance_method" title="#write_headers? (instance method)">- (Boolean) <strong>write_headers?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns <tt>true</tt> if headers are written in output.
</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Forwardable.html" title="Forwardable (module)">Forwardable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Forwardable.html#def_instance_delegator-instance_method" title="Forwardable#def_instance_delegator (method)">def_instance_delegator</a></span>, <span class='object_link'><a href="Forwardable.html#def_instance_delegators-instance_method" title="Forwardable#def_instance_delegators (method)">def_instance_delegators</a></span>, <span class='object_link'><a href="Forwardable.html#instance_delegate-instance_method" title="Forwardable#instance_delegate (method)">instance_delegate</a></span></p>

  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Enumerable.html" title="Enumerable (module)">Enumerable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Enumerable.html#to_set-instance_method" title="Enumerable#to_set (method)">#to_set</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="CSV (class)">CSV</a></span></tt>) <strong>initialize</strong>(data, options = Hash.new) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
This constructor will wrap either a String or IO object passed in
<tt>data</tt> for reading and/or writing.  In addition to the CSV instance
methods, several IO methods are delegated.  (See CSV::open() for a complete
list.)  If you pass a String for <tt>data</tt>, you can later retrieve it
(after writing to it, for example) with CSV.string().
</p>
<p>
Note that a wrapped String will be positioned at at the beginning (for
reading).  If you want it at the end (for writing), use CSV::generate(). If
you want any other positioning, pass a preset StringIO object instead.
</p>
<p>
You may set any reading and/or writing preferences in the <tt>options</tt>
Hash. Available options are:
</p>
<table>
<tr><td valign="top"><b><tt>:col_sep</tt></b></td><td><p>
The String placed between each field. This String will be transcoded into
the data&#8217;s Encoding before parsing.
</p>
</td></tr>
<tr><td valign="top"><b><tt>:row_sep</tt></b></td><td><p>
The String appended to the end of each row.  This can be set to the special
<tt>:auto</tt> setting, which requests that CSV automatically discover this
from the data.  Auto-discovery reads ahead in the data looking for the next
<tt>&quot;\r\n&quot;</tt>, <tt>&quot;\n&quot;</tt>, or
<tt>&quot;\r&quot;</tt> sequence.  A sequence will be selected even if it
occurs in a quoted field, assuming that you would have the same line
endings there.  If none of those sequences is found, <tt>data</tt> is
<tt>ARGF</tt>, <tt>STDIN</tt>, <tt>STDOUT</tt>, or <tt>STDERR</tt>, or the
stream is only available for output, the default
<tt>$INPUT_RECORD_SEPARATOR</tt> (<tt>$/</tt>) is used.  Obviously,
discovery takes a little time.  Set manually if speed is important.  Also
note that IO objects should be opened in binary mode on Windows if this
feature will be used as the line-ending translation can cause problems with
resetting the document position to where it was before the read ahead. This
String will be transcoded into the data&#8217;s Encoding before parsing.
</p>
</td></tr>
<tr><td valign="top"><b><tt>:quote_char</tt></b></td><td><p>
The character used to quote fields. This has to be a single character
String.  This is useful for application that incorrectly use <tt>'</tt> as
the quote character instead of the correct <tt>&quot;</tt>. CSV will always
consider a double sequence this character to be an escaped quote. This
String will be transcoded into the data&#8217;s Encoding before parsing.
</p>
</td></tr>
<tr><td valign="top"><b><tt>:field_size_limit</tt></b></td><td><p>
This is a maximum size CSV will read ahead looking for the closing quote
for a field.  (In truth, it reads to the first line ending beyond this
size.)  If a quote cannot be found within the limit CSV will raise a
MalformedCSVError, assuming the data is faulty.  You can use this limit to
prevent what are effectively DoS attacks on the parser.  However, this
limit can cause a legitimate parse to fail and thus is set to <tt>nil</tt>,
or off, by default.
</p>
</td></tr>
<tr><td valign="top"><b><tt>:converters</tt></b></td><td><p>
An Array of names from the Converters Hash and/or lambdas that handle
custom conversion.  A single converter doesn&#8217;t have to be in an
Array.  All built-in converters try to transcode fields to UTF-8 before
converting. The conversion will fail if the data cannot be transcoded,
leaving the field unchanged.
</p>
</td></tr>
<tr><td valign="top"><b><tt>:unconverted_fields</tt></b></td><td><p>
If set to <tt>true</tt>, an unconverted_fields() method will be added to
all returned rows (Array or CSV::Row) that will return the fields as they
were before conversion.  Note that <tt>:headers</tt> supplied by Array or
String were not fields of the document and thus will have an empty Array
attached.
</p>
</td></tr>
<tr><td valign="top"><b><tt>:headers</tt></b></td><td><p>
If set to <tt>:first_row</tt> or <tt>true</tt>, the initial row of the CSV
file will be treated as a row of headers.  If set to an Array, the contents
will be used as the headers. If set to a String, the String is run through
a call of CSV::parse_line() with the same <tt>:col_sep</tt>,
<tt>:row_sep</tt>, and <tt>:quote_char</tt> as this instance to produce an
Array of headers.  This setting causes CSV#shift() to return rows as
CSV::Row objects instead of Arrays and CSV#read() to return CSV::Table
objects instead of an Array of Arrays.
</p>
</td></tr>
<tr><td valign="top"><b><tt>:return_headers</tt></b></td><td><p>
When <tt>false</tt>, header rows are silently swallowed.  If set to
<tt>true</tt>, header rows are returned in a CSV::Row object with identical
headers and fields (save that the fields do not go through the converters).
</p>
</td></tr>
<tr><td valign="top"><b><tt>:write_headers</tt></b></td><td><p>
When <tt>true</tt> and <tt>:headers</tt> is set, a header row will be added
to the output.
</p>
</td></tr>
<tr><td valign="top"><b><tt>:header_converters</tt></b></td><td><p>
Identical in functionality to <tt>:converters</tt> save that the
conversions are only made to header rows.  All built-in converters try to
transcode headers to UTF-8 before converting.  The conversion will fail if
the data cannot be transcoded, leaving the header unchanged.
</p>
</td></tr>
<tr><td valign="top"><b><tt>:skip_blanks</tt></b></td><td><p>
When set to a <tt>true</tt> value, CSV will skip over any rows with no
content.
</p>
</td></tr>
<tr><td valign="top"><b><tt>:force_quotes</tt></b></td><td><p>
When set to a <tt>true</tt> value, CSV will quote all CSV fields it
creates.
</p>
</td></tr>
</table>
<p>
See CSV::DEFAULT_OPTIONS for the default settings.
</p>
<p>
Options cannot be overriden in the instance methods for performance
reasons, so be sure to set what you want here.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1552
1553
1554
1555
1556
1557
1558
1559
1560
1561
1562
1563
1564
1565
1566
1567
1568
1569
1570
1571
1572
1573
1574
1575
1576
1577
1578
1579
1580
1581</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1552</span>

<span class='kw'>def</span> <span class='id initialize'>initialize</span><span class='lparen'>(</span><span class='id data'>data</span><span class='comma'>,</span> <span class='id options'>options</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id new'>new</span><span class='rparen'>)</span>
  <span class='comment'># build the options for this read/write
</span>  <span class='id options'>options</span> <span class='op'>=</span> <span class='const'>DEFAULT_OPTIONS</span><span class='period'>.</span><span class='id merge'>merge</span><span class='lparen'>(</span><span class='id options'>options</span><span class='rparen'>)</span>

  <span class='comment'># create the IO object we will read from
</span>  <span class='ivar'>@io</span>       <span class='op'>=</span>   <span class='kw'>if</span> <span class='id data'>data</span><span class='period'>.</span><span class='id is_a?'>is_a?</span> <span class='const'>String</span> <span class='kw'>then</span> <span class='const'>StringIO</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id data'>data</span><span class='rparen'>)</span> <span class='kw'>else</span> <span class='id data'>data</span> <span class='kw'>end</span>
  <span class='comment'># honor the IO encoding if we can, otherwise default to ASCII-8BIT
</span>  <span class='ivar'>@encoding</span> <span class='op'>=</span> <span class='id raw_encoding'>raw_encoding</span> <span class='op'>||</span> <span class='const'>Encoding</span><span class='period'>.</span><span class='id default_internal'>default_internal</span> <span class='op'>||</span> <span class='const'>Encoding</span><span class='period'>.</span><span class='id default_external'>default_external</span>
  <span class='comment'>#
</span>  <span class='comment'># prepare for building safe regular expressions in the target encoding,
</span>  <span class='comment'># if we can transcode the needed characters
</span>  <span class='comment'>#
</span>  <span class='ivar'>@re_esc</span>   <span class='op'>=</span>   <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\\</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id encode'>encode</span><span class='lparen'>(</span><span class='ivar'>@encoding</span><span class='rparen'>)</span> <span class='kw'>rescue</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
  <span class='ivar'>@re_chars</span> <span class='op'>=</span>   <span class='qwords_beg'>%w[ </span><span class='tstring_content'>\\</span><span class='words_sep'> </span><span class='tstring_content'>.</span><span class='words_sep'>  </span><span class='tstring_content'>[</span><span class='words_sep'>  </span><span class='tstring_content'>]</span><span class='words_sep'>  </span><span class='tstring_content'>-</span><span class='words_sep'>  </span><span class='tstring_content'>^</span><span class='words_sep'>  </span><span class='tstring_content'>$</span><span class='words_sep'>  </span><span class='tstring_content'>?</span><span class='words_sep'>
</span><span class='words_sep'>                    </span><span class='tstring_content'>*</span><span class='words_sep'>  </span><span class='tstring_content'>+</span><span class='words_sep'>  </span><span class='tstring_content'>{</span><span class='words_sep'>  </span><span class='tstring_content'>}</span><span class='words_sep'>  </span><span class='tstring_content'>(</span><span class='words_sep'>  </span><span class='tstring_content'>)</span><span class='words_sep'>  </span><span class='tstring_content'>|</span><span class='words_sep'>  </span><span class='tstring_content'>#</span><span class='words_sep'>
</span><span class='words_sep'>                    </span><span class='tstring_content'>\ </span><span class='words_sep'> </span><span class='tstring_content'>\r</span><span class='words_sep'> </span><span class='tstring_content'>\n</span><span class='words_sep'> </span><span class='tstring_content'>\t</span><span class='words_sep'> </span><span class='tstring_content'>\f</span><span class='words_sep'> </span><span class='tstring_content'>\v</span><span class='words_sep'> ]</span><span class='period'>.</span>
                <span class='id map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id s'>s</span><span class='op'>|</span> <span class='id s'>s</span><span class='period'>.</span><span class='id encode'>encode</span><span class='lparen'>(</span><span class='ivar'>@encoding</span><span class='rparen'>)</span> <span class='kw'>rescue</span> <span class='kw'>nil</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id compact'>compact</span>

  <span class='id init_separators'>init_separators</span><span class='lparen'>(</span><span class='id options'>options</span><span class='rparen'>)</span>
  <span class='id init_parsers'>init_parsers</span><span class='lparen'>(</span><span class='id options'>options</span><span class='rparen'>)</span>
  <span class='id init_converters'>init_converters</span><span class='lparen'>(</span><span class='id options'>options</span><span class='rparen'>)</span>
  <span class='id init_headers'>init_headers</span><span class='lparen'>(</span><span class='id options'>options</span><span class='rparen'>)</span>

  <span class='kw'>unless</span> <span class='id options'>options</span><span class='period'>.</span><span class='id empty?'>empty?</span>
    <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unknown options:  </span><span class='embexpr_beg'>#{</span><span class='id options'>options</span><span class='period'>.</span><span class='id keys'>keys</span><span class='period'>.</span><span class='id join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>, </span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># track our own lineno since IO gets confused about line-ends is CSV fields
</span>  <span class='ivar'>@lineno</span> <span class='op'>=</span> <span class='int'>0</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <span id="col_sep-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="col_sep-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>col_sep</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The encoded <tt>:col_sep</tt> used in parsing and writing.  See CSV::new
for details.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1587
1588
1589</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1587</span>

<span class='kw'>def</span> <span class='id col_sep'>col_sep</span>
  <span class='ivar'>@col_sep</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="encoding-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="encoding-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>encoding</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The Encoding CSV is parsing or writing in.  This will be the Encoding you
receive parsed data in and/or the Encoding data will be written in.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1654
1655
1656</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1654</span>

<span class='kw'>def</span> <span class='id encoding'>encoding</span>
  <span class='ivar'>@encoding</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="field_size_limit-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="field_size_limit-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>field_size_limit</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The limit for field size, if any.  See CSV::new for details.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1599
1600
1601</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1599</span>

<span class='kw'>def</span> <span class='id field_size_limit'>field_size_limit</span>
  <span class='ivar'>@field_size_limit</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="lineno-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="lineno-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>lineno</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The line number of the last row read from this file.  Fields with nested
line-end characters will not affect this count.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1660
1661
1662</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1660</span>

<span class='kw'>def</span> <span class='id lineno'>lineno</span>
  <span class='ivar'>@lineno</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="quote_char-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="quote_char-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>quote_char</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The encoded <tt>:quote_char</tt> used in parsing and writing.  See CSV::new
for details.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1597
1598
1599</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1597</span>

<span class='kw'>def</span> <span class='id quote_char'>quote_char</span>
  <span class='ivar'>@quote_char</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="row_sep-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="row_sep-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>row_sep</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The encoded <tt>:row_sep</tt> used in parsing and writing.  See CSV::new
for details.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1592
1593
1594</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1592</span>

<span class='kw'>def</span> <span class='id row_sep'>row_sep</span>
  <span class='ivar'>@row_sep</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="dump-class_method">
  
    + (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>dump</strong>(ary_of_objs, io = &quot;&quot;, options = Hash.new) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
This method allows you to serialize an Array of Ruby objects to a String or
File of CSV data.  This is not as powerful as Marshal or YAML, but perhaps
useful for spreadsheet and database interaction.
</p>
<p>
Out of the box, this method is intended to work with simple data objects or
Structs.  It will serialize a list of instance variables and/or
Struct.members().
</p>
<p>
If you need need more complicated serialization, you can control the
process by adding methods to the class to be serialized.
</p>
<p>
A class method csv_meta() is responsible for returning the first row of the
document (as an Array).  This row is considered to be a Hash of the form
key_1,value_1,key_2,value_2,&#8230;  CSV::load() expects to find a class
key with a value of the stringified class name and CSV::dump() will create
this, if you do not define this method.  This method is only called on the
first object of the Array.
</p>
<p>
The next method you can provide is an instance method called csv_headers().
This method is expected to return the second line of the document (again as
an Array), which is to be used to give each column a header.  By default,
CSV::load() will set an instance variable if the field header starts with
an @ character or call send() passing the header as the method name and the
field value as an argument.  This method is only called on the first object
of the Array.
</p>
<p>
Finally, you can provide an instance method called csv_dump(), which will
be passed the headers.  This should return an Array of fields that can be
serialized for this object.  This method is called once for every object in
the Array.
</p>
<p>
The <tt>io</tt> parameter can be used to serialize to a File, and
<tt>options</tt> can be anything CSV::new() accepts.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1040
1041
1042
1043
1044
1045
1046
1047
1048
1049
1050
1051
1052
1053
1054
1055
1056
1057
1058
1059
1060
1061
1062
1063
1064
1065
1066
1067
1068
1069
1070
1071
1072
1073
1074
1075
1076
1077
1078
1079
1080
1081
1082
1083</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1040</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id dump'>dump</span><span class='lparen'>(</span><span class='id ary_of_objs'>ary_of_objs</span><span class='comma'>,</span> <span class='id io'>io</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id options'>options</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id new'>new</span><span class='rparen'>)</span>
  <span class='id obj_template'>obj_template</span> <span class='op'>=</span> <span class='id ary_of_objs'>ary_of_objs</span><span class='period'>.</span><span class='id first'>first</span>

  <span class='id csv'>csv</span> <span class='op'>=</span> <span class='id new'>new</span><span class='lparen'>(</span><span class='id io'>io</span><span class='comma'>,</span> <span class='id options'>options</span><span class='rparen'>)</span>

  <span class='comment'># write meta information
</span>  <span class='kw'>begin</span>
    <span class='id csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='id obj_template'>obj_template</span><span class='period'>.</span><span class='id class'>class</span><span class='period'>.</span><span class='id csv_meta'>csv_meta</span>
  <span class='kw'>rescue</span> <span class='const'>NoMethodError</span>
    <span class='id csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='symbol'>:class</span><span class='comma'>,</span> <span class='id obj_template'>obj_template</span><span class='period'>.</span><span class='id class'>class</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='comment'># write headers
</span>  <span class='kw'>begin</span>
    <span class='id headers'>headers</span> <span class='op'>=</span> <span class='id obj_template'>obj_template</span><span class='period'>.</span><span class='id csv_headers'>csv_headers</span>
  <span class='kw'>rescue</span> <span class='const'>NoMethodError</span>
    <span class='id headers'>headers</span> <span class='op'>=</span> <span class='id obj_template'>obj_template</span><span class='period'>.</span><span class='id instance_variables'>instance_variables</span><span class='period'>.</span><span class='id sort'>sort</span>
    <span class='kw'>if</span> <span class='id obj_template'>obj_template</span><span class='period'>.</span><span class='id class'>class</span><span class='period'>.</span><span class='id ancestors'>ancestors</span><span class='period'>.</span><span class='id find'>find</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id cls'>cls</span><span class='op'>|</span> <span class='id cls'>cls</span><span class='period'>.</span><span class='id to_s'>to_s</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\AStruct\b</span><span class='regexp_end'>/</span></span> <span class='rbrace'>}</span>
      <span class='id headers'>headers</span> <span class='op'>+=</span> <span class='id obj_template'>obj_template</span><span class='period'>.</span><span class='id members'>members</span><span class='period'>.</span><span class='id map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id mem'>mem</span><span class='op'>|</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id mem'>mem</span><span class='rbrace'>}</span><span class='tstring_content'>=</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id sort'>sort</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='id headers'>headers</span>

  <span class='comment'># serialize each object
</span>  <span class='id ary_of_objs'>ary_of_objs</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id obj'>obj</span><span class='op'>|</span>
    <span class='kw'>begin</span>
      <span class='id csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='id obj'>obj</span><span class='period'>.</span><span class='id csv_dump'>csv_dump</span><span class='lparen'>(</span><span class='id headers'>headers</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='const'>NoMethodError</span>
      <span class='id csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='id headers'>headers</span><span class='period'>.</span><span class='id map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id var'>var</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id var'>var</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='CHAR'>?@</span>
          <span class='id obj'>obj</span><span class='period'>.</span><span class='id instance_variable_get'>instance_variable_get</span><span class='lparen'>(</span><span class='id var'>var</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id obj'>obj</span><span class='lbracket'>[</span><span class='id var'>var</span><span class='lbracket'>[</span><span class='int'>0</span><span class='op'>..</span><span class='op'>-</span><span class='int'>2</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id io'>io</span><span class='period'>.</span><span class='id is_a?'>is_a?</span> <span class='const'>String</span>
    <span class='id csv'>csv</span><span class='period'>.</span><span class='id string'>string</span>
  <span class='kw'>else</span>
    <span class='id csv'>csv</span><span class='period'>.</span><span class='id close'>close</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="filter-class_method">
  
    + (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>filter</strong>(*args) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
:call-seq:
</p>
<pre class="code">
  filter( options = Hash.new ) { |row| ... }
  filter( input, options = Hash.new ) { |row| ... }
  filter( input, output, options = Hash.new ) { |row| ... }
</pre>
<p>
This method is a convenience for building Unix-like filters for CSV data.
Each row is yielded to the provided block which can alter it as needed.
After the block returns, the row is appended to <tt>output</tt> altered or
not.
</p>
<p>
The <tt>input</tt> and <tt>output</tt> arguments can be anything CSV::new()
accepts (generally String or IO objects).  If not given, they default to
<tt>ARGF</tt> and <tt>$stdout</tt>.
</p>
<p>
The <tt>options</tt> parameter is also filtered down to CSV::new() after
some clever key parsing.  Any key beginning with <tt>:in_</tt> or
<tt>:input_</tt> will have that leading identifier stripped and will only
be used in the <tt>options</tt> Hash for the <tt>input</tt> object.  Keys
starting with <tt>:out_</tt> or <tt>:output_</tt> affect only
<tt>output</tt>.  All other keys are assigned to both objects.
</p>
<p>
The <tt>:output_row_sep</tt> <tt>option</tt> defaults to
<tt>$INPUT_RECORD_SEPARATOR</tt> (<tt>$/</tt>).
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1156
1157
1158
1159
1160
1161
1162
1163
1164
1165
1166
1167
1168
1169
1170
1171
1172
1173
1174
1175
1176
1177
1178
1179
1180
1181</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1156</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id filter'>filter</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>
  <span class='comment'># parse options for input, output, or both
</span>  <span class='id in_options'>in_options</span><span class='comma'>,</span> <span class='id out_options'>out_options</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id new'>new</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='label'>row_sep:</span> <span class='gvar'>$INPUT_RECORD_SEPARATOR</span><span class='rbrace'>}</span>
  <span class='kw'>if</span> <span class='id args'>args</span><span class='period'>.</span><span class='id last'>last</span><span class='period'>.</span><span class='id is_a?'>is_a?</span> <span class='const'>Hash</span>
    <span class='id args'>args</span><span class='period'>.</span><span class='id pop'>pop</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id key'>key</span><span class='comma'>,</span> <span class='id value'>value</span><span class='op'>|</span>
      <span class='kw'>case</span> <span class='id key'>key</span><span class='period'>.</span><span class='id to_s'>to_s</span>
      <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\Ain(?:put)?_(.+)\Z</span><span class='regexp_end'>/</span></span>
        <span class='id in_options'>in_options</span><span class='lbracket'>[</span><span class='backref'>$1</span><span class='period'>.</span><span class='id to_sym'>to_sym</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id value'>value</span>
      <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\Aout(?:put)?_(.+)\Z</span><span class='regexp_end'>/</span></span>
        <span class='id out_options'>out_options</span><span class='lbracket'>[</span><span class='backref'>$1</span><span class='period'>.</span><span class='id to_sym'>to_sym</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id value'>value</span>
      <span class='kw'>else</span>
        <span class='id in_options'>in_options</span><span class='lbracket'>[</span><span class='id key'>key</span><span class='rbracket'>]</span>  <span class='op'>=</span> <span class='id value'>value</span>
        <span class='id out_options'>out_options</span><span class='lbracket'>[</span><span class='id key'>key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id value'>value</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='comment'># build input and output wrappers
</span>  <span class='id input'>input</span>  <span class='op'>=</span> <span class='id new'>new</span><span class='lparen'>(</span><span class='id args'>args</span><span class='period'>.</span><span class='id shift'>shift</span> <span class='op'>||</span> <span class='const'>ARGF</span><span class='comma'>,</span>    <span class='id in_options'>in_options</span><span class='rparen'>)</span>
  <span class='id output'>output</span> <span class='op'>=</span> <span class='id new'>new</span><span class='lparen'>(</span><span class='id args'>args</span><span class='period'>.</span><span class='id shift'>shift</span> <span class='op'>||</span> <span class='gvar'>$stdout</span><span class='comma'>,</span> <span class='id out_options'>out_options</span><span class='rparen'>)</span>

  <span class='comment'># read, yield, write
</span>  <span class='id input'>input</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id row'>row</span><span class='op'>|</span>
    <span class='kw'>yield</span> <span class='id row'>row</span>
    <span class='id output'>output</span> <span class='op'>&lt;&lt;</span> <span class='id row'>row</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="foreach-class_method">
  
    + (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>foreach</strong>(path, options = Hash.new, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
This method is intended as the primary interface for reading CSV files. 
You pass a <tt>path</tt> and any <tt>options</tt> you wish to set for the
read.  Each row of file will be passed to the provided <tt>block</tt> in
turn.
</p>
<p>
The <tt>options</tt> parameter can be anything CSV::new() understands. 
This method also understands an additional <tt>:encoding</tt> parameter
that you can use to specify the Encoding of the data in the file to be
read. You must provide this unless your data is in
Encoding::default_external().  CSV will use this to deterime how to parse
the data.  You may provide a second Encoding to have the data transcoded as
it is read.  For example, <tt>encoding: &quot;UTF-32BE:UTF-8&quot;</tt>
would read UTF-32BE data from the file but transcode it to UTF-8 before CSV
parses it.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1197
1198
1199
1200
1201
1202
1203
1204</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1197</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id foreach'>foreach</span><span class='lparen'>(</span><span class='id path'>path</span><span class='comma'>,</span> <span class='id options'>options</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id new'>new</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='id encoding'>encoding</span> <span class='op'>=</span>  <span class='id options'>options</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:encoding</span><span class='rparen'>)</span>
  <span class='id mode'>mode</span>     <span class='op'>=</span>  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rb</span><span class='tstring_end'>&quot;</span></span>
  <span class='id mode'>mode</span>     <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id encoding'>encoding</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id encoding'>encoding</span>
  <span class='id open'>open</span><span class='lparen'>(</span><span class='id path'>path</span><span class='comma'>,</span> <span class='id mode'>mode</span><span class='comma'>,</span> <span class='id options'>options</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id csv'>csv</span><span class='op'>|</span>
    <span class='id csv'>csv</span><span class='period'>.</span><span class='id each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="generate-class_method">
  
    + (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>generate</strong>(*args) {|csv| ... }
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
:call-seq:
</p>
<pre class="code">
  generate( str, options = Hash.new ) { |csv| ... }
  generate( options = Hash.new ) { |csv| ... }
</pre>
<p>
This method wraps a String you provide, or an empty default String, in a
CSV object which is passed to the provided block.  You can use the block to
append CSV rows to the String and when the block exits, the final String
will be returned.
</p>
<p>
Note that a passed String <b>is</b> modfied by this method.  Call dup()
before passing if you need a new String.
</p>
<p>
The <tt>options</tt> parameter can be anything CSV::new() understands. 
This method understands an additional <tt>:encoding</tt> parameter when not
passed a String to set the base Encoding for the output.  CSV needs this
hint if you plan to output non-ASCII compatible data.
</p>


  </div>
</div>
<div class="tags">
  <h3>Yields:</h3>
<ul class="yield">
  
    <li>
      
        <span class='type'>(<tt>csv</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1224
1225
1226
1227
1228
1229
1230
1231
1232
1233
1234
1235
1236
1237
1238
1239</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1224</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id generate'>generate</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>
  <span class='comment'># add a default empty String, if none was given
</span>  <span class='kw'>if</span> <span class='id args'>args</span><span class='period'>.</span><span class='id first'>first</span><span class='period'>.</span><span class='id is_a?'>is_a?</span> <span class='const'>String</span>
    <span class='id io'>io</span> <span class='op'>=</span> <span class='const'>StringIO</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id args'>args</span><span class='period'>.</span><span class='id shift'>shift</span><span class='rparen'>)</span>
    <span class='id io'>io</span><span class='period'>.</span><span class='id seek'>seek</span><span class='lparen'>(</span><span class='int'>0</span><span class='comma'>,</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>SEEK_END</span><span class='rparen'>)</span>
    <span class='id args'>args</span><span class='period'>.</span><span class='id unshift'>unshift</span><span class='lparen'>(</span><span class='id io'>io</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id encoding'>encoding</span> <span class='op'>=</span> <span class='id args'>args</span><span class='period'>.</span><span class='id last'>last</span><span class='period'>.</span><span class='id is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id args'>args</span><span class='period'>.</span><span class='id last'>last</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:encoding</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='kw'>nil</span>
    <span class='id str'>str</span>      <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='id str'>str</span><span class='period'>.</span><span class='id encode!'>encode!</span><span class='lparen'>(</span><span class='id encoding'>encoding</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id encoding'>encoding</span>
    <span class='id args'>args</span><span class='period'>.</span><span class='id unshift'>unshift</span><span class='lparen'>(</span><span class='id str'>str</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id csv'>csv</span> <span class='op'>=</span> <span class='id new'>new</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>  <span class='comment'># wrap
</span>  <span class='kw'>yield</span> <span class='id csv'>csv</span>         <span class='comment'># yield for appending
</span>  <span class='id csv'>csv</span><span class='period'>.</span><span class='id string'>string</span>        <span class='comment'># return final String
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="generate_line-class_method">
  
    + (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>generate_line</strong>(row, options = Hash.new) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
This method is a shortcut for converting a single row (Array) into a CSV
String.
</p>
<p>
The <tt>options</tt> parameter can be anything CSV::new() understands. 
This method understands an additional <tt>:encoding</tt> parameter to set
the base Encoding for the output.  This method will try to guess your
Encoding from the first non-<tt>nil</tt> field in <tt>row</tt>, if
possible, but you may need to use this parameter as a backup plan.
</p>
<p>
The <tt>:row_sep</tt> <tt>option</tt> defaults to
<tt>$INPUT_RECORD_SEPARATOR</tt> (<tt>$/</tt>) when calling this method.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1254
1255
1256
1257
1258
1259
1260
1261
1262
1263
1264</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1254</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id generate_line'>generate_line</span><span class='lparen'>(</span><span class='id row'>row</span><span class='comma'>,</span> <span class='id options'>options</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id new'>new</span><span class='rparen'>)</span>
  <span class='id options'>options</span>  <span class='op'>=</span> <span class='lbrace'>{</span><span class='label'>row_sep:</span> <span class='gvar'>$INPUT_RECORD_SEPARATOR</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id merge'>merge</span><span class='lparen'>(</span><span class='id options'>options</span><span class='rparen'>)</span>
  <span class='id encoding'>encoding</span> <span class='op'>=</span> <span class='id options'>options</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:encoding</span><span class='rparen'>)</span>
  <span class='id str'>str</span>      <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>if</span> <span class='id encoding'>encoding</span>
    <span class='id str'>str</span><span class='period'>.</span><span class='id force_encoding'>force_encoding</span><span class='lparen'>(</span><span class='id encoding'>encoding</span><span class='rparen'>)</span>
  <span class='kw'>elsif</span> <span class='id field'>field</span> <span class='op'>=</span> <span class='id row'>row</span><span class='period'>.</span><span class='id find'>find</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id f'>f</span><span class='op'>|</span> <span class='kw'>not</span> <span class='id f'>f</span><span class='period'>.</span><span class='id nil?'>nil?</span> <span class='rbrace'>}</span>
    <span class='id str'>str</span><span class='period'>.</span><span class='id force_encoding'>force_encoding</span><span class='lparen'>(</span><span class='const'>String</span><span class='lparen'>(</span><span class='id field'>field</span><span class='rparen'>)</span><span class='period'>.</span><span class='id encoding'>encoding</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='lparen'>(</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id str'>str</span><span class='comma'>,</span> <span class='id options'>options</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='id row'>row</span><span class='rparen'>)</span><span class='period'>.</span><span class='id string'>string</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="instance-class_method">
  
    + (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>instance</strong>(data = $stdout, options = Hash.new) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
This method will return a CSV instance, just like CSV::new(), but the
instance will be cached and returned for all future calls to this method
for the same <tt>data</tt> object (tested by Object#object_id()) with the
same <tt>options</tt>.
</p>
<p>
If a block is given, the instance is passed to the block and the return
value becomes the return value of the block.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


989
990
991
992
993
994
995
996
997
998
999
1000
1001
1002
1003</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 989</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id instance'>instance</span><span class='lparen'>(</span><span class='id data'>data</span> <span class='op'>=</span> <span class='gvar'>$stdout</span><span class='comma'>,</span> <span class='id options'>options</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id new'>new</span><span class='rparen'>)</span>
  <span class='comment'># create a _signature_ for this method call, data object and options
</span>  <span class='id sig'>sig</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id data'>data</span><span class='period'>.</span><span class='id object_id'>object_id</span><span class='rbracket'>]</span> <span class='op'>+</span>
        <span class='id options'>options</span><span class='period'>.</span><span class='id values_at'>values_at</span><span class='lparen'>(</span><span class='op'>*</span><span class='const'>DEFAULT_OPTIONS</span><span class='period'>.</span><span class='id keys'>keys</span><span class='period'>.</span><span class='id sort_by'>sort_by</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id sym'>sym</span><span class='op'>|</span> <span class='id sym'>sym</span><span class='period'>.</span><span class='id to_s'>to_s</span> <span class='rbrace'>}</span><span class='rparen'>)</span>

  <span class='comment'># fetch or create the instance for this signature
</span>  <span class='cvar'>@@instances</span> <span class='op'>||=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id new'>new</span>
  <span class='id instance'>instance</span>    <span class='op'>=</span>   <span class='lparen'>(</span><span class='cvar'>@@instances</span><span class='lbracket'>[</span><span class='id sig'>sig</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='id new'>new</span><span class='lparen'>(</span><span class='id data'>data</span><span class='comma'>,</span> <span class='id options'>options</span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id block_given?'>block_given?</span>
    <span class='kw'>yield</span> <span class='id instance'>instance</span>  <span class='comment'># run block, if given, returning result
</span>  <span class='kw'>else</span>
    <span class='id instance'>instance</span>        <span class='comment'># or return the instance
</span>  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="load-class_method">
  
    + (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>load</strong>(io_or_str, options = Hash.new) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
This method is the reading counterpart to CSV::dump().  See that method for
a detailed description of the process.
</p>
<p>
You can customize loading by adding a class method called csv_load() which
will be passed a Hash of meta information, an Array of headers, and an
Array of fields for the object the method is expected to return.
</p>
<p>
Remember that all fields will be Strings after this load.  If you need
something else, use <tt>options</tt> to setup converters or provide a
custom csv_load() implementation.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1097
1098
1099
1100
1101
1102
1103
1104
1105
1106
1107
1108
1109
1110
1111
1112
1113
1114
1115
1116
1117
1118
1119
1120
1121
1122
1123
1124
1125
1126
1127
1128
1129
1130</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1097</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id load'>load</span><span class='lparen'>(</span><span class='id io_or_str'>io_or_str</span><span class='comma'>,</span> <span class='id options'>options</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id new'>new</span><span class='rparen'>)</span>
  <span class='id csv'>csv</span> <span class='op'>=</span> <span class='id new'>new</span><span class='lparen'>(</span><span class='id io_or_str'>io_or_str</span><span class='comma'>,</span> <span class='id options'>options</span><span class='rparen'>)</span>

  <span class='comment'># load meta information
</span>  <span class='id meta'>meta</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='lbracket'>[</span><span class='op'>*</span><span class='id csv'>csv</span><span class='period'>.</span><span class='id shift'>shift</span><span class='rbracket'>]</span>
  <span class='id cls'>cls</span>  <span class='op'>=</span> <span class='id meta'>meta</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>class</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id encode'>encode</span><span class='lparen'>(</span><span class='id csv'>csv</span><span class='period'>.</span><span class='id encoding'>encoding</span><span class='rparen'>)</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>::</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id encode'>encode</span><span class='lparen'>(</span><span class='id csv'>csv</span><span class='period'>.</span><span class='id encoding'>encoding</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span>
                                            <span class='id inject'>inject</span><span class='lparen'>(</span><span class='const'>Object</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id c'>c</span><span class='comma'>,</span> <span class='id const'>const</span><span class='op'>|</span>
    <span class='id c'>c</span><span class='period'>.</span><span class='id const_get'>const_get</span><span class='lparen'>(</span><span class='id const'>const</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># load headers
</span>  <span class='id headers'>headers</span> <span class='op'>=</span> <span class='id csv'>csv</span><span class='period'>.</span><span class='id shift'>shift</span>

  <span class='comment'># unserialize each object stored in the file
</span>  <span class='id results'>results</span> <span class='op'>=</span> <span class='id csv'>csv</span><span class='period'>.</span><span class='id inject'>inject</span><span class='lparen'>(</span><span class='const'>Array</span><span class='period'>.</span><span class='id new'>new</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id all'>all</span><span class='comma'>,</span> <span class='id row'>row</span><span class='op'>|</span>
    <span class='kw'>begin</span>
      <span class='id obj'>obj</span> <span class='op'>=</span> <span class='id cls'>cls</span><span class='period'>.</span><span class='id csv_load'>csv_load</span><span class='lparen'>(</span><span class='id meta'>meta</span><span class='comma'>,</span> <span class='id headers'>headers</span><span class='comma'>,</span> <span class='id row'>row</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='const'>NoMethodError</span>
      <span class='id obj'>obj</span> <span class='op'>=</span> <span class='id cls'>cls</span><span class='period'>.</span><span class='id allocate'>allocate</span>
      <span class='id headers'>headers</span><span class='period'>.</span><span class='id zip'>zip</span><span class='lparen'>(</span><span class='id row'>row</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id name'>name</span><span class='comma'>,</span> <span class='id value'>value</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id name'>name</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='CHAR'>?@</span>
          <span class='id obj'>obj</span><span class='period'>.</span><span class='id instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='id name'>name</span><span class='comma'>,</span> <span class='id value'>value</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id obj'>obj</span><span class='period'>.</span><span class='id send'>send</span><span class='lparen'>(</span><span class='id name'>name</span><span class='comma'>,</span> <span class='id value'>value</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id all'>all</span> <span class='op'>&lt;&lt;</span> <span class='id obj'>obj</span>
  <span class='kw'>end</span>

  <span class='id csv'>csv</span><span class='period'>.</span><span class='id close'>close</span> <span class='kw'>unless</span> <span class='id io_or_str'>io_or_str</span><span class='period'>.</span><span class='id is_a?'>is_a?</span> <span class='const'>String</span>

  <span class='id results'>results</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="open-class_method">
  
    + (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>open</strong>(*args) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
:call-seq:
</p>
<pre class="code">
  open( filename, mode = &quot;rb&quot;, options = Hash.new ) { |faster_csv| ... }
  open( filename, options = Hash.new ) { |faster_csv| ... }
  open( filename, mode = &quot;rb&quot;, options = Hash.new )
  open( filename, options = Hash.new )
</pre>
<p>
This method opens an IO object, and wraps that with CSV.  This is intended
as the primary interface for writing a CSV file.
</p>
<p>
You must pass a <tt>filename</tt> and may optionally add a <tt>mode</tt>
for Ruby&#8217;s open().  You may also pass an optional Hash containing any
<tt>options</tt> CSV::new() understands as the final argument.
</p>
<p>
This method works like Ruby&#8217;s open() call, in that it will pass a CSV
object to a provided block and close it when the block terminates, or it
will return the CSV object when no block is provided.  (<b>Note</b>: This
is different from the Ruby 1.8 CSV library which passed rows to the block. 
Use CSV::foreach() for that behavior.)
</p>
<p>
You must provide a <tt>mode</tt> with an embedded Encoding designator
unless your data is in Encoding::default_external().  CSV will check the
Encoding of the underlying IO object (set by the <tt>mode</tt> you pass) to
deterime how to parse the data.   You may provide a second Encoding to have
the data transcoded as it is read just as you can with a normal call to
IO::open().  For example, <tt>&quot;rb:UTF-32BE:UTF-8&quot;</tt> would read
UTF-32BE data from the file but transcode it to UTF-8 before CSV parses it.
</p>
<p>
An opened CSV object will delegate to many IO methods for convenience.  You
may call:
</p>
<ul>
<li><p>
binmode()
</p>
</li>
<li><p>
binmode?()
</p>
</li>
<li><p>
close()
</p>
</li>
<li><p>
close_read()
</p>
</li>
<li><p>
close_write()
</p>
</li>
<li><p>
closed?()
</p>
</li>
<li><p>
eof()
</p>
</li>
<li><p>
eof?()
</p>
</li>
<li><p>
external_encoding()
</p>
</li>
<li><p>
fcntl()
</p>
</li>
<li><p>
fileno()
</p>
</li>
<li><p>
flock()
</p>
</li>
<li><p>
flush()
</p>
</li>
<li><p>
fsync()
</p>
</li>
<li><p>
internal_encoding()
</p>
</li>
<li><p>
ioctl()
</p>
</li>
<li><p>
isatty()
</p>
</li>
<li><p>
path()
</p>
</li>
<li><p>
pid()
</p>
</li>
<li><p>
pos()
</p>
</li>
<li><p>
pos=()
</p>
</li>
<li><p>
reopen()
</p>
</li>
<li><p>
seek()
</p>
</li>
<li><p>
stat()
</p>
</li>
<li><p>
sync()
</p>
</li>
<li><p>
sync=()
</p>
</li>
<li><p>
tell()
</p>
</li>
<li><p>
to_i()
</p>
</li>
<li><p>
to_io()
</p>
</li>
<li><p>
truncate()
</p>
</li>
<li><p>
tty?()
</p>
</li>
</ul>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1329
1330
1331
1332
1333
1334
1335
1336
1337
1338
1339
1340
1341
1342
1343
1344
1345
1346
1347</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1329</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id open'>open</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>
  <span class='comment'># find the +options+ Hash
</span>  <span class='id options'>options</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id args'>args</span><span class='period'>.</span><span class='id last'>last</span><span class='period'>.</span><span class='id is_a?'>is_a?</span> <span class='const'>Hash</span> <span class='kw'>then</span> <span class='id args'>args</span><span class='period'>.</span><span class='id pop'>pop</span> <span class='kw'>else</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id new'>new</span> <span class='kw'>end</span>
  <span class='comment'># default to a binary open mode
</span>  <span class='id args'>args</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rb</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id args'>args</span><span class='period'>.</span><span class='id size'>size</span> <span class='op'>==</span> <span class='int'>1</span>
  <span class='comment'># wrap a File opened with the remaining +args+
</span>  <span class='id csv'>csv</span>     <span class='op'>=</span> <span class='id new'>new</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id open'>open</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id options'>options</span><span class='rparen'>)</span>

  <span class='comment'># handle blocks like Ruby's open(), not like the CSV library
</span>  <span class='kw'>if</span> <span class='id block_given?'>block_given?</span>
    <span class='kw'>begin</span>
      <span class='kw'>yield</span> <span class='id csv'>csv</span>
    <span class='kw'>ensure</span>
      <span class='id csv'>csv</span><span class='period'>.</span><span class='id close'>close</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id csv'>csv</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="parse-class_method">
  
    + (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>parse</strong>(*args, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
:call-seq:
</p>
<pre class="code">
  parse( str, options = Hash.new ) { |row| ... }
  parse( str, options = Hash.new )
</pre>
<p>
This method can be used to easily parse CSV out of a String.  You may
either provide a <tt>block</tt> which will be called with each row of the
String in turn, or just use the returned Array of Arrays (when no
<tt>block</tt> is given).
</p>
<p>
You pass your <tt>str</tt> to read from, and an optional <tt>options</tt>
Hash containing anything CSV::new() understands.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1361
1362
1363
1364
1365
1366
1367
1368
1369
1370
1371
1372</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1361</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id parse'>parse</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='id csv'>csv</span> <span class='op'>=</span> <span class='id new'>new</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id block'>block</span><span class='period'>.</span><span class='id nil?'>nil?</span>  <span class='comment'># slurp contents, if no block is given
</span>    <span class='kw'>begin</span>
      <span class='id csv'>csv</span><span class='period'>.</span><span class='id read'>read</span>
    <span class='kw'>ensure</span>
      <span class='id csv'>csv</span><span class='period'>.</span><span class='id close'>close</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>           <span class='comment'># or pass each row to a provided block
</span>    <span class='id csv'>csv</span><span class='period'>.</span><span class='id each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="parse_line-class_method">
  
    + (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>parse_line</strong>(line, options = Hash.new) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
This method is a shortcut for converting a single line of a CSV String into
a into an Array.  Note that if <tt>line</tt> contains multiple rows,
anything beyond the first row is ignored.
</p>
<p>
The <tt>options</tt> parameter can be anything CSV::new() understands.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1381
1382
1383</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1381</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id parse_line'>parse_line</span><span class='lparen'>(</span><span class='id line'>line</span><span class='comma'>,</span> <span class='id options'>options</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id new'>new</span><span class='rparen'>)</span>
  <span class='id new'>new</span><span class='lparen'>(</span><span class='id line'>line</span><span class='comma'>,</span> <span class='id options'>options</span><span class='rparen'>)</span><span class='period'>.</span><span class='id shift'>shift</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="read-class_method">
  
    + (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>read</strong>(path, options = Hash.new) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Use to slurp a CSV file into an Array of Arrays.  Pass the <tt>path</tt> to
the file and any <tt>options</tt> CSV::new() understands.  This method also
understands an additional <tt>:encoding</tt> parameter that you can use to
specify the Encoding of the data in the file to be read. You must provide
this unless your data is in Encoding::default_external().  CSV will use
this to deterime how to parse the data.  You may provide a second Encoding
to have the data transcoded as it is read.  For example, <tt>encoding:
&quot;UTF-32BE:UTF-8&quot;</tt> would read UTF-32BE data from the file but
transcode it to UTF-8 before CSV parses it.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1396
1397
1398
1399
1400
1401</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1396</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id read'>read</span><span class='lparen'>(</span><span class='id path'>path</span><span class='comma'>,</span> <span class='id options'>options</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id new'>new</span><span class='rparen'>)</span>
  <span class='id encoding'>encoding</span> <span class='op'>=</span>  <span class='id options'>options</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:encoding</span><span class='rparen'>)</span>
  <span class='id mode'>mode</span>     <span class='op'>=</span>  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rb</span><span class='tstring_end'>&quot;</span></span>
  <span class='id mode'>mode</span>     <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id encoding'>encoding</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id encoding'>encoding</span>
  <span class='id open'>open</span><span class='lparen'>(</span><span class='id path'>path</span><span class='comma'>,</span> <span class='id mode'>mode</span><span class='comma'>,</span> <span class='id options'>options</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id csv'>csv</span><span class='op'>|</span> <span class='id csv'>csv</span><span class='period'>.</span><span class='id read'>read</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="readlines-class_method">
  
    + (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>readlines</strong>(*args) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Alias for CSV::read().
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1404
1405
1406</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1404</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id readlines'>readlines</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>
  <span class='id read'>read</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="table-class_method">
  
    + (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>table</strong>(path, options = Hash.new) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
A shortcut for:
</p>
<pre class="code">
  <span class='const'>CSV</span><span class='period'>.</span><span class='id read'>read</span><span class='lparen'>(</span> <span class='id path'>path</span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='label'>headers:</span>           <span class='kw'>true</span><span class='comma'>,</span>
                    <span class='label'>converters:</span>        <span class='symbol'>:numeric</span><span class='comma'>,</span>
                    <span class='label'>header_converters:</span> <span class='symbol'>:symbol</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id merge'>merge</span><span class='lparen'>(</span><span class='id options'>options</span><span class='rparen'>)</span> <span class='rparen'>)</span></pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1415
1416
1417
1418
1419</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1415</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id table'>table</span><span class='lparen'>(</span><span class='id path'>path</span><span class='comma'>,</span> <span class='id options'>options</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id new'>new</span><span class='rparen'>)</span>
  <span class='id read'>read</span><span class='lparen'>(</span> <span class='id path'>path</span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='label'>headers:</span>           <span class='kw'>true</span><span class='comma'>,</span>
                <span class='label'>converters:</span>        <span class='symbol'>:numeric</span><span class='comma'>,</span>
                <span class='label'>header_converters:</span> <span class='symbol'>:symbol</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id merge'>merge</span><span class='lparen'>(</span><span class='id options'>options</span><span class='rparen'>)</span> <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="<<-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>&lt;&lt;</strong>(row) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='add_row-instance_method'>add_row</span>, <span id='puts-instance_method'>puts</span></span>
    </span>
  
</p><div class="docstring">
  <div class="discussion">
    <p>
The primary write method for wrapped Strings and IOs, <tt>row</tt> (an
Array or CSV::Row) is converted to CSV and appended to the data source. 
When a CSV::Row is passed, only the row&#8217;s fields() are appended to
the output.
</p>
<p>
The data source must be open for writing.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1689
1690
1691
1692
1693
1694
1695
1696
1697
1698
1699
1700
1701
1702
1703
1704
1705
1706
1707
1708
1709</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1689</span>

<span class='kw'>def</span> <span class='op'>&lt;&lt;</span><span class='lparen'>(</span><span class='id row'>row</span><span class='rparen'>)</span>
  <span class='comment'># make sure headers have been assigned
</span>  <span class='kw'>if</span> <span class='id header_row?'>header_row?</span> <span class='kw'>and</span> <span class='lbracket'>[</span><span class='const'>Array</span><span class='comma'>,</span> <span class='const'>String</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id include?'>include?</span> <span class='ivar'>@use_headers</span><span class='period'>.</span><span class='id class'>class</span>
    <span class='id parse_headers'>parse_headers</span>  <span class='comment'># won't read data for Array or String
</span>    <span class='kw'>self</span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@headers</span> <span class='kw'>if</span> <span class='ivar'>@write_headers</span>
  <span class='kw'>end</span>

  <span class='comment'># handle CSV::Row objects and Hashes
</span>  <span class='id row'>row</span> <span class='op'>=</span> <span class='kw'>case</span> <span class='id row'>row</span>
        <span class='kw'>when</span> <span class='kw'>self</span><span class='period'>.</span><span class='id class'>class</span><span class='op'>::</span><span class='const'>Row</span> <span class='kw'>then</span> <span class='id row'>row</span><span class='period'>.</span><span class='id fields'>fields</span>
        <span class='kw'>when</span> <span class='const'>Hash</span>            <span class='kw'>then</span> <span class='ivar'>@headers</span><span class='period'>.</span><span class='id map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id header'>header</span><span class='op'>|</span> <span class='id row'>row</span><span class='lbracket'>[</span><span class='id header'>header</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
        <span class='kw'>else</span>                      <span class='id row'>row</span>
        <span class='kw'>end</span>

  <span class='ivar'>@headers</span> <span class='op'>=</span>  <span class='id row'>row</span> <span class='kw'>if</span> <span class='id header_row?'>header_row?</span>
  <span class='ivar'>@lineno</span>  <span class='op'>+=</span> <span class='int'>1</span>

  <span class='ivar'>@io</span> <span class='op'>&lt;&lt;</span> <span class='id row'>row</span><span class='period'>.</span><span class='id map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='ivar'>@quote</span><span class='rparen'>)</span><span class='period'>.</span><span class='id join'>join</span><span class='lparen'>(</span><span class='ivar'>@col_sep</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='ivar'>@row_sep</span>  <span class='comment'># quote and separate
</span>
  <span class='kw'>self</span>  <span class='comment'># for chaining
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="convert-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>convert</strong>(name = nil, &amp;converter) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
:call-seq:
</p>
<pre class="code">
  convert( name )
  convert { |field| ... }
  convert { |field, field_info| ... }
</pre>
<p>
You can use this method to install a CSV::Converters built-in, or provide a
block that handles a custom conversion.
</p>
<p>
If you provide a block that takes one argument, it will be passed the field
and is expected to return the converted value or the field itself.  If your
block takes two arguments, it will also be passed a CSV::FieldInfo Struct,
containing details about the field.  Again, the block should return a
converted field or the field itself.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1728
1729
1730</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1728</span>

<span class='kw'>def</span> <span class='id convert'>convert</span><span class='lparen'>(</span><span class='id name'>name</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id converter'>converter</span><span class='rparen'>)</span>
  <span class='id add_converter'>add_converter</span><span class='lparen'>(</span><span class='symbol'>:converters</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id class'>class</span><span class='op'>::</span><span class='const'>Converters</span><span class='comma'>,</span> <span class='id name'>name</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id converter'>converter</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="converters-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>converters</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the current list of converters in effect.  See CSV::new for
details. Built-in converters will be returned by name, while others will be
returned as is.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1605
1606
1607
1608
1609
1610</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1605</span>

<span class='kw'>def</span> <span class='id converters'>converters</span>
  <span class='ivar'>@converters</span><span class='period'>.</span><span class='id map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id converter'>converter</span><span class='op'>|</span>
    <span class='id name'>name</span> <span class='op'>=</span> <span class='const'>Converters</span><span class='period'>.</span><span class='id rassoc'>rassoc</span><span class='lparen'>(</span><span class='id converter'>converter</span><span class='rparen'>)</span>
    <span class='id name'>name</span> <span class='op'>?</span> <span class='id name'>name</span><span class='period'>.</span><span class='id first'>first</span> <span class='op'>:</span> <span class='id converter'>converter</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="each-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>each</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Yields each row of the data source in turn.
</p>
<p>
Support for Enumerable.
</p>
<p>
The data source must be open for reading.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1759
1760
1761
1762
1763</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1759</span>

<span class='kw'>def</span> <span class='id each'>each</span>
  <span class='kw'>while</span> <span class='id row'>row</span> <span class='op'>=</span> <span class='id shift'>shift</span>
    <span class='kw'>yield</span> <span class='id row'>row</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="force_quotes?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>force_quotes?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns <tt>true</tt> if all output fields are quoted. See CSV::new for
details.
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1648</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1648</span>

<span class='kw'>def</span> <span class='id force_quotes?'>force_quotes?</span><span class='lparen'>(</span><span class='rparen'>)</span>       <span class='ivar'>@force_quotes</span>       <span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="header_convert-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>header_convert</strong>(name = nil, &amp;converter) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
:call-seq:
</p>
<pre class="code">
  header_convert( name )
  header_convert { |field| ... }
  header_convert { |field, field_info| ... }
</pre>
<p>
Identical to CSV#convert(), but for header rows.
</p>
<p>
Note that this method must be called before header rows are read to have
any effect.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1743
1744
1745
1746
1747
1748</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1743</span>

<span class='kw'>def</span> <span class='id header_convert'>header_convert</span><span class='lparen'>(</span><span class='id name'>name</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id converter'>converter</span><span class='rparen'>)</span>
  <span class='id add_converter'>add_converter</span><span class='lparen'>(</span> <span class='symbol'>:header_converters</span><span class='comma'>,</span>
                 <span class='kw'>self</span><span class='period'>.</span><span class='id class'>class</span><span class='op'>::</span><span class='const'>HeaderConverters</span><span class='comma'>,</span>
                 <span class='id name'>name</span><span class='comma'>,</span>
                 <span class='op'>&amp;</span><span class='id converter'>converter</span> <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="header_converters-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>header_converters</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the current list of converters in effect for headers.  See CSV::new
for details.  Built-in converters will be returned by name, while others
will be returned as is.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1636
1637
1638
1639
1640
1641</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1636</span>

<span class='kw'>def</span> <span class='id header_converters'>header_converters</span>
  <span class='ivar'>@header_converters</span><span class='period'>.</span><span class='id map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id converter'>converter</span><span class='op'>|</span>
    <span class='id name'>name</span> <span class='op'>=</span> <span class='const'>HeaderConverters</span><span class='period'>.</span><span class='id rassoc'>rassoc</span><span class='lparen'>(</span><span class='id converter'>converter</span><span class='rparen'>)</span>
    <span class='id name'>name</span> <span class='op'>?</span> <span class='id name'>name</span><span class='period'>.</span><span class='id first'>first</span> <span class='op'>:</span> <span class='id converter'>converter</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="header_row?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>header_row?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns <tt>true</tt> if the next row read will be a header row.
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1781
1782
1783</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1781</span>

<span class='kw'>def</span> <span class='id header_row?'>header_row?</span>
  <span class='ivar'>@use_headers</span> <span class='kw'>and</span> <span class='ivar'>@headers</span><span class='period'>.</span><span class='id nil?'>nil?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="headers-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>headers</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns <tt>nil</tt> if headers will not be used, <tt>true</tt> if they
will but have not yet been read, or the actual headers after they have been
read.  See CSV::new for details.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1621
1622
1623</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1621</span>

<span class='kw'>def</span> <span class='id headers'>headers</span>
  <span class='ivar'>@headers</span> <span class='op'>||</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='ivar'>@use_headers</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="inspect-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>inspect</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns a simplified description of the key FasterCSV attributes in an
ASCII compatible String.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1937
1938
1939
1940
1941
1942
1943
1944
1945
1946
1947
1948
1949
1950
1951
1952
1953
1954
1955
1956
1957
1958
1959
1960
1961
1962
1963
1964
1965
1966
1967
1968
1969
1970</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1937</span>

<span class='kw'>def</span> <span class='id inspect'>inspect</span>
  <span class='id str'>str</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;#</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id class'>class</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> io_type:</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='comment'># show type of wrapped IO
</span>  <span class='kw'>if</span>    <span class='ivar'>@io</span> <span class='op'>==</span> <span class='gvar'>$stdout</span> <span class='kw'>then</span> <span class='id str'>str</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$stdout</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='ivar'>@io</span> <span class='op'>==</span> <span class='gvar'>$stdin</span>  <span class='kw'>then</span> <span class='id str'>str</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$stdin</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='ivar'>@io</span> <span class='op'>==</span> <span class='gvar'>$stderr</span> <span class='kw'>then</span> <span class='id str'>str</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$stderr</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>                      <span class='id str'>str</span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@io</span><span class='period'>.</span><span class='id class'>class</span><span class='period'>.</span><span class='id to_s'>to_s</span>
  <span class='kw'>end</span>
  <span class='comment'># show IO.path(), if available
</span>  <span class='kw'>if</span> <span class='ivar'>@io</span><span class='period'>.</span><span class='id respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:path</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='lparen'>(</span><span class='id p'>p</span> <span class='op'>=</span> <span class='ivar'>@io</span><span class='period'>.</span><span class='id path'>path</span><span class='rparen'>)</span>
    <span class='id str'>str</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> io_path:</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='id p'>p</span><span class='period'>.</span><span class='id inspect'>inspect</span>
  <span class='kw'>end</span>
  <span class='comment'># show encoding
</span>  <span class='id str'>str</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> encoding:</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@encoding</span><span class='period'>.</span><span class='id name'>name</span>
  <span class='comment'># show other attributes
</span>  <span class='qwords_beg'>%w[ </span><span class='tstring_content'>lineno</span><span class='words_sep'>     </span><span class='tstring_content'>col_sep</span><span class='words_sep'>     </span><span class='tstring_content'>row_sep</span><span class='words_sep'>
</span><span class='words_sep'>      </span><span class='tstring_content'>quote_char</span><span class='words_sep'> </span><span class='tstring_content'>skip_blanks</span><span class='words_sep'> ]</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id attr_name'>attr_name</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id a'>a</span> <span class='op'>=</span> <span class='id instance_variable_get'>instance_variable_get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>@</span><span class='embexpr_beg'>#{</span><span class='id attr_name'>attr_name</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id str'>str</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='id attr_name'>attr_name</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='id a'>a</span><span class='period'>.</span><span class='id inspect'>inspect</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='ivar'>@use_headers</span>
    <span class='id str'>str</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> headers:</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='id headers'>headers</span><span class='period'>.</span><span class='id inspect'>inspect</span>
  <span class='kw'>end</span>
  <span class='id str'>str</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&gt;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>begin</span>
    <span class='id str'>str</span><span class='period'>.</span><span class='id join'>join</span>
  <span class='kw'>rescue</span>  <span class='comment'># any encoding error
</span>    <span class='id str'>str</span><span class='period'>.</span><span class='id map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id s'>s</span><span class='op'>|</span>
      <span class='id e'>e</span> <span class='op'>=</span> <span class='const'>Encoding</span><span class='op'>::</span><span class='const'>Converter</span><span class='period'>.</span><span class='id asciicompat_encoding'>asciicompat_encoding</span><span class='lparen'>(</span><span class='id s'>s</span><span class='period'>.</span><span class='id encoding'>encoding</span><span class='rparen'>)</span>
      <span class='id e'>e</span> <span class='op'>?</span> <span class='id s'>s</span><span class='period'>.</span><span class='id encode'>encode</span><span class='lparen'>(</span><span class='id e'>e</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id s'>s</span><span class='period'>.</span><span class='id force_encoding'>force_encoding</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ASCII-8BIT</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span><span class='period'>.</span><span class='id join'>join</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="read-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>read</strong> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='readlines-instance_method'>readlines</span></span>
    </span>
  
</p><div class="docstring">
  <div class="discussion">
    <p>
Slurps the remaining rows and returns an Array of Arrays.
</p>
<p>
The data source must be open for reading.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1770
1771
1772
1773
1774
1775
1776
1777</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1770</span>

<span class='kw'>def</span> <span class='id read'>read</span>
  <span class='id rows'>rows</span> <span class='op'>=</span> <span class='id to_a'>to_a</span>
  <span class='kw'>if</span> <span class='ivar'>@use_headers</span>
    <span class='const'>Table</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id rows'>rows</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id rows'>rows</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="return_headers?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>return_headers?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns <tt>true</tt> if headers will be returned as a row of results. See
CSV::new for details.
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1628</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1628</span>

<span class='kw'>def</span> <span class='id return_headers?'>return_headers?</span><span class='lparen'>(</span><span class='rparen'>)</span>     <span class='ivar'>@return_headers</span>     <span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="rewind-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>rewind</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Rewinds the underlying IO object and resets CSV&#8217;s lineno() counter.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1673
1674
1675
1676
1677
1678</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1673</span>

<span class='kw'>def</span> <span class='id rewind'>rewind</span>
  <span class='ivar'>@headers</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@lineno</span>  <span class='op'>=</span> <span class='int'>0</span>

  <span class='ivar'>@io</span><span class='period'>.</span><span class='id rewind'>rewind</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="shift-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>shift</strong> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='gets-instance_method'>gets</span>, <span id='readline-instance_method'>readline</span></span>
    </span>
  
</p><div class="docstring">
  <div class="discussion">
    <p>
The primary read method for wrapped Strings and IOs, a single row is pulled
from the data source, parsed and returned as an Array of fields (if header
rows are not used) or a CSV::Row (when header rows are used).
</p>
<p>
The data source must be open for reading.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1792
1793
1794
1795
1796
1797
1798
1799
1800
1801
1802
1803
1804
1805
1806
1807
1808
1809
1810
1811
1812
1813
1814
1815
1816
1817
1818
1819
1820
1821
1822
1823
1824
1825
1826
1827
1828
1829
1830
1831
1832
1833
1834
1835
1836
1837
1838
1839
1840
1841
1842
1843
1844
1845
1846
1847
1848
1849
1850
1851
1852
1853
1854
1855
1856
1857
1858
1859
1860
1861
1862
1863
1864
1865
1866
1867
1868
1869
1870
1871
1872
1873
1874
1875
1876
1877
1878
1879
1880
1881
1882
1883
1884
1885
1886
1887
1888
1889
1890
1891
1892
1893
1894
1895
1896
1897
1898
1899
1900
1901
1902
1903
1904
1905
1906
1907
1908
1909
1910
1911
1912
1913
1914
1915
1916
1917
1918
1919
1920
1921
1922
1923
1924
1925
1926
1927
1928
1929</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1792</span>

<span class='kw'>def</span> <span class='id shift'>shift</span>
  <span class='comment'>#########################################################################
</span>  <span class='comment'>### This method is purposefully kept a bit long as simple conditional ###
</span>  <span class='comment'>### checks are faster than numerous (expensive) method calls.         ###
</span>  <span class='comment'>#########################################################################
</span>
  <span class='comment'># handle headers not based on document content
</span>  <span class='kw'>if</span> <span class='id header_row?'>header_row?</span> <span class='kw'>and</span> <span class='ivar'>@return_headers</span> <span class='kw'>and</span>
     <span class='lbracket'>[</span><span class='const'>Array</span><span class='comma'>,</span> <span class='const'>String</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id include?'>include?</span> <span class='ivar'>@use_headers</span><span class='period'>.</span><span class='id class'>class</span>
    <span class='kw'>if</span> <span class='ivar'>@unconverted_fields</span>
      <span class='kw'>return</span> <span class='id add_unconverted_fields'>add_unconverted_fields</span><span class='lparen'>(</span><span class='id parse_headers'>parse_headers</span><span class='comma'>,</span> <span class='const'>Array</span><span class='period'>.</span><span class='id new'>new</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='kw'>return</span> <span class='id parse_headers'>parse_headers</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># begin with a blank line, so we can always add to it
</span>  <span class='id line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>

  <span class='comment'>#
</span>  <span class='comment'># it can take multiple calls to &lt;tt&gt;@io.gets()&lt;/tt&gt; to get a full line,
</span>  <span class='comment'># because of \r and/or \n characters embedded in quoted fields
</span>  <span class='comment'>#
</span>  <span class='id in_extended_col'>in_extended_col</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='id csv'>csv</span>             <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id new'>new</span>

  <span class='id loop'>loop</span> <span class='kw'>do</span>
    <span class='comment'># add another read to the line
</span>    <span class='kw'>unless</span> <span class='id parse'>parse</span> <span class='op'>=</span> <span class='ivar'>@io</span><span class='period'>.</span><span class='id gets'>gets</span><span class='lparen'>(</span><span class='ivar'>@row_sep</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>

    <span class='id parse'>parse</span><span class='period'>.</span><span class='id sub!'>sub!</span><span class='lparen'>(</span><span class='ivar'>@parsers</span><span class='lbracket'>[</span><span class='symbol'>:line_end</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

    <span class='kw'>if</span> <span class='id csv'>csv</span><span class='period'>.</span><span class='id empty?'>empty?</span>
      <span class='comment'>#
</span>      <span class='comment'># I believe a blank line should be an &lt;tt&gt;Array.new&lt;/tt&gt;, not Ruby 1.8
</span>      <span class='comment'># CSV's &lt;tt&gt;[nil]&lt;/tt&gt;
</span>      <span class='comment'>#
</span>      <span class='kw'>if</span> <span class='id parse'>parse</span><span class='period'>.</span><span class='id empty?'>empty?</span>
        <span class='ivar'>@lineno</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='kw'>if</span> <span class='ivar'>@skip_blanks</span>
          <span class='kw'>next</span>
        <span class='kw'>elsif</span> <span class='ivar'>@unconverted_fields</span>
          <span class='kw'>return</span> <span class='id add_unconverted_fields'>add_unconverted_fields</span><span class='lparen'>(</span><span class='const'>Array</span><span class='period'>.</span><span class='id new'>new</span><span class='comma'>,</span> <span class='const'>Array</span><span class='period'>.</span><span class='id new'>new</span><span class='rparen'>)</span>
        <span class='kw'>elsif</span> <span class='ivar'>@use_headers</span>
          <span class='kw'>return</span> <span class='kw'>self</span><span class='period'>.</span><span class='id class'>class</span><span class='op'>::</span><span class='const'>Row</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='const'>Array</span><span class='period'>.</span><span class='id new'>new</span><span class='comma'>,</span> <span class='const'>Array</span><span class='period'>.</span><span class='id new'>new</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='kw'>return</span> <span class='const'>Array</span><span class='period'>.</span><span class='id new'>new</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='id parts'>parts</span> <span class='op'>=</span>  <span class='id parse'>parse</span><span class='period'>.</span><span class='id split'>split</span><span class='lparen'>(</span><span class='ivar'>@col_sep</span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>1</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id parts'>parts</span><span class='period'>.</span><span class='id empty?'>empty?</span>
      <span class='kw'>if</span> <span class='id in_extended_col'>in_extended_col</span>
        <span class='id csv'>csv</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@col_sep</span>   <span class='comment'># will be replaced with a @row_sep after the parts.each loop
</span>      <span class='kw'>else</span>
        <span class='id csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='kw'>nil</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># This loop is the hot path of csv parsing. Some things may be non-dry
</span>    <span class='comment'># for a reason. Make sure to benchmark when refactoring.
</span>    <span class='id parts'>parts</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id part'>part</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id in_extended_col'>in_extended_col</span>
        <span class='comment'># If we are continuing a previous column
</span>        <span class='kw'>if</span> <span class='id part'>part</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='ivar'>@quote_char</span> <span class='op'>&amp;&amp;</span> <span class='id part'>part</span><span class='period'>.</span><span class='id count'>count</span><span class='lparen'>(</span><span class='ivar'>@quote_char</span><span class='rparen'>)</span> <span class='op'>%</span> <span class='int'>2</span> <span class='op'>!=</span> <span class='int'>0</span>
          <span class='comment'># extended column ends
</span>          <span class='id csv'>csv</span><span class='period'>.</span><span class='id last'>last</span> <span class='op'>&lt;&lt;</span> <span class='id part'>part</span><span class='lbracket'>[</span><span class='int'>0</span><span class='op'>..</span><span class='op'>-</span><span class='int'>2</span><span class='rbracket'>]</span>
          <span class='id raise'>raise</span> <span class='const'>MalformedCSVError</span> <span class='kw'>if</span> <span class='id csv'>csv</span><span class='period'>.</span><span class='id last'>last</span> <span class='op'>=~</span> <span class='ivar'>@parsers</span><span class='lbracket'>[</span><span class='symbol'>:stray_quote</span><span class='rbracket'>]</span>
          <span class='id csv'>csv</span><span class='period'>.</span><span class='id last'>last</span><span class='period'>.</span><span class='id gsub!'>gsub!</span><span class='lparen'>(</span><span class='ivar'>@quote_char</span> <span class='op'>*</span> <span class='int'>2</span><span class='comma'>,</span> <span class='ivar'>@quote_char</span><span class='rparen'>)</span>
          <span class='id in_extended_col'>in_extended_col</span> <span class='op'>=</span> <span class='kw'>false</span>
        <span class='kw'>else</span>
          <span class='id csv'>csv</span><span class='period'>.</span><span class='id last'>last</span> <span class='op'>&lt;&lt;</span> <span class='id part'>part</span>
          <span class='id csv'>csv</span><span class='period'>.</span><span class='id last'>last</span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@col_sep</span>
        <span class='kw'>end</span>
      <span class='kw'>elsif</span> <span class='id part'>part</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='ivar'>@quote_char</span>
        <span class='comment'># If we are staring a new quoted column
</span>        <span class='kw'>if</span> <span class='id part'>part</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='ivar'>@quote_char</span> <span class='op'>||</span> <span class='id part'>part</span><span class='period'>.</span><span class='id count'>count</span><span class='lparen'>(</span><span class='ivar'>@quote_char</span><span class='rparen'>)</span> <span class='op'>%</span> <span class='int'>2</span> <span class='op'>!=</span> <span class='int'>0</span>
          <span class='comment'># start an extended column
</span>          <span class='id csv'>csv</span>             <span class='op'>&lt;&lt;</span> <span class='id part'>part</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
          <span class='id csv'>csv</span><span class='period'>.</span><span class='id last'>last</span>        <span class='op'>&lt;&lt;</span> <span class='ivar'>@col_sep</span>
          <span class='id in_extended_col'>in_extended_col</span> <span class='op'>=</span>  <span class='kw'>true</span>
        <span class='kw'>else</span>
          <span class='comment'># regular quoted column
</span>          <span class='id csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='id part'>part</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>2</span><span class='rbracket'>]</span>
          <span class='id raise'>raise</span> <span class='const'>MalformedCSVError</span> <span class='kw'>if</span> <span class='id csv'>csv</span><span class='period'>.</span><span class='id last'>last</span> <span class='op'>=~</span> <span class='ivar'>@parsers</span><span class='lbracket'>[</span><span class='symbol'>:stray_quote</span><span class='rbracket'>]</span>
          <span class='id csv'>csv</span><span class='period'>.</span><span class='id last'>last</span><span class='period'>.</span><span class='id gsub!'>gsub!</span><span class='lparen'>(</span><span class='ivar'>@quote_char</span> <span class='op'>*</span> <span class='int'>2</span><span class='comma'>,</span> <span class='ivar'>@quote_char</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>elsif</span> <span class='id part'>part</span> <span class='op'>=~</span> <span class='ivar'>@parsers</span><span class='lbracket'>[</span><span class='symbol'>:quote_or_nl</span><span class='rbracket'>]</span>
        <span class='comment'># Unquoted field with bad characters.
</span>        <span class='kw'>if</span> <span class='id part'>part</span> <span class='op'>=~</span> <span class='ivar'>@parsers</span><span class='lbracket'>[</span><span class='symbol'>:nl_or_lf</span><span class='rbracket'>]</span>
          <span class='id raise'>raise</span> <span class='const'>MalformedCSVError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unquoted fields do not allow </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
                                   <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\\r or \\n (line </span><span class='embexpr_beg'>#{</span><span class='id lineno'>lineno</span> <span class='op'>+</span> <span class='int'>1</span><span class='rbrace'>}</span><span class='tstring_content'>).</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>else</span>
          <span class='id raise'>raise</span> <span class='const'>MalformedCSVError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Illegal quoting on line </span><span class='embexpr_beg'>#{</span><span class='id lineno'>lineno</span> <span class='op'>+</span> <span class='int'>1</span><span class='rbrace'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>
      <span class='kw'>else</span>
        <span class='comment'># Regular ole unquoted field.
</span>        <span class='id csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='lparen'>(</span><span class='id part'>part</span><span class='period'>.</span><span class='id empty?'>empty?</span> <span class='op'>?</span> <span class='kw'>nil</span> <span class='op'>:</span> <span class='id part'>part</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># Replace tacked on @col_sep with @row_sep if we are still in an extended
</span>    <span class='comment'># column.
</span>    <span class='id csv'>csv</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@row_sep</span> <span class='kw'>if</span> <span class='id in_extended_col'>in_extended_col</span>

    <span class='kw'>if</span> <span class='id in_extended_col'>in_extended_col</span>
      <span class='comment'># if we're at eof?(), a quoted field wasn't closed...
</span>      <span class='kw'>if</span> <span class='ivar'>@io</span><span class='period'>.</span><span class='id eof?'>eof?</span>
        <span class='id raise'>raise</span> <span class='const'>MalformedCSVError</span><span class='comma'>,</span>
              <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unclosed quoted field on line </span><span class='embexpr_beg'>#{</span><span class='id lineno'>lineno</span> <span class='op'>+</span> <span class='int'>1</span><span class='rbrace'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>elsif</span> <span class='ivar'>@field_size_limit</span> <span class='kw'>and</span> <span class='id csv'>csv</span><span class='period'>.</span><span class='id last'>last</span><span class='period'>.</span><span class='id size'>size</span> <span class='op'>&gt;=</span> <span class='ivar'>@field_size_limit</span>
        <span class='id raise'>raise</span> <span class='const'>MalformedCSVError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Field size exceeded on line </span><span class='embexpr_beg'>#{</span><span class='id lineno'>lineno</span> <span class='op'>+</span> <span class='int'>1</span><span class='rbrace'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='comment'># otherwise, we need to loop and pull some more data to complete the row
</span>    <span class='kw'>else</span>
      <span class='ivar'>@lineno</span> <span class='op'>+=</span> <span class='int'>1</span>

      <span class='comment'># save fields unconverted fields, if needed...
</span>      <span class='id unconverted'>unconverted</span> <span class='op'>=</span> <span class='id csv'>csv</span><span class='period'>.</span><span class='id dup'>dup</span> <span class='kw'>if</span> <span class='ivar'>@unconverted_fields</span>

      <span class='comment'># convert fields, if needed...
</span>      <span class='id csv'>csv</span> <span class='op'>=</span> <span class='id convert_fields'>convert_fields</span><span class='lparen'>(</span><span class='id csv'>csv</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='ivar'>@use_headers</span> <span class='kw'>or</span> <span class='ivar'>@converters</span><span class='period'>.</span><span class='id empty?'>empty?</span>
      <span class='comment'># parse out header rows and handle CSV::Row conversions...
</span>      <span class='id csv'>csv</span> <span class='op'>=</span> <span class='id parse_headers'>parse_headers</span><span class='lparen'>(</span><span class='id csv'>csv</span><span class='rparen'>)</span>  <span class='kw'>if</span>     <span class='ivar'>@use_headers</span>

      <span class='comment'># inject unconverted fields and accessor, if requested...
</span>      <span class='kw'>if</span> <span class='ivar'>@unconverted_fields</span> <span class='kw'>and</span> <span class='kw'>not</span> <span class='id csv'>csv</span><span class='period'>.</span><span class='id respond_to?'>respond_to?</span> <span class='symbol'>:unconverted_fields</span>
        <span class='id add_unconverted_fields'>add_unconverted_fields</span><span class='lparen'>(</span><span class='id csv'>csv</span><span class='comma'>,</span> <span class='id unconverted'>unconverted</span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='comment'># return the results
</span>      <span class='kw'>break</span> <span class='id csv'>csv</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="skip_blanks?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>skip_blanks?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns <tt>true</tt> blank lines are skipped by the parser. See CSV::new
for details.
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1646</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1646</span>

<span class='kw'>def</span> <span class='id skip_blanks?'>skip_blanks?</span><span class='lparen'>(</span><span class='rparen'>)</span>        <span class='ivar'>@skip_blanks</span>        <span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="unconverted_fields?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>unconverted_fields?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns <tt>true</tt> if unconverted_fields() to parsed results.  See
CSV::new for details.
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1615</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1615</span>

<span class='kw'>def</span> <span class='id unconverted_fields?'>unconverted_fields?</span><span class='lparen'>(</span><span class='rparen'>)</span> <span class='ivar'>@unconverted_fields</span> <span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="write_headers?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>write_headers?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns <tt>true</tt> if headers are written in output. See CSV::new for
details.
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1630</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/csv.rb', line 1630</span>

<span class='kw'>def</span> <span class='id write_headers?'>write_headers?</span><span class='lparen'>(</span><span class='rparen'>)</span>      <span class='ivar'>@write_headers</span>      <span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Thu Oct 14 00:01:22 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.1 (ruby-1.9.2).
</div>

  </body>
</html>