<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Class: CGI::Session</title>
<link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (S)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../CGI.html" title="CGI (class)">CGI</a></span></span>
     &raquo; 
    <span class="title">Session</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: CGI::Session
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">CGI::Session</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/cgi/session.rb<span class="defines">,<br />
  lib/cgi/session/pstore.rb</span>
</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
Class representing an HTTP session.  See documentation for the file
cgi/session.rb for an introduction to HTTP sessions.
</p>
<h2>Lifecycle</h2>
<p>
A CGI::Session instance is created from a CGI object.  By default, this
CGI::Session instance will start a new session if none currently exists, or
continue the current session for this client if one does exist.  The
<tt>new_session</tt> option can be used to either always or never create a
new session.  See #new() for more details.
</p>
<p>
#delete() deletes a session from session storage.  It does not however
remove the session id from the client.  If the client makes another request
with the same id, the effect will be to start a new session with the old
session&#8217;s id.
</p>
<h2>Setting and retrieving session data.</h2>
<p>
The Session class associates data with a session as key-value pairs. This
data can be set and retrieved by indexing the Session instance using
&#8217;[]&#8217;, much the same as hashes (although other hash methods are
not supported).
</p>
<p>
When session processing has been completed for a request, the session
should be closed using the close() method.  This will store the
session&#8217;s state to persistent storage.  If you want to store the
session&#8217;s state to persistent storage without finishing session
processing for this request, call the update() method.
</p>
<h2>Storing session state</h2>
<p>
The caller can specify what form of storage to use for the session&#8217;s
data with the <tt>database_manager</tt> option to CGI::Session::new.  The
following storage classes are provided as part of the standard library:
</p>
<table>
<tr><td valign="top">CGI::Session::FileStore</td><td><p>
stores data as plain text in a flat file.  Only works with String data. 
This is the default storage type.
</p>
</td></tr>
<tr><td valign="top">CGI::Session::MemoryStore</td><td><p>
stores data in an in-memory hash.  The data only persists for as long as
the current ruby interpreter instance does.
</p>
</td></tr>
<tr><td valign="top">CGI::Session::PStore</td><td><p>
stores data in Marshalled format.  Provided by cgi/session/pstore.rb. 
Supports data of any type, and provides file-locking and transaction
support.
</p>
</td></tr>
</table>
<p>
Custom storage types can also be created by defining a class with the
following methods:
</p>
<pre class="code">
   <span class='id new'>new</span><span class='lparen'>(</span><span class='id session'>session</span><span class='comma'>,</span> <span class='id options'>options</span><span class='rparen'>)</span>
   <span class='id restore'>restore</span>  <span class='comment'># returns hash of session data.
</span>   <span class='id update'>update</span>
   <span class='id close'>close</span>
   <span class='id delete'>delete</span>
</pre>
<p>
Changing storage type mid-session does not work.  Note in particular that
by default the FileStore and PStore session data files have the same name. 
If your application switches from one to the other without making sure that
filenames will be different and clients still have old sessions lying
around in cookies, then things will break nastily!
</p>
<h2>Maintaining the session id.</h2>
<p>
Most session state is maintained on the server.  However, a session id must
be passed backwards and forwards between client and server to maintain a
reference to this session state.
</p>
<p>
The simplest way to do this is via cookies.  The CGI::Session class
provides transparent support for session id communication via cookies if
the client has cookies enabled.
</p>
<p>
If the client has cookies disabled, the session id must be included as a
parameter of all requests sent by the client to the server.  The
CGI::Session class in conjunction with the CGI class will transparently add
the session id as a hidden input field to all forms generated using the
CGI#form() HTML generation method.  No built-in support is provided for
other mechanisms, such as URL re-writing.  The caller is responsible for
extracting the session id from the session_id attribute and manually
encoding it in URLs and adding it as a hidden input to HTML forms created
by other mechanisms.  Also, session expiry is not automatically handled.
</p>
<h2>Examples of use</h2>
<h3>Setting the user&#8217;s name</h3>
<pre class="code">
  <span class='id require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>cgi</span><span class='tstring_end'>'</span></span>
  <span class='id require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>cgi/session</span><span class='tstring_end'>'</span></span>
  <span class='id require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>cgi/session/pstore</span><span class='tstring_end'>'</span></span>     <span class='comment'># provides CGI::Session::PStore
</span>
  <span class='id cgi'>cgi</span> <span class='op'>=</span> <span class='const'>CGI</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>html4</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

  <span class='id session'>session</span> <span class='op'>=</span> <span class='const'>CGI</span><span class='op'>::</span><span class='const'>Session</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id cgi'>cgi</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>database_manager</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='const'>CGI</span><span class='op'>::</span><span class='const'>Session</span><span class='op'>::</span><span class='const'>PStore</span><span class='comma'>,</span>  <span class='comment'># use PStore
</span>      <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>session_key</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>_rb_sess_id</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>              <span class='comment'># custom session key
</span>      <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>session_expires</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='const'>Time</span><span class='period'>.</span><span class='id now'>now</span> <span class='op'>+</span> <span class='int'>30</span> <span class='op'>*</span> <span class='int'>60</span><span class='comma'>,</span>     <span class='comment'># 30 minute timeout
</span>      <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>prefix</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>pstore_sid_</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>                   <span class='comment'># PStore option
</span>  <span class='kw'>if</span> <span class='id cgi'>cgi</span><span class='period'>.</span><span class='id has_key?'>has_key?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>user_name</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='id cgi'>cgi</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>user_name</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>
      <span class='comment'># coerce to String: cgi[] returns the
</span>      <span class='comment'># string-like CGI::QueryExtension::Value
</span>      <span class='id session'>session</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>user_name</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id cgi'>cgi</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>user_name</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id to_s'>to_s</span>
  <span class='kw'>elsif</span> <span class='op'>!</span><span class='id session'>session</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>user_name</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
      <span class='id session'>session</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>user_name</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>guest</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='id session'>session</span><span class='period'>.</span><span class='id close'>close</span>
</pre>
<h3>Creating a new session safely</h3>
<pre class="code">
  <span class='id require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>cgi</span><span class='tstring_end'>'</span></span>
  <span class='id require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>cgi/session</span><span class='tstring_end'>'</span></span>

  <span class='id cgi'>cgi</span> <span class='op'>=</span> <span class='const'>CGI</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>html4</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

  <span class='comment'># We make sure to delete an old session if one exists,
</span>  <span class='comment'># not just to free resources, but to prevent the session
</span>  <span class='comment'># from being maliciously hijacked later on.
</span>  <span class='kw'>begin</span>
      <span class='id session'>session</span> <span class='op'>=</span> <span class='const'>CGI</span><span class='op'>::</span><span class='const'>Session</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id cgi'>cgi</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>new_session</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='rparen'>)</span>
      <span class='id session'>session</span><span class='period'>.</span><span class='id delete'>delete</span>
  <span class='kw'>rescue</span> <span class='const'>ArgumentError</span>  <span class='comment'># if no old session
</span>  <span class='kw'>end</span>
  <span class='id session'>session</span> <span class='op'>=</span> <span class='const'>CGI</span><span class='op'>::</span><span class='const'>Session</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id cgi'>cgi</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>new_session</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='id session'>session</span><span class='period'>.</span><span class='id close'>close</span></pre>


  </div>
</div>
<div class="tags">
  
</div><h2>Defined Under Namespace</h2>
<p class="children">
   
    
   
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Session/FileStore.html" title="CGI::Session::FileStore (class)">FileStore</a></span>, <span class='object_link'><a href="Session/MemoryStore.html" title="CGI::Session::MemoryStore (class)">MemoryStore</a></span>, <span class='object_link'><a href="Session/NoSession.html" title="CGI::Session::NoSession (class)">NoSession</a></span>, <span class='object_link'><a href="Session/NullStore.html" title="CGI::Session::NullStore (class)">NullStore</a></span>, <span class='object_link'><a href="Session/PStore.html" title="CGI::Session::PStore (class)">PStore</a></span>
    
  
</p>


  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#new_session-instance_method" title="#new_session (instance method)">- (Object) <strong>new_session</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The id of this session.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#session_id-instance_method" title="#session_id (instance method)">- (Object) <strong>session_id</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The id of this session.
</p>
</div></span>
  
</li>

    
  </ul>


  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#callback-class_method" title="callback (class method)">+ (Object) <strong>callback</strong>(dbman) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
:nodoc:.
</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#%5B%5D-instance_method" title="#[] (instance method)">- (Object) <strong>[]</strong>(key) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Retrieve the session data for key <tt>key</tt>.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#%5B%5D%3D-instance_method" title="#[]= (instance method)">- (Object) <strong>[]=</strong>(key, val) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Set the session date for key <tt>key</tt>.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#close-instance_method" title="#close (instance method)">- (Object) <strong>close</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Store session data on the server and close the session storage.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete-instance_method" title="#delete (instance method)">- (Object) <strong>delete</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Delete the session from storage.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Object) <strong>initialize</strong>(request, option = {}) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
cgi = CGI.new(&#8220;html4&#8221;).
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update-instance_method" title="#update (instance method)">- (Object) <strong>update</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Store session data on the server.
</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>initialize</strong>(request, option = {}) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
cgi = CGI.new(&#8220;html4&#8221;)
</p>
<pre class="code">
  <span class='kw'>class</span> <span class='op'>&lt;&lt;</span> <span class='id cgi'>cgi</span>
      <span class='id undef_method'>undef_method</span> <span class='symbol'>:fieldset</span>
  <span class='kw'>end</span></pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cgi/session.rb', line 251</span>

<span class='kw'>def</span> <span class='id initialize'>initialize</span><span class='lparen'>(</span><span class='id request'>request</span><span class='comma'>,</span> <span class='id option'>option</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='ivar'>@new_session</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='id session_key'>session_key</span> <span class='op'>=</span> <span class='id option'>option</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>session_key</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>_session_id</span><span class='tstring_end'>'</span></span>
  <span class='id session_id'>session_id</span> <span class='op'>=</span> <span class='id option'>option</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>session_id</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
  <span class='kw'>unless</span> <span class='id session_id'>session_id</span>
    <span class='kw'>if</span> <span class='id option'>option</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>new_session</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
      <span class='id session_id'>session_id</span> <span class='op'>=</span> <span class='id create_new_id'>create_new_id</span>
      <span class='ivar'>@new_session</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>unless</span> <span class='id session_id'>session_id</span>
    <span class='kw'>if</span> <span class='id request'>request</span><span class='period'>.</span><span class='id key?'>key?</span><span class='lparen'>(</span><span class='id session_key'>session_key</span><span class='rparen'>)</span>
      <span class='id session_id'>session_id</span> <span class='op'>=</span> <span class='id request'>request</span><span class='lbracket'>[</span><span class='id session_key'>session_key</span><span class='rbracket'>]</span>
      <span class='id session_id'>session_id</span> <span class='op'>=</span> <span class='id session_id'>session_id</span><span class='period'>.</span><span class='id read'>read</span> <span class='kw'>if</span> <span class='id session_id'>session_id</span><span class='period'>.</span><span class='id respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:read</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='kw'>unless</span> <span class='id session_id'>session_id</span>
      <span class='id session_id'>session_id</span><span class='comma'>,</span> <span class='op'>=</span> <span class='id request'>request</span><span class='period'>.</span><span class='id cookies'>cookies</span><span class='lbracket'>[</span><span class='id session_key'>session_key</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
    <span class='kw'>unless</span> <span class='id session_id'>session_id</span>
      <span class='kw'>unless</span> <span class='id option'>option</span><span class='period'>.</span><span class='id fetch'>fetch</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>new_session</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
        <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>session_key `%s' should be supplied</span><span class='tstring_end'>&quot;</span></span><span class='op'>%</span><span class='id session_key'>session_key</span>
      <span class='kw'>end</span>
      <span class='id session_id'>session_id</span> <span class='op'>=</span> <span class='id create_new_id'>create_new_id</span>
      <span class='ivar'>@new_session</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='ivar'>@session_id</span> <span class='op'>=</span> <span class='id session_id'>session_id</span>
  <span class='id dbman'>dbman</span> <span class='op'>=</span> <span class='id option'>option</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>database_manager</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='const'>FileStore</span>
  <span class='kw'>begin</span>
    <span class='ivar'>@dbman</span> <span class='op'>=</span> <span class='id dbman'>dbman</span><span class='op'>::</span><span class='id new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id option'>option</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'>NoSession</span>
    <span class='kw'>unless</span> <span class='id option'>option</span><span class='period'>.</span><span class='id fetch'>fetch</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>new_session</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
      <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid session_id `%s'</span><span class='tstring_end'>&quot;</span></span><span class='op'>%</span><span class='id session_id'>session_id</span>
    <span class='kw'>end</span>
    <span class='id session_id'>session_id</span> <span class='op'>=</span> <span class='ivar'>@session_id</span> <span class='op'>=</span> <span class='id create_new_id'>create_new_id</span> <span class='kw'>unless</span> <span class='id session_id'>session_id</span>
    <span class='ivar'>@new_session</span><span class='op'>=</span><span class='kw'>true</span>
    <span class='kw'>retry</span>
  <span class='kw'>end</span>
  <span class='id request'>request</span><span class='period'>.</span><span class='id instance_eval'>instance_eval</span> <span class='kw'>do</span>
    <span class='ivar'>@output_hidden</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='id session_key'>session_key</span> <span class='op'>=&gt;</span> <span class='id session_id'>session_id</span><span class='rbrace'>}</span> <span class='kw'>unless</span> <span class='id option'>option</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>no_hidden</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
    <span class='ivar'>@output_cookies</span> <span class='op'>=</span>  <span class='lbracket'>[</span>
      <span class='const'>Cookie</span><span class='op'>::</span><span class='id new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id session_key'>session_key</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>value</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id session_id'>session_id</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>expires</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id option'>option</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>session_expires</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>domain</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id option'>option</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>session_domain</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>secure</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id option'>option</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>session_secure</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>path</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span>
      <span class='kw'>if</span> <span class='id option'>option</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>session_path</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
        <span class='id option'>option</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>session_path</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
      <span class='kw'>elsif</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SCRIPT_NAME</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
        <span class='const'>File</span><span class='op'>::</span><span class='id dirname'>dirname</span><span class='lparen'>(</span><span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SCRIPT_NAME</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span><span class='rparen'>)</span>
    <span class='rbracket'>]</span> <span class='kw'>unless</span> <span class='id option'>option</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>no_cookies</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='ivar'>@dbprot</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='ivar'>@dbman</span><span class='rbracket'>]</span>
  <span class='const'>ObjectSpace</span><span class='op'>::</span><span class='id define_finalizer'>define_finalizer</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='const'>Session</span><span class='op'>::</span><span class='id callback'>callback</span><span class='lparen'>(</span><span class='ivar'>@dbprot</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <span id="new_session-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="new_session-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>new_session</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The id of this session.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


162
163
164</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cgi/session.rb', line 162</span>

<span class='kw'>def</span> <span class='id new_session'>new_session</span>
  <span class='ivar'>@new_session</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="session_id-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="session_id-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>session_id</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The id of this session.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


162
163
164</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cgi/session.rb', line 162</span>

<span class='kw'>def</span> <span class='id session_id'>session_id</span>
  <span class='ivar'>@session_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="callback-class_method">
  
    + (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>callback</strong>(dbman) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
:nodoc:
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


164
165
166
167
168</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cgi/session.rb', line 164</span>

<span class='kw'>def</span> <span class='const'>Session</span><span class='op'>::</span><span class='id callback'>callback</span><span class='lparen'>(</span><span class='id dbman'>dbman</span><span class='rparen'>)</span>  <span class='comment'>#:nodoc:
</span>  <span class='const'>Proc</span><span class='period'>.</span><span class='id new'>new</span><span class='lbrace'>{</span>
    <span class='id dbman'>dbman</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id close'>close</span> <span class='kw'>unless</span> <span class='id dbman'>dbman</span><span class='period'>.</span><span class='id empty?'>empty?</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="[]-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>[]</strong>(key) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Retrieve the session data for key <tt>key</tt>.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


312
313
314
315</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cgi/session.rb', line 312</span>

<span class='kw'>def</span> <span class='op'>[]</span><span class='lparen'>(</span><span class='id key'>key</span><span class='rparen'>)</span>
  <span class='ivar'>@data</span> <span class='op'>||=</span> <span class='ivar'>@dbman</span><span class='period'>.</span><span class='id restore'>restore</span>
  <span class='ivar'>@data</span><span class='lbracket'>[</span><span class='id key'>key</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="[]=-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>[]=</strong>(key, val) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Set the session date for key <tt>key</tt>.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


318
319
320
321
322</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cgi/session.rb', line 318</span>

<span class='kw'>def</span> <span class='op'>[]=</span><span class='lparen'>(</span><span class='id key'>key</span><span class='comma'>,</span> <span class='id val'>val</span><span class='rparen'>)</span>
  <span class='ivar'>@write_lock</span> <span class='op'>||=</span> <span class='kw'>true</span>
  <span class='ivar'>@data</span> <span class='op'>||=</span> <span class='ivar'>@dbman</span><span class='period'>.</span><span class='id restore'>restore</span>
  <span class='ivar'>@data</span><span class='lbracket'>[</span><span class='id key'>key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id val'>val</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="close-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>close</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Store session data on the server and close the session storage. For some
session storage types, this is a no-op.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


332
333
334
335</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cgi/session.rb', line 332</span>

<span class='kw'>def</span> <span class='id close'>close</span>
  <span class='ivar'>@dbman</span><span class='period'>.</span><span class='id close'>close</span>
  <span class='ivar'>@dbprot</span><span class='period'>.</span><span class='id clear'>clear</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="delete-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>delete</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Delete the session from storage.  Also closes the storage.
</p>
<p>
Note that the session&#8217;s data is <em>not</em> automatically deleted
upon the session expiring.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


341
342
343
344</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cgi/session.rb', line 341</span>

<span class='kw'>def</span> <span class='id delete'>delete</span>
  <span class='ivar'>@dbman</span><span class='period'>.</span><span class='id delete'>delete</span>
  <span class='ivar'>@dbprot</span><span class='period'>.</span><span class='id clear'>clear</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="update-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>update</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Store session data on the server.  For some session storage types, this is
a no-op.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


326
327
328</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/cgi/session.rb', line 326</span>

<span class='kw'>def</span> <span class='id update'>update</span>
  <span class='ivar'>@dbman</span><span class='period'>.</span><span class='id update'>update</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Thu Oct 14 00:02:04 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.1 (ruby-1.9.2).
</div>

  </body>
</html>