  <div id="fileHeader">
    <h1>running_rspec.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>features/step_definitions/running_rspec.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Dec 29 13:11:11 +0100 2008</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>Given /^the file (.*)$/ do |relative_path|
  @path = File.expand_path(File.join(File.dirname(__FILE__), &quot;..&quot;, &quot;support&quot;, relative_path))
  unless File.exist?(@path)
    raise &quot;could not find file at #{@path}&quot;
  end
end

When /^I run it with the (.*)$/ do |interpreter|
  stderr_file = Tempfile.new('rspec')
  stderr_file.close
  @stdout = case(interpreter)
    when /^ruby interpreter/
      args = interpreter.gsub('ruby interpreter','')
      ruby(&quot;#{@path}#{args}&quot;, stderr_file.path)
    when /^spec script/
      args = interpreter.gsub('spec script','')
      spec(&quot;#{@path}#{args}&quot;, stderr_file.path)
    when 'CommandLine object' then cmdline(@path, stderr_file.path)
    else raise &quot;Unknown interpreter: #{interpreter}&quot;
  end
  @stderr = IO.read(stderr_file.path)
  @exit_code = $?.to_i
end

Then /^the (.*) should match (.*)$/ do |stream, string_or_regex|
  written = case(stream)
    when 'stdout' then @stdout
    when 'stderr' then @stderr
    else raise &quot;Unknown stream: #{stream}&quot;
  end
  written.should smart_match(string_or_regex)
end

Then /^the (.*) should not match (.*)$/ do |stream, string_or_regex|
  written = case(stream)
    when 'stdout' then @stdout
    when 'stderr' then @stderr
    else raise &quot;Unknown stream: #{stream}&quot;
  end
  written.should_not smart_match(string_or_regex)
end


Then /^the exit code should be (\d+)$/ do |exit_code|
  if @exit_code != exit_code.to_i
    raise &quot;Did not exit with #{exit_code}, but with #{@exit_code}. Standard error:\n#{@stderr}&quot;
  end
end
</pre>
    </div>