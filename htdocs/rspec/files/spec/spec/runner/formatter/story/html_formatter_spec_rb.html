  <div id="fileHeader">
    <h1>html_formatter_spec.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>spec/spec/runner/formatter/story/html_formatter_spec.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Dec 29 13:11:11 +0100 2008</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require File.dirname(__FILE__) + '/../../../../spec_helper.rb'
require 'spec/runner/formatter/story/html_formatter'

module Spec
  module Runner
    module Formatter
      module Story
        describe HtmlFormatter do
          before :each do
            @out = StringIO.new
            @options = mock('options')
            @reporter = HtmlFormatter.new(@options, @out)
          end
          
          it &quot;should just be poked at&quot; do
            @reporter.run_started(1)
            @reporter.story_started('story_title', 'narrative')

            @reporter.scenario_started('story_title', 'succeeded_scenario_name')
            @reporter.step_succeeded('given', 'succeded_step', 'one', 'two')
            @reporter.scenario_succeeded('story_title', 'succeeded_scenario_name')

            @reporter.scenario_started('story_title', 'pending_scenario_name')
            @reporter.step_pending('when', 'pending_step', 'un', 'deux')
            @reporter.scenario_pending('story_title', 'pending_scenario_name', 'not done')

            @reporter.scenario_started('story_title', 'failed_scenario_name')
            @reporter.step_failed('then', 'failed_step', 'en', 'to')
            @reporter.scenario_failed('story_title', 'failed_scenario_name', NameError.new('sup'))
            
            @reporter.scenario_started('story_title', 'scenario_with_given_scenario_name')
            @reporter.found_scenario('given scenario', 'succeeded_scenario_name')
            
            @reporter.story_ended('story_title', 'narrative')
            @reporter.run_ended
          end
          
          it &quot;should create spans for params&quot; do
            @reporter.step_succeeded('given', 'a $coloured $animal', 'brown', 'dog')
            @reporter.scenario_ended
            @reporter.story_ended('story_title', 'narrative')

            @out.string.should include(&quot;                &lt;li class=\&quot;passed\&quot;&gt;Given a &lt;span class=\&quot;param\&quot;&gt;brown&lt;/span&gt; &lt;span class=\&quot;param\&quot;&gt;dog&lt;/span&gt;&lt;/li&gt;\n&quot;)
          end
          
          it 'should create spanes for params in regexp steps' do
            @reporter.step_succeeded :given, /a (pink|blue) (.*)/, 'brown', 'dog'
            @reporter.scenario_ended
            @reporter.story_ended('story_title', 'narrative')
            
            @out.string.should include(&quot;                &lt;li class=\&quot;passed\&quot;&gt;Given a &lt;span class=\&quot;param\&quot;&gt;brown&lt;/span&gt; &lt;span class=\&quot;param\&quot;&gt;dog&lt;/span&gt;&lt;/li&gt;\n&quot;)
          end

          it &quot;should create a ul for collected_steps&quot; do
            @reporter.collected_steps(['Given a $coloured $animal', 'Given a $n legged eel'])
            @out.string.should == (&lt;&lt;-EOF)
      &lt;ul id=&quot;stock_steps&quot; style=&quot;display: none;&quot;&gt;
        &lt;li&gt;Given a $coloured $animal&lt;/li&gt;
        &lt;li&gt;Given a $n legged eel&lt;/li&gt;
      &lt;/ul&gt;
EOF
          end
          
          it 'should document additional givens using And' do
            # when
            @reporter.step_succeeded :given, 'step 1'
            @reporter.step_succeeded :given, 'step 2'
            @reporter.scenario_ended
            @reporter.story_ended '', ''

            # then
            @out.string.should include(&quot;Given step 1&quot;)
            @out.string.should include(&quot;And step 2&quot;)
          end

          it 'should document additional events using And' do
            # when
            @reporter.step_succeeded :when, 'step 1'
            @reporter.step_succeeded :when, 'step 2'
            @reporter.scenario_ended
            @reporter.story_ended '', ''

            # then
            @out.string.should include(&quot;When step 1&quot;)
            @out.string.should include(&quot;And step 2&quot;)
          end

          it 'should document additional outcomes using And' do
            # when
            @reporter.step_succeeded :then, 'step 1'
            @reporter.step_succeeded :then, 'step 2'
            @reporter.scenario_ended
            @reporter.story_ended '', ''

            # then
            @out.string.should include(&quot;Then step 1&quot;)
            @out.string.should include(&quot;And step 2&quot;)
          end

          it 'should document a GivenScenario followed by a Given using And' do
            # when
            @reporter.step_succeeded :'given scenario', 'a scenario'
            @reporter.step_succeeded :given, 'a context'
            @reporter.scenario_ended
            @reporter.story_ended '', ''

            # then
            @out.string.should include(&quot;Given scenario a scenario&quot;)
            @out.string.should include(&quot;And a context&quot;)
          end
          
          it &quot;should create a failed story if one of its scenarios fails&quot; do
              @reporter.story_started('story_title', 'narrative')
              @reporter.scenario_started('story_title', 'succeeded_scenario_name')
              @reporter.step_failed('then', 'failed_step', 'en', 'to')
              @reporter.scenario_failed('story_title', 'failed_scenario_name', NameError.new('sup'))
              @reporter.story_ended('story_title', 'narrative')
            
              @out.string.should include(&quot;      &lt;dl class=\&quot;story failed\&quot;&gt;\n        &lt;dt&gt;Story: story_title&lt;/dt&gt;\n&quot;)
          end
          
          it &quot;should create a failed scenario if one of its steps fails&quot; do
            @reporter.scenario_started('story_title', 'failed_scenario_name')
            @reporter.step_failed('then', 'failed_step', 'en', 'to')
            @reporter.scenario_failed('story_title', 'failed_scenario_name', NameError.new('sup'))
            @reporter.story_ended('story_title', 'narrative')
          
            @out.string.should include(&quot;&lt;dl class=\&quot;failed\&quot;&gt;\n              &lt;dt&gt;Scenario: failed_scenario_name&lt;/dt&gt;\n&quot;)
          end
          
        end
      end
    end
  end
end</pre>
    </div>