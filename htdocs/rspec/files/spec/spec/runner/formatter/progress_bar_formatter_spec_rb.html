  <div id="fileHeader">
    <h1>progress_bar_formatter_spec.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>spec/spec/runner/formatter/progress_bar_formatter_spec.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Dec 29 13:11:11 +0100 2008</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require File.dirname(__FILE__) + '/../../../spec_helper.rb'
require 'spec/runner/formatter/progress_bar_formatter'

module Spec
  module Runner
    module Formatter
      describe ProgressBarFormatter do
        before(:each) do
          @io = StringIO.new
          @options = mock('options')
          @options.stub!(:dry_run).and_return(false)
          @options.stub!(:colour).and_return(false)
          @formatter = ProgressBarFormatter.new(@options, @io)
        end

        it &quot;should produce line break on start dump&quot; do
          @formatter.start_dump
          @io.string.should eql(&quot;\n&quot;)
        end

        it &quot;should produce standard summary without pending when pending has a 0 count&quot; do
          @formatter.dump_summary(3, 2, 1, 0)
          @io.string.should eql(&quot;\nFinished in 3 seconds\n\n2 examples, 1 failure\n&quot;)
        end
        
        it &quot;should produce standard summary&quot; do
          example_group = ExampleGroup.describe(&quot;example_group&quot;) do
            specify &quot;example&quot; do
            end
          end
          example = example_group.examples.first
          @formatter.example_pending(example, &quot;message&quot;, &quot;#{__FILE__}:#{__LINE__}&quot;)
          @io.rewind
          @formatter.dump_summary(3, 2, 1, 1)
          @io.string.should eql(%Q|
Finished in 3 seconds

2 examples, 1 failure, 1 pending
|)
        end

        it &quot;should push green dot for passing spec&quot; do
          @io.should_receive(:tty?).and_return(true)
          @options.should_receive(:colour).and_return(true)
          @formatter.example_passed(&quot;spec&quot;)
          @io.string.should == &quot;\e[32m.\e[0m&quot;
        end

        it &quot;should push red F for failure spec&quot; do
          @io.should_receive(:tty?).and_return(true)
          @options.should_receive(:colour).and_return(true)
          @formatter.example_failed(&quot;spec&quot;, 98, Reporter::Failure.new(&quot;c s&quot;, Spec::Expectations::ExpectationNotMetError.new))
          @io.string.should eql(&quot;\e[31mF\e[0m&quot;)
        end

        it &quot;should push magenta F for error spec&quot; do
          @io.should_receive(:tty?).and_return(true)
          @options.should_receive(:colour).and_return(true)
          @formatter.example_failed(&quot;spec&quot;, 98, Reporter::Failure.new(&quot;c s&quot;, RuntimeError.new))
          @io.string.should eql(&quot;\e[35mF\e[0m&quot;)
        end

        it &quot;should push blue F for fixed pending spec&quot; do
          @io.should_receive(:tty?).and_return(true)
          @options.should_receive(:colour).and_return(true)
          @formatter.example_failed(&quot;spec&quot;, 98, Reporter::Failure.new(&quot;c s&quot;, Spec::Example::PendingExampleFixedError.new))
          @io.string.should eql(&quot;\e[34mF\e[0m&quot;)
        end

        it &quot;should push nothing on start&quot; do
          @formatter.start(4)
          @io.string.should eql(&quot;&quot;)
        end

        it &quot;should ensure two ':' in the first backtrace&quot; do
          backtrace = [&quot;/tmp/x.rb:1&quot;, &quot;/tmp/x.rb:2&quot;, &quot;/tmp/x.rb:3&quot;]
          @formatter.format_backtrace(backtrace).should eql(&lt;&lt;-EOE.rstrip)
/tmp/x.rb:1:
/tmp/x.rb:2:
/tmp/x.rb:3:
EOE

          backtrace = [&quot;/tmp/x.rb:1: message&quot;, &quot;/tmp/x.rb:2&quot;, &quot;/tmp/x.rb:3&quot;]
          @formatter.format_backtrace(backtrace).should eql(&lt;&lt;-EOE.rstrip)
/tmp/x.rb:1: message
/tmp/x.rb:2:
/tmp/x.rb:3:
EOE
        end
        
        it &quot;should dump pending with file and line number&quot; do
          example_group = ExampleGroup.describe(&quot;example_group&quot;) do
            specify &quot;example&quot; do
            end
          end
          example = example_group.examples.first
          file = __FILE__
          line = __LINE__ + 1
          @formatter.example_pending(example, &quot;message&quot;, &quot;#{__FILE__}:#{__LINE__}&quot;)
          @formatter.dump_pending
          @io.string.should ==(&lt;&lt;-HERE)
*
Pending:

example_group example (message)
#{file}:#{line}
HERE
        end
      end
      
      describe &quot;ProgressBarFormatter outputting to custom out&quot; do
        before(:each) do
          @out = mock(&quot;out&quot;)
          @options = mock('options')
          @out.stub!(:puts)
          @formatter = ProgressBarFormatter.new(@options, @out)
          @formatter.class.__send__ :public, :output_to_tty?
        end

        after(:each) do
          @formatter.class.__send__ :protected, :output_to_tty?
        end

        it &quot;should not throw NoMethodError on output_to_tty?&quot; do
          @out.should_receive(:tty?).and_raise(NoMethodError)
          @formatter.output_to_tty?.should be_false
        end
      end

      describe ProgressBarFormatter, &quot;dry run&quot; do
        before(:each) do
          @io = StringIO.new
          options = mock('options')
          options.stub!(:dry_run).and_return(true)
          @formatter = ProgressBarFormatter.new(options, @io)
        end
      
        it &quot;should not produce summary on dry run&quot; do
          @formatter.dump_summary(3, 2, 1, 0)
          @io.string.should eql(&quot;&quot;)
        end
      end
    end
  end
end
</pre>
    </div>