  <div id="fileHeader">
    <h1>specdoc_formatter_spec.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>spec/spec/runner/formatter/specdoc_formatter_spec.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Dec 29 13:11:11 +0100 2008</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require File.dirname(__FILE__) + '/../../../spec_helper.rb'
require 'spec/runner/formatter/specdoc_formatter'

module Spec
  module Runner
    module Formatter
      describe SpecdocFormatter do
        with_sandboxed_options do
          attr_reader :io, :formatter, :example_group
          before(:each) do
            @io = StringIO.new
            options.stub!(:dry_run).and_return(false)
            options.stub!(:colour).and_return(false)
            @formatter = SpecdocFormatter.new(options, io)
            @example_group = ::Spec::Example::ExampleGroup.describe(&quot;ExampleGroup&quot;) do
              specify &quot;example&quot; do
              end
            end
          end

          describe &quot;where ExampleGroup has no superclasss with a description&quot; do
            before do
              add_example_group
            end

            def add_example_group
              formatter.add_example_group(example_group)
            end

            describe &quot;#dump_summary&quot; do
              it &quot;should produce standard summary without pending when pending has a 0 count&quot; do
                formatter.dump_summary(3, 2, 1, 0)
                io.string.should have_example_group_output(&quot;\nFinished in 3 seconds\n\n2 examples, 1 failure\n&quot;)
              end

              it &quot;should produce standard summary&quot; do
                formatter.dump_summary(3, 2, 1, 4)
                io.string.should have_example_group_output(&quot;\nFinished in 3 seconds\n\n2 examples, 1 failure, 4 pending\n&quot;)
              end
            end

            describe &quot;#add_example_group&quot; do
              it &quot;should push ExampleGroup name&quot; do
                io.string.should eql(&quot;\nExampleGroup\n&quot;)
              end
            end

            describe &quot;#example_failed&quot; do
              describe &quot;where ExampleGroup has no superclasss with a description&quot; do
                describe &quot;when having an error&quot; do
                  it &quot;should push failing spec name and failure number&quot; do
                    formatter.example_failed(
                      example_group.it(&quot;spec&quot;),
                      98,
                      Reporter::Failure.new(&quot;c s&quot;, RuntimeError.new)
                    )
                    io.string.should have_example_group_output(&quot;- spec (ERROR - 98)\n&quot;)
                  end
                end

                describe &quot;when having an expectation failure&quot; do
                  it &quot;should push failing spec name and failure number&quot; do
                    formatter.example_failed(
                      example_group.it(&quot;spec&quot;),
                      98,
                      Reporter::Failure.new(&quot;c s&quot;, Spec::Expectations::ExpectationNotMetError.new)
                    )
                    io.string.should have_example_group_output(&quot;- spec (FAILED - 98)\n&quot;)
                  end
                end
              end

              describe &quot;where ExampleGroup has two superclasses with a description&quot; do
                attr_reader :child_example_group, :grand_child_example_group
              
                def add_example_group
                  @child_example_group = Class.new(example_group).describe(&quot;Child ExampleGroup&quot;)
                  @grand_child_example_group = Class.new(child_example_group).describe(&quot;GrandChild ExampleGroup&quot;)
                  formatter.add_example_group(grand_child_example_group)
                end

                describe &quot;when having an error&quot; do
                  it &quot;should push failing spec name and failure number&quot; do
                    formatter.example_failed(
                    example_group.it(&quot;spec&quot;),
                    98,
                    Reporter::Failure.new(&quot;c s&quot;, RuntimeError.new)
                    )
                    io.string.should have_nested_example_group_output(&quot;- spec (ERROR - 98)\n&quot;)
                  end
                end

                describe &quot;when having an expectation&quot; do
                  it &quot;should push failing spec name and failure number&quot; do
                    formatter.example_failed(
                      example_group.it(&quot;spec&quot;),
                      98,
                      Reporter::Failure.new(&quot;c s&quot;, Spec::Expectations::ExpectationNotMetError.new)
                    )
                    io.string.should have_nested_example_group_output(&quot;- spec (FAILED - 98)\n&quot;)
                  end
                end

                def have_nested_example_group_output(expected_output)
                  expected_full_output = &quot;\nExampleGroup Child ExampleGroup GrandChild ExampleGroup\n#{expected_output}&quot;
                  ::Spec::Matchers::SimpleMatcher.new(expected_full_output) do |actual|
                    actual == expected_full_output
                  end
                end
              end
            end

            describe &quot;#start&quot; do
              it &quot;should push nothing on start&quot; do
                formatter.start(5)
                io.string.should have_example_group_output(&quot;&quot;)
              end
            end
          
            describe &quot;#start_dump&quot; do
              it &quot;should push nothing on start dump&quot; do
                formatter.start_dump
                io.string.should have_example_group_output(&quot;&quot;)
              end
            end

            describe &quot;#example_passed&quot; do
              it &quot;should push passing spec name&quot; do
                formatter.example_passed(example_group.it(&quot;spec&quot;))
                io.string.should have_example_group_output(&quot;- spec\n&quot;)
              end
            end

            describe &quot;#example_pending&quot; do
              it &quot;should push pending example name and message&quot; do
                formatter.example_pending(example_group.examples.first, 'reason', &quot;#{__FILE__}:#{__LINE__}&quot;)
                io.string.should have_example_group_output(&quot;- example (PENDING: reason)\n&quot;)
              end

              it &quot;should dump pending&quot; do
                formatter.example_pending(example_group.examples.first, 'reason', &quot;#{__FILE__}:#{__LINE__}&quot;)
                io.rewind
                formatter.dump_pending
                io.string.should =~ /Pending\:\n\nExampleGroup example \(reason\)\n/
              end
            end

            def have_example_group_output(expected_output)
              expected = &quot;\nExampleGroup\n#{expected_output}&quot;
              ::Spec::Matchers::SimpleMatcher.new(expected) do |actual|
                actual == expected
              end
            end
          end
        end
      end
    end
  end
end
</pre>
    </div>