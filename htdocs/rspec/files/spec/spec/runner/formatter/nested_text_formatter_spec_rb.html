  <div id="fileHeader">
    <h1>nested_text_formatter_spec.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>spec/spec/runner/formatter/nested_text_formatter_spec.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Dec 29 13:11:11 +0100 2008</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require File.dirname(__FILE__) + '/../../../spec_helper.rb'
require 'spec/runner/formatter/nested_text_formatter'

module Spec
  module Runner
    module Formatter
      describe NestedTextFormatter do
        with_sandboxed_options do
          attr_reader :io, :options, :formatter, :example_group
          before(:each) do
            @io = StringIO.new
            options.stub!(:dry_run).and_return(false)
            options.stub!(:colour).and_return(false)
            @formatter = NestedTextFormatter.new(options, io)
            @example_group = ::Spec::Example::ExampleGroup.describe(&quot;ExampleGroup&quot;) do
              specify &quot;example&quot; do
              end
            end
          end

          describe &quot;where ExampleGroup has no superclasss with a description&quot; do
            before do
              add_example_group
            end

            def add_example_group
              formatter.add_example_group(example_group)
            end

            describe &quot;#dump_summary&quot; do
              it &quot;should produce standard summary without pending when pending has a 0 count&quot; do
                formatter.dump_summary(3, 2, 1, 0)
                io.string.should == &lt;&lt;-OUT
ExampleGroup

Finished in 3 seconds

2 examples, 1 failure
OUT
              end

              it &quot;should produce standard summary&quot; do
                formatter.dump_summary(3, 2, 1, 4)
                io.string.should == &lt;&lt;-OUT
ExampleGroup

Finished in 3 seconds

2 examples, 1 failure, 4 pending
OUT
              end
            end

            describe &quot;#add_example_group&quot; do
              describe &quot;when ExampleGroup has description_args&quot; do
                before do
                  example_group.description_args.should_not be_nil
                end

                describe &quot;when ExampleGroup has no parents with description args&quot; do
                  before do
                    example_group.superclass.description_args.should be_empty
                  end

                  it &quot;should push ExampleGroup name&quot; do
                    io.string.should eql(&quot;ExampleGroup\n&quot;)
                  end
                end

                describe &quot;when ExampleGroup has one parent with description args&quot; do
                  attr_reader :child_example_group
                  def add_example_group
                    example_group.description_args.should_not be_nil
                    @child_example_group = Class.new(example_group).describe(&quot;Child ExampleGroup&quot;)
                  end

                  describe &quot;and parent ExampleGroups have not been printed&quot; do
                    before do
                      formatter.add_example_group(child_example_group)
                    end

                    it &quot;should push ExampleGroup name with two spaces of indentation&quot; do
                      io.string.should == &lt;&lt;-OUT
ExampleGroup
  Child ExampleGroup
OUT
                    end
                  end

                  describe &quot;and parent ExampleGroups have been printed&quot; do
                    before do
                      formatter.add_example_group(example_group)
                      io.string = &quot;&quot;
                      formatter.add_example_group(child_example_group)
                    end

                    it &quot;should print only the indented ExampleGroup&quot; do
                      io.string.should == &lt;&lt;-OUT
  Child ExampleGroup
OUT
                    end
                  end
                end

                describe &quot;when ExampleGroup has two parents with description args&quot; do
                  attr_reader :child_example_group, :grand_child_example_group
                  def add_example_group
                    example_group.description_args.should_not be_nil
                    @child_example_group = Class.new(example_group).describe(&quot;Child ExampleGroup&quot;)
                    @grand_child_example_group = Class.new(child_example_group).describe(&quot;GrandChild ExampleGroup&quot;)
                  end

                  describe &quot;and parent ExampleGroups have not been printed&quot; do
                    before do
                      formatter.add_example_group(grand_child_example_group)
                    end

                    it &quot;should print the entire nested ExampleGroup heirarchy&quot; do
                      io.string.should == &lt;&lt;-OUT
ExampleGroup
  Child ExampleGroup
    GrandChild ExampleGroup
OUT
                    end
                  end

                  describe &quot;and parent ExampleGroups have been printed&quot; do
                    before do
                      formatter.add_example_group(child_example_group)
                      io.string = &quot;&quot;
                      formatter.add_example_group(grand_child_example_group)
                    end

                    it &quot;should print only the indented ExampleGroup&quot; do
                      io.string.should == &lt;&lt;-OUT
    GrandChild ExampleGroup
OUT
                    end
                  end
                end
              end

              describe &quot;when ExampleGroup description_args is nil&quot; do
                attr_reader :child_example_group

                describe &quot;and parent ExampleGroups have not been printed&quot; do
                  def add_example_group
                    @child_example_group = Class.new(example_group)
                    child_example_group.description_args.should be_empty
                    formatter.add_example_group(child_example_group)
                  end

                  it &quot;should render only the parent ExampleGroup&quot; do
                    io.string.should == &lt;&lt;-OUT
ExampleGroup
OUT
                  end
                end

                describe &quot;and parent ExampleGroups have been printed&quot; do
                  def add_example_group
                    @child_example_group = Class.new(example_group)
                    child_example_group.description_args.should be_empty
                    formatter.add_example_group(example_group)
                    io.string = &quot;&quot;
                    formatter.add_example_group(child_example_group)
                  end

                  it &quot;should not render anything&quot; do
                    io.string.should == &quot;&quot;
                  end
                end
              end

              describe &quot;when ExampleGroup description_args is empty&quot; do
                def add_example_group
                  example_group.set_description
                  example_group.description_args.should be_empty
                  super
                end

                it &quot;should not render anything&quot; do
                  io.string.should == &quot;&quot;
                end
              end
            end

            describe &quot;#example_failed&quot; do
              describe &quot;where ExampleGroup has no superclasss with a description&quot; do
                describe &quot;when having an error&quot; do
                  it &quot;should push failing spec name and failure number&quot; do
                    formatter.example_failed(
                      example_group.it(&quot;spec&quot;),
                      98,
                      Reporter::Failure.new(&quot;c s&quot;, RuntimeError.new)
                    )
                    io.string.should == &lt;&lt;-OUT
ExampleGroup
  spec (ERROR - 98)
OUT
                  end
                end

                describe &quot;when having an expectation failure&quot; do
                  it &quot;should push failing spec name and failure number&quot; do
                    formatter.example_failed(
                      example_group.it(&quot;spec&quot;),
                      98,
                      Reporter::Failure.new(&quot;c s&quot;, Spec::Expectations::ExpectationNotMetError.new)
                    )
                    io.string.should == &lt;&lt;-OUT
ExampleGroup
  spec (FAILED - 98)
OUT
                  end
                end
              end

              describe &quot;where ExampleGroup has two superclasses with a description&quot; do
                attr_reader :child_example_group, :grand_child_example_group

                def add_example_group
                  @child_example_group = Class.new(example_group).describe(&quot;Child ExampleGroup&quot;)
                  @grand_child_example_group = Class.new(child_example_group).describe(&quot;GrandChild ExampleGroup&quot;)
                  formatter.add_example_group(grand_child_example_group)
                end

                describe &quot;when having an error&quot; do
                  it &quot;should push failing spec name and failure number&quot; do
                    formatter.example_failed(
                      grand_child_example_group.it(&quot;spec&quot;),
                      98,
                      Reporter::Failure.new(&quot;c s&quot;, RuntimeError.new)
                    )
                    io.string.should == &lt;&lt;-OUT
ExampleGroup
  Child ExampleGroup
    GrandChild ExampleGroup
      spec (ERROR - 98)
OUT
                  end
                end

                describe &quot;when having an expectation&quot; do
                  it &quot;should push failing spec name and failure number&quot; do
                    formatter.example_failed(
                      grand_child_example_group.it(&quot;spec&quot;),
                      98,
                      Reporter::Failure.new(&quot;c s&quot;, Spec::Expectations::ExpectationNotMetError.new)
                    )
                    io.string.should == &lt;&lt;-OUT
ExampleGroup
  Child ExampleGroup
    GrandChild ExampleGroup
      spec (FAILED - 98)
OUT
                  end
                end
              end
            end

            describe &quot;#start&quot; do
              it &quot;should push nothing on start&quot; do
                formatter.start(5)
                io.string.should == &lt;&lt;-OUT
ExampleGroup
OUT
              end
            end

            describe &quot;#start_dump&quot; do
              it &quot;should push nothing on start dump&quot; do
                formatter.start_dump
                io.string.should == &lt;&lt;-OUT
ExampleGroup
OUT
              end
            end

            describe &quot;#example_passed&quot; do
              it &quot;should push passing spec name&quot; do
                formatter.example_passed(example_group.it(&quot;spec&quot;))
                io.string.should == &lt;&lt;-OUT
ExampleGroup
  spec
OUT
              end
            end

            describe &quot;#example_pending&quot; do
              it &quot;should push pending example name and message&quot; do
                formatter.example_pending(example_group.examples.first, 'reason', &quot;#{__FILE__}:#{__LINE__}&quot;)
                io.string.should == &lt;&lt;-OUT
ExampleGroup
  example (PENDING: reason)
OUT
              end

              it &quot;should dump pending&quot; do
                formatter.example_pending(example_group.examples.first, 'reason', &quot;#{__FILE__}:#{__LINE__}&quot;)
                io.rewind
                formatter.dump_pending
                io.string.should =~ /Pending\:\n\nExampleGroup example \(reason\)\n/
              end
            end

            def have_single_level_example_group_output(expected_output)
              expected = &quot;ExampleGroup\n  #{expected_output}&quot;
              ::Spec::Matchers::SimpleMatcher.new(expected) do |actual|
                actual == expected
              end
            end
          end
        end
      end
    end
  end
end</pre>
    </div>