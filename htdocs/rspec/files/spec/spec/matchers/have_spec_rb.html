  <div id="fileHeader">
    <h1>have_spec.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>spec/spec/matchers/have_spec.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Dec 29 13:11:11 +0100 2008</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require File.dirname(__FILE__) + '/../../spec_helper.rb'

share_as :HaveSpecHelper do
  def create_collection_owner_with(n)
    owner = Spec::Expectations::Helper::CollectionOwner.new
    (1..n).each do |n|
      owner.add_to_collection_with_length_method(n)
      owner.add_to_collection_with_size_method(n)
    end
    owner
  end
  before(:each) do
    unless defined?(ActiveSupport::Inflector)
      @active_support_was_not_defined
      module ActiveSupport
        class Inflector
          def self.pluralize(string)
            string.to_s + 's'
          end
        end
      end
    end
  end
end


describe &quot;should have(n).items&quot; do
  include HaveSpecHelper

  it &quot;should pass if target has a collection of items with n members&quot; do
    owner = create_collection_owner_with(3)
    owner.should have(3).items_in_collection_with_length_method
    owner.should have(3).items_in_collection_with_size_method
  end

  it &quot;should convert :no to 0&quot; do
    owner = create_collection_owner_with(0)
    owner.should have(:no).items_in_collection_with_length_method
    owner.should have(:no).items_in_collection_with_size_method
  end

  it &quot;should fail if target has a collection of items with &lt; n members&quot; do
    owner = create_collection_owner_with(3)
    lambda {
      owner.should have(4).items_in_collection_with_length_method
    }.should fail_with(&quot;expected 4 items_in_collection_with_length_method, got 3&quot;)
    lambda {
      owner.should have(4).items_in_collection_with_size_method
    }.should fail_with(&quot;expected 4 items_in_collection_with_size_method, got 3&quot;)
  end
  
  it &quot;should fail if target has a collection of items with &gt; n members&quot; do
    owner = create_collection_owner_with(3)
    lambda {
      owner.should have(2).items_in_collection_with_length_method
    }.should fail_with(&quot;expected 2 items_in_collection_with_length_method, got 3&quot;)
    lambda {
      owner.should have(2).items_in_collection_with_size_method
    }.should fail_with(&quot;expected 2 items_in_collection_with_size_method, got 3&quot;)
  end
end

describe 'should have(1).item when ActiveSupport::Inflector is defined' do
  include HaveSpecHelper
  
  it 'should pluralize the collection name' do
    owner = create_collection_owner_with(1)
    owner.should have(1).item
  end
  
  after(:each) do
    if @active_support_was_not_defined
      Object.__send__ :remove_const, :ActiveSupport
    end
  end
end

describe 'should have(1).item when Inflector is defined' do
  include HaveSpecHelper
  
  before(:each) do
    unless defined?(Inflector)
      @inflector_was_not_defined
      class Inflector
        def self.pluralize(string)
          string.to_s + 's'
        end
      end
    end
  end
  
  it 'should pluralize the collection name' do
    owner = create_collection_owner_with(1)
    owner.should have(1).item
  end

  after(:each) do
    if @inflector_was_not_defined
      Object.__send__ :remove_const, :Inflector
    end
  end
end

describe &quot;should have(n).items where result responds to items but returns something other than a collection&quot; do
  it &quot;should provide a meaningful error&quot; do
    owner = Class.new do
      def items
        Object.new
      end
    end.new
    lambda do
      owner.should have(3).items
    end.should raise_error(&quot;expected items to be a collection but it does not respond to #length or #size&quot;)
  end
end

describe &quot;should_not have(n).items&quot; do
  include HaveSpecHelper

  it &quot;should pass if target has a collection of items with &lt; n members&quot; do
    owner = create_collection_owner_with(3)
    owner.should_not have(4).items_in_collection_with_length_method
    owner.should_not have(4).items_in_collection_with_size_method
  end
  
  it &quot;should pass if target has a collection of items with &gt; n members&quot; do
    owner = create_collection_owner_with(3)
    owner.should_not have(2).items_in_collection_with_length_method
    owner.should_not have(2).items_in_collection_with_size_method
  end

  it &quot;should fail if target has a collection of items with n members&quot; do
    owner = create_collection_owner_with(3)
    lambda {
      owner.should_not have(3).items_in_collection_with_length_method
    }.should fail_with(&quot;expected target not to have 3 items_in_collection_with_length_method, got 3&quot;)
    lambda {
      owner.should_not have(3).items_in_collection_with_size_method
      }.should fail_with(&quot;expected target not to have 3 items_in_collection_with_size_method, got 3&quot;)
  end
end

describe &quot;should have_exactly(n).items&quot; do
  include HaveSpecHelper

  it &quot;should pass if target has a collection of items with n members&quot; do
    owner = create_collection_owner_with(3)
    owner.should have_exactly(3).items_in_collection_with_length_method
    owner.should have_exactly(3).items_in_collection_with_size_method
  end

  it &quot;should convert :no to 0&quot; do
    owner = create_collection_owner_with(0)
    owner.should have_exactly(:no).items_in_collection_with_length_method
    owner.should have_exactly(:no).items_in_collection_with_size_method
  end

  it &quot;should fail if target has a collection of items with &lt; n members&quot; do
    owner = create_collection_owner_with(3)
    lambda {
      owner.should have_exactly(4).items_in_collection_with_length_method
    }.should fail_with(&quot;expected 4 items_in_collection_with_length_method, got 3&quot;)
    lambda {
      owner.should have_exactly(4).items_in_collection_with_size_method
    }.should fail_with(&quot;expected 4 items_in_collection_with_size_method, got 3&quot;)
  end
  
  it &quot;should fail if target has a collection of items with &gt; n members&quot; do
    owner = create_collection_owner_with(3)
    lambda {
      owner.should have_exactly(2).items_in_collection_with_length_method
    }.should fail_with(&quot;expected 2 items_in_collection_with_length_method, got 3&quot;)
    lambda {
      owner.should have_exactly(2).items_in_collection_with_size_method
    }.should fail_with(&quot;expected 2 items_in_collection_with_size_method, got 3&quot;)
  end
end

describe &quot;should have_at_least(n).items&quot; do
  include HaveSpecHelper

  it &quot;should pass if target has a collection of items with n members&quot; do
    owner = create_collection_owner_with(3)
    owner.should have_at_least(3).items_in_collection_with_length_method
    owner.should have_at_least(3).items_in_collection_with_size_method
  end
  
  it &quot;should pass if target has a collection of items with &gt; n members&quot; do
    owner = create_collection_owner_with(3)
    owner.should have_at_least(2).items_in_collection_with_length_method
    owner.should have_at_least(2).items_in_collection_with_size_method
  end

  it &quot;should fail if target has a collection of items with &lt; n members&quot; do
    owner = create_collection_owner_with(3)
    lambda {
      owner.should have_at_least(4).items_in_collection_with_length_method
    }.should fail_with(&quot;expected at least 4 items_in_collection_with_length_method, got 3&quot;)
    lambda {
      owner.should have_at_least(4).items_in_collection_with_size_method
    }.should fail_with(&quot;expected at least 4 items_in_collection_with_size_method, got 3&quot;)
  end
  
  it &quot;should provide educational negative failure messages&quot; do
    #given
    owner = create_collection_owner_with(3)
    length_matcher = have_at_least(3).items_in_collection_with_length_method
    size_matcher = have_at_least(3).items_in_collection_with_size_method
    
    #when
    length_matcher.matches?(owner)
    size_matcher.matches?(owner)
    
    #then
    length_matcher.negative_failure_message.should == &lt;&lt;-EOF
Isn't life confusing enough?
Instead of having to figure out the meaning of this:
  should_not have_at_least(3).items_in_collection_with_length_method
We recommend that you use this instead:
  should have_at_most(2).items_in_collection_with_length_method
EOF

    size_matcher.negative_failure_message.should == &lt;&lt;-EOF
Isn't life confusing enough?
Instead of having to figure out the meaning of this:
  should_not have_at_least(3).items_in_collection_with_size_method
We recommend that you use this instead:
  should have_at_most(2).items_in_collection_with_size_method
EOF
  end
end

describe &quot;should have_at_most(n).items&quot; do
  include HaveSpecHelper

  it &quot;should pass if target has a collection of items with n members&quot; do
    owner = create_collection_owner_with(3)
    owner.should have_at_most(3).items_in_collection_with_length_method
    owner.should have_at_most(3).items_in_collection_with_size_method
  end

  it &quot;should fail if target has a collection of items with &gt; n members&quot; do
    owner = create_collection_owner_with(3)
    lambda {
      owner.should have_at_most(2).items_in_collection_with_length_method
    }.should fail_with(&quot;expected at most 2 items_in_collection_with_length_method, got 3&quot;)
    lambda {
      owner.should have_at_most(2).items_in_collection_with_size_method
    }.should fail_with(&quot;expected at most 2 items_in_collection_with_size_method, got 3&quot;)
  end
  
  it &quot;should pass if target has a collection of items with &lt; n members&quot; do
    owner = create_collection_owner_with(3)
    owner.should have_at_most(4).items_in_collection_with_length_method
    owner.should have_at_most(4).items_in_collection_with_size_method
  end

  it &quot;should provide educational negative failure messages&quot; do
    #given
    owner = create_collection_owner_with(3)
    length_matcher = have_at_most(3).items_in_collection_with_length_method
    size_matcher = have_at_most(3).items_in_collection_with_size_method
    
    #when
    length_matcher.matches?(owner)
    size_matcher.matches?(owner)
    
    #then
    length_matcher.negative_failure_message.should == &lt;&lt;-EOF
Isn't life confusing enough?
Instead of having to figure out the meaning of this:
  should_not have_at_most(3).items_in_collection_with_length_method
We recommend that you use this instead:
  should have_at_least(4).items_in_collection_with_length_method
EOF
    
    size_matcher.negative_failure_message.should == &lt;&lt;-EOF
Isn't life confusing enough?
Instead of having to figure out the meaning of this:
  should_not have_at_most(3).items_in_collection_with_size_method
We recommend that you use this instead:
  should have_at_least(4).items_in_collection_with_size_method
EOF
  end
end

describe &quot;have(n).items(args, block)&quot; do
  it &quot;should pass args to target&quot; do
    target = mock(&quot;target&quot;)
    target.should_receive(:items).with(&quot;arg1&quot;,&quot;arg2&quot;).and_return([1,2,3])
    target.should have(3).items(&quot;arg1&quot;,&quot;arg2&quot;)
  end

  it &quot;should pass block to target&quot; do
    target = mock(&quot;target&quot;)
    block = lambda { 5 }
    target.should_receive(:items).with(&quot;arg1&quot;,&quot;arg2&quot;, block).and_return([1,2,3])
    target.should have(3).items(&quot;arg1&quot;,&quot;arg2&quot;, block)
  end
end

describe &quot;have(n).items where target IS a collection&quot; do
  it &quot;should reference the number of items IN the collection&quot; do
    [1,2,3].should have(3).items
  end

  it &quot;should fail when the number of items IN the collection is not as expected&quot; do
    lambda { [1,2,3].should have(7).items }.should fail_with(&quot;expected 7 items, got 3&quot;)
  end
end

describe &quot;have(n).characters where target IS a String&quot; do
  it &quot;should pass if the length is correct&quot; do
    &quot;this string&quot;.should have(11).characters
  end

  it &quot;should fail if the length is incorrect&quot; do
    lambda { &quot;this string&quot;.should have(12).characters }.should fail_with(&quot;expected 12 characters, got 11&quot;)
  end
end

describe &quot;have(n).things on an object which is not a collection nor contains one&quot; do
  it &quot;should fail&quot; do
    lambda { Object.new.should have(2).things }.should raise_error(NoMethodError, /undefined method `things' for #&lt;Object:/)
  end
end

describe Spec::Matchers::Have, &quot;for a collection owner that implements #send&quot; do
  include HaveSpecHelper
  
  before(:each) do
    @collection = Object.new
    def @collection.floozles; [1,2] end
    def @collection.send(*args); raise &quot;DOH! Library developers shouldn't use #send!&quot; end
  end
  
  it &quot;should work in the straightforward case&quot; do
    lambda {
      @collection.should have(2).floozles
    }.should_not raise_error
  end

  it &quot;should work when doing automatic pluralization&quot; do
    lambda {
      @collection.should have_at_least(1).floozle
    }.should_not raise_error
  end

  it &quot;should blow up when the owner doesn't respond to that method&quot; do
    lambda {
      @collection.should have(99).problems
    }.should raise_error(NoMethodError, /problems/)
  end
end

module Spec
  module Matchers
    describe Have do
      it &quot;should have method_missing as private&quot; do
        with_ruby '1.8' do
          Have.private_instance_methods.should include(&quot;method_missing&quot;)
        end
        with_ruby '1.9' do
          Have.private_instance_methods.should include(:method_missing)
        end
      end
      
      describe &quot;respond_to?&quot; do
        before :each do
          @have = Have.new(:foo)
          @a_method_which_have_defines = Have.instance_methods.first
          @a_method_which_object_defines = Object.instance_methods.first
        end
        
        it &quot;should be true for a method which Have defines&quot; do
          @have.should respond_to(@a_method_which_have_defines)
        end
        
        it &quot;should be true for a method that it's superclass (Object) defines&quot; do
          @have.should respond_to(@a_method_which_object_defines)
        end
        
        it &quot;should be false for a method which neither Object nor nor Have defines&quot; do
          @have.should_not respond_to(:foo_bar_baz)
        end
        
        it &quot;should be false if the owner doesn't respond to the method&quot; do
          have = Have.new(99)
          have.should_not respond_to(:problems)
        end
        
        it &quot;should be true if the owner responds to the method&quot; do
          have = Have.new(:a_symbol)
          have.should respond_to(:to_sym)
        end
      end
    end
  end
end
</pre>
    </div>