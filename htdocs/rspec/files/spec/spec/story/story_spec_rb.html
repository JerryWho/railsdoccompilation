  <div id="fileHeader">
    <h1>story_spec.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>spec/spec/story/story_spec.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Dec 29 13:11:11 +0100 2008</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require File.dirname(__FILE__) + '/story_helper'

module Spec
  module Story
    describe Story do
      it 'should run itself in a given object' do
        # given
        $instance = nil
        story = Story.new 'title', 'narrative' do
          $instance = self
        end
        object = Object.new
        
        # when
        story.run_in(object)
        
        # then
        $instance.should be(object)
      end
      
      it 'should not raise an error if no block is supplied' do
        # when
        error = exception_from { Story.new 'title', 'narrative' }
        
        # then
        error.should be_nil
      end
      
      it &quot;should raise an error when an error is raised running in another object&quot; do
        #given
        story = Story.new 'title', 'narrative' do
          raise &quot;this is raised in the story&quot;
        end
        object = Object.new
        
        # when/then
        lambda do
          story.run_in(object)
        end.should raise_error
      end
      
      it &quot;should use the steps it is told to using a StepGroup&quot; do
        story = Story.new(&quot;title&quot;, &quot;narrative&quot;, :steps_for =&gt; steps = StepGroup.new) do end
        assignee = mock(&quot;assignee&quot;)
        assignee.should_receive(:use).with(steps)
        story.assign_steps_to(assignee)
      end

      it &quot;should use the steps it is told to using a key&quot; do
        begin
          orig_rspec_story_steps = $rspec_story_steps
          $rspec_story_steps = StepGroupHash.new
          $rspec_story_steps[:foo] = steps = Object.new
        
          story = Story.new(&quot;title&quot;, &quot;narrative&quot;, :steps_for =&gt; :foo) do end
          assignee = mock(&quot;assignee&quot;)
        
          assignee.should_receive(:use).with(steps)
          story.assign_steps_to(assignee)
        ensure
          $rspec_story_steps = orig_rspec_story_steps
        end
      end
      
      it &quot;should use the steps it is told to using multiple keys&quot; do
        begin
          orig_rspec_story_steps = $rspec_story_steps
          $rspec_story_steps = StepGroupHash.new
          $rspec_story_steps[:foo] = foo_steps = Object.new
          $rspec_story_steps[:bar] = bar_steps = Object.new
        
          story = Story.new(&quot;title&quot;, &quot;narrative&quot;, :steps_for =&gt; [:foo, :bar]) do end
          assignee = mock(&quot;assignee&quot;)
        
          assignee.should_receive(:use).with(foo_steps)
          assignee.should_receive(:use).with(bar_steps)
          story.assign_steps_to(assignee)
        ensure
          $rspec_story_steps = orig_rspec_story_steps
        end
      end
    end
  end
end
</pre>
    </div>