  <div id="fileHeader">
    <h1>example_group_factory_spec.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>spec/spec/example/example_group_factory_spec.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Dec 29 13:11:11 +0100 2008</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require File.expand_path(File.dirname(__FILE__) + '/../../spec_helper')

module Spec
  module Example
    describe ExampleGroupFactory do
      describe &quot;#get&quot; do
        attr_reader :example_group
        before(:each) do
          @example_group_class = Class.new(ExampleGroup)
          ExampleGroupFactory.register(:registered_type, @example_group_class)
        end

        after(:each) do
          ExampleGroupFactory.reset
        end

        it &quot;should return the default ExampleGroup type for nil&quot; do
          ExampleGroupFactory.get(nil).should == ExampleGroup
        end

        it &quot;should return the default ExampleGroup for an unregistered non-nil value&quot; do
          ExampleGroupFactory.get(:does_not_exist).should == ExampleGroup
        end

        it &quot;should return custom type if registered&quot; do
          ExampleGroupFactory.get(:registered_type).should == @example_group_class
        end

        it &quot;should return the actual type when that is what is submitted&quot; do
          ExampleGroupFactory.get(@example_group_class).should == @example_group_class
        end

        it &quot;should get the custom type after setting the default&quot; do
          @alternate_example_group_class = Class.new(ExampleGroup)
          ExampleGroupFactory.default(@alternate_example_group_class)
          ExampleGroupFactory.get(:registered_type).should == @example_group_class
        end
      end

      describe &quot;#create_example_group&quot; do
        attr_reader :parent_example_group
        before do
          @parent_example_group = Class.new(ExampleGroup) do
            def initialize(*args, &amp;block)
              ;
            end
          end
        end

        it &quot;should create a uniquely named class&quot; do
          example_group = Spec::Example::ExampleGroupFactory.create_example_group(&quot;example_group&quot;) {}
          example_group.name.should =~ /Spec::Example::ExampleGroup::Subclass_\d+/
        end

        it &quot;should create a Spec::Example::Example subclass by default&quot; do
          example_group = Spec::Example::ExampleGroupFactory.create_example_group(&quot;example_group&quot;) {}
          example_group.superclass.should == Spec::Example::ExampleGroup
        end

        it &quot;should raise when no description is given&quot; do
          lambda {
            Spec::Example::ExampleGroupFactory.create_example_group do; end
          }.should raise_error(ArgumentError)
        end
        
        it &quot;should raise when no block is given&quot; do
          lambda { Spec::Example::ExampleGroupFactory.create_example_group &quot;foo&quot; }.should raise_error(ArgumentError)
        end

        it &quot;should run registered ExampleGroups&quot; do
          example_group = Spec::Example::ExampleGroupFactory.create_example_group &quot;The ExampleGroup&quot; do end
          Spec::Runner.options.example_groups.should include(example_group)
        end

        it &quot;should not run unregistered ExampleGroups&quot; do
          example_group = Spec::Example::ExampleGroupFactory.create_example_group &quot;The ExampleGroup&quot; do Spec::Runner.options.remove_example_group self; end
          Spec::Runner.options.example_groups.should_not include(example_group)
        end

        describe &quot;with :type =&gt; :default&quot; do
          it &quot;should create a Spec::Example::ExampleGroup&quot; do
            example_group = Spec::Example::ExampleGroupFactory.create_example_group(
            &quot;example_group&quot;, :type =&gt; :default
            ) {}
            example_group.superclass.should == Spec::Example::ExampleGroup
          end
        end

        describe &quot;with :type =&gt; :something_other_than_default&quot; do
          it &quot;should create the specified type&quot; do
            Spec::Example::ExampleGroupFactory.register(:something_other_than_default, parent_example_group)
            non_default_example_group = Spec::Example::ExampleGroupFactory.create_example_group(
              &quot;example_group&quot;, :type =&gt; :something_other_than_default
            ) {}
            non_default_example_group.superclass.should == parent_example_group
          end
        end

        it &quot;should create a type indicated by :spec_path&quot; do
          Spec::Example::ExampleGroupFactory.register(:something_other_than_default, parent_example_group)
          custom_example_group = Spec::Example::ExampleGroupFactory.create_example_group(
            &quot;example_group&quot;, :spec_path =&gt; &quot;./spec/something_other_than_default/some_spec.rb&quot;
          ) {}
          custom_example_group.superclass.should == parent_example_group
        end

        it &quot;should create a type indicated by :spec_path (with spec_path generated by caller on windows)&quot; do
          Spec::Example::ExampleGroupFactory.register(:something_other_than_default, parent_example_group)
          custom_example_group = Spec::Example::ExampleGroupFactory.create_example_group(
            &quot;example_group&quot;,
            :spec_path =&gt; &quot;./spec\\something_other_than_default\\some_spec.rb&quot;
          ) {}
          custom_example_group.superclass.should == parent_example_group
        end
        
        it &quot;sets the spec_path from the caller&quot; do
          options = {}
          shared_example_group = Spec::Example::ExampleGroupFactory.create_example_group(&quot;foo&quot;, options) {}
          options[:spec_path].should =~ /#{__FILE__}:#{__LINE__ - 1}/
        end

        describe &quot;with :shared =&gt; true&quot; do
          def shared_example_group
            @shared_example_group ||= Spec::Example::ExampleGroupFactory.create_example_group(
              &quot;name&quot;, :spec_path =&gt; '/blah/spec/models/blah.rb', :type =&gt; :controller, :shared =&gt; true
            ) {}
          end

          it &quot;should create and register a Spec::Example::SharedExampleGroup&quot; do
            shared_example_group.should be_an_instance_of(Spec::Example::SharedExampleGroup)
            SharedExampleGroup.should include(shared_example_group)
          end
        end

        it &quot;should favor the :type over the :spec_path&quot; do
          Spec::Example::ExampleGroupFactory.register(:something_other_than_default, parent_example_group)
          custom_example_group = Spec::Example::ExampleGroupFactory.create_example_group(
            &quot;name&quot;, :spec_path =&gt; '/blah/spec/models/blah.rb', :type =&gt; :something_other_than_default
          ) {}
          custom_example_group.superclass.should == parent_example_group
        end

        it &quot;should register ExampleGroup by default&quot; do
          example_group = Spec::Example::ExampleGroupFactory.create_example_group(&quot;The ExampleGroup&quot;) do
          end
          Spec::Runner.options.example_groups.should include(example_group)
        end

        it &quot;should enable unregistering of ExampleGroups&quot; do
          example_group = Spec::Example::ExampleGroupFactory.create_example_group(&quot;The ExampleGroup&quot;) do
            Spec::Runner.options.remove_example_group self
          end
          Spec::Runner.options.example_groups.should_not include(example_group)
        end
        
        after(:each) do
          Spec::Example::ExampleGroupFactory.reset
        end
      end
      
      describe &quot;#create_shared_example_group&quot; do
        it &quot;registers a new shared example group&quot; do
          shared_example_group = Spec::Example::ExampleGroupFactory.create_shared_example_group(&quot;something shared&quot;) {}
          shared_example_group.should be_an_instance_of(Spec::Example::SharedExampleGroup)
          SharedExampleGroup.should include(shared_example_group)
        end
        
        it &quot;sets the spec_path from the caller&quot; do
          options = {}
          shared_example_group = Spec::Example::ExampleGroupFactory.create_shared_example_group(&quot;foo&quot;, options) {}
          options[:spec_path].should =~ /#{__FILE__}:#{__LINE__ - 1}/
        end
      end

      describe &quot;#registered_or_ancestor_of_registered?&quot; do
        before(:each) do
          @unregistered_parent = Class.new(ExampleGroup)
          @registered_child = Class.new(@unregistered_parent)
          @unregistered_grandchild = Class.new(@registered_child)
          Spec::Example::ExampleGroupFactory.register :registered_child, @registered_child
        end
        
        it &quot;should return true for empty list&quot; do
          Spec::Example::ExampleGroupFactory.registered_or_ancestor_of_registered?([]).should be_true
        end
        
        it &quot;should return true for a registered example group class&quot; do
          Spec::Example::ExampleGroupFactory.registered_or_ancestor_of_registered?([@registered_child]).should be_true
        end

        it &quot;should return true for an ancestor of a registered example_group_classes&quot; do
          Spec::Example::ExampleGroupFactory.registered_or_ancestor_of_registered?([@unregistered_parent]).should be_true
        end

        it &quot;should return false for a subclass of a registered example_group_class&quot; do
          Spec::Example::ExampleGroupFactory.registered_or_ancestor_of_registered?([@unregistered_grandchild]).should be_false
        end

        after(:each) do
          Spec::Example::ExampleGroupFactory.reset
        end
      end
    end
  end
end
</pre>
    </div>