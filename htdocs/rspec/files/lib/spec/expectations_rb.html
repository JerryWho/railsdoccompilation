  <div id="fileHeader">
    <h1>expectations.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>lib/spec/expectations.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sat Mar 28 20:06:25 +0100 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require 'spec/matchers'
require 'spec/expectations/errors'
require 'spec/expectations/extensions'
require 'spec/expectations/handler'

module Spec
  
  # Spec::Expectations lets you set expectations on your objects.
  #
  #   result.should == 37
  #   team.should have(11).players_on_the_field
  #
  # == How Expectations work.
  #
  # Spec::Expectations adds two methods to Object:
  #
  #   should(matcher=nil)
  #   should_not(matcher=nil)
  #
  # Both methods take an optional Expression Matcher (See Spec::Matchers).
  #
  # When +should+ receives an Expression Matcher, it calls &lt;tt&gt;matches?(self)&lt;/tt&gt;. If
  # it returns +true+, the spec passes and execution continues. If it returns
  # +false+, then the spec fails with the message returned by &lt;tt&gt;matcher.failure_message&lt;/tt&gt;.
  #
  # Similarly, when +should_not+ receives a matcher, it calls &lt;tt&gt;matches?(self)&lt;/tt&gt;. If
  # it returns +false+, the spec passes and execution continues. If it returns
  # +true+, then the spec fails with the message returned by &lt;tt&gt;matcher.negative_failure_message&lt;/tt&gt;.
  #
  # RSpec ships with a standard set of useful matchers, and writing your own
  # matchers is quite simple. See Spec::Matchers for details.
  module Expectations
    def self.differ
      defined?(@differ) ? @differ : nil
    end
    
    def self.differ=(differ)
      @differ = differ
    end

    # raises a Spec::Expectations::ExpectationNotMetError with message
    #
    # When a differ has been assigned and fail_with is passed
    # &lt;code&gt;expected&lt;/code&gt; and &lt;code&gt;target&lt;/code&gt;, passes them
    # to the differ to append a diff message to the failure message.
    def self.fail_with(message, expected=nil, target=nil) # :nodoc:
      if (Array === message) &amp; (message.length == 3)
        message, expected, target = message[0], message[1], message[2]
      end
      unless (differ.nil? || expected.nil? || target.nil?)
        if expected.is_a?(String)
          message &lt;&lt; &quot;\nDiff:&quot; &lt;&lt; self.differ.diff_as_string(target.to_s, expected)
        elsif !target.is_a?(Proc)
          message &lt;&lt; &quot;\nDiff:&quot; &lt;&lt; self.differ.diff_as_object(target, expected)
        end
      end
      Kernel::raise(Spec::Expectations::ExpectationNotMetError.new(message))
    end
  end
end
</pre>
    </div>