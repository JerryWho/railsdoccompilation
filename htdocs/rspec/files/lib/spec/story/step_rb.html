  <div id="fileHeader">
    <h1>step.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>lib/spec/story/step.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Dec 29 13:11:11 +0100 2008</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>module Spec
  module Story
    class Step
      PARAM_PATTERN = /([^\\]|^)(\$(?!\$)\w*)/
      PARAM_OR_GROUP_PATTERN = /(\$(?!\$)\w*)|\(.*?\)/
      
      attr_reader :name
      
      def initialize(name, &amp;block)
        init_name(name)
        init_expression(name)
        block_given? ? init_module(name, &amp;block) : set_pending
      end

      def perform(instance, *args)
        raise Spec::Example::ExamplePendingError.new(&quot;Not Yet Implemented&quot;) if pending?
        instance.extend(@mod)
        instance.__send__(sanitize(@name), *args)
      end

      def matches?(name)
        !(name.strip =~ @expression).nil?
      end
            
      def parse_args(name)
        name.strip.match(@expression)[1..-1]
      end

      private
      
      def sanitize(a_string_or_regexp)
        return a_string_or_regexp.source if Regexp == a_string_or_regexp
        a_string_or_regexp.to_s
      end

      def init_module(name, &amp;block)
        sanitized_name = sanitize(name)
        @mod = Module.new do
          define_method(sanitized_name, &amp;block)
        end
      end
    
      def set_pending
        @pending = true
      end
      
      def pending?
        @pending == true
      end
      
      def init_name(name)
        @name = name
      end
    
      def init_expression(string_or_regexp)
        if String === string_or_regexp
          expression = string_or_regexp.dup
          %w&lt;? ( ) [ ] { } ^ !&gt;.each {|c| expression.gsub! c, &quot;\\#{c}&quot;}
        elsif Regexp === string_or_regexp
          expression = string_or_regexp.source
        end
        while expression =~ PARAM_PATTERN
          expression.sub!($2, &quot;(.*?)&quot;)
        end
        @expression = Regexp.new(&quot;\\A#{expression}\\Z&quot;, Regexp::MULTILINE)
      end

    end
  end
end
</pre>
    </div>