  <div id="fileHeader">
    <h1>scenario_runner.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>lib/spec/story/runner/scenario_runner.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Dec 29 13:11:11 +0100 2008</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>module Spec
  module Story
    module Runner
      class ScenarioRunner
        def initialize
          @listeners = []
        end
        
        def run(scenario, world)
          @listeners.each { |l| l.scenario_started(scenario.story.title, scenario.name) }
          run_story_ignoring_scenarios(scenario.story, world)
          
          world.start_collecting_errors

          unless scenario.body
            @listeners.each { |l| l.scenario_pending(scenario.story.title, scenario.name, '') }
            return true
          end
          
          world.instance_eval(&amp;scenario.body)
          if world.errors.empty?
            @listeners.each { |l| l.scenario_succeeded(scenario.story.title, scenario.name) }
          else
            if Spec::Example::ExamplePendingError === (e = world.errors.first)
              @listeners.each { |l| l.scenario_pending(scenario.story.title, scenario.name, e.message) }
            else
              @listeners.each { |l| l.scenario_failed(scenario.story.title, scenario.name, e) }
              return false
            end
          end
          true
        end
        
        def add_listener(listener)
          @listeners &lt;&lt; listener
        end
        
        private
        
        def run_story_ignoring_scenarios(story, world)
          class &lt;&lt; world
            def Scenario(name, &amp;block)
              # do nothing
            end
          end
          story.run_in(world)
          class &lt;&lt; world
            remove_method(:Scenario)
          end
        end
      end
    end
  end
end
</pre>
    </div>