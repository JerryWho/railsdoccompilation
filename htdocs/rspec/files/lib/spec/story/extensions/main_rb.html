  <div id="fileHeader">
    <h1>main.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>lib/spec/story/extensions/main.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Dec 29 13:11:11 +0100 2008</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>module Spec
  module Story
    module Extensions
      module Main
        def Story(title, narrative, params = {}, &amp;body)
          ::Spec::Story::Runner.story_runner.Story(title, narrative, params, &amp;body)
        end
      
        # Calling this deprecated is silly, since it hasn't been released yet. But, for
        # those who are reading this - this will be deleted before the 1.1 release.
        def run_story(*args, &amp;block)
          runner = Spec::Story::Runner::PlainTextStoryRunner.new(*args)
          runner.instance_eval(&amp;block) if block
          runner.run
        end
      
        # Creates (or appends to an existing) a namespaced group of steps for use in Stories
        #
        # == Examples
        #
        #   # Creating a new group
        #   steps_for :forms do
        #     When(&quot;user enters $value in the $field field&quot;) do ... end
        #     When(&quot;user submits the $form form&quot;) do ... end
        #   end
        def steps_for(tag, &amp;block)
          steps = rspec_story_steps[tag]
          steps.instance_eval(&amp;block) if block
          steps
        end
      
        # Creates a context for running a Plain Text Story with specific groups of Steps. 
        # Also supports adding arbitrary steps that will only be accessible to
        # the Story being run.
        #
        # == Examples
        #
        #   # Run a Story with one group of steps
        #   with_steps_for :checking_accounts do
        #     run File.dirname(__FILE__) + &quot;/withdraw_cash&quot;
        #   end
        #
        #   # Run a Story, adding steps that are only available for this Story
        #   with_steps_for :accounts do
        #     Given &quot;user is logged in as account administrator&quot;
        #     run File.dirname(__FILE__) + &quot;/reconcile_accounts&quot;
        #   end
        #
        #   # Run a Story with steps from two groups
        #   with_steps_for :checking_accounts, :savings_accounts do
        #     run File.dirname(__FILE__) + &quot;/transfer_money&quot;
        #   end
        #
        #   # Run a Story with a specific Story extension
        #   with_steps_for :login, :navigation do
        #     run File.dirname(__FILE__) + &quot;/user_changes_password&quot;, :type =&gt; RailsStory
        #   end
        def with_steps_for(*tags, &amp;block)
          steps = Spec::Story::StepGroup.new do
            extend StoryRunnerStepGroupAdapter
          end
          tags.each {|tag| steps &lt;&lt; rspec_story_steps[tag]}
          steps.instance_eval(&amp;block) if block
          steps
        end

      private

        module StoryRunnerStepGroupAdapter
          def run(path, options={})
            runner = Spec::Story::Runner::PlainTextStoryRunner.new(path, options)
            runner.steps &lt;&lt; self
            runner.run
          end
        end
        
        def rspec_story_steps  # :nodoc:
          $rspec_story_steps ||= Spec::Story::StepGroupHash.new
        end
                
      end
    end
  end
end

include Spec::Story::Extensions::Main</pre>
    </div>