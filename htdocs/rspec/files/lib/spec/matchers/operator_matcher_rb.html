  <div id="fileHeader">
    <h1>operator_matcher.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>lib/spec/matchers/operator_matcher.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sat Mar 28 20:06:25 +0100 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>module Spec
  module Matchers

    class OperatorMatcher
      class &lt;&lt; self
        def registry
          @registry ||= {}
        end

        def register(klass, operator, matcher)
          registry[klass] ||= {}
          registry[klass][operator] = matcher
        end

        def get(klass, operator)
          registry[klass] &amp;&amp; registry[klass][operator]
        end
      end

      def initialize(actual)
        @actual = actual
      end

      def self.use_custom_matcher_or_delegate(operator)
        define_method(operator) do |expected|
          if matcher = OperatorMatcher.get(@actual.class, operator)
            @actual.send(::Spec::Matchers.last_should, matcher.new(expected))
          else
            eval_match(@actual, operator, expected)
          end
        end
      end

      ['==', '===', '=~', '&gt;', '&gt;=', '&lt;', '&lt;='].each do |operator|
        use_custom_matcher_or_delegate operator
      end

      def fail_with_message(message)
        Spec::Expectations.fail_with(message, @expected, @actual)
      end

      def description
        &quot;#{@operator} #{@expected.inspect}&quot;
      end
      
    private
      
      def eval_match(actual, operator, expected)
        ::Spec::Matchers.last_matcher = self
        @operator, @expected = operator, expected
        __delegate_operator(actual, operator, expected)
      end

    end

    class PositiveOperatorMatcher &lt; OperatorMatcher #:nodoc:
      def __delegate_operator(actual, operator, expected)
        return true if actual.__send__(operator, expected)
        if ['==','===', '=~'].include?(operator)
          fail_with_message(&quot;expected: #{expected.inspect},\n     got: #{actual.inspect} (using #{operator})&quot;) 
        else
          fail_with_message(&quot;expected: #{operator} #{expected.inspect},\n     got: #{operator.gsub(/./, ' ')} #{actual.inspect}&quot;)
        end
      end

    end

    class NegativeOperatorMatcher &lt; OperatorMatcher #:nodoc:
      def __delegate_operator(actual, operator, expected)
        return true unless actual.__send__(operator, expected)
        return fail_with_message(&quot;expected not: #{operator} #{expected.inspect},\n         got: #{operator.gsub(/./, ' ')} #{actual.inspect}&quot;)
      end

    end

  end
end
</pre>
    </div>