  <div id="fileHeader">
    <h1>throw_symbol.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>lib/spec/matchers/throw_symbol.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sun Jul 25 20:07:22 +0200 2010</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>module Spec
  module Matchers

    class ThrowSymbol #:nodoc:
      def initialize(expected_symbol = nil, expected_arg=nil)
        @expected_symbol = expected_symbol
        @expected_arg = expected_arg
        @caught_symbol = @caught_arg = nil
      end

      def matches?(given_proc)
        begin
          if @expected_symbol.nil?
            given_proc.call
          else
            @caught_arg = catch :proc_did_not_throw_anything do
              catch @expected_symbol do
                given_proc.call
                throw :proc_did_not_throw_anything, :nothing_thrown
              end
            end
            @caught_symbol = @expected_symbol unless @caught_arg == :nothing_thrown
          end

        # Ruby 1.8 uses NameError with `symbol'
        # Ruby 1.9 uses ArgumentError with :symbol
        rescue NameError, ArgumentError =&gt; e
          raise e unless e.message =~ /uncaught throw (`|\:)([a-zA-Z0-9_]*)(')?/
          @caught_symbol = $2.to_sym
        end
        if @expected_symbol.nil?
          !@caught_symbol.nil?
        elsif @expected_arg.nil?
          @caught_symbol == @expected_symbol
        else
          (@caught_symbol == @expected_symbol) &amp; (@caught_arg == @expected_arg)
        end
      end

      def failure_message_for_should
        if @caught_symbol
          &quot;expected #{expected}, got #{@caught_symbol.inspect}&quot;
        else
          &quot;expected #{expected} but nothing was thrown&quot;
        end
      end

      def failure_message_for_should_not
        if @expected_symbol
          &quot;expected #{expected} not to be thrown&quot;
        else
          &quot;expected no Symbol, got :#{@caught_symbol}&quot;
        end
      end

      def description
        &quot;throw #{expected}&quot;
      end

      private

        def expected
          @expected_symbol.nil? ? &quot;a Symbol&quot; : &quot;#{@expected_symbol.inspect}#{args}&quot;
        end

        def args
          @expected_arg.nil? ? &quot;&quot; : &quot; with #{@expected_arg.inspect}&quot;
        end

    end

    # :call-seq:
    #   should throw_symbol()
    #   should throw_symbol(:sym)
    #   should throw_symbol(:sym, arg)
    #   should_not throw_symbol()
    #   should_not throw_symbol(:sym)
    #   should_not throw_symbol(:sym, arg)
    #
    # Given no argument, matches if a proc throws any Symbol.
    #
    # Given a Symbol, matches if the given proc throws the specified Symbol.
    #
    # Given a Symbol and an arg, matches if the given proc throws the
    # specified Symbol with the specified arg.
    #
    # == Examples
    #
    #   lambda { do_something_risky }.should throw_symbol
    #   lambda { do_something_risky }.should throw_symbol(:that_was_risky)
    #   lambda { do_something_risky }.should throw_symbol(:that_was_risky, culprit)
    #
    #   lambda { do_something_risky }.should_not throw_symbol
    #   lambda { do_something_risky }.should_not throw_symbol(:that_was_risky)
    #   lambda { do_something_risky }.should_not throw_symbol(:that_was_risky, culprit)
    def throw_symbol(sym=nil)
      Matchers::ThrowSymbol.new(sym)
    end
  end
end
</pre>
    </div>