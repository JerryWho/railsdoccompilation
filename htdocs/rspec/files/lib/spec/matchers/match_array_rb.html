  <div id="fileHeader">
    <h1>match_array.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>lib/spec/matchers/match_array.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Oct 12 14:57:53 +0200 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>module Spec
  module Matchers

    class MatchArray #:nodoc:
      include Spec::Matchers::Pretty
      
      def initialize(expected)
        @expected = expected
      end

      def matches?(actual)
        @actual = actual        
        @extra_items = difference_between_arrays(@actual, @expected)
        @missing_items = difference_between_arrays(@expected, @actual)
        @extra_items.empty? &amp; @missing_items.empty?
      end

      def failure_message_for_should
        message =  &quot;expected collection contained:  #{safe_sort(@expected).inspect}\n&quot;
        message += &quot;actual collection contained:    #{safe_sort(@actual).inspect}\n&quot;
        message += &quot;the missing elements were:      #{safe_sort(@missing_items).inspect}\n&quot; unless @missing_items.empty?
        message += &quot;the extra elements were:        #{safe_sort(@extra_items).inspect}\n&quot;   unless @extra_items.empty?
        message
      end
      
      def failure_message_for_should_not
        &quot;Matcher does not support should_not&quot;
      end
      
      def description
        &quot;contain exactly #{_pretty_print(@expected)}&quot;
      end

      private

        def safe_sort(array)
          array.all?{|item| item.respond_to?(:&lt;=&gt;)} ? array.sort : array
        end

        def difference_between_arrays(array_1, array_2)
          difference = array_1.dup
          array_2.each do |element|
            if index = difference.index(element)
              difference.delete_at(index)
            end
          end
          difference
        end


    end

    # :call-seq:
    #   should =~ expected
    #
    # Passes if actual contains all of the expected regardless of order. 
    # This works for collections. Pass in multiple args  and it will only 
    # pass if all args are found in collection.
    #
    # NOTE: there is no should_not version of array.should =~ other_array
    # 
    # == Examples
    #
    #   [1,2,3].should   =~ [1,2,3]   # =&gt; would pass
    #   [1,2,3].should   =~ [2,3,1]   # =&gt; would pass
    #   [1,2,3,4].should =~ [1,2,3]   # =&gt; would fail
    #   [1,2,2,3].should =~ [1,2,3]   # =&gt; would fail
    #   [1,2,3].should   =~ [1,2,3,4] # =&gt; would fail
    OperatorMatcher.register(Array, '=~', Spec::Matchers::MatchArray)
  end
end
</pre>
    </div>