  <div id="fileHeader">
    <h1>link.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>lib/webrat/core/elements/link.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sat Mar 28 20:11:40 +0100 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require &quot;webrat/core_extensions/blank&quot;

require &quot;webrat/core/elements/element&quot;

module Webrat
  class Link &lt; Element #:nodoc:
    
    def self.xpath_search
      &quot;.//a[@href]&quot;
    end
    
    def click(options = {})
      method = options[:method] || http_method
      return if href =~ /^#/ &amp;&amp; method == :get
      
      options[:javascript] = true if options[:javascript].nil?
      
      if options[:javascript]
        @session.request_page(absolute_href, method, data)
      else
        @session.request_page(absolute_href, :get, {})
      end
    end
    
  protected
  
    def id
      Webrat::XML.attribute(@element, &quot;id&quot;)
    end
  
    def data
      authenticity_token.blank? ? {} : {&quot;authenticity_token&quot; =&gt; authenticity_token}
    end

    def title
      Webrat::XML.attribute(@element, &quot;title&quot;)
    end

    def href
      Webrat::XML.attribute(@element, &quot;href&quot;)
    end

    def absolute_href
      if href =~ /^\?/
        &quot;#{@session.current_url}#{href}&quot;
      elsif href !~ %r{^https?://} &amp;&amp; (href !~ /^\//)
        &quot;#{@session.current_url}/#{href}&quot;
      else
        href
      end
    end
    
    def authenticity_token
      return unless onclick &amp;&amp; onclick.include?(&quot;s.setAttribute('name', 'authenticity_token');&quot;) &amp;&amp;
        onclick =~ /s\.setAttribute\('value', '([a-f0-9]{40})'\);/
      $LAST_MATCH_INFO.captures.first
    end
    
    def onclick
      Webrat::XML.attribute(@element, &quot;onclick&quot;)
    end
    
    def http_method
      if !onclick.blank? &amp;&amp; onclick.include?(&quot;f.submit()&quot;)
        http_method_from_js_form
      else
        :get
      end
    end

    def http_method_from_js_form
      if onclick.include?(&quot;m.setAttribute('name', '_method')&quot;)
        http_method_from_fake_method_param
      else
        :post
      end
    end

    def http_method_from_fake_method_param
      if onclick.include?(&quot;m.setAttribute('value', 'delete')&quot;)
        :delete
      elsif onclick.include?(&quot;m.setAttribute('value', 'put')&quot;)
        :put
      else
        raise Webrat::WebratError.new(&quot;No HTTP method for _method param in #{onclick.inspect}&quot;)
      end
    end
    
  end
end
</pre>
    </div>