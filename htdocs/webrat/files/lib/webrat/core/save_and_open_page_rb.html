  <div id="fileHeader">
    <h1>save_and_open_page.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>lib/webrat/core/save_and_open_page.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sat Mar 28 20:11:40 +0100 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>module Webrat
  module SaveAndOpenPage
    # Saves the page out to RAILS_ROOT/tmp/ and opens it in the default
    # web browser if on OS X. Useful for debugging.
    # 
    # Example:
    #   save_and_open_page
    def save_and_open_page
      return unless File.exist?(saved_page_dir)

      filename = &quot;#{saved_page_dir}/webrat-#{Time.now.to_i}.html&quot;
      
      File.open(filename, &quot;w&quot;) do |f|
        f.write rewrite_css_and_image_references(response_body)
      end

      open_in_browser(filename)
    end
    
    def open_in_browser(path) # :nodoc
      platform = ruby_platform
      if platform =~ /cygwin/ || platform =~ /win32/
        `rundll32 url.dll,FileProtocolHandler #{path.gsub(&quot;/&quot;, &quot;\\\\&quot;)}`
      elsif platform =~ /darwin/
        `open #{path}`
      end
    end
    
    def rewrite_css_and_image_references(response_html) # :nodoc:
      return response_html unless doc_root
      response_html.gsub(/&quot;\/(stylesheets|images)/, doc_root + '/\1')
    end
    
    def saved_page_dir #:nodoc:
      File.expand_path(&quot;.&quot;)
    end
    
    def doc_root #:nodoc:
      nil
    end
  
  private

    # accessor for testing
    def ruby_platform
      RUBY_PLATFORM
    end
    
  end
end</pre>
    </div>