  <div id="fileHeader">
    <h1>merb_session.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>lib/webrat/merb_session.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sat Mar 28 20:11:40 +0100 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require &quot;webrat&quot;

require &quot;cgi&quot;
gem &quot;extlib&quot;
require &quot;extlib&quot;
require &quot;merb-core&quot;

# HashWithIndifferentAccess = Mash

module Webrat
  class MerbSession &lt; Session #:nodoc:
    include Merb::Test::MakeRequest
    
    attr_accessor :response
    
    def get(url, data, headers = nil)
      do_request(url, data, headers, &quot;GET&quot;)
    end
  
    def post(url, data, headers = nil)
      do_request(url, data, headers, &quot;POST&quot;)
    end
  
    def put(url, data, headers = nil)
      do_request(url, data, headers, &quot;PUT&quot;)
    end
  
    def delete(url, data, headers = nil)
      do_request(url, data, headers, &quot;DELETE&quot;)
    end
    
    def response_body
      @response.body.to_s
    end
    
    def response_code
      @response.status
    end
    
    def do_request(url, data, headers, method)
      @response = request(url, 
        :params =&gt; (data &amp;&amp; data.any?) ? data : nil, 
        :headers =&gt; headers,
        :method =&gt; method)
    end

  end
end

module Merb #:nodoc:
  module Test #:nodoc:
    module RequestHelper #:nodoc:
      def request(uri, env = {})
        @_webrat_session ||= Webrat::MerbSession.new
        @_webrat_session.response = @_webrat_session.request(uri, env)
      end
    end
  end
end

class Merb::Test::RspecStory #:nodoc:
  def browser
    @browser ||= Webrat::MerbSession.new
  end
end
</pre>
    </div>