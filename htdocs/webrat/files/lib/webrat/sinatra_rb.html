  <div id="fileHeader">
    <h1>sinatra.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>lib/webrat/sinatra.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sat Mar 28 20:11:40 +0100 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require &quot;webrat/rack&quot;
require &quot;sinatra/test&quot;

module Webrat
  class SinatraSession &lt; RackSession
    include Sinatra::Test

    attr_reader :request, :response

    def initialize(context = nil)
      super(context)

      app = context.respond_to?(:app) ? context.app : Sinatra::Application
      @browser = Sinatra::TestHarness.new(app)
    end

    %w(get head post put delete).each do |verb|
      class_eval &lt;&lt;-RUBY
        def #{verb}(path, data, headers = {})
          params = data.inject({}) do |data, (key,value)|
            data[key] = Rack::Utils.unescape(value)
            data
          end
          headers[&quot;HTTP_HOST&quot;] = &quot;www.example.com&quot;
          @browser.#{verb}(path, params, headers)
        end
      RUBY
    end

    def response_body
      @browser.body
    end

    def response_code
      @browser.status
    end

    private

      def response
        @browser.response
      end
  end
end
</pre>
    </div>