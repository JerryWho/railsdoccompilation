<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Module: ActionDispatch::Assertions::SelectorAssertions</title>
<link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (S)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../ActionDispatch.html" title="ActionDispatch (module)">ActionDispatch</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Assertions.html" title="ActionDispatch::Assertions (module)">Assertions</a></span></span>
     &raquo; 
    <span class="title">SelectorAssertions</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Module: ActionDispatch::Assertions::SelectorAssertions
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">actionpack/lib/action_dispatch/testing/assertions/selector.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
Adds the <tt>assert_select</tt> method for use in Rails functional test
cases, which can be used to make assertions on the response HTML of a
controller action. You can also call <tt>assert_select</tt> within another
<tt>assert_select</tt> to make assertions on elements selected by the
enclosing assertion.
</p>
<p>
Use <tt>css_select</tt> to select elements without making an assertions,
either from the response HTML or elements selected by the enclosing
assertion.
</p>
<p>
In addition to HTML responses, you can make the following assertions:
</p>
<ul>
<li><p>
<tt>assert_select_rjs</tt> - Assertions on HTML content of RJS update and
insertion operations.
</p>
</li>
<li><p>
<tt>assert_select_encoded</tt> - Assertions on HTML encoded inside XML, for
example for dealing with feed item descriptions.
</p>
</li>
<li><p>
<tt>assert_select_email</tt> - Assertions on the HTML body of an e-mail.
</p>
</li>
</ul>
<p>
Also see HTML::Selector to learn how to use selectors.
</p>


  </div>
</div>
<div class="tags">
  
</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="RJS_PATTERN_HTML-constant" class="">RJS_PATTERN_HTML =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\&quot;((\\\\\&quot;|[^\&quot;])*)\&quot;</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
        <dt id="RJS_ANY_ID-constant" class="">RJS_ANY_ID =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\&quot;([^\&quot;])*\&quot;</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
        <dt id="RJS_STATEMENTS-constant" class="">RJS_STATEMENTS =
          
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span>
  <span class='symbol'>:chained_replace</span>      <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\\$\\(</span><span class='embexpr_beg'>#{</span><span class='const'>RJS_ANY_ID</span><span class='rbrace'>}</span><span class='tstring_content'>\\)\\.replace\\(</span><span class='embexpr_beg'>#{</span><span class='const'>RJS_PATTERN_HTML</span><span class='rbrace'>}</span><span class='tstring_content'>\\)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='symbol'>:chained_replace_html</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\\$\\(</span><span class='embexpr_beg'>#{</span><span class='const'>RJS_ANY_ID</span><span class='rbrace'>}</span><span class='tstring_content'>\\)\\.update\\(</span><span class='embexpr_beg'>#{</span><span class='const'>RJS_PATTERN_HTML</span><span class='rbrace'>}</span><span class='tstring_content'>\\)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='symbol'>:replace_html</span>         <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Element\\.update\\(</span><span class='embexpr_beg'>#{</span><span class='const'>RJS_ANY_ID</span><span class='rbrace'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='const'>RJS_PATTERN_HTML</span><span class='rbrace'>}</span><span class='tstring_content'>\\)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='symbol'>:replace</span>              <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Element\\.replace\\(</span><span class='embexpr_beg'>#{</span><span class='const'>RJS_ANY_ID</span><span class='rbrace'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='const'>RJS_PATTERN_HTML</span><span class='rbrace'>}</span><span class='tstring_content'>\\)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='symbol'>:redirect</span>             <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>window.location.href = </span><span class='embexpr_beg'>#{</span><span class='const'>RJS_ANY_ID</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='rbrace'>}</span></pre></dd>
      
        <dt id="RJS_INSERTIONS-constant" class="">RJS_INSERTIONS =
          
        </dt>
        <dd><pre class="code"><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>top</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bottom</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>before</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>after</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span></pre></dd>
      
        <dt id="RJS_PATTERN_UNICODE_ESCAPED_CHAR-constant" class="">RJS_PATTERN_UNICODE_ESCAPED_CHAR =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\\u([0-9a-zA-Z]{4})</span><span class='regexp_end'>/</span></span></pre></dd>
      
    </dl>
  



  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#assert_select-instance_method" title="#assert_select (instance method)">- (Object) <strong>assert_select</strong>(*args, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
:call-seq:.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#assert_select_email-instance_method" title="#assert_select_email (instance method)">- (Object) <strong>assert_select_email</strong>(&amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
:call-seq:.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#assert_select_encoded-instance_method" title="#assert_select_encoded (instance method)">- (Object) <strong>assert_select_encoded</strong>(element = nil, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
:call-seq:.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#assert_select_rjs-instance_method" title="#assert_select_rjs (instance method)">- (Object) <strong>assert_select_rjs</strong>(*args, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
:call-seq:.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#count_description-instance_method" title="#count_description (instance method)">- (Object) <strong>count_description</strong>(min, max, count) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
:nodoc:.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#css_select-instance_method" title="#css_select (instance method)">- (Object) <strong>css_select</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
:call-seq:.
</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="assert_select-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>assert_select</strong>(*args, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
:call-seq:
</p>
<pre class="code">
  <span class='id assert_select'>assert_select</span><span class='lparen'>(</span><span class='id selector'>selector</span><span class='comma'>,</span> <span class='id equality?'>equality?</span><span class='comma'>,</span> <span class='id message?'>message?</span><span class='rparen'>)</span>
  <span class='id assert_select'>assert_select</span><span class='lparen'>(</span><span class='id element'>element</span><span class='comma'>,</span> <span class='id selector'>selector</span><span class='comma'>,</span> <span class='id equality?'>equality?</span><span class='comma'>,</span> <span class='id message?'>message?</span><span class='rparen'>)</span>
</pre>
<p>
An assertion that selects elements and makes one or more equality tests.
</p>
<p>
If the first argument is an element, selects all matching elements starting
from (and including) that element and all its children in depth-first
order.
</p>
<p>
If no element if specified, calling <tt>assert_select</tt> selects from the
response HTML unless <tt>assert_select</tt> is called from within an
<tt>assert_select</tt> block.
</p>
<p>
When called with a block <tt>assert_select</tt> passes an array of selected
elements to the block. Calling <tt>assert_select</tt> from the block, with
no element specified, runs the assertion on the complete set of elements
selected by the enclosing assertion. Alternatively the array may be
iterated through so that <tt>assert_select</tt> can be called separately
for each element.
</p>
<h4>Example</h4>
<p>
If the response contains two ordered lists, each with four list elements
then:
</p>
<pre class="code">
  <span class='id assert_select'>assert_select</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ol</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id elements'>elements</span><span class='op'>|</span>
    <span class='id elements'>elements</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id element'>element</span><span class='op'>|</span>
      <span class='id assert_select'>assert_select</span> <span class='id element'>element</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>li</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>4</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
</pre>
<p>
will pass, as will:
</p>
<pre class="code">
  <span class='id assert_select'>assert_select</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ol</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id assert_select'>assert_select</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>li</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>8</span>
  <span class='kw'>end</span>
</pre>
<p>
The selector may be a CSS selector expression (String), an expression with
substitution values, or an HTML::Selector object.
</p>
<h3>Equality Tests</h3>
<p>
The equality test may be one of the following:
</p>
<ul>
<li><p>
<tt>true</tt> - Assertion is true if at least one element selected.
</p>
</li>
<li><p>
<tt>false</tt> - Assertion is true if no element selected.
</p>
</li>
<li><p>
<tt>String/Regexp</tt> - Assertion is true if the text value of at least
one element matches the string or regular expression.
</p>
</li>
<li><p>
<tt>Integer</tt> - Assertion is true if exactly that number of elements are
selected.
</p>
</li>
<li><p>
<tt>Range</tt> - Assertion is true if the number of selected elements fit
the range.
</p>
</li>
</ul>
<p>
If no equality test specified, the assertion is true if at least one
element selected.
</p>
<p>
To perform more than one equality tests, use a hash with the following
keys:
</p>
<ul>
<li><p>
<tt>:text</tt> - Narrow the selection to elements that have this text value
(string or regexp).
</p>
</li>
<li><p>
<tt>:html</tt> - Narrow the selection to elements that have this HTML
content (string or regexp).
</p>
</li>
<li><p>
<tt>:count</tt> - Assertion is true if the number of selected elements is
equal to this value.
</p>
</li>
<li><p>
<tt>:minimum</tt> - Assertion is true if the number of selected elements is
at least this value.
</p>
</li>
<li><p>
<tt>:maximum</tt> - Assertion is true if the number of selected elements is
at most this value.
</p>
</li>
</ul>
<p>
If the method is called with a block, once all equality tests are evaluated
the block is called with an array of all matched elements.
</p>
<h4>Examples</h4>
<pre class="code">
  <span class='comment'># At least one form element
</span>  <span class='id assert_select'>assert_select</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>form</span><span class='tstring_end'>&quot;</span></span>

  <span class='comment'># Form element includes four input fields
</span>  <span class='id assert_select'>assert_select</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>form input</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>4</span>

  <span class='comment'># Page title is &quot;Welcome&quot;
</span>  <span class='id assert_select'>assert_select</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>title</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Welcome</span><span class='tstring_end'>&quot;</span></span>

  <span class='comment'># Page title is &quot;Welcome&quot; and there is only one title element
</span>  <span class='id assert_select'>assert_select</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>title</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:count</span><span class='op'>=&gt;</span><span class='int'>1</span><span class='comma'>,</span> <span class='symbol'>:text</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Welcome</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Wrong title or more than one title element</span><span class='tstring_end'>&quot;</span></span>

  <span class='comment'># Page contains no forms
</span>  <span class='id assert_select'>assert_select</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>form</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>This page must contain no forms</span><span class='tstring_end'>&quot;</span></span>

  <span class='comment'># Test the content and style
</span>  <span class='id assert_select'>assert_select</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>body div.header ul.menu</span><span class='tstring_end'>&quot;</span></span>

  <span class='comment'># Use substitution values
</span>  <span class='id assert_select'>assert_select</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ol&gt;li#?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>item-\d+</span><span class='regexp_end'>/</span></span>

  <span class='comment'># All input fields in the form have a name
</span>  <span class='id assert_select'>assert_select</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>form input</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='id assert_select'>assert_select</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[name=?]</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>.+</span><span class='regexp_end'>/</span></span>  <span class='comment'># Not empty
</span>  <span class='kw'>end</span></pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'actionpack/lib/action_dispatch/testing/assertions/selector.rb', line 195</span>

<span class='kw'>def</span> <span class='id assert_select'>assert_select</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='comment'># Start with optional element followed by mandatory selector.
</span>  <span class='id arg'>arg</span> <span class='op'>=</span> <span class='id args'>args</span><span class='period'>.</span><span class='id shift'>shift</span>

  <span class='kw'>if</span> <span class='id arg'>arg</span><span class='period'>.</span><span class='id is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>HTML</span><span class='op'>::</span><span class='const'>Node</span><span class='rparen'>)</span>
    <span class='comment'># First argument is a node (tag or text, but also HTML root),
</span>    <span class='comment'># so we know what we're selecting from.
</span>    <span class='id root'>root</span> <span class='op'>=</span> <span class='id arg'>arg</span>
    <span class='id arg'>arg</span> <span class='op'>=</span> <span class='id args'>args</span><span class='period'>.</span><span class='id shift'>shift</span>
  <span class='kw'>elsif</span> <span class='id arg'>arg</span> <span class='op'>==</span> <span class='kw'>nil</span>
    <span class='comment'># This usually happens when passing a node/element that
</span>    <span class='comment'># happens to be nil.
</span>    <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>First argument is either selector or element to select, but nil found. Perhaps you called assert_select with an element that does not exist?</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='ivar'>@selected</span>
    <span class='id root'>root</span> <span class='op'>=</span> <span class='const'>HTML</span><span class='op'>::</span><span class='const'>Node</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id root'>root</span><span class='period'>.</span><span class='id children'>children</span><span class='period'>.</span><span class='id concat'>concat</span> <span class='ivar'>@selected</span>
  <span class='kw'>else</span>
    <span class='comment'># Otherwise just operate on the response document.
</span>    <span class='id root'>root</span> <span class='op'>=</span> <span class='id response_from_page_or_rjs'>response_from_page_or_rjs</span>
  <span class='kw'>end</span>

  <span class='comment'># First or second argument is the selector: string and we pass
</span>  <span class='comment'># all remaining arguments. Array and we pass the argument. Also
</span>  <span class='comment'># accepts selector itself.
</span>  <span class='kw'>case</span> <span class='id arg'>arg</span>
    <span class='kw'>when</span> <span class='const'>String</span>
      <span class='id selector'>selector</span> <span class='op'>=</span> <span class='const'>HTML</span><span class='op'>::</span><span class='const'>Selector</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id arg'>arg</span><span class='comma'>,</span> <span class='id args'>args</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>Array</span>
      <span class='id selector'>selector</span> <span class='op'>=</span> <span class='const'>HTML</span><span class='op'>::</span><span class='const'>Selector</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='op'>*</span><span class='id arg'>arg</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>HTML</span><span class='op'>::</span><span class='const'>Selector</span>
      <span class='id selector'>selector</span> <span class='op'>=</span> <span class='id arg'>arg</span>
    <span class='kw'>else</span> <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Expecting a selector as the first argument</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># Next argument is used for equality tests.
</span>  <span class='id equals'>equals</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>case</span> <span class='id arg'>arg</span> <span class='op'>=</span> <span class='id args'>args</span><span class='period'>.</span><span class='id shift'>shift</span>
    <span class='kw'>when</span> <span class='const'>Hash</span>
      <span class='id equals'>equals</span> <span class='op'>=</span> <span class='id arg'>arg</span>
    <span class='kw'>when</span> <span class='const'>String</span><span class='comma'>,</span> <span class='const'>Regexp</span>
      <span class='id equals'>equals</span><span class='lbracket'>[</span><span class='symbol'>:text</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id arg'>arg</span>
    <span class='kw'>when</span> <span class='const'>Integer</span>
      <span class='id equals'>equals</span><span class='lbracket'>[</span><span class='symbol'>:count</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id arg'>arg</span>
    <span class='kw'>when</span> <span class='const'>Range</span>
      <span class='id equals'>equals</span><span class='lbracket'>[</span><span class='symbol'>:minimum</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id arg'>arg</span><span class='period'>.</span><span class='id begin'>begin</span>
      <span class='id equals'>equals</span><span class='lbracket'>[</span><span class='symbol'>:maximum</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id arg'>arg</span><span class='period'>.</span><span class='id end'>end</span>
    <span class='kw'>when</span> <span class='const'>FalseClass</span>
      <span class='id equals'>equals</span><span class='lbracket'>[</span><span class='symbol'>:count</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='kw'>when</span> <span class='const'>NilClass</span><span class='comma'>,</span> <span class='const'>TrueClass</span>
      <span class='id equals'>equals</span><span class='lbracket'>[</span><span class='symbol'>:minimum</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>1</span>
    <span class='kw'>else</span> <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I don't understand what you're trying to match</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># By default we're looking for at least one match.
</span>  <span class='kw'>if</span> <span class='id equals'>equals</span><span class='lbracket'>[</span><span class='symbol'>:count</span><span class='rbracket'>]</span>
    <span class='id equals'>equals</span><span class='lbracket'>[</span><span class='symbol'>:minimum</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id equals'>equals</span><span class='lbracket'>[</span><span class='symbol'>:maximum</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id equals'>equals</span><span class='lbracket'>[</span><span class='symbol'>:count</span><span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='id equals'>equals</span><span class='lbracket'>[</span><span class='symbol'>:minimum</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>1</span> <span class='kw'>unless</span> <span class='id equals'>equals</span><span class='lbracket'>[</span><span class='symbol'>:minimum</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='comment'># Last argument is the message we use if the assertion fails.
</span>  <span class='id message'>message</span> <span class='op'>=</span> <span class='id args'>args</span><span class='period'>.</span><span class='id shift'>shift</span>
  <span class='comment'>#- message = &quot;No match made with selector #{selector.inspect}&quot; unless message
</span>  <span class='kw'>if</span> <span class='id args'>args</span><span class='period'>.</span><span class='id shift'>shift</span>
    <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Not expecting that last argument, you either have too many arguments, or they're the wrong type</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id matches'>matches</span> <span class='op'>=</span> <span class='id selector'>selector</span><span class='period'>.</span><span class='id select'>select</span><span class='lparen'>(</span><span class='id root'>root</span><span class='rparen'>)</span>
  <span class='comment'># If text/html, narrow down to those elements that match it.
</span>  <span class='id content_mismatch'>content_mismatch</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>if</span> <span class='id match_with'>match_with</span> <span class='op'>=</span> <span class='id equals'>equals</span><span class='lbracket'>[</span><span class='symbol'>:text</span><span class='rbracket'>]</span>
    <span class='id matches'>matches</span><span class='period'>.</span><span class='id delete_if'>delete_if</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id match'>match</span><span class='op'>|</span>
      <span class='id text'>text</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
      <span class='id stack'>stack</span> <span class='op'>=</span> <span class='id match'>match</span><span class='period'>.</span><span class='id children'>children</span><span class='period'>.</span><span class='id reverse'>reverse</span>
      <span class='kw'>while</span> <span class='id node'>node</span> <span class='op'>=</span> <span class='id stack'>stack</span><span class='period'>.</span><span class='id pop'>pop</span>
        <span class='kw'>if</span> <span class='id node'>node</span><span class='period'>.</span><span class='id tag?'>tag?</span>
          <span class='id stack'>stack</span><span class='period'>.</span><span class='id concat'>concat</span> <span class='id node'>node</span><span class='period'>.</span><span class='id children'>children</span><span class='period'>.</span><span class='id reverse'>reverse</span>
        <span class='kw'>else</span>
          <span class='id content'>content</span> <span class='op'>=</span> <span class='id node'>node</span><span class='period'>.</span><span class='id content'>content</span>
          <span class='id text'>text</span> <span class='op'>&lt;&lt;</span> <span class='id content'>content</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
      <span class='id text'>text</span><span class='period'>.</span><span class='id strip!'>strip!</span> <span class='kw'>unless</span> <span class='const'>NO_STRIP</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span><span class='id match'>match</span><span class='period'>.</span><span class='id name'>name</span><span class='rparen'>)</span>
      <span class='kw'>unless</span> <span class='id match_with'>match_with</span><span class='period'>.</span><span class='id is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Regexp</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='lparen'>(</span><span class='id text'>text</span> <span class='op'>=~</span> <span class='id match_with'>match_with</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='lparen'>(</span><span class='id text'>text</span> <span class='op'>==</span> <span class='id match_with'>match_with</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rparen'>)</span>
        <span class='id content_mismatch'>content_mismatch</span> <span class='op'>||=</span> <span class='id build_message'>build_message</span><span class='lparen'>(</span><span class='id message'>message</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;?&gt; expected but was\n&lt;?&gt;.</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id match_with'>match_with</span><span class='comma'>,</span> <span class='id text'>text</span><span class='rparen'>)</span>
        <span class='kw'>true</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>elsif</span> <span class='id match_with'>match_with</span> <span class='op'>=</span> <span class='id equals'>equals</span><span class='lbracket'>[</span><span class='symbol'>:html</span><span class='rbracket'>]</span>
    <span class='id matches'>matches</span><span class='period'>.</span><span class='id delete_if'>delete_if</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id match'>match</span><span class='op'>|</span>
      <span class='id html'>html</span> <span class='op'>=</span> <span class='id match'>match</span><span class='period'>.</span><span class='id children'>children</span><span class='period'>.</span><span class='id map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_s</span><span class='rparen'>)</span><span class='period'>.</span><span class='id join'>join</span>
      <span class='id html'>html</span><span class='period'>.</span><span class='id strip!'>strip!</span> <span class='kw'>unless</span> <span class='const'>NO_STRIP</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span><span class='id match'>match</span><span class='period'>.</span><span class='id name'>name</span><span class='rparen'>)</span>
      <span class='kw'>unless</span> <span class='id match_with'>match_with</span><span class='period'>.</span><span class='id is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Regexp</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='lparen'>(</span><span class='id html'>html</span> <span class='op'>=~</span> <span class='id match_with'>match_with</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='lparen'>(</span><span class='id html'>html</span> <span class='op'>==</span> <span class='id match_with'>match_with</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rparen'>)</span>
        <span class='id content_mismatch'>content_mismatch</span> <span class='op'>||=</span> <span class='id build_message'>build_message</span><span class='lparen'>(</span><span class='id message'>message</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;?&gt; expected but was\n&lt;?&gt;.</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id match_with'>match_with</span><span class='comma'>,</span> <span class='id html'>html</span><span class='rparen'>)</span>
        <span class='kw'>true</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='comment'># Expecting foo found bar element only if found zero, not if
</span>  <span class='comment'># found one but expecting two.
</span>  <span class='id message'>message</span> <span class='op'>||=</span> <span class='id content_mismatch'>content_mismatch</span> <span class='kw'>if</span> <span class='id matches'>matches</span><span class='period'>.</span><span class='id empty?'>empty?</span>
  <span class='comment'># Test minimum/maximum occurrence.
</span>  <span class='id min'>min</span><span class='comma'>,</span> <span class='id max'>max</span><span class='comma'>,</span> <span class='id count'>count</span> <span class='op'>=</span> <span class='id equals'>equals</span><span class='lbracket'>[</span><span class='symbol'>:minimum</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id equals'>equals</span><span class='lbracket'>[</span><span class='symbol'>:maximum</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id equals'>equals</span><span class='lbracket'>[</span><span class='symbol'>:count</span><span class='rbracket'>]</span>
  <span class='id message'>message</span> <span class='op'>=</span> <span class='id message'>message</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>%(</span><span class='tstring_content'>Expected </span><span class='embexpr_beg'>#{</span><span class='id count_description'>count_description</span><span class='lparen'>(</span><span class='id min'>min</span><span class='comma'>,</span> <span class='id max'>max</span><span class='comma'>,</span> <span class='id count'>count</span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='tstring_content'> matching &quot;</span><span class='embexpr_beg'>#{</span><span class='id selector'>selector</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rbrace'>}</span><span class='tstring_content'>&quot;, found </span><span class='embexpr_beg'>#{</span><span class='id matches'>matches</span><span class='period'>.</span><span class='id size'>size</span><span class='rbrace'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>)</span></span>
  <span class='kw'>if</span> <span class='id count'>count</span>
    <span class='id assert'>assert</span> <span class='id matches'>matches</span><span class='period'>.</span><span class='id size'>size</span> <span class='op'>==</span> <span class='id count'>count</span><span class='comma'>,</span> <span class='id message'>message</span>
  <span class='kw'>else</span>
    <span class='id assert'>assert</span> <span class='id matches'>matches</span><span class='period'>.</span><span class='id size'>size</span> <span class='op'>&gt;=</span> <span class='id min'>min</span><span class='comma'>,</span> <span class='id message'>message</span> <span class='kw'>if</span> <span class='id min'>min</span>
    <span class='id assert'>assert</span> <span class='id matches'>matches</span><span class='period'>.</span><span class='id size'>size</span> <span class='op'>&lt;=</span> <span class='id max'>max</span><span class='comma'>,</span> <span class='id message'>message</span> <span class='kw'>if</span> <span class='id max'>max</span>
  <span class='kw'>end</span>

  <span class='comment'># If a block is given call that block. Set @selected to allow
</span>  <span class='comment'># nested assert_select, which can be nested several levels deep.
</span>  <span class='kw'>if</span> <span class='id block_given?'>block_given?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id matches'>matches</span><span class='period'>.</span><span class='id empty?'>empty?</span>
    <span class='kw'>begin</span>
      <span class='id in_scope'>in_scope</span><span class='comma'>,</span> <span class='ivar'>@selected</span> <span class='op'>=</span> <span class='ivar'>@selected</span><span class='comma'>,</span> <span class='id matches'>matches</span>
      <span class='kw'>yield</span> <span class='id matches'>matches</span>
    <span class='kw'>ensure</span>
      <span class='ivar'>@selected</span> <span class='op'>=</span> <span class='id in_scope'>in_scope</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Returns all matches elements.
</span>  <span class='id matches'>matches</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="assert_select_email-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>assert_select_email</strong>(&amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
:call-seq:
</p>
<pre class="code">
  <span class='id assert_select_email'>assert_select_email</span> <span class='lbrace'>{</span> <span class='rbrace'>}</span>
</pre>
<p>
Extracts the body of an email and runs nested assertions on it.
</p>
<p>
You must enable deliveries for this assertion to work, use:
</p>
<pre class="code">
  <span class='const'>ActionMailer</span><span class='op'>::</span><span class='const'>Base</span><span class='period'>.</span><span class='id perform_deliveries'>perform_deliveries</span> <span class='op'>=</span> <span class='kw'>true</span>
</pre>
<h4>Examples</h4>
<pre class="code">
 <span class='id assert_select_email'>assert_select_email</span> <span class='kw'>do</span>
   <span class='id assert_select'>assert_select</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>h1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Email alert</span><span class='tstring_end'>&quot;</span></span>
 <span class='kw'>end</span>

 <span class='id assert_select_email'>assert_select_email</span> <span class='kw'>do</span>
   <span class='id items'>items</span> <span class='op'>=</span> <span class='id assert_select'>assert_select</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ol&gt;li</span><span class='tstring_end'>&quot;</span></span>
   <span class='id items'>items</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span>
      <span class='comment'># Work with items here...
</span>   <span class='kw'>end</span>
 <span class='kw'>end</span></pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


567
568
569
570
571
572
573
574
575
576
577
578
579</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'actionpack/lib/action_dispatch/testing/assertions/selector.rb', line 567</span>

<span class='kw'>def</span> <span class='id assert_select_email'>assert_select_email</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='id deliveries'>deliveries</span> <span class='op'>=</span> <span class='const'>ActionMailer</span><span class='op'>::</span><span class='const'>Base</span><span class='period'>.</span><span class='id deliveries'>deliveries</span>
  <span class='id assert'>assert</span> <span class='op'>!</span><span class='id deliveries'>deliveries</span><span class='period'>.</span><span class='id empty?'>empty?</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No e-mail in delivery list</span><span class='tstring_end'>&quot;</span></span>

  <span class='kw'>for</span> <span class='id delivery'>delivery</span> <span class='kw'>in</span> <span class='id deliveries'>deliveries</span>
    <span class='kw'>for</span> <span class='id part'>part</span> <span class='kw'>in</span> <span class='id delivery'>delivery</span><span class='period'>.</span><span class='id parts'>parts</span>
      <span class='kw'>if</span> <span class='id part'>part</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Content-Type</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id to_s'>to_s</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^text\/html\W</span><span class='regexp_end'>/</span></span>
        <span class='id root'>root</span> <span class='op'>=</span> <span class='const'>HTML</span><span class='op'>::</span><span class='const'>Document</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id part'>part</span><span class='period'>.</span><span class='id body'>body</span><span class='rparen'>)</span><span class='period'>.</span><span class='id root'>root</span>
        <span class='id assert_select'>assert_select</span> <span class='id root'>root</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:root</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="assert_select_encoded-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>assert_select_encoded</strong>(element = nil, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
:call-seq:
</p>
<pre class="code">
  assert_select_encoded(element?) { |elements| ... }
</pre>
<p>
Extracts the content of an element, treats it as encoded HTML and runs
nested assertion on it.
</p>
<p>
You typically call this method within another assertion to operate on all
currently selected elements. You can also pass an element or array of
elements.
</p>
<p>
The content of each element is un-encoded, and wrapped in the root element
<tt>encoded</tt>. It then calls the block with all un-encoded elements.
</p>
<h4>Examples</h4>
<pre class="code">
  <span class='comment'># Selects all bold tags from within the title of an ATOM feed's entries (perhaps to nab a section name prefix)
</span>  <span class='id assert_select_feed'>assert_select_feed</span> <span class='symbol'>:atom</span><span class='comma'>,</span> <span class='float'>1.0</span> <span class='kw'>do</span>
    <span class='comment'># Select each entry item and then the title item
</span>    <span class='id assert_select'>assert_select</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>entry&gt;title</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='comment'># Run assertions on the encoded title elements
</span>      <span class='id assert_select_encoded'>assert_select_encoded</span> <span class='kw'>do</span>
        <span class='id assert_select'>assert_select</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>b</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># Selects all paragraph tags from within the description of an RSS feed
</span>  <span class='id assert_select_feed'>assert_select_feed</span> <span class='symbol'>:rss</span><span class='comma'>,</span> <span class='float'>2.0</span> <span class='kw'>do</span>
    <span class='comment'># Select description element of each feed item.
</span>    <span class='id assert_select'>assert_select</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>channel&gt;item&gt;description</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
      <span class='comment'># Run assertions on the encoded elements.
</span>      <span class='id assert_select_encoded'>assert_select_encoded</span> <span class='kw'>do</span>
        <span class='id assert_select'>assert_select</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>p</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span></pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'actionpack/lib/action_dispatch/testing/assertions/selector.rb', line 513</span>

<span class='kw'>def</span> <span class='id assert_select_encoded'>assert_select_encoded</span><span class='lparen'>(</span><span class='id element'>element</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id element'>element</span>
    <span class='kw'>when</span> <span class='const'>Array</span>
      <span class='id elements'>elements</span> <span class='op'>=</span> <span class='id element'>element</span>
    <span class='kw'>when</span> <span class='const'>HTML</span><span class='op'>::</span><span class='const'>Node</span>
      <span class='id elements'>elements</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id element'>element</span><span class='rbracket'>]</span>
    <span class='kw'>when</span> <span class='kw'>nil</span>
      <span class='kw'>unless</span> <span class='id elements'>elements</span> <span class='op'>=</span> <span class='ivar'>@selected</span>
        <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>First argument is optional, but must be called from a nested assert_select</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Argument is optional, and may be node or array of nodes</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id fix_content'>fix_content</span> <span class='op'>=</span> <span class='id lambda'>lambda</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id node'>node</span><span class='op'>|</span>
    <span class='comment'># Gets around a bug in the Rails 1.1 HTML parser.
</span>    <span class='id node'>node</span><span class='period'>.</span><span class='id content'>content</span><span class='period'>.</span><span class='id gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>&lt;!\[CDATA\[(.*)(\]\]&gt;)?</span><span class='regexp_end'>/m</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='const'>Rack</span><span class='op'>::</span><span class='const'>Utils</span><span class='period'>.</span><span class='id escapeHTML'>escapeHTML</span><span class='lparen'>(</span><span class='backref'>$1</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='id selected'>selected</span> <span class='op'>=</span> <span class='id elements'>elements</span><span class='period'>.</span><span class='id map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id element'>element</span><span class='op'>|</span>
    <span class='id text'>text</span> <span class='op'>=</span> <span class='id element'>element</span><span class='period'>.</span><span class='id children'>children</span><span class='period'>.</span><span class='id select'>select</span><span class='lbrace'>{</span> <span class='op'>|</span><span class='id c'>c</span><span class='op'>|</span> <span class='kw'>not</span> <span class='id c'>c</span><span class='period'>.</span><span class='id tag?'>tag?</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id map'>map</span><span class='lbrace'>{</span> <span class='op'>|</span><span class='id c'>c</span><span class='op'>|</span> <span class='id fix_content'>fix_content</span><span class='lbracket'>[</span><span class='id c'>c</span><span class='rbracket'>]</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id join'>join</span>
    <span class='id root'>root</span> <span class='op'>=</span> <span class='const'>HTML</span><span class='op'>::</span><span class='const'>Document</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='const'>CGI</span><span class='period'>.</span><span class='id unescapeHTML'>unescapeHTML</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;encoded&gt;</span><span class='embexpr_beg'>#{</span><span class='id text'>text</span><span class='rbrace'>}</span><span class='tstring_content'>&lt;/encoded&gt;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id root'>root</span>
    <span class='id css_select'>css_select</span><span class='lparen'>(</span><span class='id root'>root</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>encoded:root</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='kw'>begin</span>
    <span class='id old_selected'>old_selected</span><span class='comma'>,</span> <span class='ivar'>@selected</span> <span class='op'>=</span> <span class='ivar'>@selected</span><span class='comma'>,</span> <span class='id selected'>selected</span>
    <span class='id assert_select'>assert_select</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:root</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span>
  <span class='kw'>ensure</span>
    <span class='ivar'>@selected</span> <span class='op'>=</span> <span class='id old_selected'>old_selected</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="assert_select_rjs-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>assert_select_rjs</strong>(*args, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
:call-seq:
</p>
<pre class="code">
  assert_select_rjs(id?) { |elements| ... }
  assert_select_rjs(statement, id?) { |elements| ... }
  assert_select_rjs(:insert, position, id?) { |elements| ... }
</pre>
<p>
Selects content from the RJS response.
</p>
<h3>Narrowing down</h3>
<p>
With no arguments, asserts that one or more elements are updated or
inserted by RJS statements.
</p>
<p>
Use the <tt>id</tt> argument to narrow down the assertion to only
statements that update or insert an element with that identifier.
</p>
<p>
Use the first argument to narrow down assertions to only statements of that
type. Possible values are <tt>:replace</tt>, <tt>:replace_html</tt>,
<tt>:show</tt>, <tt>:hide</tt>, <tt>:toggle</tt>, <tt>:remove&lt;/tta&gt;,
&lt;tt&gt;:insert_html</tt> and <tt>:redirect</tt>.
</p>
<p>
Use the argument <tt>:insert</tt> followed by an insertion position to
narrow down the assertion to only statements that insert elements in that
position. Possible values are <tt>:top</tt>, <tt>:bottom</tt>,
<tt>:before</tt> and <tt>:after</tt>.
</p>
<p>
Use the argument <tt>:redirect</tt> followed by a path to check that an
statement which redirects to the specified path is generated.
</p>
<p>
Using the <tt>:remove</tt> statement, you will be able to pass a block, but
it will be ignored as there is no HTML passed for this statement.
</p>
<h3>Using blocks</h3>
<p>
Without a block, <tt>assert_select_rjs</tt> merely asserts that the
response contains one or more RJS statements that replace or update
content.
</p>
<p>
With a block, <tt>assert_select_rjs</tt> also selects all elements used in
these statements and passes them to the block. Nested assertions are
supported.
</p>
<p>
Calling <tt>assert_select_rjs</tt> with no arguments and using nested
asserts asserts that the HTML content is returned by one or more RJS
statements. Using <tt>assert_select</tt> directly makes the same assertion
on the content, but without distinguishing whether the content is returned
in an HTML or JavaScript.
</p>
<h4>Examples</h4>
<pre class="code">
  # Replacing the element foo.
  # page.replace 'foo', ...
  assert_select_rjs :replace, &quot;foo&quot;

  # Replacing with the chained RJS proxy.
  # page[:foo].replace ...
  assert_select_rjs :chained_replace, 'foo'

  # Inserting into the element bar, top position.
  assert_select_rjs :insert, :top, &quot;bar&quot;

  # Remove the element bar
  assert_select_rjs :remove, &quot;bar&quot;

  # Changing the element foo, with an image.
  assert_select_rjs &quot;foo&quot; do
    assert_select &quot;img[src=/images/logo.gif&quot;&quot;
  end

  # RJS inserts or updates a list with four items.
  assert_select_rjs do
    assert_select &quot;ol&gt;li&quot;, 4
  end

  # The same, but shorter.
  assert_select &quot;ol&gt;li&quot;, 4

  # Checking for a redirect.
  assert_select_rjs :redirect, root_path</pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'actionpack/lib/action_dispatch/testing/assertions/selector.rb', line 412</span>

<span class='kw'>def</span> <span class='id assert_select_rjs'>assert_select_rjs</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='id rjs_type'>rjs_type</span> <span class='op'>=</span> <span class='id args'>args</span><span class='period'>.</span><span class='id first'>first</span><span class='period'>.</span><span class='id is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id args'>args</span><span class='period'>.</span><span class='id shift'>shift</span> <span class='op'>:</span> <span class='kw'>nil</span>
  <span class='id id'>id</span>       <span class='op'>=</span> <span class='id args'>args</span><span class='period'>.</span><span class='id first'>first</span><span class='period'>.</span><span class='id is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id args'>args</span><span class='period'>.</span><span class='id shift'>shift</span> <span class='op'>:</span> <span class='kw'>nil</span>

  <span class='comment'># If the first argument is a symbol, it's the type of RJS statement we're looking
</span>  <span class='comment'># for (update, replace, insertion, etc). Otherwise, we're looking for just about
</span>  <span class='comment'># any RJS statement.
</span>  <span class='kw'>if</span> <span class='id rjs_type'>rjs_type</span>
    <span class='kw'>if</span> <span class='id rjs_type'>rjs_type</span> <span class='op'>==</span> <span class='symbol'>:insert</span>
      <span class='id position'>position</span>  <span class='op'>=</span> <span class='id args'>args</span><span class='period'>.</span><span class='id shift'>shift</span>
      <span class='id id'>id</span> <span class='op'>=</span> <span class='id args'>args</span><span class='period'>.</span><span class='id shift'>shift</span>
      <span class='id insertion'>insertion</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>insert_</span><span class='embexpr_beg'>#{</span><span class='id position'>position</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id to_sym'>to_sym</span>
      <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unknown RJS insertion type </span><span class='embexpr_beg'>#{</span><span class='id position'>position</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='const'>RJS_STATEMENTS</span><span class='lbracket'>[</span><span class='id insertion'>insertion</span><span class='rbracket'>]</span>
      <span class='id statement'>statement</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='const'>RJS_STATEMENTS</span><span class='lbracket'>[</span><span class='id insertion'>insertion</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>else</span>
      <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unknown RJS statement type </span><span class='embexpr_beg'>#{</span><span class='id rjs_type'>rjs_type</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='const'>RJS_STATEMENTS</span><span class='lbracket'>[</span><span class='id rjs_type'>rjs_type</span><span class='rbracket'>]</span>
      <span class='id statement'>statement</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='const'>RJS_STATEMENTS</span><span class='lbracket'>[</span><span class='id rjs_type'>rjs_type</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id statement'>statement</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>RJS_STATEMENTS</span><span class='lbracket'>[</span><span class='symbol'>:any</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># Next argument we're looking for is the element identifier. If missing, we pick
</span>  <span class='comment'># any element, otherwise we replace it in the statement.
</span>  <span class='id pattern'>pattern</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span>
    <span class='id id'>id</span> <span class='op'>?</span> <span class='id statement'>statement</span><span class='period'>.</span><span class='id gsub'>gsub</span><span class='lparen'>(</span><span class='const'>RJS_ANY_ID</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\&quot;</span><span class='embexpr_beg'>#{</span><span class='id id'>id</span><span class='rbrace'>}</span><span class='tstring_content'>\&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id statement'>statement</span>
  <span class='rparen'>)</span>

  <span class='comment'># Duplicate the body since the next step involves destroying it.
</span>  <span class='id matches'>matches</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>case</span> <span class='id rjs_type'>rjs_type</span>
    <span class='kw'>when</span> <span class='symbol'>:remove</span><span class='comma'>,</span> <span class='symbol'>:show</span><span class='comma'>,</span> <span class='symbol'>:hide</span><span class='comma'>,</span> <span class='symbol'>:toggle</span>
      <span class='id matches'>matches</span> <span class='op'>=</span> <span class='ivar'>@response</span><span class='period'>.</span><span class='id body'>body</span><span class='period'>.</span><span class='id match'>match</span><span class='lparen'>(</span><span class='id pattern'>pattern</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='ivar'>@response</span><span class='period'>.</span><span class='id body'>body</span><span class='period'>.</span><span class='id gsub'>gsub</span><span class='lparen'>(</span><span class='id pattern'>pattern</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id match'>match</span><span class='op'>|</span>
        <span class='id html'>html</span> <span class='op'>=</span> <span class='id unescape_rjs'>unescape_rjs</span><span class='lparen'>(</span><span class='id match'>match</span><span class='rparen'>)</span>
        <span class='id matches'>matches</span> <span class='op'>||=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
        <span class='id matches'>matches</span><span class='period'>.</span><span class='id concat'>concat</span> <span class='const'>HTML</span><span class='op'>::</span><span class='const'>Document</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id html'>html</span><span class='rparen'>)</span><span class='period'>.</span><span class='id root'>root</span><span class='period'>.</span><span class='id children'>children</span><span class='period'>.</span><span class='id select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id n'>n</span><span class='op'>|</span> <span class='id n'>n</span><span class='period'>.</span><span class='id tag?'>tag?</span> <span class='rbrace'>}</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id matches'>matches</span>
    <span class='id assert_block'>assert_block</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='kw'>true</span> <span class='rbrace'>}</span> <span class='comment'># to count the assertion
</span>    <span class='kw'>if</span> <span class='id block_given?'>block_given?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='symbol'>:remove</span><span class='comma'>,</span> <span class='symbol'>:show</span><span class='comma'>,</span> <span class='symbol'>:hide</span><span class='comma'>,</span> <span class='symbol'>:toggle</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id include?'>include?</span> <span class='id rjs_type'>rjs_type</span><span class='rparen'>)</span>
      <span class='kw'>begin</span>
        <span class='id in_scope'>in_scope</span><span class='comma'>,</span> <span class='ivar'>@selected</span> <span class='op'>=</span> <span class='ivar'>@selected</span><span class='comma'>,</span> <span class='id matches'>matches</span>
        <span class='kw'>yield</span> <span class='id matches'>matches</span>
      <span class='kw'>ensure</span>
        <span class='ivar'>@selected</span> <span class='op'>=</span> <span class='id in_scope'>in_scope</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id matches'>matches</span>
  <span class='kw'>else</span>
    <span class='comment'># RJS statement not found.
</span>    <span class='kw'>case</span> <span class='id rjs_type'>rjs_type</span>
      <span class='kw'>when</span> <span class='symbol'>:remove</span><span class='comma'>,</span> <span class='symbol'>:show</span><span class='comma'>,</span> <span class='symbol'>:hide</span><span class='comma'>,</span> <span class='symbol'>:toggle</span>
        <span class='id flunk_message'>flunk_message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No RJS statement that </span><span class='embexpr_beg'>#{</span><span class='id rjs_type'>rjs_type</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rbrace'>}</span><span class='tstring_content'>s '</span><span class='embexpr_beg'>#{</span><span class='id id'>id</span><span class='rbrace'>}</span><span class='tstring_content'>' was rendered.</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>else</span>
        <span class='id flunk_message'>flunk_message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No RJS statement that replaces or inserts HTML content.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id flunk'>flunk</span> <span class='id args'>args</span><span class='period'>.</span><span class='id shift'>shift</span> <span class='op'>||</span> <span class='id flunk_message'>flunk_message</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="count_description-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>count_description</strong>(min, max, count) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
:nodoc:
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


321
322
323
324
325
326
327
328
329
330
331
332
333</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'actionpack/lib/action_dispatch/testing/assertions/selector.rb', line 321</span>

<span class='kw'>def</span> <span class='id count_description'>count_description</span><span class='lparen'>(</span><span class='id min'>min</span><span class='comma'>,</span> <span class='id max'>max</span><span class='comma'>,</span> <span class='id count'>count</span><span class='rparen'>)</span> <span class='comment'>#:nodoc:
</span>  <span class='id pluralize'>pluralize</span> <span class='op'>=</span> <span class='id lambda'>lambda</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id word'>word</span><span class='comma'>,</span> <span class='id quantity'>quantity</span><span class='op'>|</span> <span class='id word'>word</span> <span class='op'>&lt;&lt;</span> <span class='lparen'>(</span><span class='id quantity'>quantity</span> <span class='op'>==</span> <span class='int'>1</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>s</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='rbrace'>}</span>

  <span class='kw'>if</span> <span class='id min'>min</span> <span class='op'>&amp;&amp;</span> <span class='id max'>max</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id max'>max</span> <span class='op'>!=</span> <span class='id min'>min</span><span class='rparen'>)</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>between </span><span class='embexpr_beg'>#{</span><span class='id min'>min</span><span class='rbrace'>}</span><span class='tstring_content'> and </span><span class='embexpr_beg'>#{</span><span class='id max'>max</span><span class='rbrace'>}</span><span class='tstring_content'> elements</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='id min'>min</span> <span class='op'>&amp;&amp;</span> <span class='id max'>max</span> <span class='op'>&amp;&amp;</span> <span class='id max'>max</span> <span class='op'>==</span> <span class='id min'>min</span> <span class='op'>&amp;&amp;</span> <span class='id count'>count</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>exactly </span><span class='embexpr_beg'>#{</span><span class='id count'>count</span><span class='rbrace'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id pluralize'>pluralize</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>element</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id min'>min</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='id min'>min</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='lparen'>(</span><span class='id min'>min</span> <span class='op'>==</span> <span class='int'>1</span> <span class='op'>&amp;&amp;</span> <span class='id max'>max</span> <span class='op'>==</span> <span class='int'>1</span><span class='rparen'>)</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>at least </span><span class='embexpr_beg'>#{</span><span class='id min'>min</span><span class='rbrace'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id pluralize'>pluralize</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>element</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id min'>min</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='id max'>max</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>at most </span><span class='embexpr_beg'>#{</span><span class='id max'>max</span><span class='rbrace'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id pluralize'>pluralize</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>element</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id max'>max</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="css_select-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>css_select</strong>(*args) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
:call-seq:
</p>
<pre class="code">
  css_select(selector) =&gt; array
  css_select(element, selector) =&gt; array
</pre>
<p>
Select and return all matching elements.
</p>
<p>
If called with a single argument, uses that argument as a selector to match
all elements of the current page. Returns an empty array if no match is
found.
</p>
<p>
If called with two arguments, uses the first argument as the base element
and the second argument as the selector. Attempts to match the base element
and any of its children. Returns an empty array if no match is found.
</p>
<p>
The selector may be a CSS selector expression (String), an expression with
substitution values (Array) or an HTML::Selector object.
</p>
<h4>Examples</h4>
<pre class="code">
  # Selects all div tags
  divs = css_select(&quot;div&quot;)

  # Selects all paragraph tags and does something interesting
  pars = css_select(&quot;p&quot;)
  pars.each do |par|
    # Do something fun with paragraphs here...
  end

  # Selects all list items in unordered lists
  items = css_select(&quot;ul&gt;li&quot;)

  # Selects all form tags and then all inputs inside the form
  forms = css_select(&quot;form&quot;)
  forms.each do |form|
    inputs = css_select(form, &quot;input&quot;)
    ...
  end</pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'actionpack/lib/action_dispatch/testing/assertions/selector.rb', line 65</span>

<span class='kw'>def</span> <span class='id css_select'>css_select</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>
  <span class='comment'># See assert_select to understand what's going on here.
</span>  <span class='id arg'>arg</span> <span class='op'>=</span> <span class='id args'>args</span><span class='period'>.</span><span class='id shift'>shift</span>

  <span class='kw'>if</span> <span class='id arg'>arg</span><span class='period'>.</span><span class='id is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>HTML</span><span class='op'>::</span><span class='const'>Node</span><span class='rparen'>)</span>
    <span class='id root'>root</span> <span class='op'>=</span> <span class='id arg'>arg</span>
    <span class='id arg'>arg</span> <span class='op'>=</span> <span class='id args'>args</span><span class='period'>.</span><span class='id shift'>shift</span>
  <span class='kw'>elsif</span> <span class='id arg'>arg</span> <span class='op'>==</span> <span class='kw'>nil</span>
    <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>First argument is either selector or element to select, but nil found. Perhaps you called assert_select with an element that does not exist?</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='ivar'>@selected</span>
    <span class='id matches'>matches</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

    <span class='ivar'>@selected</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id selected'>selected</span><span class='op'>|</span>
      <span class='id subset'>subset</span> <span class='op'>=</span> <span class='id css_select'>css_select</span><span class='lparen'>(</span><span class='id selected'>selected</span><span class='comma'>,</span> <span class='const'>HTML</span><span class='op'>::</span><span class='const'>Selector</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id arg'>arg</span><span class='period'>.</span><span class='id dup'>dup</span><span class='comma'>,</span> <span class='id args'>args</span><span class='period'>.</span><span class='id dup'>dup</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id subset'>subset</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id match'>match</span><span class='op'>|</span>
        <span class='id matches'>matches</span> <span class='op'>&lt;&lt;</span> <span class='id match'>match</span> <span class='kw'>unless</span> <span class='id matches'>matches</span><span class='period'>.</span><span class='id any?'>any?</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id m'>m</span><span class='op'>|</span> <span class='id m'>m</span><span class='period'>.</span><span class='id equal?'>equal?</span><span class='lparen'>(</span><span class='id match'>match</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='id matches'>matches</span>
  <span class='kw'>else</span>
    <span class='id root'>root</span> <span class='op'>=</span> <span class='id response_from_page_or_rjs'>response_from_page_or_rjs</span>
  <span class='kw'>end</span>

  <span class='kw'>case</span> <span class='id arg'>arg</span>
    <span class='kw'>when</span> <span class='const'>String</span>
      <span class='id selector'>selector</span> <span class='op'>=</span> <span class='const'>HTML</span><span class='op'>::</span><span class='const'>Selector</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id arg'>arg</span><span class='comma'>,</span> <span class='id args'>args</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>Array</span>
      <span class='id selector'>selector</span> <span class='op'>=</span> <span class='const'>HTML</span><span class='op'>::</span><span class='const'>Selector</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='op'>*</span><span class='id arg'>arg</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>HTML</span><span class='op'>::</span><span class='const'>Selector</span>
      <span class='id selector'>selector</span> <span class='op'>=</span> <span class='id arg'>arg</span>
    <span class='kw'>else</span> <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Expecting a selector as the first argument</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id selector'>selector</span><span class='period'>.</span><span class='id select'>select</span><span class='lparen'>(</span><span class='id root'>root</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Thu Nov  4 20:04:23 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.1 (ruby-1.9.2).
</div>

  </body>
</html>