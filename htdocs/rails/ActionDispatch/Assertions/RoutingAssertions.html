<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Module: ActionDispatch::Assertions::RoutingAssertions</title>
<link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (R)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../ActionDispatch.html" title="ActionDispatch (module)">ActionDispatch</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Assertions.html" title="ActionDispatch::Assertions (module)">Assertions</a></span></span>
     &raquo; 
    <span class="title">RoutingAssertions</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Module: ActionDispatch::Assertions::RoutingAssertions
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">actionpack/lib/action_dispatch/testing/assertions/routing.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
Suite of assertions to test routes generated by \Rails and the handling of
requests made to them.
</p>


  </div>
</div>
<div class="tags">
  
</div>


  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#assert_generates-instance_method" title="#assert_generates (instance method)">- (Object) <strong>assert_generates</strong>(expected_path, options, defaults = {}, extras = {}, message = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Asserts that the provided options can be used to generate the provided
path.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#assert_recognizes-instance_method" title="#assert_recognizes (instance method)">- (Object) <strong>assert_recognizes</strong>(expected_options, path, extras = {}, message = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Asserts that the routing of the given <tt>path</tt> was handled correctly
and that the parsed options (given in the <tt>expected_options</tt> hash)
match <tt>path</tt>.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#assert_routing-instance_method" title="#assert_routing (instance method)">- (Object) <strong>assert_routing</strong>(path, options, defaults = {}, extras = {}, message = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Asserts that path and options match both ways; in other words, it verifies
that <tt>path</tt> generates <tt>options</tt> and then that
<tt>options</tt> generates <tt>path</tt>.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#method_missing-instance_method" title="#method_missing (instance method)">- (Object) <strong>method_missing</strong>(selector, *args, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
ROUTES TODO: These assertions should really work in an integration context.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#with_routing-instance_method" title="#with_routing (instance method)">- (Object) <strong>with_routing</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
A helper to make it easier to test different route configurations.
</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="method_missing_details" class="method_details_list">
  <h2>Dynamic Method Handling</h2>
  <p class="notice this">
    This class handles dynamic methods through the <tt>method_missing</tt> method
    
  </p>
  
    <div class="method_details first">
  <p class="signature first" id="method_missing-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>method_missing</strong>(selector, *args, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
ROUTES TODO: These assertions should really work in an integration context
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


173
174
175
176
177
178
179</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'actionpack/lib/action_dispatch/testing/assertions/routing.rb', line 173</span>

<span class='kw'>def</span> <span class='id method_missing'>method_missing</span><span class='lparen'>(</span><span class='id selector'>selector</span><span class='comma'>,</span> <span class='op'>*</span><span class='id args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='ivar'>@controller</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@routes</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@routes</span><span class='period'>.</span><span class='id named_routes'>named_routes</span><span class='period'>.</span><span class='id helpers'>helpers</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span><span class='id selector'>selector</span><span class='rparen'>)</span>
    <span class='ivar'>@controller</span><span class='period'>.</span><span class='id send'>send</span><span class='lparen'>(</span><span class='id selector'>selector</span><span class='comma'>,</span> <span class='op'>*</span><span class='id args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='kw'>super</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="assert_generates-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>assert_generates</strong>(expected_path, options, defaults = {}, extras = {}, message = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Asserts that the provided options can be used to generate the provided
path.  This is the inverse of <tt>assert_recognizes</tt>. The
<tt>extras</tt> parameter is used to tell the request the names and values
of additional request parameters that would be in a query string. The
<tt>message</tt> parameter allows you to specify a custom error message for
assertion failures.
</p>
<p>
The <tt>defaults</tt> parameter is unused.
</p>
<h4>Examples</h4>
<pre class="code">
  <span class='comment'># Asserts that the default action is generated for a route with no action
</span>  <span class='id assert_generates'>assert_generates</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/items</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:controller</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>items</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:action</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>index</span><span class='tstring_end'>&quot;</span></span>

  <span class='comment'># Tests that the list action is properly routed
</span>  <span class='id assert_generates'>assert_generates</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/items/list</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:controller</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>items</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:action</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>list</span><span class='tstring_end'>&quot;</span></span>

  <span class='comment'># Tests the generation of a route with a parameter
</span>  <span class='id assert_generates'>assert_generates</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/items/list/1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='symbol'>:controller</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>items</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:action</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>list</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:id</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>

  <span class='comment'># Asserts that the generated route gives us our custom route
</span>  <span class='id assert_generates'>assert_generates</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>changesets/12</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='symbol'>:controller</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>scm</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:action</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>show_diff</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:revision</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>12</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span></pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'actionpack/lib/action_dispatch/testing/assertions/routing.rb', line 73</span>

<span class='kw'>def</span> <span class='id assert_generates'>assert_generates</span><span class='lparen'>(</span><span class='id expected_path'>expected_path</span><span class='comma'>,</span> <span class='id options'>options</span><span class='comma'>,</span> <span class='id defaults'>defaults</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='id extras'>extras</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='id message'>message</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id expected_path'>expected_path</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>://</span><span class='regexp_end'>}</span></span>
    <span class='kw'>begin</span>
      <span class='id uri'>uri</span> <span class='op'>=</span> <span class='const'>URI</span><span class='period'>.</span><span class='id parse'>parse</span><span class='lparen'>(</span><span class='id expected_path'>expected_path</span><span class='rparen'>)</span>
      <span class='id expected_path'>expected_path</span> <span class='op'>=</span> <span class='id uri'>uri</span><span class='period'>.</span><span class='id path'>path</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='period'>.</span><span class='id empty?'>empty?</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id uri'>uri</span><span class='period'>.</span><span class='id path'>path</span>
    <span class='kw'>rescue</span> <span class='const'>URI</span><span class='op'>::</span><span class='const'>InvalidURIError</span> <span class='op'>=&gt;</span> <span class='id e'>e</span>
      <span class='id raise'>raise</span> <span class='const'>ActionController</span><span class='op'>::</span><span class='const'>RoutingError</span><span class='comma'>,</span> <span class='id e'>e</span><span class='period'>.</span><span class='id message'>message</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id expected_path'>expected_path</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id expected_path'>expected_path</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id expected_path'>expected_path</span><span class='period'>.</span><span class='id first'>first</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>
  <span class='comment'># Load routes.rb if it hasn't been loaded.
</span>
  <span class='id generated_path'>generated_path</span><span class='comma'>,</span> <span class='id extra_keys'>extra_keys</span> <span class='op'>=</span> <span class='ivar'>@routes</span><span class='period'>.</span><span class='id generate_extras'>generate_extras</span><span class='lparen'>(</span><span class='id options'>options</span><span class='comma'>,</span> <span class='id defaults'>defaults</span><span class='rparen'>)</span>
  <span class='id found_extras'>found_extras</span> <span class='op'>=</span> <span class='id options'>options</span><span class='period'>.</span><span class='id reject'>reject</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id k'>k</span><span class='comma'>,</span> <span class='id v'>v</span><span class='op'>|</span> <span class='op'>!</span> <span class='id extra_keys'>extra_keys</span><span class='period'>.</span><span class='id include?'>include?</span> <span class='id k'>k</span><span class='rbrace'>}</span>

  <span class='id msg'>msg</span> <span class='op'>=</span> <span class='id build_message'>build_message</span><span class='lparen'>(</span><span class='id message'>message</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>found extras &lt;?&gt;, not &lt;?&gt;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id found_extras'>found_extras</span><span class='comma'>,</span> <span class='id extras'>extras</span><span class='rparen'>)</span>
  <span class='id assert_block'>assert_block</span><span class='lparen'>(</span><span class='id msg'>msg</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='id found_extras'>found_extras</span> <span class='op'>==</span> <span class='id extras'>extras</span> <span class='rbrace'>}</span>

  <span class='id msg'>msg</span> <span class='op'>=</span> <span class='id build_message'>build_message</span><span class='lparen'>(</span><span class='id message'>message</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The generated path &lt;?&gt; did not match &lt;?&gt;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id generated_path'>generated_path</span><span class='comma'>,</span>
      <span class='id expected_path'>expected_path</span><span class='rparen'>)</span>
  <span class='id assert_block'>assert_block</span><span class='lparen'>(</span><span class='id msg'>msg</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='id expected_path'>expected_path</span> <span class='op'>==</span> <span class='id generated_path'>generated_path</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="assert_recognizes-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>assert_recognizes</strong>(expected_options, path, extras = {}, message = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Asserts that the routing of the given <tt>path</tt> was handled correctly
and that the parsed options (given in the <tt>expected_options</tt> hash)
match <tt>path</tt>.  Basically, it asserts that \Rails recognizes the
route given by <tt>expected_options</tt>.
</p>
<p>
Pass a hash in the second argument (<tt>path</tt>) to specify the request
method.  This is useful for routes requiring a specific HTTP method.  The
hash should contain a :path with the incoming request path and a :method
containing the required HTTP verb.
</p>
<pre class="code">
  <span class='comment'># assert that POSTing to /items will call the create action on ItemsController
</span>  <span class='id assert_recognizes'>assert_recognizes</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='symbol'>:controller</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>items</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:action</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>create</span><span class='tstring_end'>'</span></span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:path</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>items</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:method</span> <span class='op'>=&gt;</span> <span class='symbol'>:post</span><span class='rbrace'>}</span><span class='rparen'>)</span>
</pre>
<p>
You can also pass in <tt>extras</tt> with a hash containing URL parameters
that would normally be in the query string.  This can be used to assert
that values in the query string string will end up in the params hash
correctly.  To test query strings you must use the extras argument,
appending the query string on the path directly will not work.  For
example:
</p>
<pre class="code">
  <span class='comment'># assert that a path of '/items/list/1?view=print' returns the correct options
</span>  <span class='id assert_recognizes'>assert_recognizes</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='symbol'>:controller</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>items</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:action</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>list</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:id</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>1</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:view</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>print</span><span class='tstring_end'>'</span></span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>items/list/1</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='symbol'>:view</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>print</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='rparen'>)</span>
</pre>
<p>
The <tt>message</tt> parameter allows you to pass in an error message that
is displayed upon failure.
</p>
<h4>Examples</h4>
<pre class="code">
  <span class='comment'># Check the default route (i.e., the index action)
</span>  <span class='id assert_recognizes'>assert_recognizes</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='symbol'>:controller</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>items</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:action</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>index</span><span class='tstring_end'>'</span></span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>items</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>

  <span class='comment'># Test a specific action
</span>  <span class='id assert_recognizes'>assert_recognizes</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='symbol'>:controller</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>items</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:action</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>list</span><span class='tstring_end'>'</span></span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>items/list</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>

  <span class='comment'># Test an action with a parameter
</span>  <span class='id assert_recognizes'>assert_recognizes</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='symbol'>:controller</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>items</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:action</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>destroy</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:id</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>1</span><span class='tstring_end'>'</span></span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>items/destroy/1</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>

  <span class='comment'># Test a custom route
</span>  <span class='id assert_recognizes'>assert_recognizes</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='symbol'>:controller</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>items</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:action</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>show</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:id</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>1</span><span class='tstring_end'>'</span></span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>view/item1</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>

  <span class='comment'># Check a Simply RESTful generated route
</span>  <span class='id assert_recognizes'>assert_recognizes</span> <span class='id list_items_url'>list_items_url</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>items/list</span><span class='tstring_end'>'</span></span></pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


43
44
45
46
47
48
49
50
51
52
53</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'actionpack/lib/action_dispatch/testing/assertions/routing.rb', line 43</span>

<span class='kw'>def</span> <span class='id assert_recognizes'>assert_recognizes</span><span class='lparen'>(</span><span class='id expected_options'>expected_options</span><span class='comma'>,</span> <span class='id path'>path</span><span class='comma'>,</span> <span class='id extras'>extras</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='id message'>message</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id request'>request</span> <span class='op'>=</span> <span class='id recognized_request_for'>recognized_request_for</span><span class='lparen'>(</span><span class='id path'>path</span><span class='rparen'>)</span>

  <span class='id expected_options'>expected_options</span> <span class='op'>=</span> <span class='id expected_options'>expected_options</span><span class='period'>.</span><span class='id clone'>clone</span>
  <span class='id extras'>extras</span><span class='period'>.</span><span class='id each_key'>each_key</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id key'>key</span><span class='op'>|</span> <span class='id expected_options'>expected_options</span><span class='period'>.</span><span class='id delete'>delete</span> <span class='id key'>key</span> <span class='rbrace'>}</span> <span class='kw'>unless</span> <span class='id extras'>extras</span><span class='period'>.</span><span class='id nil?'>nil?</span>

  <span class='id expected_options'>expected_options</span><span class='period'>.</span><span class='id stringify_keys!'>stringify_keys!</span>
  <span class='id msg'>msg</span> <span class='op'>=</span> <span class='id build_message'>build_message</span><span class='lparen'>(</span><span class='id message'>message</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The recognized options &lt;?&gt; did not match &lt;?&gt;, difference: &lt;?&gt;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='id request'>request</span><span class='period'>.</span><span class='id path_parameters'>path_parameters</span><span class='comma'>,</span> <span class='id expected_options'>expected_options</span><span class='comma'>,</span> <span class='id expected_options'>expected_options</span><span class='period'>.</span><span class='id diff'>diff</span><span class='lparen'>(</span><span class='id request'>request</span><span class='period'>.</span><span class='id path_parameters'>path_parameters</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id assert_block'>assert_block</span><span class='lparen'>(</span><span class='id msg'>msg</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='id request'>request</span><span class='period'>.</span><span class='id path_parameters'>path_parameters</span> <span class='op'>==</span> <span class='id expected_options'>expected_options</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="assert_routing-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>assert_routing</strong>(path, options, defaults = {}, extras = {}, message = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Asserts that path and options match both ways; in other words, it verifies
that <tt>path</tt> generates <tt>options</tt> and then that
<tt>options</tt> generates <tt>path</tt>.  This essentially combines
<tt>assert_recognizes</tt> and <tt>assert_generates</tt> into one step.
</p>
<p>
The <tt>extras</tt> hash allows you to specify options that would normally
be provided as a query string to the action.  The <tt>message</tt>
parameter allows you to specify a custom error message to display upon
failure.
</p>
<h4>Examples</h4>
<pre class="code">
 <span class='comment'># Assert a basic route: a controller with the default action (index)
</span> <span class='id assert_routing'>assert_routing</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/home</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:controller</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>home</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:action</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>index</span><span class='tstring_end'>'</span></span>

 <span class='comment'># Test a route generated with a specific controller, action, and parameter (id)
</span> <span class='id assert_routing'>assert_routing</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/entries/show/23</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:controller</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>entries</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:action</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>show</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:id</span> <span class='op'>=&gt;</span> <span class='int'>23</span>

 <span class='comment'># Assert a basic route (controller + default action), with an error message if it fails
</span> <span class='id assert_routing'>assert_routing</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/store</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='symbol'>:controller</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>store</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:action</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>index</span><span class='tstring_end'>'</span></span> <span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Route for store index not generated properly</span><span class='tstring_end'>'</span></span>

 <span class='comment'># Tests a route, providing a defaults hash
</span> <span class='id assert_routing'>assert_routing</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>controller/action/9</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:id</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>9</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:item</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>square</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:controller</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>controller</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:action</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>action</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:item</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>square</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>

 <span class='comment'># Tests a route with a HTTP method
</span> <span class='id assert_routing'>assert_routing</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='symbol'>:method</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>put</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:path</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/product/321</span><span class='tstring_end'>'</span></span> <span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='symbol'>:controller</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>product</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:action</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>update</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:id</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>321</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='rparen'>)</span></pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


119
120
121
122
123
124
125
126
127
128</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'actionpack/lib/action_dispatch/testing/assertions/routing.rb', line 119</span>

<span class='kw'>def</span> <span class='id assert_routing'>assert_routing</span><span class='lparen'>(</span><span class='id path'>path</span><span class='comma'>,</span> <span class='id options'>options</span><span class='comma'>,</span> <span class='id defaults'>defaults</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='id extras'>extras</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='id message'>message</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id assert_recognizes'>assert_recognizes</span><span class='lparen'>(</span><span class='id options'>options</span><span class='comma'>,</span> <span class='id path'>path</span><span class='comma'>,</span> <span class='id extras'>extras</span><span class='comma'>,</span> <span class='id message'>message</span><span class='rparen'>)</span>

  <span class='id controller'>controller</span><span class='comma'>,</span> <span class='id default_controller'>default_controller</span> <span class='op'>=</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:controller</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id defaults'>defaults</span><span class='lbracket'>[</span><span class='symbol'>:controller</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id controller'>controller</span> <span class='op'>&amp;&amp;</span> <span class='id controller'>controller</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span><span class='CHAR'>?/</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id default_controller'>default_controller</span> <span class='op'>&amp;&amp;</span> <span class='id default_controller'>default_controller</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span><span class='CHAR'>?/</span><span class='rparen'>)</span>
    <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:controller</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id controller'>controller</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id assert_generates'>assert_generates</span><span class='lparen'>(</span><span class='id path'>path</span><span class='period'>.</span><span class='id is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id path'>path</span><span class='lbracket'>[</span><span class='symbol'>:path</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='id path'>path</span><span class='comma'>,</span> <span class='id options'>options</span><span class='comma'>,</span> <span class='id defaults'>defaults</span><span class='comma'>,</span> <span class='id extras'>extras</span><span class='comma'>,</span> <span class='id message'>message</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="with_routing-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>with_routing</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
A helper to make it easier to test different route configurations. This
method temporarily replaces @routes with a new RouteSet instance.
</p>
<p>
The new instance is yielded to the passed block. Typically the block will
create some routes using <tt>map.draw { map.connect ... }</tt>:
</p>
<pre class="code">
  with_routing do |set|
    set.draw do |map|
      map.connect ':controller/:action/:id'
        assert_equal(
          ['/content/10/show', {}],
          map.generate(:controller =&gt; 'content', :id =&gt; 10, :action =&gt; 'show')
      end
    end
  end</pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'actionpack/lib/action_dispatch/testing/assertions/routing.rb', line 147</span>

<span class='kw'>def</span> <span class='id with_routing'>with_routing</span>
  <span class='id old_routes'>old_routes</span><span class='comma'>,</span> <span class='ivar'>@routes</span> <span class='op'>=</span> <span class='ivar'>@routes</span><span class='comma'>,</span> <span class='const'>ActionDispatch</span><span class='op'>::</span><span class='const'>Routing</span><span class='op'>::</span><span class='const'>RouteSet</span><span class='period'>.</span><span class='id new'>new</span>
  <span class='id old_controller'>old_controller</span><span class='comma'>,</span> <span class='ivar'>@controller</span> <span class='op'>=</span> <span class='ivar'>@controller</span><span class='comma'>,</span> <span class='ivar'>@controller</span><span class='period'>.</span><span class='id clone'>clone</span> <span class='kw'>if</span> <span class='ivar'>@controller</span>
  <span class='id _routes'>_routes</span> <span class='op'>=</span> <span class='ivar'>@routes</span>

  <span class='comment'># Unfortunately, there is currently an abstraction leak between AC::Base
</span>  <span class='comment'># and AV::Base which requires having the URL helpers in both AC and AV.
</span>  <span class='comment'># To do this safely at runtime for tests, we need to bump up the helper serial
</span>  <span class='comment'># to that the old AV subclass isn't cached.
</span>  <span class='comment'>#
</span>  <span class='comment'># TODO: Make this unnecessary
</span>  <span class='kw'>if</span> <span class='ivar'>@controller</span>
    <span class='ivar'>@controller</span><span class='period'>.</span><span class='id singleton_class'>singleton_class</span><span class='period'>.</span><span class='id send'>send</span><span class='lparen'>(</span><span class='symbol'>:include</span><span class='comma'>,</span> <span class='id _routes'>_routes</span><span class='period'>.</span><span class='id url_helpers'>url_helpers</span><span class='rparen'>)</span>
    <span class='ivar'>@controller</span><span class='period'>.</span><span class='id view_context_class'>view_context_class</span> <span class='op'>=</span> <span class='const'>Class</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='ivar'>@controller</span><span class='period'>.</span><span class='id view_context_class'>view_context_class</span><span class='rparen'>)</span> <span class='kw'>do</span>
      <span class='id include'>include</span> <span class='id _routes'>_routes</span><span class='period'>.</span><span class='id url_helpers'>url_helpers</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>yield</span> <span class='ivar'>@routes</span>
<span class='kw'>ensure</span>
  <span class='ivar'>@routes</span> <span class='op'>=</span> <span class='id old_routes'>old_routes</span>
  <span class='kw'>if</span> <span class='ivar'>@controller</span>
    <span class='ivar'>@controller</span> <span class='op'>=</span> <span class='id old_controller'>old_controller</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Thu Nov  4 20:04:22 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.1 (ruby-1.9.2).
</div>

  </body>
</html>