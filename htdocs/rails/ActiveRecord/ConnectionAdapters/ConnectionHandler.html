<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Class: ActiveRecord::ConnectionAdapters::ConnectionHandler</title>
<link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (C)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../ConnectionAdapters.html" title="ActiveRecord::ConnectionAdapters (module)">ConnectionAdapters</a></span></span>
     &raquo; 
    <span class="title">ConnectionHandler</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: ActiveRecord::ConnectionAdapters::ConnectionHandler
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">ActiveRecord::ConnectionAdapters::ConnectionHandler</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
ConnectionHandler is a collection of ConnectionPool objects. It is used for
keeping separate connection pools for Active Record models that connect to
different databases.
</p>
<p>
For example, suppose that you have 5 models, with the following hierarchy:
</p>
<pre class="code">
 |
 +-- Book
 |    |
 |    +-- ScaryBook
 |    +-- GoodBook
 +-- Author
 +-- BankAccount
</pre>
<p>
Suppose that Book is to connect to a separate database (i.e. one other than
the default database). Then Book, ScaryBook and GoodBook will all use the
same connection pool. Likewise, Author and BankAccount will use the same
connection pool. However, the connection pool used by Author/BankAccount is
not the same as the one used by Book/ScaryBook/GoodBook.
</p>
<p>
Normally there is only a single ConnectionHandler instance, accessible via
ActiveRecord::Base.connection_handler. Active Record models use this to
determine that connection pool that they should use.
</p>


  </div>
</div>
<div class="tags">
  
</div>

  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#connection_pools-instance_method" title="#connection_pools (instance method)">- (Object) <strong>connection_pools</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute connection_pools.
</p>
</div></span>
  
</li>

    
  </ul>


  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clear_active_connections%21-instance_method" title="#clear_active_connections! (instance method)">- (Object) <strong>clear_active_connections!</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns any connections in use by the current thread back to the pool, and
also returns connections to the pool cached by threads that are no longer
alive.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clear_all_connections%21-instance_method" title="#clear_all_connections! (instance method)">- (Object) <strong>clear_all_connections!</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clear_reloadable_connections%21-instance_method" title="#clear_reloadable_connections! (instance method)">- (Object) <strong>clear_reloadable_connections!</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Clears the cache which maps classes.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#connected%3F-instance_method" title="#connected? (instance method)">- (Boolean) <strong>connected?</strong>(klass) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns true if a connection that&#8217;s accessible to this class has
already been opened.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#establish_connection-instance_method" title="#establish_connection (instance method)">- (Object) <strong>establish_connection</strong>(name, spec) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (ConnectionHandler) <strong>initialize</strong>(pools = {}) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
A new instance of ConnectionHandler.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove_connection-instance_method" title="#remove_connection (instance method)">- (Object) <strong>remove_connection</strong>(klass) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Remove the connection for this class.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#retrieve_connection-instance_method" title="#retrieve_connection (instance method)">- (Object) <strong>retrieve_connection</strong>(klass) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Locate the connection of the nearest super class.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#retrieve_connection_pool-instance_method" title="#retrieve_connection_pool (instance method)">- (Object) <strong>retrieve_connection_pool</strong>(klass) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#verify_active_connections%21-instance_method" title="#verify_active_connections! (instance method)">- (Object) <strong>verify_active_connections!</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Verify active connections.
</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="ActiveRecord::ConnectionAdapters::ConnectionHandler (class)">ConnectionHandler</a></span></tt>) <strong>initialize</strong>(pools = {}) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
A new instance of ConnectionHandler
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


283
284
285</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb', line 283</span>

<span class='kw'>def</span> <span class='id initialize'>initialize</span><span class='lparen'>(</span><span class='id pools'>pools</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='ivar'>@connection_pools</span> <span class='op'>=</span> <span class='id pools'>pools</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <span id="connection_pools-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="connection_pools-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>connection_pools</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute connection_pools
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


281
282
283</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb', line 281</span>

<span class='kw'>def</span> <span class='id connection_pools'>connection_pools</span>
  <span class='ivar'>@connection_pools</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="clear_active_connections!-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>clear_active_connections!</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns any connections in use by the current thread back to the pool, and
also returns connections to the pool cached by threads that are no longer
alive.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


294
295
296</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb', line 294</span>

<span class='kw'>def</span> <span class='id clear_active_connections!'>clear_active_connections!</span>
  <span class='ivar'>@connection_pools</span><span class='period'>.</span><span class='id each_value'>each_value</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id pool'>pool</span><span class='op'>|</span> <span class='id pool'>pool</span><span class='period'>.</span><span class='id release_connection'>release_connection</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="clear_all_connections!-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>clear_all_connections!</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


303
304
305</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb', line 303</span>

<span class='kw'>def</span> <span class='id clear_all_connections!'>clear_all_connections!</span>
  <span class='ivar'>@connection_pools</span><span class='period'>.</span><span class='id each_value'>each_value</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id pool'>pool</span><span class='op'>|</span> <span class='id pool'>pool</span><span class='period'>.</span><span class='id disconnect!'>disconnect!</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="clear_reloadable_connections!-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>clear_reloadable_connections!</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Clears the cache which maps classes
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


299
300
301</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb', line 299</span>

<span class='kw'>def</span> <span class='id clear_reloadable_connections!'>clear_reloadable_connections!</span>
  <span class='ivar'>@connection_pools</span><span class='period'>.</span><span class='id each_value'>each_value</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id pool'>pool</span><span class='op'>|</span> <span class='id pool'>pool</span><span class='period'>.</span><span class='id clear_reloadable_connections!'>clear_reloadable_connections!</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="connected?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>connected?</strong>(klass) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns true if a connection that&#8217;s accessible to this class has
already been opened.
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


323
324
325
326</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb', line 323</span>

<span class='kw'>def</span> <span class='id connected?'>connected?</span><span class='lparen'>(</span><span class='id klass'>klass</span><span class='rparen'>)</span>
  <span class='id conn'>conn</span> <span class='op'>=</span> <span class='id retrieve_connection_pool'>retrieve_connection_pool</span><span class='lparen'>(</span><span class='id klass'>klass</span><span class='rparen'>)</span>
  <span class='id conn'>conn</span> <span class='op'>&amp;&amp;</span> <span class='id conn'>conn</span><span class='period'>.</span><span class='id connected?'>connected?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="establish_connection-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>establish_connection</strong>(name, spec) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


287
288
289</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb', line 287</span>

<span class='kw'>def</span> <span class='id establish_connection'>establish_connection</span><span class='lparen'>(</span><span class='id name'>name</span><span class='comma'>,</span> <span class='id spec'>spec</span><span class='rparen'>)</span>
  <span class='ivar'>@connection_pools</span><span class='lbracket'>[</span><span class='id name'>name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ConnectionAdapters</span><span class='op'>::</span><span class='const'>ConnectionPool</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id spec'>spec</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="remove_connection-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>remove_connection</strong>(klass) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Remove the connection for this class. This will close the active connection
and the defined connection (if they exist). The result can be used as an
argument for establish_connection, for easily re-establishing the
connection.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


332
333
334
335
336
337
338
339</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb', line 332</span>

<span class='kw'>def</span> <span class='id remove_connection'>remove_connection</span><span class='lparen'>(</span><span class='id klass'>klass</span><span class='rparen'>)</span>
  <span class='id pool'>pool</span> <span class='op'>=</span> <span class='ivar'>@connection_pools</span><span class='lbracket'>[</span><span class='id klass'>klass</span><span class='period'>.</span><span class='id name'>name</span><span class='rbracket'>]</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id pool'>pool</span>

  <span class='ivar'>@connection_pools</span><span class='period'>.</span><span class='id delete_if'>delete_if</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id key'>key</span><span class='comma'>,</span> <span class='id value'>value</span><span class='op'>|</span> <span class='id value'>value</span> <span class='op'>==</span> <span class='id pool'>pool</span> <span class='rbrace'>}</span>
  <span class='id pool'>pool</span><span class='period'>.</span><span class='id disconnect!'>disconnect!</span>
  <span class='id pool'>pool</span><span class='period'>.</span><span class='id spec'>spec</span><span class='period'>.</span><span class='id config'>config</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="retrieve_connection-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>retrieve_connection</strong>(klass) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Locate the connection of the nearest super class. This can be an active or
defined connection: if it is the latter, it will be opened and set as the
active connection for the class it was defined for (not necessarily the
current class).
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


316
317
318
319</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb', line 316</span>

<span class='kw'>def</span> <span class='id retrieve_connection'>retrieve_connection</span><span class='lparen'>(</span><span class='id klass'>klass</span><span class='rparen'>)</span> <span class='comment'>#:nodoc:
</span>  <span class='id pool'>pool</span> <span class='op'>=</span> <span class='id retrieve_connection_pool'>retrieve_connection_pool</span><span class='lparen'>(</span><span class='id klass'>klass</span><span class='rparen'>)</span>
  <span class='lparen'>(</span><span class='id pool'>pool</span> <span class='op'>&amp;&amp;</span> <span class='id pool'>pool</span><span class='period'>.</span><span class='id connection'>connection</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id raise'>raise</span> <span class='const'>ConnectionNotEstablished</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="retrieve_connection_pool-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>retrieve_connection_pool</strong>(klass) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


341
342
343
344
345
346</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb', line 341</span>

<span class='kw'>def</span> <span class='id retrieve_connection_pool'>retrieve_connection_pool</span><span class='lparen'>(</span><span class='id klass'>klass</span><span class='rparen'>)</span>
  <span class='id pool'>pool</span> <span class='op'>=</span> <span class='ivar'>@connection_pools</span><span class='lbracket'>[</span><span class='id klass'>klass</span><span class='period'>.</span><span class='id name'>name</span><span class='rbracket'>]</span>
  <span class='kw'>return</span> <span class='id pool'>pool</span> <span class='kw'>if</span> <span class='id pool'>pool</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span> <span class='op'>==</span> <span class='id klass'>klass</span>
  <span class='id retrieve_connection_pool'>retrieve_connection_pool</span> <span class='id klass'>klass</span><span class='period'>.</span><span class='id superclass'>superclass</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="verify_active_connections!-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>verify_active_connections!</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Verify active connections.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


308
309
310</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb', line 308</span>

<span class='kw'>def</span> <span class='id verify_active_connections!'>verify_active_connections!</span> <span class='comment'>#:nodoc:
</span>  <span class='ivar'>@connection_pools</span><span class='period'>.</span><span class='id each_value'>each_value</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id pool'>pool</span><span class='op'>|</span> <span class='id pool'>pool</span><span class='period'>.</span><span class='id verify_active_connections!'>verify_active_connections!</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Thu Nov  4 20:04:31 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.1 (ruby-1.9.2).
</div>

  </body>
</html>