  <div id="C00000863">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />MigrationTest<br/>
  In:
<a href="#" onclick="jsHref('files/activerecord/test/cases/migration_test_rb.html');">activerecord/test/cases/migration_test.rb</a>

Parent:&nbsp;
ActiveRecord::TestCase
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">




  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M005695&name=setup" >setup</a></li>
  <li><a href="index.html?a=M005696&name=teardown" >teardown</a></li>
  <li><a href="index.html?a=M005711&name=test_add_column_not_null_with_default" >test_add_column_not_null_with_default</a></li>
  <li><a href="index.html?a=M005710&name=test_add_column_not_null_without_default" >test_add_column_not_null_without_default</a></li>
  <li><a href="index.html?a=M005713&name=test_add_column_with_precision_and_scale" >test_add_column_with_precision_and_scale</a></li>
  <li><a href="index.html?a=M005700&name=test_add_column_with_primary_key_attribute" >test_add_column_with_primary_key_attribute</a></li>
  <li><a href="index.html?a=M005758&name=test_add_drop_table_with_prefix_and_suffix" >test_add_drop_table_with_prefix_and_suffix</a></li>
  <li><a href="index.html?a=M005697&name=test_add_index" >test_add_index</a></li>
  <li><a href="index.html?a=M005716&name=test_add_remove_single_field_using_string_arguments" >test_add_remove_single_field_using_string_arguments</a></li>
  <li><a href="index.html?a=M005717&name=test_add_remove_single_field_using_symbol_arguments" >test_add_remove_single_field_using_symbol_arguments</a></li>
  <li><a href="index.html?a=M005718&name=test_add_rename" >test_add_rename</a></li>
  <li><a href="index.html?a=M005738&name=test_add_table" >test_add_table</a></li>
  <li><a href="index.html?a=M005739&name=test_add_table_with_decimals" >test_add_table_with_decimals</a></li>
  <li><a href="index.html?a=M005731&name=test_change_column" >test_change_column</a></li>
  <li><a href="index.html?a=M005734&name=test_change_column_default" >test_change_column_default</a></li>
  <li><a href="index.html?a=M005737&name=test_change_column_default_to_null" >test_change_column_default_to_null</a></li>
  <li><a href="index.html?a=M005729&name=test_change_column_nullability" >test_change_column_nullability</a></li>
  <li><a href="index.html?a=M005735&name=test_change_column_quotes_column_names" >test_change_column_quotes_column_names</a></li>
  <li><a href="index.html?a=M005733&name=test_change_column_with_new_default" >test_change_column_with_new_default</a></li>
  <li><a href="index.html?a=M005732&name=test_change_column_with_nil_default" >test_change_column_with_nil_default</a></li>
  <li><a href="index.html?a=M005727&name=test_change_type_of_not_null_column" >test_change_type_of_not_null_column</a></li>
  <li><a href="index.html?a=M005701&name=test_create_table_adds_id" >test_create_table_adds_id</a></li>
  <li><a href="index.html?a=M005759&name=test_create_table_with_binary_column" >test_create_table_with_binary_column</a></li>
  <li><a href="index.html?a=M005763&name=test_create_table_with_custom_sequence_name" >test_create_table_with_custom_sequence_name</a></li>
  <li><a href="index.html?a=M005703&name=test_create_table_with_defaults" >test_create_table_with_defaults</a></li>
  <li><a href="index.html?a=M005707&name=test_create_table_with_force_true_does_not_drop_nonexisting_table" >test_create_table_with_force_true_does_not_drop_nonexisting_table</a></li>
  <li><a href="index.html?a=M005704&name=test_create_table_with_limits" >test_create_table_with_limits</a></li>
  <li><a href="index.html?a=M005702&name=test_create_table_with_not_null_column" >test_create_table_with_not_null_column</a></li>
  <li><a href="index.html?a=M005706&name=test_create_table_with_primary_key_prefix_as_table_name" >test_create_table_with_primary_key_prefix_as_table_name</a></li>
  <li><a href="index.html?a=M005705&name=test_create_table_with_primary_key_prefix_as_table_name_with_underscore" >test_create_table_with_primary_key_prefix_as_table_name_with_underscore</a></li>
  <li><a href="index.html?a=M005708&name=test_create_table_with_timestamps_should_create_datetime_columns" >test_create_table_with_timestamps_should_create_datetime_columns</a></li>
  <li><a href="index.html?a=M005709&name=test_create_table_with_timestamps_should_create_datetime_columns_with_options" >test_create_table_with_timestamps_should_create_datetime_columns_with_options</a></li>
  <li><a href="index.html?a=M005699&name=test_create_table_without_id" >test_create_table_without_id</a></li>
  <li><a href="index.html?a=M005747&name=test_finds_migrations" >test_finds_migrations</a></li>
  <li><a href="index.html?a=M005748&name=test_finds_pending_migrations" >test_finds_pending_migrations</a></li>
  <li><a href="index.html?a=M005736&name=test_keeping_default_and_notnull_constaint_on_change" >test_keeping_default_and_notnull_constaint_on_change</a></li>
  <li><a href="index.html?a=M005740&name=test_migrator" >test_migrator</a></li>
  <li><a href="index.html?a=M005751&name=test_migrator_db_has_no_schema_migrations_table" >test_migrator_db_has_no_schema_migrations_table</a></li>
  <li><a href="index.html?a=M005745&name=test_migrator_double_down" >test_migrator_double_down</a></li>
  <li><a href="index.html?a=M005744&name=test_migrator_double_up" >test_migrator_double_up</a></li>
  <li><a href="index.html?a=M005754&name=test_migrator_going_down_due_to_version_target" >test_migrator_going_down_due_to_version_target</a></li>
  <li><a href="index.html?a=M005750&name=test_migrator_interleaved_migrations" >test_migrator_interleaved_migrations</a></li>
  <li><a href="index.html?a=M005742&name=test_migrator_one_down" >test_migrator_one_down</a></li>
  <li><a href="index.html?a=M005741&name=test_migrator_one_up" >test_migrator_one_up</a></li>
  <li><a href="index.html?a=M005743&name=test_migrator_one_up_one_down" >test_migrator_one_up_one_down</a></li>
  <li><a href="index.html?a=M005746&name=test_migrator_one_up_with_exception_and_rollback" >test_migrator_one_up_with_exception_and_rollback</a></li>
  <li><a href="index.html?a=M005755&name=test_migrator_rollback" >test_migrator_rollback</a></li>
  <li><a href="index.html?a=M005752&name=test_migrator_verbosity" >test_migrator_verbosity</a></li>
  <li><a href="index.html?a=M005753&name=test_migrator_verbosity_off" >test_migrator_verbosity_off</a></li>
  <li><a href="index.html?a=M005761&name=test_migrator_with_duplicate_names" >test_migrator_with_duplicate_names</a></li>
  <li><a href="index.html?a=M005760&name=test_migrator_with_duplicates" >test_migrator_with_duplicates</a></li>
  <li><a href="index.html?a=M005762&name=test_migrator_with_missing_version_numbers" >test_migrator_with_missing_version_numbers</a></li>
  <li><a href="index.html?a=M005712&name=test_native_decimal_insert_manual_vs_automatic" >test_native_decimal_insert_manual_vs_automatic</a></li>
  <li><a href="index.html?a=M005714&name=test_native_types" >test_native_types</a></li>
  <li><a href="index.html?a=M005749&name=test_only_loads_pending_migrations" >test_only_loads_pending_migrations</a></li>
  <li><a href="index.html?a=M005757&name=test_proper_table_name" >test_proper_table_name</a></li>
  <li><a href="index.html?a=M005725&name=test_remove_column_with_index" >test_remove_column_with_index</a></li>
  <li><a href="index.html?a=M005726&name=test_remove_column_with_multi_column_index" >test_remove_column_with_multi_column_index</a></li>
  <li><a href="index.html?a=M005720&name=test_rename_column" >test_rename_column</a></li>
  <li><a href="index.html?a=M005721&name=test_rename_column_preserves_default_value_not_null" >test_rename_column_preserves_default_value_not_null</a></li>
  <li><a href="index.html?a=M005719&name=test_rename_column_using_symbol_arguments" >test_rename_column_using_symbol_arguments</a></li>
  <li><a href="index.html?a=M005724&name=test_rename_column_with_an_index" >test_rename_column_with_an_index</a></li>
  <li><a href="index.html?a=M005723&name=test_rename_column_with_sql_reserved_word" >test_rename_column_with_sql_reserved_word</a></li>
  <li><a href="index.html?a=M005722&name=test_rename_nonexistent_column" >test_rename_nonexistent_column</a></li>
  <li><a href="index.html?a=M005728&name=test_rename_table" >test_rename_table</a></li>
  <li><a href="index.html?a=M005730&name=test_rename_table_with_an_index" >test_rename_table_with_an_index</a></li>
  <li><a href="index.html?a=M005756&name=test_schema_migrations_table_name" >test_schema_migrations_table_name</a></li>
  <li><a href="index.html?a=M005715&name=test_unabstracted_database_dependent_types" >test_unabstracted_database_dependent_types</a></li>
  <li><a href="index.html?a=M005698&name=testing_table_with_only_foo_attribute" >testing_table_with_only_foo_attribute</a></li>
  <li><a href="index.html?a=M005764&name=with_env_tz" >with_env_tz</a></li>
  </ul>






<div class="sectiontitle">Public Instance methods</div>
<div id="M005695" class="method">
  <div id="M005695_title" class="title">
    <b>setup</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005695_source')" id="l_M005695_source">show source</a> ]</p>
  <div id="M005695_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 51</span>
51:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setup</span>
52:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migration</span>.<span class="ruby-identifier">verbose</span> = <span class="ruby-keyword kw">true</span>
53:       <span class="ruby-constant">PeopleHaveLastNames</span>.<span class="ruby-identifier">message_count</span> = <span class="ruby-value">0</span>
54:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005696" class="method">
  <div id="M005696_title" class="title">
    <b>teardown</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005696_source')" id="l_M005696_source">show source</a> ]</p>
  <div id="M005696_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 56</span>
56:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">teardown</span>
57:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">initialize_schema_migrations_table</span>
58:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span> <span class="ruby-node">&quot;DELETE FROM #{ActiveRecord::Migrator.schema_migrations_table_name}&quot;</span>
59: 
60:       <span class="ruby-node">%w(reminders people_reminders prefix_reminders_suffix)</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">table</span><span class="ruby-operator">|</span>
61:         <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span>(<span class="ruby-identifier">table</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
62:       <span class="ruby-keyword kw">end</span>
63:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">reset_column_information</span>
64: 
65:       <span class="ruby-node">%w(last_name key bio age height wealth birthday favorite_day
66:          moment_of_truth male administrator funny)</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">column</span><span class="ruby-operator">|</span>
67:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_column</span>(<span class="ruby-value str">'people'</span>, <span class="ruby-identifier">column</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
68:       <span class="ruby-keyword kw">end</span>
69:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_column</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
70:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_column</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;middle_name&quot;</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
71:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">40</span>)
72:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
73:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005711" class="method">
  <div id="M005711_title" class="title">
    <b>test_add_column_not_null_with_default</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005711_source')" id="l_M005711_source">show source</a> ]</p>
  <div id="M005711_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 331</span>
331:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_add_column_not_null_with_default</span>
332:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
333:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:foo</span>, <span class="ruby-identifier">:string</span>
334:       <span class="ruby-keyword kw">end</span>
335: 
336:       <span class="ruby-identifier">con</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>
337:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">enable_identity_insert</span>(<span class="ruby-value str">&quot;testings&quot;</span>, <span class="ruby-keyword kw">true</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:SybaseAdapter</span>)
338:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span> <span class="ruby-node">&quot;insert into testings (#{con.quote_column_name('id')}, #{con.quote_column_name('foo')}) values (1, 'hello')&quot;</span>
339:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">enable_identity_insert</span>(<span class="ruby-value str">&quot;testings&quot;</span>, <span class="ruby-keyword kw">false</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:SybaseAdapter</span>)
340:       <span class="ruby-identifier">assert_nothing_raised</span> {<span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-identifier">:testings</span>, <span class="ruby-identifier">:bar</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;default&quot;</span> }
341: 
342:       <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">StatementInvalid</span>) <span class="ruby-keyword kw">do</span>
343:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:OpenBaseAdapter</span>)
344:           <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span> <span class="ruby-node">&quot;insert into testings (#{con.quote_column_name('id')}, #{con.quote_column_name('foo')}, #{con.quote_column_name('bar')}) values (2, 'hello', NULL)&quot;</span>
345:         <span class="ruby-keyword kw">else</span>
346:           <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">insert</span>(<span class="ruby-node">&quot;INSERT INTO testings (#{con.quote_column_name('id')}, #{con.quote_column_name('foo')}, #{con.quote_column_name('bar')}) VALUES (2, 'hello', NULL)&quot;</span>,
347:             <span class="ruby-value str">&quot;Testing Insert&quot;</span>,<span class="ruby-value str">&quot;id&quot;</span>,<span class="ruby-value">2</span>)
348:         <span class="ruby-keyword kw">end</span>
349:       <span class="ruby-keyword kw">end</span>
350:     <span class="ruby-keyword kw">ensure</span>
351:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
352:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005710" class="method">
  <div id="M005710_title" class="title">
    <b>test_add_column_not_null_without_default</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005710_source')" id="l_M005710_source">show source</a> ]</p>
  <div id="M005710_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 317</span>
317:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_add_column_not_null_without_default</span>
318:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
319:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:foo</span>, <span class="ruby-identifier">:string</span>
320:         <span class="ruby-keyword kw">end</span>
321:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-identifier">:testings</span>, <span class="ruby-identifier">:bar</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
322: 
323:         <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">StatementInvalid</span>) <span class="ruby-keyword kw">do</span>
324:           <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span> <span class="ruby-value str">&quot;insert into testings (foo, bar) values ('hello', NULL)&quot;</span>
325:         <span class="ruby-keyword kw">end</span>
326:       <span class="ruby-keyword kw">ensure</span>
327:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
328:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005713" class="method">
  <div id="M005713_title" class="title">
    <b>test_add_column_with_precision_and_scale</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005713_source')" id="l_M005713_source">show source</a> ]</p>
  <div id="M005713_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 402</span>
402:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_add_column_with_precision_and_scale</span>
403:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">'people'</span>, <span class="ruby-value str">'wealth'</span>, <span class="ruby-identifier">:decimal</span>, <span class="ruby-identifier">:precision</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">9</span>, <span class="ruby-identifier">:scale</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">7</span>
404:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
405: 
406:       <span class="ruby-identifier">wealth_column</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">'wealth'</span>]
407:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">9</span>, <span class="ruby-identifier">wealth_column</span>.<span class="ruby-identifier">precision</span>
408:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">7</span>, <span class="ruby-identifier">wealth_column</span>.<span class="ruby-identifier">scale</span>
409:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005700" class="method">
  <div id="M005700_title" class="title">
    <b>test_add_column_with_primary_key_attribute</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005700_source')" id="l_M005700_source">show source</a> ]</p>
  <div id="M005700_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 131</span>
131:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_add_column_with_primary_key_attribute</span>
132:       <span class="ruby-identifier">testing_table_with_only_foo_attribute</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">connection</span><span class="ruby-operator">|</span>
133:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-identifier">:testings</span>, <span class="ruby-identifier">:id</span>, <span class="ruby-identifier">:primary_key</span> }
134:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-identifier">:testings</span>).<span class="ruby-identifier">size</span>, <span class="ruby-value">2</span>
135:       <span class="ruby-keyword kw">end</span>
136:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005758" class="method">
  <div id="M005758_title" class="title">
    <b>test_add_drop_table_with_prefix_and_suffix</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005758_source')" id="l_M005758_source">show source</a> ]</p>
  <div id="M005758_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1141</span>
1141:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_add_drop_table_with_prefix_and_suffix</span>
1142:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">table_exists?</span>
1143:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_prefix</span> = <span class="ruby-value str">'prefix_'</span>
1144:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_suffix</span> = <span class="ruby-value str">'_suffix'</span>
1145:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">reset_table_name</span>
1146:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">reset_sequence_name</span>
1147:       <span class="ruby-constant">WeNeedReminders</span>.<span class="ruby-identifier">up</span>
1148:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value str">&quot;content&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;hello world&quot;</span>, <span class="ruby-value str">&quot;remind_at&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
1149:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;hello world&quot;</span>, <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>).<span class="ruby-identifier">content</span>
1150: 
1151:       <span class="ruby-constant">WeNeedReminders</span>.<span class="ruby-identifier">down</span>
1152:       <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">StatementInvalid</span>) { <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>) }
1153:     <span class="ruby-keyword kw">ensure</span>
1154:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_prefix</span> = <span class="ruby-value str">''</span>
1155:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_suffix</span> = <span class="ruby-value str">''</span>
1156:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">reset_table_name</span>
1157:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">reset_sequence_name</span>
1158:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005697" class="method">
  <div id="M005697_title" class="title">
    <b>test_add_index</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005697_source')" id="l_M005697_source">show source</a> ]</p>
  <div id="M005697_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 75</span>
 75:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_add_index</span>
 76:       <span class="ruby-comment cmt"># Limit size of last_name and key columns to support Firebird index limitations</span>
 77:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;last_name&quot;</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">100</span>
 78:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;key&quot;</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">100</span>
 79:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;administrator&quot;</span>, <span class="ruby-identifier">:boolean</span>
 80: 
 81:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;last_name&quot;</span>) }
 82:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;last_name&quot;</span>) }
 83: 
 84:       <span class="ruby-comment cmt"># Orcl nds shrt indx nms.  Sybs 2.</span>
 85:       <span class="ruby-comment cmt"># OpenBase does not have named indexes.  You must specify a single column name</span>
 86:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:OracleAdapter</span>, <span class="ruby-identifier">:SybaseAdapter</span>, <span class="ruby-identifier">:OpenBaseAdapter</span>)
 87:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, [<span class="ruby-value str">&quot;last_name&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>]) }
 88:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-identifier">:column</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;last_name&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>]) }
 89:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, [<span class="ruby-value str">&quot;last_name&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>]) }
 90:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;index_people_on_last_name_and_first_name&quot;</span>) }
 91:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, [<span class="ruby-value str">&quot;last_name&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>]) }
 92:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;last_name_and_first_name&quot;</span>) }
 93:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, [<span class="ruby-value str">&quot;last_name&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>]) }
 94:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, [<span class="ruby-value str">&quot;last_name&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>]) }
 95:       <span class="ruby-keyword kw">end</span>
 96: 
 97:       <span class="ruby-comment cmt"># quoting</span>
 98:       <span class="ruby-comment cmt"># Note: changed index name from &quot;key&quot; to &quot;key_idx&quot; since &quot;key&quot; is a Firebird reserved word</span>
 99:       <span class="ruby-comment cmt"># OpenBase does not have named indexes.  You must specify a single column name</span>
100:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:OpenBaseAdapter</span>)
101:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">update_all</span> <span class="ruby-node">&quot;#{Person.connection.quote_column_name 'key'}=#{Person.connection.quote_column_name 'id'}&quot;</span> <span class="ruby-comment cmt">#some databases (including sqlite2 won't add a unique index if existing data non unique)</span>
102:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, [<span class="ruby-value str">&quot;key&quot;</span>], <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;key_idx&quot;</span>, <span class="ruby-identifier">:unique</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>) }
103:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;key_idx&quot;</span>, <span class="ruby-identifier">:unique</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>) }
104:       <span class="ruby-keyword kw">end</span>
105: 
106:       <span class="ruby-comment cmt"># Sybase adapter does not support indexes on :boolean columns</span>
107:       <span class="ruby-comment cmt"># OpenBase does not have named indexes.  You must specify a single column</span>
108:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:SybaseAdapter</span>, <span class="ruby-identifier">:OpenBaseAdapter</span>)
109:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-node">%w(last_name first_name administrator)</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;named_admin&quot;</span>) }
110:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;named_admin&quot;</span>) }
111:       <span class="ruby-keyword kw">end</span>
112:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005716" class="method">
  <div id="M005716_title" class="title">
    <b>test_add_remove_single_field_using_string_arguments</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005716_source')" id="l_M005716_source">show source</a> ]</p>
  <div id="M005716_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 491</span>
491:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_add_remove_single_field_using_string_arguments</span>
492:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
493: 
494:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migration</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">'people'</span>, <span class="ruby-value str">'last_name'</span>, <span class="ruby-identifier">:string</span>
495: 
496:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
497:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
498: 
499:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migration</span>.<span class="ruby-identifier">remove_column</span> <span class="ruby-value str">'people'</span>, <span class="ruby-value str">'last_name'</span>
500: 
501:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
502:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
503:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005717" class="method">
  <div id="M005717_title" class="title">
    <b>test_add_remove_single_field_using_symbol_arguments</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005717_source')" id="l_M005717_source">show source</a> ]</p>
  <div id="M005717_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 505</span>
505:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_add_remove_single_field_using_symbol_arguments</span>
506:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
507: 
508:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migration</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-identifier">:people</span>, <span class="ruby-identifier">:last_name</span>, <span class="ruby-identifier">:string</span>
509: 
510:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
511:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
512: 
513:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migration</span>.<span class="ruby-identifier">remove_column</span> <span class="ruby-identifier">:people</span>, <span class="ruby-identifier">:last_name</span>
514: 
515:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
516:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
517:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005718" class="method">
  <div id="M005718_title" class="title">
    <b>test_add_rename</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005718_source')" id="l_M005718_source">show source</a> ]</p>
  <div id="M005718_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 519</span>
519:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_add_rename</span>
520:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">delete_all</span>
521: 
522:       <span class="ruby-keyword kw">begin</span>
523:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;girlfriend&quot;</span>, <span class="ruby-identifier">:string</span>
524:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
525:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">create</span> <span class="ruby-identifier">:girlfriend</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'bobette'</span>
526: 
527:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">rename_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;girlfriend&quot;</span>, <span class="ruby-value str">&quot;exgirlfriend&quot;</span>
528: 
529:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
530:         <span class="ruby-identifier">bob</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>)
531: 
532:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;bobette&quot;</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">exgirlfriend</span>
533:       <span class="ruby-keyword kw">ensure</span>
534:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_column</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;girlfriend&quot;</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
535:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_column</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;exgirlfriend&quot;</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
536:       <span class="ruby-keyword kw">end</span>
537: 
538:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005738" class="method">
  <div id="M005738_title" class="title">
    <b>test_add_table</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005738_source')" id="l_M005738_source">show source</a> ]</p>
  <div id="M005738_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 831</span>
831:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_add_table</span>
832:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">table_exists?</span>
833: 
834:       <span class="ruby-constant">WeNeedReminders</span>.<span class="ruby-identifier">up</span>
835: 
836:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value str">&quot;content&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;hello world&quot;</span>, <span class="ruby-value str">&quot;remind_at&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
837:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;hello world&quot;</span>, <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>).<span class="ruby-identifier">content</span>
838: 
839:       <span class="ruby-constant">WeNeedReminders</span>.<span class="ruby-identifier">down</span>
840:       <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">StatementInvalid</span>) { <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>) }
841:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005739" class="method">
  <div id="M005739_title" class="title">
    <b>test_add_table_with_decimals</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005739_source')" id="l_M005739_source">show source</a> ]</p>
  <div id="M005739_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 843</span>
843:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_add_table_with_decimals</span>
844:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:big_numbers</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
845: 
846:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">BigNumber</span>.<span class="ruby-identifier">table_exists?</span>
847:       <span class="ruby-constant">GiveMeBigNumbers</span>.<span class="ruby-identifier">up</span>
848: 
849:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">BigNumber</span>.<span class="ruby-identifier">create</span>(
850:         <span class="ruby-identifier">:bank_balance</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1586.43</span>,
851:         <span class="ruby-identifier">:big_bank_balance</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">BigDecimal</span>(<span class="ruby-value str">&quot;1000234000567.95&quot;</span>),
852:         <span class="ruby-identifier">:world_population</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">6000000000</span>,
853:         <span class="ruby-identifier">:my_house_population</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">3</span>,
854:         <span class="ruby-identifier">:value_of_e</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">BigDecimal</span>(<span class="ruby-value str">&quot;2.7182818284590452353602875&quot;</span>)
855:       )
856: 
857:       <span class="ruby-identifier">b</span> = <span class="ruby-constant">BigNumber</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>)
858:       <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">b</span>
859: 
860:       <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">bank_balance</span>
861:       <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">big_bank_balance</span>
862:       <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">world_population</span>
863:       <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">my_house_population</span>
864:       <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">value_of_e</span>
865: 
866:       <span class="ruby-comment cmt"># TODO: set world_population &gt;= 2**62 to cover 64-bit platforms and test</span>
867:       <span class="ruby-comment cmt"># is_a?(Bignum)</span>
868:       <span class="ruby-identifier">assert_kind_of</span> <span class="ruby-constant">Integer</span>, <span class="ruby-identifier">b</span>.<span class="ruby-identifier">world_population</span>
869:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">6000000000</span>, <span class="ruby-identifier">b</span>.<span class="ruby-identifier">world_population</span>
870:       <span class="ruby-identifier">assert_kind_of</span> <span class="ruby-constant">Fixnum</span>, <span class="ruby-identifier">b</span>.<span class="ruby-identifier">my_house_population</span>
871:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">3</span>, <span class="ruby-identifier">b</span>.<span class="ruby-identifier">my_house_population</span>
872:       <span class="ruby-identifier">assert_kind_of</span> <span class="ruby-constant">BigDecimal</span>, <span class="ruby-identifier">b</span>.<span class="ruby-identifier">bank_balance</span>
873:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">BigDecimal</span>(<span class="ruby-value str">&quot;1586.43&quot;</span>), <span class="ruby-identifier">b</span>.<span class="ruby-identifier">bank_balance</span>
874:       <span class="ruby-identifier">assert_kind_of</span> <span class="ruby-constant">BigDecimal</span>, <span class="ruby-identifier">b</span>.<span class="ruby-identifier">big_bank_balance</span>
875:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">BigDecimal</span>(<span class="ruby-value str">&quot;1000234000567.95&quot;</span>), <span class="ruby-identifier">b</span>.<span class="ruby-identifier">big_bank_balance</span>
876: 
877:       <span class="ruby-comment cmt"># This one is fun. The 'value_of_e' field is defined as 'DECIMAL' with</span>
878:       <span class="ruby-comment cmt"># precision/scale explicitly left out.  By the SQL standard, numbers</span>
879:       <span class="ruby-comment cmt"># assigned to this field should be truncated but that's seldom respected.</span>
880:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:PostgreSQLAdapter</span>, <span class="ruby-identifier">:SQLite2Adapter</span>)
881:         <span class="ruby-comment cmt"># - PostgreSQL changes the SQL spec on columns declared simply as</span>
882:         <span class="ruby-comment cmt"># &quot;decimal&quot; to something more useful: instead of being given a scale</span>
883:         <span class="ruby-comment cmt"># of 0, they take on the compile-time limit for precision and scale,</span>
884:         <span class="ruby-comment cmt"># so the following should succeed unless you have used really wacky</span>
885:         <span class="ruby-comment cmt"># compilation options</span>
886:         <span class="ruby-comment cmt"># - SQLite2 has the default behavior of preserving all data sent in,</span>
887:         <span class="ruby-comment cmt"># so this happens there too</span>
888:         <span class="ruby-identifier">assert_kind_of</span> <span class="ruby-constant">BigDecimal</span>, <span class="ruby-identifier">b</span>.<span class="ruby-identifier">value_of_e</span>
889:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">BigDecimal</span>(<span class="ruby-value str">&quot;2.7182818284590452353602875&quot;</span>), <span class="ruby-identifier">b</span>.<span class="ruby-identifier">value_of_e</span>
890:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:SQLiteAdapter</span>)
891:         <span class="ruby-comment cmt"># - SQLite3 stores a float, in violation of SQL</span>
892:         <span class="ruby-identifier">assert_kind_of</span> <span class="ruby-constant">BigDecimal</span>, <span class="ruby-identifier">b</span>.<span class="ruby-identifier">value_of_e</span>
893:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">BigDecimal</span>(<span class="ruby-value str">&quot;2.71828182845905&quot;</span>), <span class="ruby-identifier">b</span>.<span class="ruby-identifier">value_of_e</span>
894:       <span class="ruby-keyword kw">else</span>
895:         <span class="ruby-comment cmt"># - SQL standard is an integer</span>
896:         <span class="ruby-identifier">assert_kind_of</span> <span class="ruby-constant">Fixnum</span>, <span class="ruby-identifier">b</span>.<span class="ruby-identifier">value_of_e</span>
897:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">b</span>.<span class="ruby-identifier">value_of_e</span>
898:       <span class="ruby-keyword kw">end</span>
899: 
900:       <span class="ruby-constant">GiveMeBigNumbers</span>.<span class="ruby-identifier">down</span>
901:       <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">StatementInvalid</span>) { <span class="ruby-constant">BigNumber</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>) }
902:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005731" class="method">
  <div id="M005731_title" class="title">
    <b>test_change_column</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005731_source')" id="l_M005731_source">show source</a> ]</p>
  <div id="M005731_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 713</span>
713:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_change_column</span>
714:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">'people'</span>, <span class="ruby-value str">'age'</span>, <span class="ruby-identifier">:integer</span>
715:       <span class="ruby-identifier">old_columns</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-constant">Person</span>.<span class="ruby-identifier">table_name</span>, <span class="ruby-node">&quot;#{name} Columns&quot;</span>)
716:       <span class="ruby-identifier">assert</span> <span class="ruby-identifier">old_columns</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'age'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:integer</span> }
717: 
718:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;age&quot;</span>, <span class="ruby-identifier">:string</span> }
719: 
720:       <span class="ruby-identifier">new_columns</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-constant">Person</span>.<span class="ruby-identifier">table_name</span>, <span class="ruby-node">&quot;#{name} Columns&quot;</span>)
721:       <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">new_columns</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'age'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:integer</span> }
722:       <span class="ruby-identifier">assert</span> <span class="ruby-identifier">new_columns</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'age'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:string</span> }
723: 
724:       <span class="ruby-identifier">old_columns</span> = <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-constant">Topic</span>.<span class="ruby-identifier">table_name</span>, <span class="ruby-node">&quot;#{name} Columns&quot;</span>)
725:       <span class="ruby-identifier">assert</span> <span class="ruby-identifier">old_columns</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'approved'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:boolean</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">default</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span> }
726:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-identifier">:topics</span>, <span class="ruby-identifier">:approved</span>, <span class="ruby-identifier">:boolean</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span> }
727:       <span class="ruby-identifier">new_columns</span> = <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-constant">Topic</span>.<span class="ruby-identifier">table_name</span>, <span class="ruby-node">&quot;#{name} Columns&quot;</span>)
728:       <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">new_columns</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'approved'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:boolean</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">default</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span> }
729:       <span class="ruby-identifier">assert</span> <span class="ruby-identifier">new_columns</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'approved'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:boolean</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">default</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">false</span> }
730:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-identifier">:topics</span>, <span class="ruby-identifier">:approved</span>, <span class="ruby-identifier">:boolean</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span> }
731:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005734" class="method">
  <div id="M005734_title" class="title">
    <b>test_change_column_default</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005734_source')" id="l_M005734_source">show source</a> ]</p>
  <div id="M005734_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 758</span>
758:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_change_column_default</span>
759:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column_default</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>, <span class="ruby-value str">&quot;Tester&quot;</span>
760:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
761:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;Tester&quot;</span>, <span class="ruby-constant">Person</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">first_name</span>
762:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005737" class="method">
  <div id="M005737_title" class="title">
    <b>test_change_column_default_to_null</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005737_source')" id="l_M005737_source">show source</a> ]</p>
  <div id="M005737_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 825</span>
825:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_change_column_default_to_null</span>
826:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column_default</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>, <span class="ruby-keyword kw">nil</span>
827:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
828:       <span class="ruby-identifier">assert_nil</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">first_name</span>
829:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005729" class="method">
  <div id="M005729_title" class="title">
    <b>test_change_column_nullability</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005729_source')" id="l_M005729_source">show source</a> ]</p>
  <div id="M005729_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 677</span>
677:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_change_column_nullability</span>
678:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">delete_all</span>
679:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;funny&quot;</span>, <span class="ruby-identifier">:boolean</span>
680:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
681:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;funny&quot;</span>].<span class="ruby-identifier">null</span>, <span class="ruby-value str">&quot;Column 'funny' must initially allow nulls&quot;</span>
682:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;funny&quot;</span>, <span class="ruby-identifier">:boolean</span>, <span class="ruby-identifier">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>
683:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
684:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;funny&quot;</span>].<span class="ruby-identifier">null</span>, <span class="ruby-value str">&quot;Column 'funny' must *not* allow nulls at this point&quot;</span>
685:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;funny&quot;</span>, <span class="ruby-identifier">:boolean</span>, <span class="ruby-identifier">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>
686:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
687:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;funny&quot;</span>].<span class="ruby-identifier">null</span>, <span class="ruby-value str">&quot;Column 'funny' must allow nulls again at this point&quot;</span>
688:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005735" class="method">
  <div id="M005735_title" class="title">
    <b>test_change_column_quotes_column_names</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005735_source')" id="l_M005735_source">show source</a> ]</p>
  <div id="M005735_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 764</span>
764:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_change_column_quotes_column_names</span>
765:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
766:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:select</span>, <span class="ruby-identifier">:string</span>
767:       <span class="ruby-keyword kw">end</span>
768: 
769:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-identifier">:testings</span>, <span class="ruby-identifier">:select</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">10</span> }
770: 
771:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span> <span class="ruby-node">&quot;insert into testings (#{Person.connection.quote_column_name('select')}) values ('7 chars')&quot;</span> }
772:     <span class="ruby-keyword kw">ensure</span>
773:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
774:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005733" class="method">
  <div id="M005733_title" class="title">
    <b>test_change_column_with_new_default</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005733_source')" id="l_M005733_source">show source</a> ]</p>
  <div id="M005733_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 746</span>
746:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_change_column_with_new_default</span>
747:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;administrator&quot;</span>, <span class="ruby-identifier">:boolean</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>
748:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
749:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">administrator?</span>
750: 
751:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;administrator&quot;</span>, <span class="ruby-identifier">:boolean</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span> }
752:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
753:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">administrator?</span>
754:     <span class="ruby-keyword kw">ensure</span>
755:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_column</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;administrator&quot;</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
756:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005732" class="method">
  <div id="M005732_title" class="title">
    <b>test_change_column_with_nil_default</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005732_source')" id="l_M005732_source">show source</a> ]</p>
  <div id="M005732_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 733</span>
733:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_change_column_with_nil_default</span>
734:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;contributor&quot;</span>, <span class="ruby-identifier">:boolean</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>
735:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
736:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">contributor?</span>
737: 
738:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;contributor&quot;</span>, <span class="ruby-identifier">:boolean</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span> }
739:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
740:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">contributor?</span>
741:       <span class="ruby-identifier">assert_nil</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">contributor</span>
742:     <span class="ruby-keyword kw">ensure</span>
743:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_column</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;contributor&quot;</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
744:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005727" class="method">
  <div id="M005727_title" class="title">
    <b>test_change_type_of_not_null_column</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005727_source')" id="l_M005727_source">show source</a> ]</p>
  <div id="M005727_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 646</span>
646:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_change_type_of_not_null_column</span>
647:       <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
648:         <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-value str">&quot;topics&quot;</span>, <span class="ruby-value str">&quot;written_on&quot;</span>, <span class="ruby-identifier">:datetime</span>, <span class="ruby-identifier">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
649:         <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">reset_column_information</span>
650: 
651:         <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-value str">&quot;topics&quot;</span>, <span class="ruby-value str">&quot;written_on&quot;</span>, <span class="ruby-identifier">:datetime</span>, <span class="ruby-identifier">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
652:         <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">reset_column_information</span>
653:       <span class="ruby-keyword kw">end</span>
654:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005701" class="method">
  <div id="M005701_title" class="title">
    <b>test_create_table_adds_id</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005701_source')" id="l_M005701_source">show source</a> ]</p>
  <div id="M005701_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 138</span>
138:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_create_table_adds_id</span>
139:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
140:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:foo</span>, <span class="ruby-identifier">:string</span>
141:       <span class="ruby-keyword kw">end</span>
142: 
143:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w(foo id)</span>,
144:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-identifier">:testings</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> }.<span class="ruby-identifier">sort</span>
145:     <span class="ruby-keyword kw">ensure</span>
146:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
147:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005759" class="method">
  <div id="M005759_title" class="title">
    <b>test_create_table_with_binary_column</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005759_source')" id="l_M005759_source">show source</a> ]</p>
  <div id="M005759_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1160</span>
1160:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_create_table_with_binary_column</span>
1161:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:binary_testings</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
1162: 
1163:       <span class="ruby-identifier">assert_nothing_raised</span> {
1164:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:binary_testings</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
1165:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value str">&quot;data&quot;</span>, <span class="ruby-identifier">:binary</span>, <span class="ruby-identifier">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
1166:         <span class="ruby-keyword kw">end</span>
1167:       }
1168: 
1169:       <span class="ruby-identifier">columns</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-identifier">:binary_testings</span>)
1170:       <span class="ruby-identifier">data_column</span> = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;data&quot;</span> }
1171: 
1172:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:MysqlAdapter</span>)
1173:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">''</span>, <span class="ruby-identifier">data_column</span>.<span class="ruby-identifier">default</span>
1174:       <span class="ruby-keyword kw">else</span>
1175:         <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">data_column</span>.<span class="ruby-identifier">default</span>
1176:       <span class="ruby-keyword kw">end</span>
1177: 
1178:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:binary_testings</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
1179:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005763" class="method">
  <div id="M005763_title" class="title">
    <b>test_create_table_with_custom_sequence_name</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005763_source')" id="l_M005763_source">show source</a> ]</p>
  <div id="M005763_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1199</span>
1199:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_create_table_with_custom_sequence_name</span>
1200:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">current_adapter?</span> <span class="ruby-identifier">:OracleAdapter</span>
1201: 
1202:       <span class="ruby-comment cmt"># table name is 29 chars, the standard sequence name will</span>
1203:       <span class="ruby-comment cmt"># be 33 chars and fail</span>
1204:       <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">StatementInvalid</span>) <span class="ruby-keyword kw">do</span>
1205:         <span class="ruby-keyword kw">begin</span>
1206:           <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:table_with_name_thats_just_ok</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
1207:             <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:foo</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
1208:           <span class="ruby-keyword kw">end</span>
1209:         <span class="ruby-keyword kw">ensure</span>
1210:           <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:table_with_name_thats_just_ok</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
1211:         <span class="ruby-keyword kw">end</span>
1212:       <span class="ruby-keyword kw">end</span>
1213: 
1214:       <span class="ruby-comment cmt"># should be all good w/ a custom sequence name</span>
1215:       <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
1216:         <span class="ruby-keyword kw">begin</span>
1217:           <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:table_with_name_thats_just_ok</span>,
1218:                                          <span class="ruby-identifier">:sequence_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'suitably_short_seq'</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
1219:             <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:foo</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
1220:           <span class="ruby-keyword kw">end</span>
1221: 
1222:           <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-value str">&quot;select suitably_short_seq.nextval from dual&quot;</span>)
1223: 
1224:         <span class="ruby-keyword kw">ensure</span>
1225:           <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:table_with_name_thats_just_ok</span>,
1226:                                        <span class="ruby-identifier">:sequence_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'suitably_short_seq'</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
1227:         <span class="ruby-keyword kw">end</span>
1228:       <span class="ruby-keyword kw">end</span>
1229: 
1230:       <span class="ruby-comment cmt"># confirm the custom sequence got dropped</span>
1231:       <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">StatementInvalid</span>) <span class="ruby-keyword kw">do</span>
1232:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-value str">&quot;select suitably_short_seq.nextval from dual&quot;</span>)
1233:       <span class="ruby-keyword kw">end</span>
1234:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005703" class="method">
  <div id="M005703_title" class="title">
    <b>test_create_table_with_defaults</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005703_source')" id="l_M005703_source">show source</a> ]</p>
  <div id="M005703_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 163</span>
163:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_create_table_with_defaults</span>
164:       <span class="ruby-comment cmt"># MySQL doesn't allow defaults on TEXT or BLOB columns.</span>
165:       <span class="ruby-identifier">mysql</span> = <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:MysqlAdapter</span>)
166: 
167:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
168:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:one</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;hello&quot;</span>
169:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:two</span>, <span class="ruby-identifier">:boolean</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>
170:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:three</span>, <span class="ruby-identifier">:boolean</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
171:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:four</span>, <span class="ruby-identifier">:integer</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
172:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:five</span>, <span class="ruby-identifier">:text</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;hello&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">mysql</span>
173:       <span class="ruby-keyword kw">end</span>
174: 
175:       <span class="ruby-identifier">columns</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-identifier">:testings</span>)
176:       <span class="ruby-identifier">one</span> = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;one&quot;</span> }
177:       <span class="ruby-identifier">two</span> = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;two&quot;</span> }
178:       <span class="ruby-identifier">three</span> = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;three&quot;</span> }
179:       <span class="ruby-identifier">four</span> = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;four&quot;</span> }
180:       <span class="ruby-identifier">five</span> = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;five&quot;</span> } <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">mysql</span>
181: 
182:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;hello&quot;</span>, <span class="ruby-identifier">one</span>.<span class="ruby-identifier">default</span>
183:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">two</span>.<span class="ruby-identifier">default</span>
184:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">three</span>.<span class="ruby-identifier">default</span>
185:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">four</span>.<span class="ruby-identifier">default</span>
186:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;hello&quot;</span>, <span class="ruby-identifier">five</span>.<span class="ruby-identifier">default</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">mysql</span>
187: 
188:     <span class="ruby-keyword kw">ensure</span>
189:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
190:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005707" class="method">
  <div id="M005707_title" class="title">
    <b>test_create_table_with_force_true_does_not_drop_nonexisting_table</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005707_source')" id="l_M005707_source">show source</a> ]</p>
  <div id="M005707_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 264</span>
264:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_create_table_with_force_true_does_not_drop_nonexisting_table</span>
265:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">table_exists?</span>(<span class="ruby-identifier">:testings2</span>)
266:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:testings2</span>
267:       <span class="ruby-keyword kw">end</span>
268: 
269:       <span class="ruby-comment cmt"># using a copy as we need the drop_table method to</span>
270:       <span class="ruby-comment cmt"># continue to work for the ensure block of the test</span>
271:       <span class="ruby-identifier">temp_conn</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">dup</span>
272:       <span class="ruby-identifier">temp_conn</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:drop_table</span>).<span class="ruby-identifier">never</span>
273:       <span class="ruby-identifier">temp_conn</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:testings2</span>, <span class="ruby-identifier">:force</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
274:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:foo</span>, <span class="ruby-identifier">:string</span>
275:       <span class="ruby-keyword kw">end</span>
276:     <span class="ruby-keyword kw">ensure</span>
277:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:testings2</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
278:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005704" class="method">
  <div id="M005704_title" class="title">
    <b>test_create_table_with_limits</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005704_source')" id="l_M005704_source">show source</a> ]</p>
  <div id="M005704_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 192</span>
192:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_create_table_with_limits</span>
193:       <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
194:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
195:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:foo</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">255</span>
196: 
197:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:default_int</span>, <span class="ruby-identifier">:integer</span>
198: 
199:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:one_int</span>,    <span class="ruby-identifier">:integer</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
200:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:four_int</span>,   <span class="ruby-identifier">:integer</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">4</span>
201:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:eight_int</span>,  <span class="ruby-identifier">:integer</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">8</span>
202:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:eleven_int</span>, <span class="ruby-identifier">:integer</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">11</span>
203:         <span class="ruby-keyword kw">end</span>
204:       <span class="ruby-keyword kw">end</span>
205: 
206:       <span class="ruby-identifier">columns</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-identifier">:testings</span>)
207:       <span class="ruby-identifier">foo</span> = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;foo&quot;</span> }
208:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">255</span>, <span class="ruby-identifier">foo</span>.<span class="ruby-identifier">limit</span>
209: 
210:       <span class="ruby-identifier">default</span> = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;default_int&quot;</span> }
211:       <span class="ruby-identifier">one</span>     = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;one_int&quot;</span>     }
212:       <span class="ruby-identifier">four</span>    = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;four_int&quot;</span>    }
213:       <span class="ruby-identifier">eight</span>   = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;eight_int&quot;</span>   }
214:       <span class="ruby-identifier">eleven</span>  = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;eleven_int&quot;</span>   }
215: 
216:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:PostgreSQLAdapter</span>)
217:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'integer'</span>, <span class="ruby-identifier">default</span>.<span class="ruby-identifier">sql_type</span>
218:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'smallint'</span>, <span class="ruby-identifier">one</span>.<span class="ruby-identifier">sql_type</span>
219:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'integer'</span>, <span class="ruby-identifier">four</span>.<span class="ruby-identifier">sql_type</span>
220:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'bigint'</span>, <span class="ruby-identifier">eight</span>.<span class="ruby-identifier">sql_type</span>
221:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'integer'</span>, <span class="ruby-identifier">eleven</span>.<span class="ruby-identifier">sql_type</span>
222:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:MysqlAdapter</span>)
223:         <span class="ruby-identifier">assert_match</span> <span class="ruby-value str">'int(11)'</span>, <span class="ruby-identifier">default</span>.<span class="ruby-identifier">sql_type</span>
224:         <span class="ruby-identifier">assert_match</span> <span class="ruby-value str">'tinyint'</span>, <span class="ruby-identifier">one</span>.<span class="ruby-identifier">sql_type</span>
225:         <span class="ruby-identifier">assert_match</span> <span class="ruby-value str">'int'</span>, <span class="ruby-identifier">four</span>.<span class="ruby-identifier">sql_type</span>
226:         <span class="ruby-identifier">assert_match</span> <span class="ruby-value str">'bigint'</span>, <span class="ruby-identifier">eight</span>.<span class="ruby-identifier">sql_type</span>
227:         <span class="ruby-identifier">assert_match</span> <span class="ruby-value str">'int(11)'</span>, <span class="ruby-identifier">eleven</span>.<span class="ruby-identifier">sql_type</span>
228:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:OracleAdapter</span>)
229:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'NUMBER(38)'</span>, <span class="ruby-identifier">default</span>.<span class="ruby-identifier">sql_type</span>
230:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'NUMBER(1)'</span>, <span class="ruby-identifier">one</span>.<span class="ruby-identifier">sql_type</span>
231:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'NUMBER(4)'</span>, <span class="ruby-identifier">four</span>.<span class="ruby-identifier">sql_type</span>
232:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'NUMBER(8)'</span>, <span class="ruby-identifier">eight</span>.<span class="ruby-identifier">sql_type</span>
233:       <span class="ruby-keyword kw">end</span>
234:     <span class="ruby-keyword kw">ensure</span>
235:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
236:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005702" class="method">
  <div id="M005702_title" class="title">
    <b>test_create_table_with_not_null_column</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005702_source')" id="l_M005702_source">show source</a> ]</p>
  <div id="M005702_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 149</span>
149:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_create_table_with_not_null_column</span>
150:       <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
151:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
152:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:foo</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
153:         <span class="ruby-keyword kw">end</span>
154:       <span class="ruby-keyword kw">end</span>
155: 
156:       <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">StatementInvalid</span>) <span class="ruby-keyword kw">do</span>
157:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span> <span class="ruby-value str">&quot;insert into testings (foo) values (NULL)&quot;</span>
158:       <span class="ruby-keyword kw">end</span>
159:     <span class="ruby-keyword kw">ensure</span>
160:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
161:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005706" class="method">
  <div id="M005706_title" class="title">
    <b>test_create_table_with_primary_key_prefix_as_table_name</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005706_source')" id="l_M005706_source">show source</a> ]</p>
  <div id="M005706_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 251</span>
251:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_create_table_with_primary_key_prefix_as_table_name</span>
252:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">primary_key_prefix_type</span> = <span class="ruby-identifier">:table_name</span>
253: 
254:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
255:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:foo</span>, <span class="ruby-identifier">:string</span>
256:       <span class="ruby-keyword kw">end</span>
257: 
258:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w(foo testingid)</span>, <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-identifier">:testings</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> }.<span class="ruby-identifier">sort</span>
259:     <span class="ruby-keyword kw">ensure</span>
260:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
261:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">primary_key_prefix_type</span> = <span class="ruby-keyword kw">nil</span>
262:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005705" class="method">
  <div id="M005705_title" class="title">
    <b>test_create_table_with_primary_key_prefix_as_table_name_with_underscore</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005705_source')" id="l_M005705_source">show source</a> ]</p>
  <div id="M005705_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 238</span>
238:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_create_table_with_primary_key_prefix_as_table_name_with_underscore</span>
239:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">primary_key_prefix_type</span> = <span class="ruby-identifier">:table_name_with_underscore</span>
240: 
241:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
242:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:foo</span>, <span class="ruby-identifier">:string</span>
243:       <span class="ruby-keyword kw">end</span>
244: 
245:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w(foo testing_id)</span>, <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-identifier">:testings</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> }.<span class="ruby-identifier">sort</span>
246:     <span class="ruby-keyword kw">ensure</span>
247:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
248:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">primary_key_prefix_type</span> = <span class="ruby-keyword kw">nil</span>
249:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005708" class="method">
  <div id="M005708_title" class="title">
    <b>test_create_table_with_timestamps_should_create_datetime_columns</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005708_source')" id="l_M005708_source">show source</a> ]</p>
  <div id="M005708_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 280</span>
280:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_create_table_with_timestamps_should_create_datetime_columns</span>
281:       <span class="ruby-identifier">table_name</span> = <span class="ruby-identifier">:testings</span>
282: 
283:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">table_name</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
284:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">timestamps</span>
285:       <span class="ruby-keyword kw">end</span>
286:       <span class="ruby-identifier">created_columns</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-identifier">table_name</span>)
287: 
288:       <span class="ruby-identifier">created_at_column</span> = <span class="ruby-identifier">created_columns</span>.<span class="ruby-identifier">detect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'created_at'</span> }
289:       <span class="ruby-identifier">updated_at_column</span> = <span class="ruby-identifier">created_columns</span>.<span class="ruby-identifier">detect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'updated_at'</span> }
290: 
291:       <span class="ruby-identifier">assert</span> <span class="ruby-identifier">created_at_column</span>.<span class="ruby-identifier">null</span>
292:       <span class="ruby-identifier">assert</span> <span class="ruby-identifier">updated_at_column</span>.<span class="ruby-identifier">null</span>
293:     <span class="ruby-keyword kw">ensure</span>
294:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">table_name</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
295:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005709" class="method">
  <div id="M005709_title" class="title">
    <b>test_create_table_with_timestamps_should_create_datetime_columns_with_options</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005709_source')" id="l_M005709_source">show source</a> ]</p>
  <div id="M005709_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 297</span>
297:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_create_table_with_timestamps_should_create_datetime_columns_with_options</span>
298:       <span class="ruby-identifier">table_name</span> = <span class="ruby-identifier">:testings</span>
299: 
300:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">table_name</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
301:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">timestamps</span> <span class="ruby-identifier">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
302:       <span class="ruby-keyword kw">end</span>
303:       <span class="ruby-identifier">created_columns</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-identifier">table_name</span>)
304: 
305:       <span class="ruby-identifier">created_at_column</span> = <span class="ruby-identifier">created_columns</span>.<span class="ruby-identifier">detect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'created_at'</span> }
306:       <span class="ruby-identifier">updated_at_column</span> = <span class="ruby-identifier">created_columns</span>.<span class="ruby-identifier">detect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'updated_at'</span> }
307: 
308:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">created_at_column</span>.<span class="ruby-identifier">null</span>
309:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">updated_at_column</span>.<span class="ruby-identifier">null</span>
310:     <span class="ruby-keyword kw">ensure</span>
311:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">table_name</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
312:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005699" class="method">
  <div id="M005699_title" class="title">
    <b>test_create_table_without_id</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005699_source')" id="l_M005699_source">show source</a> ]</p>
  <div id="M005699_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 125</span>
125:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_create_table_without_id</span>
126:       <span class="ruby-identifier">testing_table_with_only_foo_attribute</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">connection</span><span class="ruby-operator">|</span>
127:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-identifier">:testings</span>).<span class="ruby-identifier">size</span>, <span class="ruby-value">1</span>
128:       <span class="ruby-keyword kw">end</span>
129:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005747" class="method">
  <div id="M005747_title" class="title">
    <b>test_finds_migrations</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005747_source')" id="l_M005747_source">show source</a> ]</p>
  <div id="M005747_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 988</span>
988:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_finds_migrations</span>
989:       <span class="ruby-identifier">migrations</span> = <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:up</span>, <span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>).<span class="ruby-identifier">migrations</span>
990: 
991:       [[<span class="ruby-value">1</span>, <span class="ruby-value str">'PeopleHaveLastNames'</span>], [<span class="ruby-value">2</span>, <span class="ruby-value str">'WeNeedReminders'</span>], [<span class="ruby-value">3</span>, <span class="ruby-value str">'InnocentJointable'</span>]].<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pair</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
992:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">migrations</span>[<span class="ruby-identifier">i</span>].<span class="ruby-identifier">version</span>, <span class="ruby-identifier">pair</span>.<span class="ruby-identifier">first</span>
993:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">migrations</span>[<span class="ruby-identifier">i</span>].<span class="ruby-identifier">name</span>, <span class="ruby-identifier">pair</span>.<span class="ruby-identifier">last</span>
994:       <span class="ruby-keyword kw">end</span>
995:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005748" class="method">
  <div id="M005748_title" class="title">
    <b>test_finds_pending_migrations</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005748_source')" id="l_M005748_source">show source</a> ]</p>
  <div id="M005748_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 997</span>
 997:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_finds_pending_migrations</span>
 998:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">up</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/interleaved/pass_2&quot;</span>, <span class="ruby-value">1</span>)
 999:       <span class="ruby-identifier">migrations</span> = <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:up</span>, <span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/interleaved/pass_2&quot;</span>).<span class="ruby-identifier">pending_migrations</span>
1000: 
1001:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">migrations</span>.<span class="ruby-identifier">size</span>
1002:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">migrations</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">version</span>, <span class="ruby-value">3</span>
1003:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">migrations</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">name</span>, <span class="ruby-value str">'InnocentJointable'</span>
1004:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005736" class="method">
  <div id="M005736_title" class="title">
    <b>test_keeping_default_and_notnull_constaint_on_change</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005736_source')" id="l_M005736_source">show source</a> ]</p>
  <div id="M005736_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 776</span>
776:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_keeping_default_and_notnull_constaint_on_change</span>
777:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
778:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:title</span>, <span class="ruby-identifier">:string</span>
779:       <span class="ruby-keyword kw">end</span>
780:       <span class="ruby-identifier">person_klass</span> = <span class="ruby-constant">Class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Person</span>)
781:       <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">set_table_name</span> <span class="ruby-value str">'testings'</span>
782: 
783:       <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;testings&quot;</span>, <span class="ruby-value str">&quot;wealth&quot;</span>, <span class="ruby-identifier">:integer</span>, <span class="ruby-identifier">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">99</span>
784:       <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">reset_column_information</span>
785:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">99</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;wealth&quot;</span>].<span class="ruby-identifier">default</span>
786:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;wealth&quot;</span>].<span class="ruby-identifier">null</span>
787:       <span class="ruby-identifier">assert_nothing_raised</span> {<span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-value str">&quot;insert into testings (title) values ('tester')&quot;</span>)}
788: 
789:       <span class="ruby-comment cmt"># change column default to see that column doesn't lose its not null definition</span>
790:       <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column_default</span> <span class="ruby-value str">&quot;testings&quot;</span>, <span class="ruby-value str">&quot;wealth&quot;</span>, <span class="ruby-value">100</span>
791:       <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">reset_column_information</span>
792:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">100</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;wealth&quot;</span>].<span class="ruby-identifier">default</span>
793:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;wealth&quot;</span>].<span class="ruby-identifier">null</span>
794: 
795:       <span class="ruby-comment cmt"># rename column to see that column doesn't lose its not null and/or default definition</span>
796:       <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">rename_column</span> <span class="ruby-value str">&quot;testings&quot;</span>, <span class="ruby-value str">&quot;wealth&quot;</span>, <span class="ruby-value str">&quot;money&quot;</span>
797:       <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">reset_column_information</span>
798:       <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;wealth&quot;</span>]
799:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">100</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;money&quot;</span>].<span class="ruby-identifier">default</span>
800:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;money&quot;</span>].<span class="ruby-identifier">null</span>
801: 
802:       <span class="ruby-comment cmt"># change column</span>
803:       <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-value str">&quot;testings&quot;</span>, <span class="ruby-value str">&quot;money&quot;</span>, <span class="ruby-identifier">:integer</span>, <span class="ruby-identifier">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1000</span>
804:       <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">reset_column_information</span>
805:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1000</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;money&quot;</span>].<span class="ruby-identifier">default</span>
806:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;money&quot;</span>].<span class="ruby-identifier">null</span>
807: 
808:       <span class="ruby-comment cmt"># change column, make it nullable and clear default</span>
809:       <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-value str">&quot;testings&quot;</span>, <span class="ruby-value str">&quot;money&quot;</span>, <span class="ruby-identifier">:integer</span>, <span class="ruby-identifier">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>
810:       <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">reset_column_information</span>
811:       <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;money&quot;</span>].<span class="ruby-identifier">default</span>
812:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;money&quot;</span>].<span class="ruby-identifier">null</span>
813: 
814:       <span class="ruby-comment cmt"># change_column_null, make it not nullable and set null values to a default value</span>
815:       <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-value str">'UPDATE testings SET money = NULL'</span>)
816:       <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column_null</span> <span class="ruby-value str">&quot;testings&quot;</span>, <span class="ruby-value str">&quot;money&quot;</span>, <span class="ruby-keyword kw">false</span>, <span class="ruby-value">2000</span>
817:       <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">reset_column_information</span>
818:       <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;money&quot;</span>].<span class="ruby-identifier">default</span>
819:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;money&quot;</span>].<span class="ruby-identifier">null</span>
820:       <span class="ruby-identifier">assert_equal</span> [<span class="ruby-value">2000</span>], <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_values</span>(<span class="ruby-value str">&quot;SELECT money FROM testings&quot;</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">to_i</span> }.<span class="ruby-identifier">sort</span>
821:     <span class="ruby-keyword kw">ensure</span>
822:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
823:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005740" class="method">
  <div id="M005740_title" class="title">
    <b>test_migrator</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005740_source')" id="l_M005740_source">show source</a> ]</p>
  <div id="M005740_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 904</span>
904:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator</span>
905:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
906:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">table_exists?</span>
907: 
908:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">up</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>)
909: 
910:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">3</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">current_version</span>
911:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
912:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
913:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value str">&quot;content&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;hello world&quot;</span>, <span class="ruby-value str">&quot;remind_at&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
914:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;hello world&quot;</span>, <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>).<span class="ruby-identifier">content</span>
915: 
916:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">down</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>)
917: 
918:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">0</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">current_version</span>
919:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
920:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
921:       <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">StatementInvalid</span>) { <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>) }
922:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005751" class="method">
  <div id="M005751_title" class="title">
    <b>test_migrator_db_has_no_schema_migrations_table</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005751_source')" id="l_M005751_source">show source</a> ]</p>
  <div id="M005751_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1041</span>
1041:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_db_has_no_schema_migrations_table</span>
1042:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-value str">&quot;DROP TABLE schema_migrations;&quot;</span>)
1043:       <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
1044:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">migrate</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">1</span>)
1045:       <span class="ruby-keyword kw">end</span>
1046:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005745" class="method">
  <div id="M005745_title" class="title">
    <b>test_migrator_double_down</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005745_source')" id="l_M005745_source">show source</a> ]</p>
  <div id="M005745_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 965</span>
965:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_double_down</span>
966:       <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value">0</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">current_version</span>)
967:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">run</span>(<span class="ruby-identifier">:up</span>, <span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">1</span>)
968:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">run</span>(<span class="ruby-identifier">:down</span>, <span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">1</span>)
969:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">run</span>(<span class="ruby-identifier">:down</span>, <span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">1</span>) }
970:       <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value">0</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">current_version</span>)
971:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005744" class="method">
  <div id="M005744_title" class="title">
    <b>test_migrator_double_up</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005744_source')" id="l_M005744_source">show source</a> ]</p>
  <div id="M005744_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 958</span>
958:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_double_up</span>
959:       <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value">0</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">current_version</span>)
960:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">run</span>(<span class="ruby-identifier">:up</span>, <span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">1</span>)
961:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">run</span>(<span class="ruby-identifier">:up</span>, <span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">1</span>) }
962:       <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value">1</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">current_version</span>)
963:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005754" class="method">
  <div id="M005754_title" class="title">
    <b>test_migrator_going_down_due_to_version_target</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005754_source')" id="l_M005754_source">show source</a> ]</p>
  <div id="M005754_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1066</span>
1066:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_going_down_due_to_version_target</span>
1067:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">up</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">1</span>)
1068:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">migrate</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">0</span>)
1069: 
1070:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
1071:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">table_exists?</span>
1072: 
1073:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">migrate</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>)
1074: 
1075:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
1076:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
1077:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value str">&quot;content&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;hello world&quot;</span>, <span class="ruby-value str">&quot;remind_at&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
1078:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;hello world&quot;</span>, <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>).<span class="ruby-identifier">content</span>
1079:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005750" class="method">
  <div id="M005750_title" class="title">
    <b>test_migrator_interleaved_migrations</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005750_source')" id="l_M005750_source">show source</a> ]</p>
  <div id="M005750_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1026</span>
1026:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_interleaved_migrations</span>
1027:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">up</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/interleaved/pass_1&quot;</span>)
1028: 
1029:       <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
1030:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">up</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/interleaved/pass_2&quot;</span>)
1031:       <span class="ruby-keyword kw">end</span>
1032: 
1033:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
1034:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
1035: 
1036:       <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
1037:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">down</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/interleaved/pass_3&quot;</span>)
1038:       <span class="ruby-keyword kw">end</span>
1039:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005742" class="method">
  <div id="M005742_title" class="title">
    <b>test_migrator_one_down</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005742_source')" id="l_M005742_source">show source</a> ]</p>
  <div id="M005742_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 940</span>
940:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_one_down</span>
941:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">up</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>)
942: 
943:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">down</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">1</span>)
944: 
945:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
946:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
947:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">table_exists?</span>
948:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005741" class="method">
  <div id="M005741_title" class="title">
    <b>test_migrator_one_up</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005741_source')" id="l_M005741_source">show source</a> ]</p>
  <div id="M005741_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 924</span>
924:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_one_up</span>
925:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
926:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">table_exists?</span>
927: 
928:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">up</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">1</span>)
929: 
930:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
931:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
932:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">table_exists?</span>
933: 
934:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">up</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">2</span>)
935: 
936:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value str">&quot;content&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;hello world&quot;</span>, <span class="ruby-value str">&quot;remind_at&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
937:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;hello world&quot;</span>, <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>).<span class="ruby-identifier">content</span>
938:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005743" class="method">
  <div id="M005743_title" class="title">
    <b>test_migrator_one_up_one_down</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005743_source')" id="l_M005743_source">show source</a> ]</p>
  <div id="M005743_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 950</span>
950:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_one_up_one_down</span>
951:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">up</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">1</span>)
952:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">down</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">0</span>)
953: 
954:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
955:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">table_exists?</span>
956:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005746" class="method">
  <div id="M005746_title" class="title">
    <b>test_migrator_one_up_with_exception_and_rollback</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005746_source')" id="l_M005746_source">show source</a> ]</p>
  <div id="M005746_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 974</span>
974:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_one_up_with_exception_and_rollback</span>
975:         <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
976: 
977:         <span class="ruby-identifier">e</span> = <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">StandardError</span>) <span class="ruby-keyword kw">do</span>
978:           <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">up</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/broken&quot;</span>, <span class="ruby-value">100</span>)
979:         <span class="ruby-keyword kw">end</span>
980: 
981:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;An error has occurred, this and all later migrations canceled:\n\nSomething broke&quot;</span>, <span class="ruby-identifier">e</span>.<span class="ruby-identifier">message</span>
982: 
983:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
984:         <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
985:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005755" class="method">
  <div id="M005755_title" class="title">
    <b>test_migrator_rollback</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005755_source')" id="l_M005755_source">show source</a> ]</p>
  <div id="M005755_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1081</span>
1081:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_rollback</span>
1082:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">migrate</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>)
1083:       <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value">3</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">current_version</span>)
1084: 
1085:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">rollback</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>)
1086:       <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value">2</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">current_version</span>)
1087: 
1088:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">rollback</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>)
1089:       <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value">1</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">current_version</span>)
1090: 
1091:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">rollback</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>)
1092:       <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value">0</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">current_version</span>)
1093: 
1094:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">rollback</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>)
1095:       <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value">0</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">current_version</span>)
1096:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005752" class="method">
  <div id="M005752_title" class="title">
    <b>test_migrator_verbosity</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005752_source')" id="l_M005752_source">show source</a> ]</p>
  <div id="M005752_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1048</span>
1048:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_verbosity</span>
1049:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">up</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">1</span>)
1050:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">PeopleHaveLastNames</span>.<span class="ruby-identifier">message_count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
1051:       <span class="ruby-constant">PeopleHaveLastNames</span>.<span class="ruby-identifier">message_count</span> = <span class="ruby-value">0</span>
1052: 
1053:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">down</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">0</span>)
1054:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">PeopleHaveLastNames</span>.<span class="ruby-identifier">message_count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
1055:       <span class="ruby-constant">PeopleHaveLastNames</span>.<span class="ruby-identifier">message_count</span> = <span class="ruby-value">0</span>
1056:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005753" class="method">
  <div id="M005753_title" class="title">
    <b>test_migrator_verbosity_off</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005753_source')" id="l_M005753_source">show source</a> ]</p>
  <div id="M005753_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1058</span>
1058:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_verbosity_off</span>
1059:       <span class="ruby-constant">PeopleHaveLastNames</span>.<span class="ruby-identifier">verbose</span> = <span class="ruby-keyword kw">false</span>
1060:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">up</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">1</span>)
1061:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">PeopleHaveLastNames</span>.<span class="ruby-identifier">message_count</span>.<span class="ruby-identifier">zero?</span>
1062:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">down</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">0</span>)
1063:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">PeopleHaveLastNames</span>.<span class="ruby-identifier">message_count</span>.<span class="ruby-identifier">zero?</span>
1064:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005761" class="method">
  <div id="M005761_title" class="title">
    <b>test_migrator_with_duplicate_names</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005761_source')" id="l_M005761_source">show source</a> ]</p>
  <div id="M005761_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1187</span>
1187:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_with_duplicate_names</span>
1188:       <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">DuplicateMigrationNameError</span>, <span class="ruby-value str">&quot;Multiple migrations have the name Chunky&quot;</span>) <span class="ruby-keyword kw">do</span>
1189:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">migrate</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/duplicate_names&quot;</span>, <span class="ruby-keyword kw">nil</span>)
1190:       <span class="ruby-keyword kw">end</span>
1191:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005760" class="method">
  <div id="M005760_title" class="title">
    <b>test_migrator_with_duplicates</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005760_source')" id="l_M005760_source">show source</a> ]</p>
  <div id="M005760_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1181</span>
1181:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_with_duplicates</span>
1182:       <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">DuplicateMigrationVersionError</span>) <span class="ruby-keyword kw">do</span>
1183:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">migrate</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/duplicate&quot;</span>, <span class="ruby-keyword kw">nil</span>)
1184:       <span class="ruby-keyword kw">end</span>
1185:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005762" class="method">
  <div id="M005762_title" class="title">
    <b>test_migrator_with_missing_version_numbers</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005762_source')" id="l_M005762_source">show source</a> ]</p>
  <div id="M005762_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1193</span>
1193:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_with_missing_version_numbers</span>
1194:       <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">UnknownMigrationVersionError</span>) <span class="ruby-keyword kw">do</span>
1195:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">migrate</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/missing&quot;</span>, <span class="ruby-value">500</span>)
1196:       <span class="ruby-keyword kw">end</span>
1197:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005712" class="method">
  <div id="M005712_title" class="title">
    <b>test_native_decimal_insert_manual_vs_automatic</b>()
  </div>
  <div class="description">
  <p>
We specifically do a manual INSERT here, and then test only the SELECT
functionality. This allows us to more easily catch INSERT being broken, but
SELECT actually working fine.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005712_source')" id="l_M005712_source">show source</a> ]</p>
  <div id="M005712_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 357</span>
357:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_native_decimal_insert_manual_vs_automatic</span>
358:       <span class="ruby-identifier">correct_value</span> = <span class="ruby-value str">'0012345678901234567890.0123456789'</span>.<span class="ruby-identifier">to_d</span>
359: 
360:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">delete_all</span>
361:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;wealth&quot;</span>, <span class="ruby-identifier">:decimal</span>, <span class="ruby-identifier">:precision</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'30'</span>, <span class="ruby-identifier">:scale</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'10'</span>
362:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
363: 
364:       <span class="ruby-comment cmt"># Do a manual insertion</span>
365:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:OracleAdapter</span>)
366:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span> <span class="ruby-value str">&quot;insert into people (id, wealth) values (people_seq.nextval, 12345678901234567890.0123456789)&quot;</span>
367:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:OpenBaseAdapter</span>) <span class="ruby-operator">||</span> (<span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:MysqlAdapter</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">Mysql</span>.<span class="ruby-identifier">client_version</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">50003</span>) <span class="ruby-comment cmt">#before mysql 5.0.3 decimals stored as strings</span>
368:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span> <span class="ruby-value str">&quot;insert into people (wealth) values ('12345678901234567890.0123456789')&quot;</span>
369:       <span class="ruby-keyword kw">else</span>
370:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span> <span class="ruby-value str">&quot;insert into people (wealth) values (12345678901234567890.0123456789)&quot;</span>
371:       <span class="ruby-keyword kw">end</span>
372: 
373:       <span class="ruby-comment cmt"># SELECT</span>
374:       <span class="ruby-identifier">row</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>)
375:       <span class="ruby-identifier">assert_kind_of</span> <span class="ruby-constant">BigDecimal</span>, <span class="ruby-identifier">row</span>.<span class="ruby-identifier">wealth</span>
376: 
377:       <span class="ruby-comment cmt"># If this assert fails, that means the SELECT is broken!</span>
378:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:SQLite3Adapter</span>)
379:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">correct_value</span>, <span class="ruby-identifier">row</span>.<span class="ruby-identifier">wealth</span>
380:       <span class="ruby-keyword kw">end</span>
381: 
382:       <span class="ruby-comment cmt"># Reset to old state</span>
383:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">delete_all</span>
384: 
385:       <span class="ruby-comment cmt"># Now use the Rails insertion</span>
386:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">create</span> <span class="ruby-identifier">:wealth</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">BigDecimal</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;12345678901234567890.0123456789&quot;</span>) }
387: 
388:       <span class="ruby-comment cmt"># SELECT</span>
389:       <span class="ruby-identifier">row</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>)
390:       <span class="ruby-identifier">assert_kind_of</span> <span class="ruby-constant">BigDecimal</span>, <span class="ruby-identifier">row</span>.<span class="ruby-identifier">wealth</span>
391: 
392:       <span class="ruby-comment cmt"># If these asserts fail, that means the INSERT (create function, or cast to SQL) is broken!</span>
393:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:SQLite3Adapter</span>)
394:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">correct_value</span>, <span class="ruby-identifier">row</span>.<span class="ruby-identifier">wealth</span>
395:       <span class="ruby-keyword kw">end</span>
396: 
397:       <span class="ruby-comment cmt"># Reset to old state</span>
398:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">del_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;wealth&quot;</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
399:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
400:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005714" class="method">
  <div id="M005714_title" class="title">
    <b>test_native_types</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005714_source')" id="l_M005714_source">show source</a> ]</p>
  <div id="M005714_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 411</span>
411:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_native_types</span>
412:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">delete_all</span>
413:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;last_name&quot;</span>, <span class="ruby-identifier">:string</span>
414:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;bio&quot;</span>, <span class="ruby-identifier">:text</span>
415:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;age&quot;</span>, <span class="ruby-identifier">:integer</span>
416:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;height&quot;</span>, <span class="ruby-identifier">:float</span>
417:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;wealth&quot;</span>, <span class="ruby-identifier">:decimal</span>, <span class="ruby-identifier">:precision</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'30'</span>, <span class="ruby-identifier">:scale</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'10'</span>
418:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;birthday&quot;</span>, <span class="ruby-identifier">:datetime</span>
419:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;favorite_day&quot;</span>, <span class="ruby-identifier">:date</span>
420:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;moment_of_truth&quot;</span>, <span class="ruby-identifier">:datetime</span>
421:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;male&quot;</span>, <span class="ruby-identifier">:boolean</span>
422:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
423: 
424:       <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
425:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">create</span> <span class="ruby-identifier">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'bob'</span>, <span class="ruby-identifier">:last_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'bobsen'</span>,
426:           <span class="ruby-identifier">:bio</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;I was born ....&quot;</span>, <span class="ruby-identifier">:age</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">18</span>, <span class="ruby-identifier">:height</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1.78</span>,
427:           <span class="ruby-identifier">:wealth</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">BigDecimal</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;12345678901234567890.0123456789&quot;</span>),
428:           <span class="ruby-identifier">:birthday</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">18</span>.<span class="ruby-identifier">years</span>.<span class="ruby-identifier">ago</span>, <span class="ruby-identifier">:favorite_day</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">days</span>.<span class="ruby-identifier">ago</span>,
429:           <span class="ruby-identifier">:moment_of_truth</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;1782-10-10 21:40:18&quot;</span>, <span class="ruby-identifier">:male</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>
430:       <span class="ruby-keyword kw">end</span>
431: 
432:       <span class="ruby-identifier">bob</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>)
433:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'bob'</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">first_name</span>
434:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'bobsen'</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">last_name</span>
435:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;I was born ....&quot;</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">bio</span>
436:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">18</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">age</span>
437: 
438:       <span class="ruby-comment cmt"># Test for 30 significent digits (beyond the 16 of float), 10 of them</span>
439:       <span class="ruby-comment cmt"># after the decimal place.</span>
440: 
441:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:SQLite3Adapter</span>)
442:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">BigDecimal</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;0012345678901234567890.0123456789&quot;</span>), <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">wealth</span>
443:       <span class="ruby-keyword kw">end</span>
444: 
445:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">male?</span>
446: 
447:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">String</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">first_name</span>.<span class="ruby-identifier">class</span>
448:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">String</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">last_name</span>.<span class="ruby-identifier">class</span>
449:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">String</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">bio</span>.<span class="ruby-identifier">class</span>
450:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Fixnum</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">age</span>.<span class="ruby-identifier">class</span>
451:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Time</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">birthday</span>.<span class="ruby-identifier">class</span>
452: 
453:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:OracleAdapter</span>, <span class="ruby-identifier">:SybaseAdapter</span>)
454:         <span class="ruby-comment cmt"># Sybase, and Oracle don't differentiate between date/time</span>
455:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Time</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">favorite_day</span>.<span class="ruby-identifier">class</span>
456:       <span class="ruby-keyword kw">else</span>
457:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Date</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">favorite_day</span>.<span class="ruby-identifier">class</span>
458:       <span class="ruby-keyword kw">end</span>
459: 
460:       <span class="ruby-comment cmt"># Test DateTime column and defaults, including timezone.</span>
461:       <span class="ruby-comment cmt"># FIXME: moment of truth may be Time on 64-bit platforms.</span>
462:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">moment_of_truth</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">DateTime</span>)
463: 
464:         <span class="ruby-identifier">with_env_tz</span> <span class="ruby-value str">'US/Eastern'</span> <span class="ruby-keyword kw">do</span>
465:           <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">local_offset</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">moment_of_truth</span>.<span class="ruby-identifier">offset</span>
466:           <span class="ruby-identifier">assert_not_equal</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">moment_of_truth</span>.<span class="ruby-identifier">offset</span>
467:           <span class="ruby-identifier">assert_not_equal</span> <span class="ruby-value str">&quot;Z&quot;</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">moment_of_truth</span>.<span class="ruby-identifier">zone</span>
468:           <span class="ruby-comment cmt"># US/Eastern is -5 hours from GMT</span>
469:           <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Rational</span>(<span class="ruby-value">-5</span>, <span class="ruby-value">24</span>), <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">moment_of_truth</span>.<span class="ruby-identifier">offset</span>
470:           <span class="ruby-identifier">assert_match</span> <span class="ruby-regexp re">/\A-05:?00\Z/</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">moment_of_truth</span>.<span class="ruby-identifier">zone</span> <span class="ruby-comment cmt">#ruby 1.8.6 uses HH:MM, prior versions use HHMM</span>
471:           <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">DateTime</span><span class="ruby-operator">::</span><span class="ruby-constant">ITALY</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">moment_of_truth</span>.<span class="ruby-identifier">start</span>
472:         <span class="ruby-keyword kw">end</span>
473:       <span class="ruby-keyword kw">end</span>
474: 
475:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">TrueClass</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">male?</span>.<span class="ruby-identifier">class</span>
476:       <span class="ruby-identifier">assert_kind_of</span> <span class="ruby-constant">BigDecimal</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">wealth</span>
477:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005749" class="method">
  <div id="M005749_title" class="title">
    <b>test_only_loads_pending_migrations</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005749_source')" id="l_M005749_source">show source</a> ]</p>
  <div id="M005749_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1006</span>
1006:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_only_loads_pending_migrations</span>
1007:       <span class="ruby-comment cmt"># migrate up to 1</span>
1008:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">up</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">1</span>)
1009: 
1010:       <span class="ruby-comment cmt"># now unload the migrations that have been defined</span>
1011:       <span class="ruby-constant">PeopleHaveLastNames</span>.<span class="ruby-identifier">unloadable</span>
1012:       <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">Dependencies</span>.<span class="ruby-identifier">remove_unloadable_constants!</span>
1013: 
1014:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">migrate</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-keyword kw">nil</span>)
1015: 
1016:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-keyword kw">defined?</span> <span class="ruby-constant">PeopleHaveLastNames</span>
1017: 
1018:       <span class="ruby-node">%w(WeNeedReminders, InnocentJointable)</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">migration</span><span class="ruby-operator">|</span>
1019:         <span class="ruby-identifier">assert</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-identifier">migration</span>
1020:       <span class="ruby-keyword kw">end</span>
1021: 
1022:     <span class="ruby-keyword kw">ensure</span>
1023:       <span class="ruby-identifier">load</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid/1_people_have_last_names.rb&quot;</span>)
1024:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005757" class="method">
  <div id="M005757_title" class="title">
    <b>test_proper_table_name</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005757_source')" id="l_M005757_source">show source</a> ]</p>
  <div id="M005757_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1112</span>
1112:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_proper_table_name</span>
1113:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;table&quot;</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">proper_table_name</span>(<span class="ruby-value str">'table'</span>)
1114:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;table&quot;</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">proper_table_name</span>(<span class="ruby-identifier">:table</span>)
1115:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;reminders&quot;</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">proper_table_name</span>(<span class="ruby-constant">Reminder</span>)
1116:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">reset_table_name</span>
1117:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">table_name</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">proper_table_name</span>(<span class="ruby-constant">Reminder</span>)
1118: 
1119:       <span class="ruby-comment cmt"># Use the model's own prefix/suffix if a model is given</span>
1120:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_prefix</span> = <span class="ruby-value str">&quot;ARprefix_&quot;</span>
1121:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_suffix</span> = <span class="ruby-value str">&quot;_ARsuffix&quot;</span>
1122:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">table_name_prefix</span> = <span class="ruby-value str">'prefix_'</span>
1123:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">table_name_suffix</span> = <span class="ruby-value str">'_suffix'</span>
1124:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">reset_table_name</span>
1125:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;prefix_reminders_suffix&quot;</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">proper_table_name</span>(<span class="ruby-constant">Reminder</span>)
1126:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">table_name_prefix</span> = <span class="ruby-value str">''</span>
1127:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">table_name_suffix</span> = <span class="ruby-value str">''</span>
1128:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">reset_table_name</span>
1129: 
1130:       <span class="ruby-comment cmt"># Use AR::Base's prefix/suffix if string or symbol is given</span>
1131:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_prefix</span> = <span class="ruby-value str">&quot;prefix_&quot;</span>
1132:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_suffix</span> = <span class="ruby-value str">&quot;_suffix&quot;</span>
1133:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">reset_table_name</span>
1134:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;prefix_table_suffix&quot;</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">proper_table_name</span>(<span class="ruby-value str">'table'</span>)
1135:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;prefix_table_suffix&quot;</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">proper_table_name</span>(<span class="ruby-identifier">:table</span>)
1136:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_prefix</span> = <span class="ruby-value str">&quot;&quot;</span>
1137:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_suffix</span> = <span class="ruby-value str">&quot;&quot;</span>
1138:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">reset_table_name</span>
1139:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005725" class="method">
  <div id="M005725_title" class="title">
    <b>test_remove_column_with_index</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005725_source')" id="l_M005725_source">show source</a> ]</p>
  <div id="M005725_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 621</span>
621:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_remove_column_with_index</span>
622:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span>(<span class="ruby-identifier">:hats</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">table</span><span class="ruby-operator">|</span>
623:         <span class="ruby-identifier">table</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:hat_name</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">100</span>
624:         <span class="ruby-identifier">table</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:hat_size</span>, <span class="ruby-identifier">:integer</span>
625:       <span class="ruby-keyword kw">end</span>
626:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span> <span class="ruby-value str">&quot;hats&quot;</span>, <span class="ruby-value str">&quot;hat_size&quot;</span>
627: 
628:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_column</span>(<span class="ruby-value str">&quot;hats&quot;</span>, <span class="ruby-value str">&quot;hat_size&quot;</span>) }
629:     <span class="ruby-keyword kw">ensure</span>
630:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span>(<span class="ruby-identifier">:hats</span>)
631:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005726" class="method">
  <div id="M005726_title" class="title">
    <b>test_remove_column_with_multi_column_index</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005726_source')" id="l_M005726_source">show source</a> ]</p>
  <div id="M005726_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 633</span>
633:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_remove_column_with_multi_column_index</span>
634:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span>(<span class="ruby-identifier">:hats</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">table</span><span class="ruby-operator">|</span>
635:         <span class="ruby-identifier">table</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:hat_name</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">100</span>
636:         <span class="ruby-identifier">table</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:hat_size</span>, <span class="ruby-identifier">:integer</span>
637:         <span class="ruby-identifier">table</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:hat_style</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">100</span>
638:       <span class="ruby-keyword kw">end</span>
639:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span> <span class="ruby-value str">&quot;hats&quot;</span>, [<span class="ruby-value str">&quot;hat_style&quot;</span>, <span class="ruby-value str">&quot;hat_size&quot;</span>], <span class="ruby-identifier">:unique</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>
640: 
641:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_column</span>(<span class="ruby-value str">&quot;hats&quot;</span>, <span class="ruby-value str">&quot;hat_size&quot;</span>) }
642:     <span class="ruby-keyword kw">ensure</span>
643:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span>(<span class="ruby-identifier">:hats</span>)
644:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005720" class="method">
  <div id="M005720_title" class="title">
    <b>test_rename_column</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005720_source')" id="l_M005720_source">show source</a> ]</p>
  <div id="M005720_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 553</span>
553:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_rename_column</span>
554:       <span class="ruby-keyword kw">begin</span>
555:         <span class="ruby-identifier">names_before</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:first_name</span>)
556:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">rename_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>, <span class="ruby-value str">&quot;nick_name&quot;</span>
557:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
558:         <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_names</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;nick_name&quot;</span>)
559:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">names_before</span>, <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:nick_name</span>)
560:       <span class="ruby-keyword kw">ensure</span>
561:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_column</span>(<span class="ruby-value str">&quot;people&quot;</span>,<span class="ruby-value str">&quot;nick_name&quot;</span>)
562:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span>(<span class="ruby-value str">&quot;people&quot;</span>,<span class="ruby-value str">&quot;first_name&quot;</span>, <span class="ruby-identifier">:string</span>)
563:       <span class="ruby-keyword kw">end</span>
564:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005721" class="method">
  <div id="M005721_title" class="title">
    <b>test_rename_column_preserves_default_value_not_null</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005721_source')" id="l_M005721_source">show source</a> ]</p>
  <div id="M005721_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 566</span>
566:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_rename_column_preserves_default_value_not_null</span>
567:       <span class="ruby-keyword kw">begin</span>
568:         <span class="ruby-identifier">default_before</span> = <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-value str">&quot;developers&quot;</span>).<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;salary&quot;</span> }.<span class="ruby-identifier">default</span>
569:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">70000</span>, <span class="ruby-identifier">default_before</span>
570:         <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">rename_column</span> <span class="ruby-value str">&quot;developers&quot;</span>, <span class="ruby-value str">&quot;salary&quot;</span>, <span class="ruby-value str">&quot;anual_salary&quot;</span>
571:         <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">reset_column_information</span>
572:         <span class="ruby-identifier">assert</span> <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">column_names</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;anual_salary&quot;</span>)
573:         <span class="ruby-identifier">default_after</span> = <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-value str">&quot;developers&quot;</span>).<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;anual_salary&quot;</span> }.<span class="ruby-identifier">default</span>
574:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">70000</span>, <span class="ruby-identifier">default_after</span>
575:       <span class="ruby-keyword kw">ensure</span>
576:         <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">rename_column</span> <span class="ruby-value str">&quot;developers&quot;</span>, <span class="ruby-value str">&quot;anual_salary&quot;</span>, <span class="ruby-value str">&quot;salary&quot;</span>
577:         <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">reset_column_information</span>
578:       <span class="ruby-keyword kw">end</span>
579:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005719" class="method">
  <div id="M005719_title" class="title">
    <b>test_rename_column_using_symbol_arguments</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005719_source')" id="l_M005719_source">show source</a> ]</p>
  <div id="M005719_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 540</span>
540:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_rename_column_using_symbol_arguments</span>
541:       <span class="ruby-keyword kw">begin</span>
542:         <span class="ruby-identifier">names_before</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:first_name</span>)
543:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">rename_column</span> <span class="ruby-identifier">:people</span>, <span class="ruby-identifier">:first_name</span>, <span class="ruby-identifier">:nick_name</span>
544:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
545:         <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_names</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;nick_name&quot;</span>)
546:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">names_before</span>, <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:nick_name</span>)
547:       <span class="ruby-keyword kw">ensure</span>
548:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_column</span>(<span class="ruby-value str">&quot;people&quot;</span>,<span class="ruby-value str">&quot;nick_name&quot;</span>)
549:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span>(<span class="ruby-value str">&quot;people&quot;</span>,<span class="ruby-value str">&quot;first_name&quot;</span>, <span class="ruby-identifier">:string</span>)
550:       <span class="ruby-keyword kw">end</span>
551:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005724" class="method">
  <div id="M005724_title" class="title">
    <b>test_rename_column_with_an_index</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005724_source')" id="l_M005724_source">show source</a> ]</p>
  <div id="M005724_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 608</span>
608:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_rename_column_with_an_index</span>
609:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span>(<span class="ruby-identifier">:hats</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">table</span><span class="ruby-operator">|</span>
610:         <span class="ruby-identifier">table</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:hat_name</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">100</span>
611:         <span class="ruby-identifier">table</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:hat_size</span>, <span class="ruby-identifier">:integer</span>
612:       <span class="ruby-keyword kw">end</span>
613:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span> <span class="ruby-identifier">:hats</span>, <span class="ruby-identifier">:hat_name</span>
614:       <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
615:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">rename_column</span> <span class="ruby-value str">&quot;hats&quot;</span>, <span class="ruby-value str">&quot;hat_name&quot;</span>, <span class="ruby-value str">&quot;name&quot;</span>
616:       <span class="ruby-keyword kw">end</span>
617:     <span class="ruby-keyword kw">ensure</span>
618:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span>(<span class="ruby-identifier">:hats</span>)
619:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005723" class="method">
  <div id="M005723_title" class="title">
    <b>test_rename_column_with_sql_reserved_word</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005723_source')" id="l_M005723_source">show source</a> ]</p>
  <div id="M005723_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 597</span>
597:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_rename_column_with_sql_reserved_word</span>
598:       <span class="ruby-keyword kw">begin</span>
599:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">rename_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>, <span class="ruby-value str">&quot;group&quot;</span> }
600:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
601:         <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_names</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;group&quot;</span>)
602:       <span class="ruby-keyword kw">ensure</span>
603:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_column</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;group&quot;</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
604:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>, <span class="ruby-identifier">:string</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
605:       <span class="ruby-keyword kw">end</span>
606:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005722" class="method">
  <div id="M005722_title" class="title">
    <b>test_rename_nonexistent_column</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005722_source')" id="l_M005722_source">show source</a> ]</p>
  <div id="M005722_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 581</span>
581:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_rename_nonexistent_column</span>
582:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span>(<span class="ruby-identifier">:hats</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">table</span><span class="ruby-operator">|</span>
583:         <span class="ruby-identifier">table</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:hat_name</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>
584:       <span class="ruby-keyword kw">end</span>
585:       <span class="ruby-identifier">exception</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:PostgreSQLAdapter</span>)
586:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">StatementInvalid</span>
587:       <span class="ruby-keyword kw">else</span>
588:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">ActiveRecordError</span>
589:       <span class="ruby-keyword kw">end</span>
590:       <span class="ruby-identifier">assert_raise</span>(<span class="ruby-identifier">exception</span>) <span class="ruby-keyword kw">do</span>
591:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">rename_column</span> <span class="ruby-value str">&quot;hats&quot;</span>, <span class="ruby-value str">&quot;nonexistent&quot;</span>, <span class="ruby-value str">&quot;should_fail&quot;</span>
592:       <span class="ruby-keyword kw">end</span>
593:     <span class="ruby-keyword kw">ensure</span>
594:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span>(<span class="ruby-identifier">:hats</span>)
595:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005728" class="method">
  <div id="M005728_title" class="title">
    <b>test_rename_table</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005728_source')" id="l_M005728_source">show source</a> ]</p>
  <div id="M005728_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 656</span>
656:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_rename_table</span>
657:       <span class="ruby-keyword kw">begin</span>
658:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:octopuses</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
659:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:url</span>, <span class="ruby-identifier">:string</span>
660:         <span class="ruby-keyword kw">end</span>
661:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">rename_table</span> <span class="ruby-identifier">:octopuses</span>, <span class="ruby-identifier">:octopi</span>
662: 
663:         <span class="ruby-comment cmt"># Using explicit id in insert for compatibility across all databases</span>
664:         <span class="ruby-identifier">con</span> = <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>
665:         <span class="ruby-identifier">con</span>.<span class="ruby-identifier">enable_identity_insert</span>(<span class="ruby-value str">&quot;octopi&quot;</span>, <span class="ruby-keyword kw">true</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:SybaseAdapter</span>)
666:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">con</span>.<span class="ruby-identifier">execute</span> <span class="ruby-node">&quot;INSERT INTO octopi (#{con.quote_column_name('id')}, #{con.quote_column_name('url')}) VALUES (1, 'http://www.foreverflying.com/octopus-black7.jpg')&quot;</span> }
667:         <span class="ruby-identifier">con</span>.<span class="ruby-identifier">enable_identity_insert</span>(<span class="ruby-value str">&quot;octopi&quot;</span>, <span class="ruby-keyword kw">false</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:SybaseAdapter</span>)
668: 
669:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'http://www.foreverflying.com/octopus-black7.jpg'</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_value</span>(<span class="ruby-value str">&quot;SELECT url FROM octopi WHERE id=1&quot;</span>)
670: 
671:       <span class="ruby-keyword kw">ensure</span>
672:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:octopuses</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
673:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:octopi</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
674:       <span class="ruby-keyword kw">end</span>
675:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005730" class="method">
  <div id="M005730_title" class="title">
    <b>test_rename_table_with_an_index</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005730_source')" id="l_M005730_source">show source</a> ]</p>
  <div id="M005730_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 690</span>
690:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_rename_table_with_an_index</span>
691:       <span class="ruby-keyword kw">begin</span>
692:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:octopuses</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
693:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:url</span>, <span class="ruby-identifier">:string</span>
694:         <span class="ruby-keyword kw">end</span>
695:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span> <span class="ruby-identifier">:octopuses</span>, <span class="ruby-identifier">:url</span>
696: 
697:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">rename_table</span> <span class="ruby-identifier">:octopuses</span>, <span class="ruby-identifier">:octopi</span>
698: 
699:         <span class="ruby-comment cmt"># Using explicit id in insert for compatibility across all databases</span>
700:         <span class="ruby-identifier">con</span> = <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>
701:         <span class="ruby-identifier">con</span>.<span class="ruby-identifier">enable_identity_insert</span>(<span class="ruby-value str">&quot;octopi&quot;</span>, <span class="ruby-keyword kw">true</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:SybaseAdapter</span>)
702:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">con</span>.<span class="ruby-identifier">execute</span> <span class="ruby-node">&quot;INSERT INTO octopi (#{con.quote_column_name('id')}, #{con.quote_column_name('url')}) VALUES (1, 'http://www.foreverflying.com/octopus-black7.jpg')&quot;</span> }
703:         <span class="ruby-identifier">con</span>.<span class="ruby-identifier">enable_identity_insert</span>(<span class="ruby-value str">&quot;octopi&quot;</span>, <span class="ruby-keyword kw">false</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:SybaseAdapter</span>)
704: 
705:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'http://www.foreverflying.com/octopus-black7.jpg'</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_value</span>(<span class="ruby-value str">&quot;SELECT url FROM octopi WHERE id=1&quot;</span>)
706:         <span class="ruby-identifier">assert</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">indexes</span>(<span class="ruby-identifier">:octopi</span>).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">columns</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;url&quot;</span>)
707:       <span class="ruby-keyword kw">ensure</span>
708:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:octopuses</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
709:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:octopi</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
710:       <span class="ruby-keyword kw">end</span>
711:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005756" class="method">
  <div id="M005756_title" class="title">
    <b>test_schema_migrations_table_name</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005756_source')" id="l_M005756_source">show source</a> ]</p>
  <div id="M005756_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1098</span>
1098:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_schema_migrations_table_name</span>
1099:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_prefix</span> = <span class="ruby-value str">&quot;prefix_&quot;</span>
1100:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_suffix</span> = <span class="ruby-value str">&quot;_suffix&quot;</span>
1101:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">reset_table_name</span>
1102:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;prefix_schema_migrations_suffix&quot;</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">schema_migrations_table_name</span>
1103:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_prefix</span> = <span class="ruby-value str">&quot;&quot;</span>
1104:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_suffix</span> = <span class="ruby-value str">&quot;&quot;</span>
1105:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">reset_table_name</span>
1106:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;schema_migrations&quot;</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">schema_migrations_table_name</span>
1107:     <span class="ruby-keyword kw">ensure</span>
1108:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_prefix</span> = <span class="ruby-value str">&quot;&quot;</span>
1109:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_suffix</span> = <span class="ruby-value str">&quot;&quot;</span>
1110:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005715" class="method">
  <div id="M005715_title" class="title">
    <b>test_unabstracted_database_dependent_types</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005715_source')" id="l_M005715_source">show source</a> ]</p>
  <div id="M005715_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 480</span>
480:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_unabstracted_database_dependent_types</span>
481:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">delete_all</span>
482: 
483:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migration</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-identifier">:people</span>, <span class="ruby-identifier">:intelligence_quotient</span>, <span class="ruby-identifier">:tinyint</span>
484:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
485:         <span class="ruby-identifier">assert_match</span> <span class="ruby-regexp re">/tinyint/</span>, <span class="ruby-constant">Person</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">'intelligence_quotient'</span>].<span class="ruby-identifier">sql_type</span>
486:       <span class="ruby-keyword kw">ensure</span>
487:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migration</span>.<span class="ruby-identifier">remove_column</span> <span class="ruby-identifier">:people</span>, <span class="ruby-identifier">:intelligence_quotient</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
488:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="sectiontitle">Protected Instance methods</div>
<div id="M005698" class="method">
  <div id="M005698_title" class="title">
    <b>testing_table_with_only_foo_attribute</b>() {|Person.connection| ...}
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005698_source')" id="l_M005698_source">show source</a> ]</p>
  <div id="M005698_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 114</span>
114:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">testing_table_with_only_foo_attribute</span>
115:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:testings</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
116:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:foo</span>, <span class="ruby-identifier">:string</span>
117:       <span class="ruby-keyword kw">end</span>
118: 
119:       <span class="ruby-keyword kw">yield</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>
120:     <span class="ruby-keyword kw">ensure</span>
121:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
122:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005764" class="method">
  <div id="M005764_title" class="title">
    <b>with_env_tz</b>(new_tz = 'US/Eastern') {|| ...}
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005764_source')" id="l_M005764_source">show source</a> ]</p>
  <div id="M005764_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1237</span>
1237:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">with_env_tz</span>(<span class="ruby-identifier">new_tz</span> = <span class="ruby-value str">'US/Eastern'</span>)
1238:         <span class="ruby-identifier">old_tz</span>, <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'TZ'</span>] = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'TZ'</span>], <span class="ruby-identifier">new_tz</span>
1239:         <span class="ruby-keyword kw">yield</span>
1240:       <span class="ruby-keyword kw">ensure</span>
1241:         <span class="ruby-identifier">old_tz</span> <span class="ruby-value">? </span><span class="ruby-constant">ENV</span>[<span class="ruby-value str">'TZ'</span>] = <span class="ruby-identifier">old_tz</span> <span class="ruby-operator">:</span> <span class="ruby-constant">ENV</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">'TZ'</span>)
1242:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>