  <div id="C00000807">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />MigrationTest<br/>
  In:
<a href="#" onclick="jsHref('files/activerecord/test/cases/migration_test_rb.html');">activerecord/test/cases/migration_test.rb</a>

Parent:&nbsp;
ActiveRecord::TestCase
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">




  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M005756&name=setup" >setup</a></li>
  <li><a href="index.html?a=M005757&name=teardown" >teardown</a></li>
  <li><a href="index.html?a=M005777&name=test_add_column_not_null_with_default" >test_add_column_not_null_with_default</a></li>
  <li><a href="index.html?a=M005776&name=test_add_column_not_null_without_default" >test_add_column_not_null_without_default</a></li>
  <li><a href="index.html?a=M005786&name=test_add_column_with_positioning" >test_add_column_with_positioning</a></li>
  <li><a href="index.html?a=M005779&name=test_add_column_with_precision_and_scale" >test_add_column_with_precision_and_scale</a></li>
  <li><a href="index.html?a=M005765&name=test_add_column_with_primary_key_attribute" >test_add_column_with_primary_key_attribute</a></li>
  <li><a href="index.html?a=M005829&name=test_add_drop_table_with_prefix_and_suffix" >test_add_drop_table_with_prefix_and_suffix</a></li>
  <li><a href="index.html?a=M005758&name=test_add_index" >test_add_index</a></li>
  <li><a href="index.html?a=M005759&name=test_add_index_length_limit" >test_add_index_length_limit</a></li>
  <li><a href="index.html?a=M005782&name=test_add_remove_single_field_using_string_arguments" >test_add_remove_single_field_using_string_arguments</a></li>
  <li><a href="index.html?a=M005783&name=test_add_remove_single_field_using_symbol_arguments" >test_add_remove_single_field_using_symbol_arguments</a></li>
  <li><a href="index.html?a=M005788&name=test_add_rename" >test_add_rename</a></li>
  <li><a href="index.html?a=M005808&name=test_add_table" >test_add_table</a></li>
  <li><a href="index.html?a=M005809&name=test_add_table_with_decimals" >test_add_table_with_decimals</a></li>
  <li><a href="index.html?a=M005801&name=test_change_column" >test_change_column</a></li>
  <li><a href="index.html?a=M005804&name=test_change_column_default" >test_change_column_default</a></li>
  <li><a href="index.html?a=M005807&name=test_change_column_default_to_null" >test_change_column_default_to_null</a></li>
  <li><a href="index.html?a=M005799&name=test_change_column_nullability" >test_change_column_nullability</a></li>
  <li><a href="index.html?a=M005805&name=test_change_column_quotes_column_names" >test_change_column_quotes_column_names</a></li>
  <li><a href="index.html?a=M005803&name=test_change_column_with_new_default" >test_change_column_with_new_default</a></li>
  <li><a href="index.html?a=M005802&name=test_change_column_with_nil_default" >test_change_column_with_nil_default</a></li>
  <li><a href="index.html?a=M005787&name=test_change_column_with_positioning" >test_change_column_with_positioning</a></li>
  <li><a href="index.html?a=M005797&name=test_change_type_of_not_null_column" >test_change_type_of_not_null_column</a></li>
  <li><a href="index.html?a=M005785&name=test_column_positioning" >test_column_positioning</a></li>
  <li><a href="index.html?a=M005766&name=test_create_table_adds_id" >test_create_table_adds_id</a></li>
  <li><a href="index.html?a=M005830&name=test_create_table_with_binary_column" >test_create_table_with_binary_column</a></li>
  <li><a href="index.html?a=M005834&name=test_create_table_with_custom_sequence_name" >test_create_table_with_custom_sequence_name</a></li>
  <li><a href="index.html?a=M005768&name=test_create_table_with_defaults" >test_create_table_with_defaults</a></li>
  <li><a href="index.html?a=M005772&name=test_create_table_with_force_true_does_not_drop_nonexisting_table" >test_create_table_with_force_true_does_not_drop_nonexisting_table</a></li>
  <li><a href="index.html?a=M005769&name=test_create_table_with_limits" >test_create_table_with_limits</a></li>
  <li><a href="index.html?a=M005767&name=test_create_table_with_not_null_column" >test_create_table_with_not_null_column</a></li>
  <li><a href="index.html?a=M005771&name=test_create_table_with_primary_key_prefix_as_table_name" >test_create_table_with_primary_key_prefix_as_table_name</a></li>
  <li><a href="index.html?a=M005770&name=test_create_table_with_primary_key_prefix_as_table_name_with_underscore" >test_create_table_with_primary_key_prefix_as_table_name_with_underscore</a></li>
  <li><a href="index.html?a=M005773&name=test_create_table_with_timestamps_should_create_datetime_columns" >test_create_table_with_timestamps_should_create_datetime_columns</a></li>
  <li><a href="index.html?a=M005774&name=test_create_table_with_timestamps_should_create_datetime_columns_with_options" >test_create_table_with_timestamps_should_create_datetime_columns_with_options</a></li>
  <li><a href="index.html?a=M005775&name=test_create_table_without_a_block" >test_create_table_without_a_block</a></li>
  <li><a href="index.html?a=M005764&name=test_create_table_without_id" >test_create_table_without_id</a></li>
  <li><a href="index.html?a=M005762&name=test_double_add_index" >test_double_add_index</a></li>
  <li><a href="index.html?a=M005817&name=test_finds_migrations" >test_finds_migrations</a></li>
  <li><a href="index.html?a=M005818&name=test_finds_pending_migrations" >test_finds_pending_migrations</a></li>
  <li><a href="index.html?a=M005806&name=test_keeping_default_and_notnull_constaint_on_change" >test_keeping_default_and_notnull_constaint_on_change</a></li>
  <li><a href="index.html?a=M005810&name=test_migrator" >test_migrator</a></li>
  <li><a href="index.html?a=M005822&name=test_migrator_db_has_no_schema_migrations_table" >test_migrator_db_has_no_schema_migrations_table</a></li>
  <li><a href="index.html?a=M005815&name=test_migrator_double_down" >test_migrator_double_down</a></li>
  <li><a href="index.html?a=M005814&name=test_migrator_double_up" >test_migrator_double_up</a></li>
  <li><a href="index.html?a=M005825&name=test_migrator_going_down_due_to_version_target" >test_migrator_going_down_due_to_version_target</a></li>
  <li><a href="index.html?a=M005821&name=test_migrator_interleaved_migrations" >test_migrator_interleaved_migrations</a></li>
  <li><a href="index.html?a=M005812&name=test_migrator_one_down" >test_migrator_one_down</a></li>
  <li><a href="index.html?a=M005811&name=test_migrator_one_up" >test_migrator_one_up</a></li>
  <li><a href="index.html?a=M005813&name=test_migrator_one_up_one_down" >test_migrator_one_up_one_down</a></li>
  <li><a href="index.html?a=M005816&name=test_migrator_one_up_with_exception_and_rollback" >test_migrator_one_up_with_exception_and_rollback</a></li>
  <li><a href="index.html?a=M005826&name=test_migrator_rollback" >test_migrator_rollback</a></li>
  <li><a href="index.html?a=M005823&name=test_migrator_verbosity" >test_migrator_verbosity</a></li>
  <li><a href="index.html?a=M005824&name=test_migrator_verbosity_off" >test_migrator_verbosity_off</a></li>
  <li><a href="index.html?a=M005832&name=test_migrator_with_duplicate_names" >test_migrator_with_duplicate_names</a></li>
  <li><a href="index.html?a=M005831&name=test_migrator_with_duplicates" >test_migrator_with_duplicates</a></li>
  <li><a href="index.html?a=M005833&name=test_migrator_with_missing_version_numbers" >test_migrator_with_missing_version_numbers</a></li>
  <li><a href="index.html?a=M005778&name=test_native_decimal_insert_manual_vs_automatic" >test_native_decimal_insert_manual_vs_automatic</a></li>
  <li><a href="index.html?a=M005780&name=test_native_types" >test_native_types</a></li>
  <li><a href="index.html?a=M005819&name=test_only_loads_pending_migrations" >test_only_loads_pending_migrations</a></li>
  <li><a href="index.html?a=M005828&name=test_proper_table_name" >test_proper_table_name</a></li>
  <li><a href="index.html?a=M005795&name=test_remove_column_with_index" >test_remove_column_with_index</a></li>
  <li><a href="index.html?a=M005796&name=test_remove_column_with_multi_column_index" >test_remove_column_with_multi_column_index</a></li>
  <li><a href="index.html?a=M005760&name=test_remove_nonexistent_index" >test_remove_nonexistent_index</a></li>
  <li><a href="index.html?a=M005790&name=test_rename_column" >test_rename_column</a></li>
  <li><a href="index.html?a=M005791&name=test_rename_column_preserves_default_value_not_null" >test_rename_column_preserves_default_value_not_null</a></li>
  <li><a href="index.html?a=M005789&name=test_rename_column_using_symbol_arguments" >test_rename_column_using_symbol_arguments</a></li>
  <li><a href="index.html?a=M005794&name=test_rename_column_with_an_index" >test_rename_column_with_an_index</a></li>
  <li><a href="index.html?a=M005793&name=test_rename_column_with_sql_reserved_word" >test_rename_column_with_sql_reserved_word</a></li>
  <li><a href="index.html?a=M005761&name=test_rename_index" >test_rename_index</a></li>
  <li><a href="index.html?a=M005792&name=test_rename_nonexistent_column" >test_rename_nonexistent_column</a></li>
  <li><a href="index.html?a=M005798&name=test_rename_table" >test_rename_table</a></li>
  <li><a href="index.html?a=M005800&name=test_rename_table_with_an_index" >test_rename_table_with_an_index</a></li>
  <li><a href="index.html?a=M005827&name=test_schema_migrations_table_name" >test_schema_migrations_table_name</a></li>
  <li><a href="index.html?a=M005820&name=test_target_version_zero_should_run_only_once" >test_target_version_zero_should_run_only_once</a></li>
  <li><a href="index.html?a=M005781&name=test_unabstracted_database_dependent_types" >test_unabstracted_database_dependent_types</a></li>
  <li><a href="index.html?a=M005784&name=testing_table_for_positioning" >testing_table_for_positioning</a></li>
  <li><a href="index.html?a=M005763&name=testing_table_with_only_foo_attribute" >testing_table_with_only_foo_attribute</a></li>
  <li><a href="index.html?a=M005835&name=with_env_tz" >with_env_tz</a></li>
  </ul>






<div class="sectiontitle">Public Instance methods</div>
<div id="M005756" class="method">
  <div id="M005756_title" class="title">
    <b>setup</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005756_source')" id="l_M005756_source">show source</a> ]</p>
  <div id="M005756_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 51</span>
51:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setup</span>
52:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migration</span>.<span class="ruby-identifier">verbose</span> = <span class="ruby-keyword kw">true</span>
53:       <span class="ruby-constant">PeopleHaveLastNames</span>.<span class="ruby-identifier">message_count</span> = <span class="ruby-value">0</span>
54:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005757" class="method">
  <div id="M005757_title" class="title">
    <b>teardown</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005757_source')" id="l_M005757_source">show source</a> ]</p>
  <div id="M005757_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 56</span>
56:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">teardown</span>
57:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">initialize_schema_migrations_table</span>
58:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span> <span class="ruby-node">&quot;DELETE FROM #{ActiveRecord::Migrator.schema_migrations_table_name}&quot;</span>
59: 
60:       <span class="ruby-node">%w(reminders people_reminders prefix_reminders_suffix)</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">table</span><span class="ruby-operator">|</span>
61:         <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span>(<span class="ruby-identifier">table</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
62:       <span class="ruby-keyword kw">end</span>
63:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">reset_column_information</span>
64: 
65:       <span class="ruby-node">%w(last_name key bio age height wealth birthday favorite_day
66:          moment_of_truth male administrator funny)</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">column</span><span class="ruby-operator">|</span>
67:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_column</span>(<span class="ruby-value str">'people'</span>, <span class="ruby-identifier">column</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
68:       <span class="ruby-keyword kw">end</span>
69:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_column</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
70:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_column</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;middle_name&quot;</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
71:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">40</span>)
72:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
73:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005777" class="method">
  <div id="M005777_title" class="title">
    <b>test_add_column_not_null_with_default</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005777_source')" id="l_M005777_source">show source</a> ]</p>
  <div id="M005777_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 380</span>
380:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_add_column_not_null_with_default</span>
381:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
382:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:foo</span>, <span class="ruby-identifier">:string</span>
383:       <span class="ruby-keyword kw">end</span>
384: 
385:       <span class="ruby-identifier">con</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>
386:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">enable_identity_insert</span>(<span class="ruby-value str">&quot;testings&quot;</span>, <span class="ruby-keyword kw">true</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:SybaseAdapter</span>)
387:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span> <span class="ruby-node">&quot;insert into testings (#{con.quote_column_name('id')}, #{con.quote_column_name('foo')}) values (1, 'hello')&quot;</span>
388:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">enable_identity_insert</span>(<span class="ruby-value str">&quot;testings&quot;</span>, <span class="ruby-keyword kw">false</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:SybaseAdapter</span>)
389:       <span class="ruby-identifier">assert_nothing_raised</span> {<span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-identifier">:testings</span>, <span class="ruby-identifier">:bar</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;default&quot;</span> }
390: 
391:       <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">StatementInvalid</span>) <span class="ruby-keyword kw">do</span>
392:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:OpenBaseAdapter</span>)
393:           <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span> <span class="ruby-node">&quot;insert into testings (#{con.quote_column_name('id')}, #{con.quote_column_name('foo')}, #{con.quote_column_name('bar')}) values (2, 'hello', NULL)&quot;</span>
394:         <span class="ruby-keyword kw">else</span>
395:           <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">insert</span>(<span class="ruby-node">&quot;INSERT INTO testings (#{con.quote_column_name('id')}, #{con.quote_column_name('foo')}, #{con.quote_column_name('bar')}) VALUES (2, 'hello', NULL)&quot;</span>,
396:             <span class="ruby-value str">&quot;Testing Insert&quot;</span>,<span class="ruby-value str">&quot;id&quot;</span>,<span class="ruby-value">2</span>)
397:         <span class="ruby-keyword kw">end</span>
398:       <span class="ruby-keyword kw">end</span>
399:     <span class="ruby-keyword kw">ensure</span>
400:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
401:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005776" class="method">
  <div id="M005776_title" class="title">
    <b>test_add_column_not_null_without_default</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005776_source')" id="l_M005776_source">show source</a> ]</p>
  <div id="M005776_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 366</span>
366:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_add_column_not_null_without_default</span>
367:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
368:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:foo</span>, <span class="ruby-identifier">:string</span>
369:         <span class="ruby-keyword kw">end</span>
370:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-identifier">:testings</span>, <span class="ruby-identifier">:bar</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
371: 
372:         <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">StatementInvalid</span>) <span class="ruby-keyword kw">do</span>
373:           <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span> <span class="ruby-value str">&quot;insert into testings (foo, bar) values ('hello', NULL)&quot;</span>
374:         <span class="ruby-keyword kw">end</span>
375:       <span class="ruby-keyword kw">ensure</span>
376:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
377:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005786" class="method">
  <div id="M005786_title" class="title">
    <b>test_add_column_with_positioning</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005786_source')" id="l_M005786_source">show source</a> ]</p>
  <div id="M005786_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 588</span>
588:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_add_column_with_positioning</span>
589:         <span class="ruby-identifier">testing_table_for_positioning</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">conn</span><span class="ruby-operator">|</span>
590:           <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-identifier">:testings</span>, <span class="ruby-identifier">:new_col</span>, <span class="ruby-identifier">:integer</span>
591:           <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w(first second third new_col)</span>, <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-identifier">:testings</span>).<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> }
592:         <span class="ruby-keyword kw">end</span>
593:         <span class="ruby-identifier">testing_table_for_positioning</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">conn</span><span class="ruby-operator">|</span>
594:           <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-identifier">:testings</span>, <span class="ruby-identifier">:new_col</span>, <span class="ruby-identifier">:integer</span>, <span class="ruby-identifier">:first</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>
595:           <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w(new_col first second third)</span>, <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-identifier">:testings</span>).<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> }
596:         <span class="ruby-keyword kw">end</span>
597:         <span class="ruby-identifier">testing_table_for_positioning</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">conn</span><span class="ruby-operator">|</span>
598:           <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-identifier">:testings</span>, <span class="ruby-identifier">:new_col</span>, <span class="ruby-identifier">:integer</span>, <span class="ruby-identifier">:after</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:first</span>
599:           <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w(first new_col second third)</span>, <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-identifier">:testings</span>).<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> }
600:         <span class="ruby-keyword kw">end</span>
601:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005779" class="method">
  <div id="M005779_title" class="title">
    <b>test_add_column_with_precision_and_scale</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005779_source')" id="l_M005779_source">show source</a> ]</p>
  <div id="M005779_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 451</span>
451:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_add_column_with_precision_and_scale</span>
452:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">'people'</span>, <span class="ruby-value str">'wealth'</span>, <span class="ruby-identifier">:decimal</span>, <span class="ruby-identifier">:precision</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">9</span>, <span class="ruby-identifier">:scale</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">7</span>
453:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
454: 
455:       <span class="ruby-identifier">wealth_column</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">'wealth'</span>]
456:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">9</span>, <span class="ruby-identifier">wealth_column</span>.<span class="ruby-identifier">precision</span>
457:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">7</span>, <span class="ruby-identifier">wealth_column</span>.<span class="ruby-identifier">scale</span>
458:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005765" class="method">
  <div id="M005765_title" class="title">
    <b>test_add_column_with_primary_key_attribute</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005765_source')" id="l_M005765_source">show source</a> ]</p>
  <div id="M005765_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 173</span>
173:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_add_column_with_primary_key_attribute</span>
174:       <span class="ruby-identifier">testing_table_with_only_foo_attribute</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">connection</span><span class="ruby-operator">|</span>
175:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-identifier">:testings</span>, <span class="ruby-identifier">:id</span>, <span class="ruby-identifier">:primary_key</span> }
176:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-identifier">:testings</span>).<span class="ruby-identifier">size</span>, <span class="ruby-value">2</span>
177:       <span class="ruby-keyword kw">end</span>
178:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005829" class="method">
  <div id="M005829_title" class="title">
    <b>test_add_drop_table_with_prefix_and_suffix</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005829_source')" id="l_M005829_source">show source</a> ]</p>
  <div id="M005829_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1256</span>
1256:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_add_drop_table_with_prefix_and_suffix</span>
1257:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">table_exists?</span>
1258:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_prefix</span> = <span class="ruby-value str">'prefix_'</span>
1259:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_suffix</span> = <span class="ruby-value str">'_suffix'</span>
1260:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">reset_table_name</span>
1261:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">reset_sequence_name</span>
1262:       <span class="ruby-constant">WeNeedReminders</span>.<span class="ruby-identifier">up</span>
1263:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value str">&quot;content&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;hello world&quot;</span>, <span class="ruby-value str">&quot;remind_at&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
1264:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;hello world&quot;</span>, <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>).<span class="ruby-identifier">content</span>
1265: 
1266:       <span class="ruby-constant">WeNeedReminders</span>.<span class="ruby-identifier">down</span>
1267:       <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">StatementInvalid</span>) { <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>) }
1268:     <span class="ruby-keyword kw">ensure</span>
1269:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_prefix</span> = <span class="ruby-value str">''</span>
1270:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_suffix</span> = <span class="ruby-value str">''</span>
1271:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">reset_table_name</span>
1272:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">reset_sequence_name</span>
1273:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005758" class="method">
  <div id="M005758_title" class="title">
    <b>test_add_index</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005758_source')" id="l_M005758_source">show source</a> ]</p>
  <div id="M005758_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 75</span>
 75:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_add_index</span>
 76:       <span class="ruby-comment cmt"># Limit size of last_name and key columns to support Firebird index limitations</span>
 77:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;last_name&quot;</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">100</span>
 78:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;key&quot;</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">100</span>
 79:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;administrator&quot;</span>, <span class="ruby-identifier">:boolean</span>
 80: 
 81:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;last_name&quot;</span>) }
 82:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;last_name&quot;</span>) }
 83: 
 84:       <span class="ruby-comment cmt"># Orcl nds shrt indx nms.  Sybs 2.</span>
 85:       <span class="ruby-comment cmt"># OpenBase does not have named indexes.  You must specify a single column name</span>
 86:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:OracleAdapter</span>, <span class="ruby-identifier">:SybaseAdapter</span>, <span class="ruby-identifier">:OpenBaseAdapter</span>)
 87:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, [<span class="ruby-value str">&quot;last_name&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>]) }
 88:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-identifier">:column</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;last_name&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>]) }
 89:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, [<span class="ruby-value str">&quot;last_name&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>]) }
 90:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;index_people_on_last_name_and_first_name&quot;</span>) }
 91:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, [<span class="ruby-value str">&quot;last_name&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>]) }
 92:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;last_name_and_first_name&quot;</span>) }
 93:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, [<span class="ruby-value str">&quot;last_name&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>]) }
 94:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, [<span class="ruby-value str">&quot;last_name&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>]) }
 95:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, [<span class="ruby-value str">&quot;last_name&quot;</span>], <span class="ruby-identifier">:length</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">10</span>) }
 96:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;last_name&quot;</span>) }
 97:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, [<span class="ruby-value str">&quot;last_name&quot;</span>], <span class="ruby-identifier">:length</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:last_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">10</span>}) }
 98:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, [<span class="ruby-value str">&quot;last_name&quot;</span>]) }
 99:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, [<span class="ruby-value str">&quot;last_name&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>], <span class="ruby-identifier">:length</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">10</span>) }
100:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, [<span class="ruby-value str">&quot;last_name&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>]) }
101:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, [<span class="ruby-value str">&quot;last_name&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>], <span class="ruby-identifier">:length</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:last_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">10</span>, <span class="ruby-identifier">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">20</span>}) }
102:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, [<span class="ruby-value str">&quot;last_name&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>]) }
103:       <span class="ruby-keyword kw">end</span>
104: 
105:       <span class="ruby-comment cmt"># quoting</span>
106:       <span class="ruby-comment cmt"># Note: changed index name from &quot;key&quot; to &quot;key_idx&quot; since &quot;key&quot; is a Firebird reserved word</span>
107:       <span class="ruby-comment cmt"># OpenBase does not have named indexes.  You must specify a single column name</span>
108:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:OpenBaseAdapter</span>)
109:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">update_all</span> <span class="ruby-node">&quot;#{Person.connection.quote_column_name 'key'}=#{Person.connection.quote_column_name 'id'}&quot;</span> <span class="ruby-comment cmt">#some databases (including sqlite2 won't add a unique index if existing data non unique)</span>
110:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, [<span class="ruby-value str">&quot;key&quot;</span>], <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;key_idx&quot;</span>, <span class="ruby-identifier">:unique</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>) }
111:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;key_idx&quot;</span>, <span class="ruby-identifier">:unique</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>) }
112:       <span class="ruby-keyword kw">end</span>
113: 
114:       <span class="ruby-comment cmt"># Sybase adapter does not support indexes on :boolean columns</span>
115:       <span class="ruby-comment cmt"># OpenBase does not have named indexes.  You must specify a single column</span>
116:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:SybaseAdapter</span>, <span class="ruby-identifier">:OpenBaseAdapter</span>)
117:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-node">%w(last_name first_name administrator)</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;named_admin&quot;</span>) }
118:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;named_admin&quot;</span>) }
119:       <span class="ruby-keyword kw">end</span>
120:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005759" class="method">
  <div id="M005759_title" class="title">
    <b>test_add_index_length_limit</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005759_source')" id="l_M005759_source">show source</a> ]</p>
  <div id="M005759_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 122</span>
122:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_add_index_length_limit</span>
123:       <span class="ruby-identifier">good_index_name</span> = <span class="ruby-value str">'x'</span> <span class="ruby-operator">*</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">index_name_length</span>
124:       <span class="ruby-identifier">too_long_index_name</span> = <span class="ruby-identifier">good_index_name</span> <span class="ruby-operator">+</span> <span class="ruby-value str">'x'</span>
125:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">too_long_index_name</span>) }
126:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">index_exists?</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-identifier">too_long_index_name</span>, <span class="ruby-keyword kw">false</span>)
127:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">good_index_name</span>) }
128:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">index_exists?</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-identifier">good_index_name</span>, <span class="ruby-keyword kw">false</span>)
129:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005782" class="method">
  <div id="M005782_title" class="title">
    <b>test_add_remove_single_field_using_string_arguments</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005782_source')" id="l_M005782_source">show source</a> ]</p>
  <div id="M005782_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 540</span>
540:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_add_remove_single_field_using_string_arguments</span>
541:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
542: 
543:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migration</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">'people'</span>, <span class="ruby-value str">'last_name'</span>, <span class="ruby-identifier">:string</span>
544: 
545:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
546:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
547: 
548:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migration</span>.<span class="ruby-identifier">remove_column</span> <span class="ruby-value str">'people'</span>, <span class="ruby-value str">'last_name'</span>
549: 
550:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
551:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
552:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005783" class="method">
  <div id="M005783_title" class="title">
    <b>test_add_remove_single_field_using_symbol_arguments</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005783_source')" id="l_M005783_source">show source</a> ]</p>
  <div id="M005783_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 554</span>
554:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_add_remove_single_field_using_symbol_arguments</span>
555:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
556: 
557:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migration</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-identifier">:people</span>, <span class="ruby-identifier">:last_name</span>, <span class="ruby-identifier">:string</span>
558: 
559:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
560:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
561: 
562:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migration</span>.<span class="ruby-identifier">remove_column</span> <span class="ruby-identifier">:people</span>, <span class="ruby-identifier">:last_name</span>
563: 
564:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
565:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
566:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005788" class="method">
  <div id="M005788_title" class="title">
    <b>test_add_rename</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005788_source')" id="l_M005788_source">show source</a> ]</p>
  <div id="M005788_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 615</span>
615:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_add_rename</span>
616:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">delete_all</span>
617: 
618:       <span class="ruby-keyword kw">begin</span>
619:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;girlfriend&quot;</span>, <span class="ruby-identifier">:string</span>
620:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
621:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">create</span> <span class="ruby-identifier">:girlfriend</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'bobette'</span>
622: 
623:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">rename_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;girlfriend&quot;</span>, <span class="ruby-value str">&quot;exgirlfriend&quot;</span>
624: 
625:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
626:         <span class="ruby-identifier">bob</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>)
627: 
628:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;bobette&quot;</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">exgirlfriend</span>
629:       <span class="ruby-keyword kw">ensure</span>
630:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_column</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;girlfriend&quot;</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
631:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_column</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;exgirlfriend&quot;</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
632:       <span class="ruby-keyword kw">end</span>
633: 
634:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005808" class="method">
  <div id="M005808_title" class="title">
    <b>test_add_table</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005808_source')" id="l_M005808_source">show source</a> ]</p>
  <div id="M005808_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 927</span>
927:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_add_table</span>
928:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">table_exists?</span>
929: 
930:       <span class="ruby-constant">WeNeedReminders</span>.<span class="ruby-identifier">up</span>
931: 
932:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value str">&quot;content&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;hello world&quot;</span>, <span class="ruby-value str">&quot;remind_at&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
933:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;hello world&quot;</span>, <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>).<span class="ruby-identifier">content</span>
934: 
935:       <span class="ruby-constant">WeNeedReminders</span>.<span class="ruby-identifier">down</span>
936:       <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">StatementInvalid</span>) { <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>) }
937:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005809" class="method">
  <div id="M005809_title" class="title">
    <b>test_add_table_with_decimals</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005809_source')" id="l_M005809_source">show source</a> ]</p>
  <div id="M005809_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 939</span>
939:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_add_table_with_decimals</span>
940:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:big_numbers</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
941: 
942:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">BigNumber</span>.<span class="ruby-identifier">table_exists?</span>
943:       <span class="ruby-constant">GiveMeBigNumbers</span>.<span class="ruby-identifier">up</span>
944: 
945:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">BigNumber</span>.<span class="ruby-identifier">create</span>(
946:         <span class="ruby-identifier">:bank_balance</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1586.43</span>,
947:         <span class="ruby-identifier">:big_bank_balance</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">BigDecimal</span>(<span class="ruby-value str">&quot;1000234000567.95&quot;</span>),
948:         <span class="ruby-identifier">:world_population</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">6000000000</span>,
949:         <span class="ruby-identifier">:my_house_population</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">3</span>,
950:         <span class="ruby-identifier">:value_of_e</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">BigDecimal</span>(<span class="ruby-value str">&quot;2.7182818284590452353602875&quot;</span>)
951:       )
952: 
953:       <span class="ruby-identifier">b</span> = <span class="ruby-constant">BigNumber</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>)
954:       <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">b</span>
955: 
956:       <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">bank_balance</span>
957:       <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">big_bank_balance</span>
958:       <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">world_population</span>
959:       <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">my_house_population</span>
960:       <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">value_of_e</span>
961: 
962:       <span class="ruby-comment cmt"># TODO: set world_population &gt;= 2**62 to cover 64-bit platforms and test</span>
963:       <span class="ruby-comment cmt"># is_a?(Bignum)</span>
964:       <span class="ruby-identifier">assert_kind_of</span> <span class="ruby-constant">Integer</span>, <span class="ruby-identifier">b</span>.<span class="ruby-identifier">world_population</span>
965:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">6000000000</span>, <span class="ruby-identifier">b</span>.<span class="ruby-identifier">world_population</span>
966:       <span class="ruby-identifier">assert_kind_of</span> <span class="ruby-constant">Fixnum</span>, <span class="ruby-identifier">b</span>.<span class="ruby-identifier">my_house_population</span>
967:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">3</span>, <span class="ruby-identifier">b</span>.<span class="ruby-identifier">my_house_population</span>
968:       <span class="ruby-identifier">assert_kind_of</span> <span class="ruby-constant">BigDecimal</span>, <span class="ruby-identifier">b</span>.<span class="ruby-identifier">bank_balance</span>
969:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">BigDecimal</span>(<span class="ruby-value str">&quot;1586.43&quot;</span>), <span class="ruby-identifier">b</span>.<span class="ruby-identifier">bank_balance</span>
970:       <span class="ruby-identifier">assert_kind_of</span> <span class="ruby-constant">BigDecimal</span>, <span class="ruby-identifier">b</span>.<span class="ruby-identifier">big_bank_balance</span>
971:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">BigDecimal</span>(<span class="ruby-value str">&quot;1000234000567.95&quot;</span>), <span class="ruby-identifier">b</span>.<span class="ruby-identifier">big_bank_balance</span>
972: 
973:       <span class="ruby-comment cmt"># This one is fun. The 'value_of_e' field is defined as 'DECIMAL' with</span>
974:       <span class="ruby-comment cmt"># precision/scale explicitly left out.  By the SQL standard, numbers</span>
975:       <span class="ruby-comment cmt"># assigned to this field should be truncated but that's seldom respected.</span>
976:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:PostgreSQLAdapter</span>, <span class="ruby-identifier">:SQLite2Adapter</span>)
977:         <span class="ruby-comment cmt"># - PostgreSQL changes the SQL spec on columns declared simply as</span>
978:         <span class="ruby-comment cmt"># &quot;decimal&quot; to something more useful: instead of being given a scale</span>
979:         <span class="ruby-comment cmt"># of 0, they take on the compile-time limit for precision and scale,</span>
980:         <span class="ruby-comment cmt"># so the following should succeed unless you have used really wacky</span>
981:         <span class="ruby-comment cmt"># compilation options</span>
982:         <span class="ruby-comment cmt"># - SQLite2 has the default behavior of preserving all data sent in,</span>
983:         <span class="ruby-comment cmt"># so this happens there too</span>
984:         <span class="ruby-identifier">assert_kind_of</span> <span class="ruby-constant">BigDecimal</span>, <span class="ruby-identifier">b</span>.<span class="ruby-identifier">value_of_e</span>
985:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">BigDecimal</span>(<span class="ruby-value str">&quot;2.7182818284590452353602875&quot;</span>), <span class="ruby-identifier">b</span>.<span class="ruby-identifier">value_of_e</span>
986:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:SQLiteAdapter</span>)
987:         <span class="ruby-comment cmt"># - SQLite3 stores a float, in violation of SQL</span>
988:         <span class="ruby-identifier">assert_kind_of</span> <span class="ruby-constant">BigDecimal</span>, <span class="ruby-identifier">b</span>.<span class="ruby-identifier">value_of_e</span>
989:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">BigDecimal</span>(<span class="ruby-value str">&quot;2.71828182845905&quot;</span>), <span class="ruby-identifier">b</span>.<span class="ruby-identifier">value_of_e</span>
990:       <span class="ruby-keyword kw">else</span>
991:         <span class="ruby-comment cmt"># - SQL standard is an integer</span>
992:         <span class="ruby-identifier">assert_kind_of</span> <span class="ruby-constant">Fixnum</span>, <span class="ruby-identifier">b</span>.<span class="ruby-identifier">value_of_e</span>
993:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">b</span>.<span class="ruby-identifier">value_of_e</span>
994:       <span class="ruby-keyword kw">end</span>
995: 
996:       <span class="ruby-constant">GiveMeBigNumbers</span>.<span class="ruby-identifier">down</span>
997:       <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">StatementInvalid</span>) { <span class="ruby-constant">BigNumber</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>) }
998:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005801" class="method">
  <div id="M005801_title" class="title">
    <b>test_change_column</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005801_source')" id="l_M005801_source">show source</a> ]</p>
  <div id="M005801_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 809</span>
809:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_change_column</span>
810:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">'people'</span>, <span class="ruby-value str">'age'</span>, <span class="ruby-identifier">:integer</span>
811:       <span class="ruby-identifier">old_columns</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-constant">Person</span>.<span class="ruby-identifier">table_name</span>, <span class="ruby-node">&quot;#{name} Columns&quot;</span>)
812:       <span class="ruby-identifier">assert</span> <span class="ruby-identifier">old_columns</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'age'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:integer</span> }
813: 
814:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;age&quot;</span>, <span class="ruby-identifier">:string</span> }
815: 
816:       <span class="ruby-identifier">new_columns</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-constant">Person</span>.<span class="ruby-identifier">table_name</span>, <span class="ruby-node">&quot;#{name} Columns&quot;</span>)
817:       <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">new_columns</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'age'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:integer</span> }
818:       <span class="ruby-identifier">assert</span> <span class="ruby-identifier">new_columns</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'age'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:string</span> }
819: 
820:       <span class="ruby-identifier">old_columns</span> = <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-constant">Topic</span>.<span class="ruby-identifier">table_name</span>, <span class="ruby-node">&quot;#{name} Columns&quot;</span>)
821:       <span class="ruby-identifier">assert</span> <span class="ruby-identifier">old_columns</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'approved'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:boolean</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">default</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span> }
822:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-identifier">:topics</span>, <span class="ruby-identifier">:approved</span>, <span class="ruby-identifier">:boolean</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span> }
823:       <span class="ruby-identifier">new_columns</span> = <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-constant">Topic</span>.<span class="ruby-identifier">table_name</span>, <span class="ruby-node">&quot;#{name} Columns&quot;</span>)
824:       <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">new_columns</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'approved'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:boolean</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">default</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span> }
825:       <span class="ruby-identifier">assert</span> <span class="ruby-identifier">new_columns</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'approved'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:boolean</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">default</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">false</span> }
826:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-identifier">:topics</span>, <span class="ruby-identifier">:approved</span>, <span class="ruby-identifier">:boolean</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span> }
827:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005804" class="method">
  <div id="M005804_title" class="title">
    <b>test_change_column_default</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005804_source')" id="l_M005804_source">show source</a> ]</p>
  <div id="M005804_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 854</span>
854:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_change_column_default</span>
855:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column_default</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>, <span class="ruby-value str">&quot;Tester&quot;</span>
856:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
857:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;Tester&quot;</span>, <span class="ruby-constant">Person</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">first_name</span>
858:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005807" class="method">
  <div id="M005807_title" class="title">
    <b>test_change_column_default_to_null</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005807_source')" id="l_M005807_source">show source</a> ]</p>
  <div id="M005807_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 921</span>
921:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_change_column_default_to_null</span>
922:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column_default</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>, <span class="ruby-keyword kw">nil</span>
923:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
924:       <span class="ruby-identifier">assert_nil</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">first_name</span>
925:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005799" class="method">
  <div id="M005799_title" class="title">
    <b>test_change_column_nullability</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005799_source')" id="l_M005799_source">show source</a> ]</p>
  <div id="M005799_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 773</span>
773:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_change_column_nullability</span>
774:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">delete_all</span>
775:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;funny&quot;</span>, <span class="ruby-identifier">:boolean</span>
776:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
777:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;funny&quot;</span>].<span class="ruby-identifier">null</span>, <span class="ruby-value str">&quot;Column 'funny' must initially allow nulls&quot;</span>
778:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;funny&quot;</span>, <span class="ruby-identifier">:boolean</span>, <span class="ruby-identifier">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>
779:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
780:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;funny&quot;</span>].<span class="ruby-identifier">null</span>, <span class="ruby-value str">&quot;Column 'funny' must *not* allow nulls at this point&quot;</span>
781:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;funny&quot;</span>, <span class="ruby-identifier">:boolean</span>, <span class="ruby-identifier">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>
782:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
783:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;funny&quot;</span>].<span class="ruby-identifier">null</span>, <span class="ruby-value str">&quot;Column 'funny' must allow nulls again at this point&quot;</span>
784:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005805" class="method">
  <div id="M005805_title" class="title">
    <b>test_change_column_quotes_column_names</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005805_source')" id="l_M005805_source">show source</a> ]</p>
  <div id="M005805_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 860</span>
860:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_change_column_quotes_column_names</span>
861:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
862:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:select</span>, <span class="ruby-identifier">:string</span>
863:       <span class="ruby-keyword kw">end</span>
864: 
865:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-identifier">:testings</span>, <span class="ruby-identifier">:select</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">10</span> }
866: 
867:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span> <span class="ruby-node">&quot;insert into testings (#{Person.connection.quote_column_name('select')}) values ('7 chars')&quot;</span> }
868:     <span class="ruby-keyword kw">ensure</span>
869:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
870:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005803" class="method">
  <div id="M005803_title" class="title">
    <b>test_change_column_with_new_default</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005803_source')" id="l_M005803_source">show source</a> ]</p>
  <div id="M005803_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 842</span>
842:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_change_column_with_new_default</span>
843:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;administrator&quot;</span>, <span class="ruby-identifier">:boolean</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>
844:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
845:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">administrator?</span>
846: 
847:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;administrator&quot;</span>, <span class="ruby-identifier">:boolean</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span> }
848:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
849:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">administrator?</span>
850:     <span class="ruby-keyword kw">ensure</span>
851:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_column</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;administrator&quot;</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
852:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005802" class="method">
  <div id="M005802_title" class="title">
    <b>test_change_column_with_nil_default</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005802_source')" id="l_M005802_source">show source</a> ]</p>
  <div id="M005802_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 829</span>
829:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_change_column_with_nil_default</span>
830:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;contributor&quot;</span>, <span class="ruby-identifier">:boolean</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>
831:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
832:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">contributor?</span>
833: 
834:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;contributor&quot;</span>, <span class="ruby-identifier">:boolean</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span> }
835:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
836:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">contributor?</span>
837:       <span class="ruby-identifier">assert_nil</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">contributor</span>
838:     <span class="ruby-keyword kw">ensure</span>
839:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_column</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;contributor&quot;</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
840:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005787" class="method">
  <div id="M005787_title" class="title">
    <b>test_change_column_with_positioning</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005787_source')" id="l_M005787_source">show source</a> ]</p>
  <div id="M005787_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 603</span>
603:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_change_column_with_positioning</span>
604:         <span class="ruby-identifier">testing_table_for_positioning</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">conn</span><span class="ruby-operator">|</span>
605:           <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-identifier">:testings</span>, <span class="ruby-identifier">:second</span>, <span class="ruby-identifier">:integer</span>, <span class="ruby-identifier">:first</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>
606:           <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w(second first third)</span>, <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-identifier">:testings</span>).<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> }
607:         <span class="ruby-keyword kw">end</span>
608:         <span class="ruby-identifier">testing_table_for_positioning</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">conn</span><span class="ruby-operator">|</span>
609:           <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-identifier">:testings</span>, <span class="ruby-identifier">:second</span>, <span class="ruby-identifier">:integer</span>, <span class="ruby-identifier">:after</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:third</span>
610:           <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w(first third second)</span>, <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-identifier">:testings</span>).<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> }
611:         <span class="ruby-keyword kw">end</span>
612:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005797" class="method">
  <div id="M005797_title" class="title">
    <b>test_change_type_of_not_null_column</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005797_source')" id="l_M005797_source">show source</a> ]</p>
  <div id="M005797_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 742</span>
742:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_change_type_of_not_null_column</span>
743:       <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
744:         <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-value str">&quot;topics&quot;</span>, <span class="ruby-value str">&quot;written_on&quot;</span>, <span class="ruby-identifier">:datetime</span>, <span class="ruby-identifier">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
745:         <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">reset_column_information</span>
746: 
747:         <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-value str">&quot;topics&quot;</span>, <span class="ruby-value str">&quot;written_on&quot;</span>, <span class="ruby-identifier">:datetime</span>, <span class="ruby-identifier">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
748:         <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">reset_column_information</span>
749:       <span class="ruby-keyword kw">end</span>
750:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005785" class="method">
  <div id="M005785_title" class="title">
    <b>test_column_positioning</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005785_source')" id="l_M005785_source">show source</a> ]</p>
  <div id="M005785_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 582</span>
582:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_column_positioning</span>
583:         <span class="ruby-identifier">testing_table_for_positioning</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">conn</span><span class="ruby-operator">|</span>
584:           <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w(first second third)</span>, <span class="ruby-identifier">conn</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-identifier">:testings</span>).<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> }
585:         <span class="ruby-keyword kw">end</span>
586:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005766" class="method">
  <div id="M005766_title" class="title">
    <b>test_create_table_adds_id</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005766_source')" id="l_M005766_source">show source</a> ]</p>
  <div id="M005766_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 180</span>
180:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_create_table_adds_id</span>
181:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
182:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:foo</span>, <span class="ruby-identifier">:string</span>
183:       <span class="ruby-keyword kw">end</span>
184: 
185:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w(foo id)</span>,
186:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-identifier">:testings</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> }.<span class="ruby-identifier">sort</span>
187:     <span class="ruby-keyword kw">ensure</span>
188:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
189:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005830" class="method">
  <div id="M005830_title" class="title">
    <b>test_create_table_with_binary_column</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005830_source')" id="l_M005830_source">show source</a> ]</p>
  <div id="M005830_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1275</span>
1275:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_create_table_with_binary_column</span>
1276:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:binary_testings</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
1277: 
1278:       <span class="ruby-identifier">assert_nothing_raised</span> {
1279:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:binary_testings</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
1280:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-value str">&quot;data&quot;</span>, <span class="ruby-identifier">:binary</span>, <span class="ruby-identifier">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
1281:         <span class="ruby-keyword kw">end</span>
1282:       }
1283: 
1284:       <span class="ruby-identifier">columns</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-identifier">:binary_testings</span>)
1285:       <span class="ruby-identifier">data_column</span> = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;data&quot;</span> }
1286: 
1287:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:MysqlAdapter</span>)
1288:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">''</span>, <span class="ruby-identifier">data_column</span>.<span class="ruby-identifier">default</span>
1289:       <span class="ruby-keyword kw">else</span>
1290:         <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">data_column</span>.<span class="ruby-identifier">default</span>
1291:       <span class="ruby-keyword kw">end</span>
1292: 
1293:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:binary_testings</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
1294:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005834" class="method">
  <div id="M005834_title" class="title">
    <b>test_create_table_with_custom_sequence_name</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005834_source')" id="l_M005834_source">show source</a> ]</p>
  <div id="M005834_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1314</span>
1314:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_create_table_with_custom_sequence_name</span>
1315:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">current_adapter?</span> <span class="ruby-identifier">:OracleAdapter</span>
1316: 
1317:       <span class="ruby-comment cmt"># table name is 29 chars, the standard sequence name will</span>
1318:       <span class="ruby-comment cmt"># be 33 chars and fail</span>
1319:       <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">StatementInvalid</span>) <span class="ruby-keyword kw">do</span>
1320:         <span class="ruby-keyword kw">begin</span>
1321:           <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:table_with_name_thats_just_ok</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
1322:             <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:foo</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
1323:           <span class="ruby-keyword kw">end</span>
1324:         <span class="ruby-keyword kw">ensure</span>
1325:           <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:table_with_name_thats_just_ok</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
1326:         <span class="ruby-keyword kw">end</span>
1327:       <span class="ruby-keyword kw">end</span>
1328: 
1329:       <span class="ruby-comment cmt"># should be all good w/ a custom sequence name</span>
1330:       <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
1331:         <span class="ruby-keyword kw">begin</span>
1332:           <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:table_with_name_thats_just_ok</span>,
1333:                                          <span class="ruby-identifier">:sequence_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'suitably_short_seq'</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
1334:             <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:foo</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
1335:           <span class="ruby-keyword kw">end</span>
1336: 
1337:           <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-value str">&quot;select suitably_short_seq.nextval from dual&quot;</span>)
1338: 
1339:         <span class="ruby-keyword kw">ensure</span>
1340:           <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:table_with_name_thats_just_ok</span>,
1341:                                        <span class="ruby-identifier">:sequence_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'suitably_short_seq'</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
1342:         <span class="ruby-keyword kw">end</span>
1343:       <span class="ruby-keyword kw">end</span>
1344: 
1345:       <span class="ruby-comment cmt"># confirm the custom sequence got dropped</span>
1346:       <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">StatementInvalid</span>) <span class="ruby-keyword kw">do</span>
1347:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-value str">&quot;select suitably_short_seq.nextval from dual&quot;</span>)
1348:       <span class="ruby-keyword kw">end</span>
1349:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005768" class="method">
  <div id="M005768_title" class="title">
    <b>test_create_table_with_defaults</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005768_source')" id="l_M005768_source">show source</a> ]</p>
  <div id="M005768_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 205</span>
205:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_create_table_with_defaults</span>
206:       <span class="ruby-comment cmt"># MySQL doesn't allow defaults on TEXT or BLOB columns.</span>
207:       <span class="ruby-identifier">mysql</span> = <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:MysqlAdapter</span>)
208: 
209:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
210:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:one</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;hello&quot;</span>
211:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:two</span>, <span class="ruby-identifier">:boolean</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>
212:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:three</span>, <span class="ruby-identifier">:boolean</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
213:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:four</span>, <span class="ruby-identifier">:integer</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
214:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:five</span>, <span class="ruby-identifier">:text</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;hello&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">mysql</span>
215:       <span class="ruby-keyword kw">end</span>
216: 
217:       <span class="ruby-identifier">columns</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-identifier">:testings</span>)
218:       <span class="ruby-identifier">one</span> = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;one&quot;</span> }
219:       <span class="ruby-identifier">two</span> = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;two&quot;</span> }
220:       <span class="ruby-identifier">three</span> = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;three&quot;</span> }
221:       <span class="ruby-identifier">four</span> = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;four&quot;</span> }
222:       <span class="ruby-identifier">five</span> = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;five&quot;</span> } <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">mysql</span>
223: 
224:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;hello&quot;</span>, <span class="ruby-identifier">one</span>.<span class="ruby-identifier">default</span>
225:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">two</span>.<span class="ruby-identifier">default</span>
226:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">three</span>.<span class="ruby-identifier">default</span>
227:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">four</span>.<span class="ruby-identifier">default</span>
228:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;hello&quot;</span>, <span class="ruby-identifier">five</span>.<span class="ruby-identifier">default</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">mysql</span>
229: 
230:     <span class="ruby-keyword kw">ensure</span>
231:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
232:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005772" class="method">
  <div id="M005772_title" class="title">
    <b>test_create_table_with_force_true_does_not_drop_nonexisting_table</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005772_source')" id="l_M005772_source">show source</a> ]</p>
  <div id="M005772_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 306</span>
306:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_create_table_with_force_true_does_not_drop_nonexisting_table</span>
307:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">table_exists?</span>(<span class="ruby-identifier">:testings2</span>)
308:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:testings2</span>
309:       <span class="ruby-keyword kw">end</span>
310: 
311:       <span class="ruby-comment cmt"># using a copy as we need the drop_table method to</span>
312:       <span class="ruby-comment cmt"># continue to work for the ensure block of the test</span>
313:       <span class="ruby-identifier">temp_conn</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">dup</span>
314:       <span class="ruby-identifier">temp_conn</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:drop_table</span>).<span class="ruby-identifier">never</span>
315:       <span class="ruby-identifier">temp_conn</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:testings2</span>, <span class="ruby-identifier">:force</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
316:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:foo</span>, <span class="ruby-identifier">:string</span>
317:       <span class="ruby-keyword kw">end</span>
318:     <span class="ruby-keyword kw">ensure</span>
319:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:testings2</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
320:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005769" class="method">
  <div id="M005769_title" class="title">
    <b>test_create_table_with_limits</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005769_source')" id="l_M005769_source">show source</a> ]</p>
  <div id="M005769_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 234</span>
234:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_create_table_with_limits</span>
235:       <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
236:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
237:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:foo</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">255</span>
238: 
239:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:default_int</span>, <span class="ruby-identifier">:integer</span>
240: 
241:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:one_int</span>,    <span class="ruby-identifier">:integer</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
242:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:four_int</span>,   <span class="ruby-identifier">:integer</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">4</span>
243:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:eight_int</span>,  <span class="ruby-identifier">:integer</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">8</span>
244:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:eleven_int</span>, <span class="ruby-identifier">:integer</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">11</span>
245:         <span class="ruby-keyword kw">end</span>
246:       <span class="ruby-keyword kw">end</span>
247: 
248:       <span class="ruby-identifier">columns</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-identifier">:testings</span>)
249:       <span class="ruby-identifier">foo</span> = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;foo&quot;</span> }
250:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">255</span>, <span class="ruby-identifier">foo</span>.<span class="ruby-identifier">limit</span>
251: 
252:       <span class="ruby-identifier">default</span> = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;default_int&quot;</span> }
253:       <span class="ruby-identifier">one</span>     = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;one_int&quot;</span>     }
254:       <span class="ruby-identifier">four</span>    = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;four_int&quot;</span>    }
255:       <span class="ruby-identifier">eight</span>   = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;eight_int&quot;</span>   }
256:       <span class="ruby-identifier">eleven</span>  = <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;eleven_int&quot;</span>   }
257: 
258:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:PostgreSQLAdapter</span>)
259:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'integer'</span>, <span class="ruby-identifier">default</span>.<span class="ruby-identifier">sql_type</span>
260:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'smallint'</span>, <span class="ruby-identifier">one</span>.<span class="ruby-identifier">sql_type</span>
261:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'integer'</span>, <span class="ruby-identifier">four</span>.<span class="ruby-identifier">sql_type</span>
262:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'bigint'</span>, <span class="ruby-identifier">eight</span>.<span class="ruby-identifier">sql_type</span>
263:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'integer'</span>, <span class="ruby-identifier">eleven</span>.<span class="ruby-identifier">sql_type</span>
264:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:MysqlAdapter</span>)
265:         <span class="ruby-identifier">assert_match</span> <span class="ruby-value str">'int(11)'</span>, <span class="ruby-identifier">default</span>.<span class="ruby-identifier">sql_type</span>
266:         <span class="ruby-identifier">assert_match</span> <span class="ruby-value str">'tinyint'</span>, <span class="ruby-identifier">one</span>.<span class="ruby-identifier">sql_type</span>
267:         <span class="ruby-identifier">assert_match</span> <span class="ruby-value str">'int'</span>, <span class="ruby-identifier">four</span>.<span class="ruby-identifier">sql_type</span>
268:         <span class="ruby-identifier">assert_match</span> <span class="ruby-value str">'bigint'</span>, <span class="ruby-identifier">eight</span>.<span class="ruby-identifier">sql_type</span>
269:         <span class="ruby-identifier">assert_match</span> <span class="ruby-value str">'int(11)'</span>, <span class="ruby-identifier">eleven</span>.<span class="ruby-identifier">sql_type</span>
270:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:OracleAdapter</span>)
271:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'NUMBER(38)'</span>, <span class="ruby-identifier">default</span>.<span class="ruby-identifier">sql_type</span>
272:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'NUMBER(1)'</span>, <span class="ruby-identifier">one</span>.<span class="ruby-identifier">sql_type</span>
273:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'NUMBER(4)'</span>, <span class="ruby-identifier">four</span>.<span class="ruby-identifier">sql_type</span>
274:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'NUMBER(8)'</span>, <span class="ruby-identifier">eight</span>.<span class="ruby-identifier">sql_type</span>
275:       <span class="ruby-keyword kw">end</span>
276:     <span class="ruby-keyword kw">ensure</span>
277:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
278:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005767" class="method">
  <div id="M005767_title" class="title">
    <b>test_create_table_with_not_null_column</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005767_source')" id="l_M005767_source">show source</a> ]</p>
  <div id="M005767_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 191</span>
191:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_create_table_with_not_null_column</span>
192:       <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
193:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
194:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:foo</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
195:         <span class="ruby-keyword kw">end</span>
196:       <span class="ruby-keyword kw">end</span>
197: 
198:       <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">StatementInvalid</span>) <span class="ruby-keyword kw">do</span>
199:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span> <span class="ruby-value str">&quot;insert into testings (foo) values (NULL)&quot;</span>
200:       <span class="ruby-keyword kw">end</span>
201:     <span class="ruby-keyword kw">ensure</span>
202:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
203:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005771" class="method">
  <div id="M005771_title" class="title">
    <b>test_create_table_with_primary_key_prefix_as_table_name</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005771_source')" id="l_M005771_source">show source</a> ]</p>
  <div id="M005771_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 293</span>
293:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_create_table_with_primary_key_prefix_as_table_name</span>
294:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">primary_key_prefix_type</span> = <span class="ruby-identifier">:table_name</span>
295: 
296:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
297:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:foo</span>, <span class="ruby-identifier">:string</span>
298:       <span class="ruby-keyword kw">end</span>
299: 
300:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w(foo testingid)</span>, <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-identifier">:testings</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> }.<span class="ruby-identifier">sort</span>
301:     <span class="ruby-keyword kw">ensure</span>
302:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
303:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">primary_key_prefix_type</span> = <span class="ruby-keyword kw">nil</span>
304:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005770" class="method">
  <div id="M005770_title" class="title">
    <b>test_create_table_with_primary_key_prefix_as_table_name_with_underscore</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005770_source')" id="l_M005770_source">show source</a> ]</p>
  <div id="M005770_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 280</span>
280:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_create_table_with_primary_key_prefix_as_table_name_with_underscore</span>
281:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">primary_key_prefix_type</span> = <span class="ruby-identifier">:table_name_with_underscore</span>
282: 
283:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
284:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:foo</span>, <span class="ruby-identifier">:string</span>
285:       <span class="ruby-keyword kw">end</span>
286: 
287:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w(foo testing_id)</span>, <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-identifier">:testings</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> }.<span class="ruby-identifier">sort</span>
288:     <span class="ruby-keyword kw">ensure</span>
289:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
290:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">primary_key_prefix_type</span> = <span class="ruby-keyword kw">nil</span>
291:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005773" class="method">
  <div id="M005773_title" class="title">
    <b>test_create_table_with_timestamps_should_create_datetime_columns</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005773_source')" id="l_M005773_source">show source</a> ]</p>
  <div id="M005773_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 322</span>
322:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_create_table_with_timestamps_should_create_datetime_columns</span>
323:       <span class="ruby-identifier">table_name</span> = <span class="ruby-identifier">:testings</span>
324: 
325:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">table_name</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
326:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">timestamps</span>
327:       <span class="ruby-keyword kw">end</span>
328:       <span class="ruby-identifier">created_columns</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-identifier">table_name</span>)
329: 
330:       <span class="ruby-identifier">created_at_column</span> = <span class="ruby-identifier">created_columns</span>.<span class="ruby-identifier">detect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'created_at'</span> }
331:       <span class="ruby-identifier">updated_at_column</span> = <span class="ruby-identifier">created_columns</span>.<span class="ruby-identifier">detect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'updated_at'</span> }
332: 
333:       <span class="ruby-identifier">assert</span> <span class="ruby-identifier">created_at_column</span>.<span class="ruby-identifier">null</span>
334:       <span class="ruby-identifier">assert</span> <span class="ruby-identifier">updated_at_column</span>.<span class="ruby-identifier">null</span>
335:     <span class="ruby-keyword kw">ensure</span>
336:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">table_name</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
337:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005774" class="method">
  <div id="M005774_title" class="title">
    <b>test_create_table_with_timestamps_should_create_datetime_columns_with_options</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005774_source')" id="l_M005774_source">show source</a> ]</p>
  <div id="M005774_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 339</span>
339:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_create_table_with_timestamps_should_create_datetime_columns_with_options</span>
340:       <span class="ruby-identifier">table_name</span> = <span class="ruby-identifier">:testings</span>
341: 
342:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">table_name</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
343:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">timestamps</span> <span class="ruby-identifier">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
344:       <span class="ruby-keyword kw">end</span>
345:       <span class="ruby-identifier">created_columns</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-identifier">table_name</span>)
346: 
347:       <span class="ruby-identifier">created_at_column</span> = <span class="ruby-identifier">created_columns</span>.<span class="ruby-identifier">detect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'created_at'</span> }
348:       <span class="ruby-identifier">updated_at_column</span> = <span class="ruby-identifier">created_columns</span>.<span class="ruby-identifier">detect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'updated_at'</span> }
349: 
350:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">created_at_column</span>.<span class="ruby-identifier">null</span>
351:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">updated_at_column</span>.<span class="ruby-identifier">null</span>
352:     <span class="ruby-keyword kw">ensure</span>
353:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">table_name</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
354:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005775" class="method">
  <div id="M005775_title" class="title">
    <b>test_create_table_without_a_block</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005775_source')" id="l_M005775_source">show source</a> ]</p>
  <div id="M005775_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 356</span>
356:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_create_table_without_a_block</span>
357:       <span class="ruby-identifier">table_name</span> = <span class="ruby-identifier">:testings</span>
358:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">table_name</span>
359:     <span class="ruby-keyword kw">ensure</span>
360:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">table_name</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
361:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005764" class="method">
  <div id="M005764_title" class="title">
    <b>test_create_table_without_id</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005764_source')" id="l_M005764_source">show source</a> ]</p>
  <div id="M005764_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 167</span>
167:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_create_table_without_id</span>
168:       <span class="ruby-identifier">testing_table_with_only_foo_attribute</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">connection</span><span class="ruby-operator">|</span>
169:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-identifier">:testings</span>).<span class="ruby-identifier">size</span>, <span class="ruby-value">1</span>
170:       <span class="ruby-keyword kw">end</span>
171:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005762" class="method">
  <div id="M005762_title" class="title">
    <b>test_double_add_index</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005762_source')" id="l_M005762_source">show source</a> ]</p>
  <div id="M005762_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 149</span>
149:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_double_add_index</span>
150:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:OpenBaseAdapter</span>)
151:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span>(<span class="ruby-value str">'people'</span>, [<span class="ruby-identifier">:first_name</span>], <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'some_idx'</span>)
152:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span>(<span class="ruby-value str">'people'</span>, [<span class="ruby-identifier">:first_name</span>], <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'some_idx'</span>) }
153:       <span class="ruby-keyword kw">end</span>
154:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005817" class="method">
  <div id="M005817_title" class="title">
    <b>test_finds_migrations</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005817_source')" id="l_M005817_source">show source</a> ]</p>
  <div id="M005817_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1084</span>
1084:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_finds_migrations</span>
1085:       <span class="ruby-identifier">migrations</span> = <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:up</span>, <span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>).<span class="ruby-identifier">migrations</span>
1086: 
1087:       [[<span class="ruby-value">1</span>, <span class="ruby-value str">'PeopleHaveLastNames'</span>], [<span class="ruby-value">2</span>, <span class="ruby-value str">'WeNeedReminders'</span>], [<span class="ruby-value">3</span>, <span class="ruby-value str">'InnocentJointable'</span>]].<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pair</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
1088:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">migrations</span>[<span class="ruby-identifier">i</span>].<span class="ruby-identifier">version</span>, <span class="ruby-identifier">pair</span>.<span class="ruby-identifier">first</span>
1089:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">migrations</span>[<span class="ruby-identifier">i</span>].<span class="ruby-identifier">name</span>, <span class="ruby-identifier">pair</span>.<span class="ruby-identifier">last</span>
1090:       <span class="ruby-keyword kw">end</span>
1091:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005818" class="method">
  <div id="M005818_title" class="title">
    <b>test_finds_pending_migrations</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005818_source')" id="l_M005818_source">show source</a> ]</p>
  <div id="M005818_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1093</span>
1093:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_finds_pending_migrations</span>
1094:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">up</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/interleaved/pass_2&quot;</span>, <span class="ruby-value">1</span>)
1095:       <span class="ruby-identifier">migrations</span> = <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:up</span>, <span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/interleaved/pass_2&quot;</span>).<span class="ruby-identifier">pending_migrations</span>
1096: 
1097:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">migrations</span>.<span class="ruby-identifier">size</span>
1098:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">migrations</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">version</span>, <span class="ruby-value">3</span>
1099:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">migrations</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">name</span>, <span class="ruby-value str">'InnocentJointable'</span>
1100:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005806" class="method">
  <div id="M005806_title" class="title">
    <b>test_keeping_default_and_notnull_constaint_on_change</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005806_source')" id="l_M005806_source">show source</a> ]</p>
  <div id="M005806_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 872</span>
872:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_keeping_default_and_notnull_constaint_on_change</span>
873:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
874:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:title</span>, <span class="ruby-identifier">:string</span>
875:       <span class="ruby-keyword kw">end</span>
876:       <span class="ruby-identifier">person_klass</span> = <span class="ruby-constant">Class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Person</span>)
877:       <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">set_table_name</span> <span class="ruby-value str">'testings'</span>
878: 
879:       <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;testings&quot;</span>, <span class="ruby-value str">&quot;wealth&quot;</span>, <span class="ruby-identifier">:integer</span>, <span class="ruby-identifier">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">99</span>
880:       <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">reset_column_information</span>
881:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">99</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;wealth&quot;</span>].<span class="ruby-identifier">default</span>
882:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;wealth&quot;</span>].<span class="ruby-identifier">null</span>
883:       <span class="ruby-identifier">assert_nothing_raised</span> {<span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-value str">&quot;insert into testings (title) values ('tester')&quot;</span>)}
884: 
885:       <span class="ruby-comment cmt"># change column default to see that column doesn't lose its not null definition</span>
886:       <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column_default</span> <span class="ruby-value str">&quot;testings&quot;</span>, <span class="ruby-value str">&quot;wealth&quot;</span>, <span class="ruby-value">100</span>
887:       <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">reset_column_information</span>
888:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">100</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;wealth&quot;</span>].<span class="ruby-identifier">default</span>
889:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;wealth&quot;</span>].<span class="ruby-identifier">null</span>
890: 
891:       <span class="ruby-comment cmt"># rename column to see that column doesn't lose its not null and/or default definition</span>
892:       <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">rename_column</span> <span class="ruby-value str">&quot;testings&quot;</span>, <span class="ruby-value str">&quot;wealth&quot;</span>, <span class="ruby-value str">&quot;money&quot;</span>
893:       <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">reset_column_information</span>
894:       <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;wealth&quot;</span>]
895:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">100</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;money&quot;</span>].<span class="ruby-identifier">default</span>
896:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;money&quot;</span>].<span class="ruby-identifier">null</span>
897: 
898:       <span class="ruby-comment cmt"># change column</span>
899:       <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-value str">&quot;testings&quot;</span>, <span class="ruby-value str">&quot;money&quot;</span>, <span class="ruby-identifier">:integer</span>, <span class="ruby-identifier">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1000</span>
900:       <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">reset_column_information</span>
901:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1000</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;money&quot;</span>].<span class="ruby-identifier">default</span>
902:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;money&quot;</span>].<span class="ruby-identifier">null</span>
903: 
904:       <span class="ruby-comment cmt"># change column, make it nullable and clear default</span>
905:       <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column</span> <span class="ruby-value str">&quot;testings&quot;</span>, <span class="ruby-value str">&quot;money&quot;</span>, <span class="ruby-identifier">:integer</span>, <span class="ruby-identifier">:null</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>
906:       <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">reset_column_information</span>
907:       <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;money&quot;</span>].<span class="ruby-identifier">default</span>
908:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;money&quot;</span>].<span class="ruby-identifier">null</span>
909: 
910:       <span class="ruby-comment cmt"># change_column_null, make it not nullable and set null values to a default value</span>
911:       <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-value str">'UPDATE testings SET money = NULL'</span>)
912:       <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">change_column_null</span> <span class="ruby-value str">&quot;testings&quot;</span>, <span class="ruby-value str">&quot;money&quot;</span>, <span class="ruby-keyword kw">false</span>, <span class="ruby-value">2000</span>
913:       <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">reset_column_information</span>
914:       <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;money&quot;</span>].<span class="ruby-identifier">default</span>
915:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">person_klass</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">&quot;money&quot;</span>].<span class="ruby-identifier">null</span>
916:       <span class="ruby-identifier">assert_equal</span> [<span class="ruby-value">2000</span>], <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_values</span>(<span class="ruby-value str">&quot;SELECT money FROM testings&quot;</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">to_i</span> }.<span class="ruby-identifier">sort</span>
917:     <span class="ruby-keyword kw">ensure</span>
918:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
919:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005810" class="method">
  <div id="M005810_title" class="title">
    <b>test_migrator</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005810_source')" id="l_M005810_source">show source</a> ]</p>
  <div id="M005810_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1000</span>
1000:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator</span>
1001:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
1002:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">table_exists?</span>
1003: 
1004:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">up</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>)
1005: 
1006:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">3</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">current_version</span>
1007:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
1008:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
1009:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value str">&quot;content&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;hello world&quot;</span>, <span class="ruby-value str">&quot;remind_at&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
1010:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;hello world&quot;</span>, <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>).<span class="ruby-identifier">content</span>
1011: 
1012:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">down</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>)
1013: 
1014:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">0</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">current_version</span>
1015:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
1016:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
1017:       <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">StatementInvalid</span>) { <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>) }
1018:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005822" class="method">
  <div id="M005822_title" class="title">
    <b>test_migrator_db_has_no_schema_migrations_table</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005822_source')" id="l_M005822_source">show source</a> ]</p>
  <div id="M005822_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1156</span>
1156:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_db_has_no_schema_migrations_table</span>
1157:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-value str">&quot;DROP TABLE schema_migrations;&quot;</span>)
1158:       <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
1159:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">migrate</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">1</span>)
1160:       <span class="ruby-keyword kw">end</span>
1161:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005815" class="method">
  <div id="M005815_title" class="title">
    <b>test_migrator_double_down</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005815_source')" id="l_M005815_source">show source</a> ]</p>
  <div id="M005815_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1061</span>
1061:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_double_down</span>
1062:       <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value">0</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">current_version</span>)
1063:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">run</span>(<span class="ruby-identifier">:up</span>, <span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">1</span>)
1064:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">run</span>(<span class="ruby-identifier">:down</span>, <span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">1</span>)
1065:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">run</span>(<span class="ruby-identifier">:down</span>, <span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">1</span>) }
1066:       <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value">0</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">current_version</span>)
1067:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005814" class="method">
  <div id="M005814_title" class="title">
    <b>test_migrator_double_up</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005814_source')" id="l_M005814_source">show source</a> ]</p>
  <div id="M005814_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1054</span>
1054:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_double_up</span>
1055:       <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value">0</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">current_version</span>)
1056:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">run</span>(<span class="ruby-identifier">:up</span>, <span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">1</span>)
1057:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">run</span>(<span class="ruby-identifier">:up</span>, <span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">1</span>) }
1058:       <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value">1</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">current_version</span>)
1059:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005825" class="method">
  <div id="M005825_title" class="title">
    <b>test_migrator_going_down_due_to_version_target</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005825_source')" id="l_M005825_source">show source</a> ]</p>
  <div id="M005825_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1181</span>
1181:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_going_down_due_to_version_target</span>
1182:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">up</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">1</span>)
1183:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">migrate</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">0</span>)
1184: 
1185:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
1186:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">table_exists?</span>
1187: 
1188:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">migrate</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>)
1189: 
1190:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
1191:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
1192:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value str">&quot;content&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;hello world&quot;</span>, <span class="ruby-value str">&quot;remind_at&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
1193:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;hello world&quot;</span>, <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>).<span class="ruby-identifier">content</span>
1194:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005821" class="method">
  <div id="M005821_title" class="title">
    <b>test_migrator_interleaved_migrations</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005821_source')" id="l_M005821_source">show source</a> ]</p>
  <div id="M005821_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1141</span>
1141:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_interleaved_migrations</span>
1142:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">up</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/interleaved/pass_1&quot;</span>)
1143: 
1144:       <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
1145:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">up</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/interleaved/pass_2&quot;</span>)
1146:       <span class="ruby-keyword kw">end</span>
1147: 
1148:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
1149:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
1150: 
1151:       <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
1152:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">down</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/interleaved/pass_3&quot;</span>)
1153:       <span class="ruby-keyword kw">end</span>
1154:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005812" class="method">
  <div id="M005812_title" class="title">
    <b>test_migrator_one_down</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005812_source')" id="l_M005812_source">show source</a> ]</p>
  <div id="M005812_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1036</span>
1036:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_one_down</span>
1037:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">up</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>)
1038: 
1039:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">down</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">1</span>)
1040: 
1041:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
1042:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
1043:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">table_exists?</span>
1044:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005811" class="method">
  <div id="M005811_title" class="title">
    <b>test_migrator_one_up</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005811_source')" id="l_M005811_source">show source</a> ]</p>
  <div id="M005811_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1020</span>
1020:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_one_up</span>
1021:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
1022:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">table_exists?</span>
1023: 
1024:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">up</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">1</span>)
1025: 
1026:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
1027:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
1028:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">table_exists?</span>
1029: 
1030:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">up</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">2</span>)
1031: 
1032:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">create</span>(<span class="ruby-value str">&quot;content&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;hello world&quot;</span>, <span class="ruby-value str">&quot;remind_at&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
1033:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;hello world&quot;</span>, <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>).<span class="ruby-identifier">content</span>
1034:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005813" class="method">
  <div id="M005813_title" class="title">
    <b>test_migrator_one_up_one_down</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005813_source')" id="l_M005813_source">show source</a> ]</p>
  <div id="M005813_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1046</span>
1046:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_one_up_one_down</span>
1047:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">up</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">1</span>)
1048:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">down</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">0</span>)
1049: 
1050:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
1051:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">table_exists?</span>
1052:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005816" class="method">
  <div id="M005816_title" class="title">
    <b>test_migrator_one_up_with_exception_and_rollback</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005816_source')" id="l_M005816_source">show source</a> ]</p>
  <div id="M005816_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1070</span>
1070:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_one_up_with_exception_and_rollback</span>
1071:         <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
1072: 
1073:         <span class="ruby-identifier">e</span> = <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">StandardError</span>) <span class="ruby-keyword kw">do</span>
1074:           <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">up</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/broken&quot;</span>, <span class="ruby-value">100</span>)
1075:         <span class="ruby-keyword kw">end</span>
1076: 
1077:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;An error has occurred, this and all later migrations canceled:\n\nSomething broke&quot;</span>, <span class="ruby-identifier">e</span>.<span class="ruby-identifier">message</span>
1078: 
1079:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
1080:         <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_methods_hash</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">:last_name</span>)
1081:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005826" class="method">
  <div id="M005826_title" class="title">
    <b>test_migrator_rollback</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005826_source')" id="l_M005826_source">show source</a> ]</p>
  <div id="M005826_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1196</span>
1196:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_rollback</span>
1197:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">migrate</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>)
1198:       <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value">3</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">current_version</span>)
1199: 
1200:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">rollback</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>)
1201:       <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value">2</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">current_version</span>)
1202: 
1203:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">rollback</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>)
1204:       <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value">1</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">current_version</span>)
1205: 
1206:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">rollback</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>)
1207:       <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value">0</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">current_version</span>)
1208: 
1209:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">rollback</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>)
1210:       <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value">0</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">current_version</span>)
1211:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005823" class="method">
  <div id="M005823_title" class="title">
    <b>test_migrator_verbosity</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005823_source')" id="l_M005823_source">show source</a> ]</p>
  <div id="M005823_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1163</span>
1163:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_verbosity</span>
1164:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">up</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">1</span>)
1165:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">PeopleHaveLastNames</span>.<span class="ruby-identifier">message_count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
1166:       <span class="ruby-constant">PeopleHaveLastNames</span>.<span class="ruby-identifier">message_count</span> = <span class="ruby-value">0</span>
1167: 
1168:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">down</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">0</span>)
1169:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">PeopleHaveLastNames</span>.<span class="ruby-identifier">message_count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
1170:       <span class="ruby-constant">PeopleHaveLastNames</span>.<span class="ruby-identifier">message_count</span> = <span class="ruby-value">0</span>
1171:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005824" class="method">
  <div id="M005824_title" class="title">
    <b>test_migrator_verbosity_off</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005824_source')" id="l_M005824_source">show source</a> ]</p>
  <div id="M005824_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1173</span>
1173:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_verbosity_off</span>
1174:       <span class="ruby-constant">PeopleHaveLastNames</span>.<span class="ruby-identifier">verbose</span> = <span class="ruby-keyword kw">false</span>
1175:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">up</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">1</span>)
1176:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">PeopleHaveLastNames</span>.<span class="ruby-identifier">message_count</span>.<span class="ruby-identifier">zero?</span>
1177:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">down</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">0</span>)
1178:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">PeopleHaveLastNames</span>.<span class="ruby-identifier">message_count</span>.<span class="ruby-identifier">zero?</span>
1179:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005832" class="method">
  <div id="M005832_title" class="title">
    <b>test_migrator_with_duplicate_names</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005832_source')" id="l_M005832_source">show source</a> ]</p>
  <div id="M005832_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1302</span>
1302:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_with_duplicate_names</span>
1303:       <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">DuplicateMigrationNameError</span>, <span class="ruby-value str">&quot;Multiple migrations have the name Chunky&quot;</span>) <span class="ruby-keyword kw">do</span>
1304:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">migrate</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/duplicate_names&quot;</span>, <span class="ruby-keyword kw">nil</span>)
1305:       <span class="ruby-keyword kw">end</span>
1306:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005831" class="method">
  <div id="M005831_title" class="title">
    <b>test_migrator_with_duplicates</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005831_source')" id="l_M005831_source">show source</a> ]</p>
  <div id="M005831_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1296</span>
1296:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_with_duplicates</span>
1297:       <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">DuplicateMigrationVersionError</span>) <span class="ruby-keyword kw">do</span>
1298:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">migrate</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/duplicate&quot;</span>, <span class="ruby-keyword kw">nil</span>)
1299:       <span class="ruby-keyword kw">end</span>
1300:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005833" class="method">
  <div id="M005833_title" class="title">
    <b>test_migrator_with_missing_version_numbers</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005833_source')" id="l_M005833_source">show source</a> ]</p>
  <div id="M005833_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1308</span>
1308:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_migrator_with_missing_version_numbers</span>
1309:       <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">UnknownMigrationVersionError</span>) <span class="ruby-keyword kw">do</span>
1310:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">migrate</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/missing&quot;</span>, <span class="ruby-value">500</span>)
1311:       <span class="ruby-keyword kw">end</span>
1312:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005778" class="method">
  <div id="M005778_title" class="title">
    <b>test_native_decimal_insert_manual_vs_automatic</b>()
  </div>
  <div class="description">
  <p>
We specifically do a manual INSERT here, and then test only the SELECT
functionality. This allows us to more easily catch INSERT being broken, but
SELECT actually working fine.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005778_source')" id="l_M005778_source">show source</a> ]</p>
  <div id="M005778_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 406</span>
406:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_native_decimal_insert_manual_vs_automatic</span>
407:       <span class="ruby-identifier">correct_value</span> = <span class="ruby-value str">'0012345678901234567890.0123456789'</span>.<span class="ruby-identifier">to_d</span>
408: 
409:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">delete_all</span>
410:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;wealth&quot;</span>, <span class="ruby-identifier">:decimal</span>, <span class="ruby-identifier">:precision</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'30'</span>, <span class="ruby-identifier">:scale</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'10'</span>
411:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
412: 
413:       <span class="ruby-comment cmt"># Do a manual insertion</span>
414:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:OracleAdapter</span>)
415:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span> <span class="ruby-value str">&quot;insert into people (id, wealth) values (people_seq.nextval, 12345678901234567890.0123456789)&quot;</span>
416:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:OpenBaseAdapter</span>) <span class="ruby-operator">||</span> (<span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:MysqlAdapter</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">Mysql</span>.<span class="ruby-identifier">client_version</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">50003</span>) <span class="ruby-comment cmt">#before mysql 5.0.3 decimals stored as strings</span>
417:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span> <span class="ruby-value str">&quot;insert into people (wealth) values ('12345678901234567890.0123456789')&quot;</span>
418:       <span class="ruby-keyword kw">else</span>
419:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span> <span class="ruby-value str">&quot;insert into people (wealth) values (12345678901234567890.0123456789)&quot;</span>
420:       <span class="ruby-keyword kw">end</span>
421: 
422:       <span class="ruby-comment cmt"># SELECT</span>
423:       <span class="ruby-identifier">row</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>)
424:       <span class="ruby-identifier">assert_kind_of</span> <span class="ruby-constant">BigDecimal</span>, <span class="ruby-identifier">row</span>.<span class="ruby-identifier">wealth</span>
425: 
426:       <span class="ruby-comment cmt"># If this assert fails, that means the SELECT is broken!</span>
427:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:SQLite3Adapter</span>)
428:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">correct_value</span>, <span class="ruby-identifier">row</span>.<span class="ruby-identifier">wealth</span>
429:       <span class="ruby-keyword kw">end</span>
430: 
431:       <span class="ruby-comment cmt"># Reset to old state</span>
432:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">delete_all</span>
433: 
434:       <span class="ruby-comment cmt"># Now use the Rails insertion</span>
435:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">create</span> <span class="ruby-identifier">:wealth</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">BigDecimal</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;12345678901234567890.0123456789&quot;</span>) }
436: 
437:       <span class="ruby-comment cmt"># SELECT</span>
438:       <span class="ruby-identifier">row</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>)
439:       <span class="ruby-identifier">assert_kind_of</span> <span class="ruby-constant">BigDecimal</span>, <span class="ruby-identifier">row</span>.<span class="ruby-identifier">wealth</span>
440: 
441:       <span class="ruby-comment cmt"># If these asserts fail, that means the INSERT (create function, or cast to SQL) is broken!</span>
442:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:SQLite3Adapter</span>)
443:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">correct_value</span>, <span class="ruby-identifier">row</span>.<span class="ruby-identifier">wealth</span>
444:       <span class="ruby-keyword kw">end</span>
445: 
446:       <span class="ruby-comment cmt"># Reset to old state</span>
447:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">del_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;wealth&quot;</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
448:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
449:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005780" class="method">
  <div id="M005780_title" class="title">
    <b>test_native_types</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005780_source')" id="l_M005780_source">show source</a> ]</p>
  <div id="M005780_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 460</span>
460:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_native_types</span>
461:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">delete_all</span>
462:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;last_name&quot;</span>, <span class="ruby-identifier">:string</span>
463:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;bio&quot;</span>, <span class="ruby-identifier">:text</span>
464:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;age&quot;</span>, <span class="ruby-identifier">:integer</span>
465:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;height&quot;</span>, <span class="ruby-identifier">:float</span>
466:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;wealth&quot;</span>, <span class="ruby-identifier">:decimal</span>, <span class="ruby-identifier">:precision</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'30'</span>, <span class="ruby-identifier">:scale</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'10'</span>
467:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;birthday&quot;</span>, <span class="ruby-identifier">:datetime</span>
468:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;favorite_day&quot;</span>, <span class="ruby-identifier">:date</span>
469:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;moment_of_truth&quot;</span>, <span class="ruby-identifier">:datetime</span>
470:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;male&quot;</span>, <span class="ruby-identifier">:boolean</span>
471:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
472: 
473:       <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
474:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">create</span> <span class="ruby-identifier">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'bob'</span>, <span class="ruby-identifier">:last_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'bobsen'</span>,
475:           <span class="ruby-identifier">:bio</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;I was born ....&quot;</span>, <span class="ruby-identifier">:age</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">18</span>, <span class="ruby-identifier">:height</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1.78</span>,
476:           <span class="ruby-identifier">:wealth</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">BigDecimal</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;12345678901234567890.0123456789&quot;</span>),
477:           <span class="ruby-identifier">:birthday</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">18</span>.<span class="ruby-identifier">years</span>.<span class="ruby-identifier">ago</span>, <span class="ruby-identifier">:favorite_day</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">10</span>.<span class="ruby-identifier">days</span>.<span class="ruby-identifier">ago</span>,
478:           <span class="ruby-identifier">:moment_of_truth</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;1782-10-10 21:40:18&quot;</span>, <span class="ruby-identifier">:male</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>
479:       <span class="ruby-keyword kw">end</span>
480: 
481:       <span class="ruby-identifier">bob</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>)
482:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'bob'</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">first_name</span>
483:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'bobsen'</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">last_name</span>
484:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;I was born ....&quot;</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">bio</span>
485:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">18</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">age</span>
486: 
487:       <span class="ruby-comment cmt"># Test for 30 significent digits (beyond the 16 of float), 10 of them</span>
488:       <span class="ruby-comment cmt"># after the decimal place.</span>
489: 
490:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:SQLite3Adapter</span>)
491:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">BigDecimal</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;0012345678901234567890.0123456789&quot;</span>), <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">wealth</span>
492:       <span class="ruby-keyword kw">end</span>
493: 
494:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">male?</span>
495: 
496:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">String</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">first_name</span>.<span class="ruby-identifier">class</span>
497:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">String</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">last_name</span>.<span class="ruby-identifier">class</span>
498:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">String</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">bio</span>.<span class="ruby-identifier">class</span>
499:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Fixnum</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">age</span>.<span class="ruby-identifier">class</span>
500:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Time</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">birthday</span>.<span class="ruby-identifier">class</span>
501: 
502:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:OracleAdapter</span>, <span class="ruby-identifier">:SybaseAdapter</span>)
503:         <span class="ruby-comment cmt"># Sybase, and Oracle don't differentiate between date/time</span>
504:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Time</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">favorite_day</span>.<span class="ruby-identifier">class</span>
505:       <span class="ruby-keyword kw">else</span>
506:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Date</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">favorite_day</span>.<span class="ruby-identifier">class</span>
507:       <span class="ruby-keyword kw">end</span>
508: 
509:       <span class="ruby-comment cmt"># Test DateTime column and defaults, including timezone.</span>
510:       <span class="ruby-comment cmt"># FIXME: moment of truth may be Time on 64-bit platforms.</span>
511:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">moment_of_truth</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">DateTime</span>)
512: 
513:         <span class="ruby-identifier">with_env_tz</span> <span class="ruby-value str">'US/Eastern'</span> <span class="ruby-keyword kw">do</span>
514:           <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">local_offset</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">moment_of_truth</span>.<span class="ruby-identifier">offset</span>
515:           <span class="ruby-identifier">assert_not_equal</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">moment_of_truth</span>.<span class="ruby-identifier">offset</span>
516:           <span class="ruby-identifier">assert_not_equal</span> <span class="ruby-value str">&quot;Z&quot;</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">moment_of_truth</span>.<span class="ruby-identifier">zone</span>
517:           <span class="ruby-comment cmt"># US/Eastern is -5 hours from GMT</span>
518:           <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Rational</span>(<span class="ruby-value">-5</span>, <span class="ruby-value">24</span>), <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">moment_of_truth</span>.<span class="ruby-identifier">offset</span>
519:           <span class="ruby-identifier">assert_match</span> <span class="ruby-regexp re">/\A-05:?00\Z/</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">moment_of_truth</span>.<span class="ruby-identifier">zone</span> <span class="ruby-comment cmt">#ruby 1.8.6 uses HH:MM, prior versions use HHMM</span>
520:           <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">DateTime</span><span class="ruby-operator">::</span><span class="ruby-constant">ITALY</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">moment_of_truth</span>.<span class="ruby-identifier">start</span>
521:         <span class="ruby-keyword kw">end</span>
522:       <span class="ruby-keyword kw">end</span>
523: 
524:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">TrueClass</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">male?</span>.<span class="ruby-identifier">class</span>
525:       <span class="ruby-identifier">assert_kind_of</span> <span class="ruby-constant">BigDecimal</span>, <span class="ruby-identifier">bob</span>.<span class="ruby-identifier">wealth</span>
526:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005819" class="method">
  <div id="M005819_title" class="title">
    <b>test_only_loads_pending_migrations</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005819_source')" id="l_M005819_source">show source</a> ]</p>
  <div id="M005819_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1102</span>
1102:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_only_loads_pending_migrations</span>
1103:       <span class="ruby-comment cmt"># migrate up to 1</span>
1104:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">up</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">1</span>)
1105: 
1106:       <span class="ruby-comment cmt"># now unload the migrations that have been defined</span>
1107:       <span class="ruby-constant">PeopleHaveLastNames</span>.<span class="ruby-identifier">unloadable</span>
1108:       <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">Dependencies</span>.<span class="ruby-identifier">remove_unloadable_constants!</span>
1109: 
1110:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">migrate</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-keyword kw">nil</span>)
1111: 
1112:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-keyword kw">defined?</span> <span class="ruby-constant">PeopleHaveLastNames</span>
1113: 
1114:       <span class="ruby-node">%w(WeNeedReminders, InnocentJointable)</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">migration</span><span class="ruby-operator">|</span>
1115:         <span class="ruby-identifier">assert</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-identifier">migration</span>
1116:       <span class="ruby-keyword kw">end</span>
1117: 
1118:     <span class="ruby-keyword kw">ensure</span>
1119:       <span class="ruby-identifier">load</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid/1_people_have_last_names.rb&quot;</span>)
1120:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005828" class="method">
  <div id="M005828_title" class="title">
    <b>test_proper_table_name</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005828_source')" id="l_M005828_source">show source</a> ]</p>
  <div id="M005828_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1227</span>
1227:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_proper_table_name</span>
1228:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;table&quot;</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">proper_table_name</span>(<span class="ruby-value str">'table'</span>)
1229:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;table&quot;</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">proper_table_name</span>(<span class="ruby-identifier">:table</span>)
1230:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;reminders&quot;</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">proper_table_name</span>(<span class="ruby-constant">Reminder</span>)
1231:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">reset_table_name</span>
1232:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">table_name</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">proper_table_name</span>(<span class="ruby-constant">Reminder</span>)
1233: 
1234:       <span class="ruby-comment cmt"># Use the model's own prefix/suffix if a model is given</span>
1235:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_prefix</span> = <span class="ruby-value str">&quot;ARprefix_&quot;</span>
1236:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_suffix</span> = <span class="ruby-value str">&quot;_ARsuffix&quot;</span>
1237:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">table_name_prefix</span> = <span class="ruby-value str">'prefix_'</span>
1238:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">table_name_suffix</span> = <span class="ruby-value str">'_suffix'</span>
1239:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">reset_table_name</span>
1240:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;prefix_reminders_suffix&quot;</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">proper_table_name</span>(<span class="ruby-constant">Reminder</span>)
1241:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">table_name_prefix</span> = <span class="ruby-value str">''</span>
1242:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">table_name_suffix</span> = <span class="ruby-value str">''</span>
1243:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">reset_table_name</span>
1244: 
1245:       <span class="ruby-comment cmt"># Use AR::Base's prefix/suffix if string or symbol is given</span>
1246:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_prefix</span> = <span class="ruby-value str">&quot;prefix_&quot;</span>
1247:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_suffix</span> = <span class="ruby-value str">&quot;_suffix&quot;</span>
1248:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">reset_table_name</span>
1249:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;prefix_table_suffix&quot;</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">proper_table_name</span>(<span class="ruby-value str">'table'</span>)
1250:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;prefix_table_suffix&quot;</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">proper_table_name</span>(<span class="ruby-identifier">:table</span>)
1251:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_prefix</span> = <span class="ruby-value str">&quot;&quot;</span>
1252:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_suffix</span> = <span class="ruby-value str">&quot;&quot;</span>
1253:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">reset_table_name</span>
1254:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005795" class="method">
  <div id="M005795_title" class="title">
    <b>test_remove_column_with_index</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005795_source')" id="l_M005795_source">show source</a> ]</p>
  <div id="M005795_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 717</span>
717:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_remove_column_with_index</span>
718:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span>(<span class="ruby-identifier">:hats</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">table</span><span class="ruby-operator">|</span>
719:         <span class="ruby-identifier">table</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:hat_name</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">100</span>
720:         <span class="ruby-identifier">table</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:hat_size</span>, <span class="ruby-identifier">:integer</span>
721:       <span class="ruby-keyword kw">end</span>
722:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span> <span class="ruby-value str">&quot;hats&quot;</span>, <span class="ruby-value str">&quot;hat_size&quot;</span>
723: 
724:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_column</span>(<span class="ruby-value str">&quot;hats&quot;</span>, <span class="ruby-value str">&quot;hat_size&quot;</span>) }
725:     <span class="ruby-keyword kw">ensure</span>
726:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span>(<span class="ruby-identifier">:hats</span>)
727:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005796" class="method">
  <div id="M005796_title" class="title">
    <b>test_remove_column_with_multi_column_index</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005796_source')" id="l_M005796_source">show source</a> ]</p>
  <div id="M005796_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 729</span>
729:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_remove_column_with_multi_column_index</span>
730:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span>(<span class="ruby-identifier">:hats</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">table</span><span class="ruby-operator">|</span>
731:         <span class="ruby-identifier">table</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:hat_name</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">100</span>
732:         <span class="ruby-identifier">table</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:hat_size</span>, <span class="ruby-identifier">:integer</span>
733:         <span class="ruby-identifier">table</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:hat_style</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">100</span>
734:       <span class="ruby-keyword kw">end</span>
735:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span> <span class="ruby-value str">&quot;hats&quot;</span>, [<span class="ruby-value str">&quot;hat_style&quot;</span>, <span class="ruby-value str">&quot;hat_size&quot;</span>], <span class="ruby-identifier">:unique</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>
736: 
737:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_column</span>(<span class="ruby-value str">&quot;hats&quot;</span>, <span class="ruby-value str">&quot;hat_size&quot;</span>) }
738:     <span class="ruby-keyword kw">ensure</span>
739:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span>(<span class="ruby-identifier">:hats</span>)
740:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005760" class="method">
  <div id="M005760_title" class="title">
    <b>test_remove_nonexistent_index</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005760_source')" id="l_M005760_source">show source</a> ]</p>
  <div id="M005760_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 131</span>
131:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_remove_nonexistent_index</span>
132:       <span class="ruby-comment cmt"># we do this by name, so OpenBase is a wash as noted above</span>
133:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:OpenBaseAdapter</span>)
134:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_index</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;no_such_index&quot;</span>) }
135:       <span class="ruby-keyword kw">end</span>
136:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005790" class="method">
  <div id="M005790_title" class="title">
    <b>test_rename_column</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005790_source')" id="l_M005790_source">show source</a> ]</p>
  <div id="M005790_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 649</span>
649:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_rename_column</span>
650:       <span class="ruby-keyword kw">begin</span>
651:         <span class="ruby-identifier">names_before</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:first_name</span>)
652:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">rename_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>, <span class="ruby-value str">&quot;nick_name&quot;</span>
653:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
654:         <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_names</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;nick_name&quot;</span>)
655:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">names_before</span>, <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:nick_name</span>)
656:       <span class="ruby-keyword kw">ensure</span>
657:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_column</span>(<span class="ruby-value str">&quot;people&quot;</span>,<span class="ruby-value str">&quot;nick_name&quot;</span>)
658:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span>(<span class="ruby-value str">&quot;people&quot;</span>,<span class="ruby-value str">&quot;first_name&quot;</span>, <span class="ruby-identifier">:string</span>)
659:       <span class="ruby-keyword kw">end</span>
660:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005791" class="method">
  <div id="M005791_title" class="title">
    <b>test_rename_column_preserves_default_value_not_null</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005791_source')" id="l_M005791_source">show source</a> ]</p>
  <div id="M005791_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 662</span>
662:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_rename_column_preserves_default_value_not_null</span>
663:       <span class="ruby-keyword kw">begin</span>
664:         <span class="ruby-identifier">default_before</span> = <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-value str">&quot;developers&quot;</span>).<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;salary&quot;</span> }.<span class="ruby-identifier">default</span>
665:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">70000</span>, <span class="ruby-identifier">default_before</span>
666:         <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">rename_column</span> <span class="ruby-value str">&quot;developers&quot;</span>, <span class="ruby-value str">&quot;salary&quot;</span>, <span class="ruby-value str">&quot;anual_salary&quot;</span>
667:         <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">reset_column_information</span>
668:         <span class="ruby-identifier">assert</span> <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">column_names</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;anual_salary&quot;</span>)
669:         <span class="ruby-identifier">default_after</span> = <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">columns</span>(<span class="ruby-value str">&quot;developers&quot;</span>).<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;anual_salary&quot;</span> }.<span class="ruby-identifier">default</span>
670:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">70000</span>, <span class="ruby-identifier">default_after</span>
671:       <span class="ruby-keyword kw">ensure</span>
672:         <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">rename_column</span> <span class="ruby-value str">&quot;developers&quot;</span>, <span class="ruby-value str">&quot;anual_salary&quot;</span>, <span class="ruby-value str">&quot;salary&quot;</span>
673:         <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">reset_column_information</span>
674:       <span class="ruby-keyword kw">end</span>
675:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005789" class="method">
  <div id="M005789_title" class="title">
    <b>test_rename_column_using_symbol_arguments</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005789_source')" id="l_M005789_source">show source</a> ]</p>
  <div id="M005789_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 636</span>
636:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_rename_column_using_symbol_arguments</span>
637:       <span class="ruby-keyword kw">begin</span>
638:         <span class="ruby-identifier">names_before</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:first_name</span>)
639:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">rename_column</span> <span class="ruby-identifier">:people</span>, <span class="ruby-identifier">:first_name</span>, <span class="ruby-identifier">:nick_name</span>
640:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
641:         <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_names</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;nick_name&quot;</span>)
642:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">names_before</span>, <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:nick_name</span>)
643:       <span class="ruby-keyword kw">ensure</span>
644:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_column</span>(<span class="ruby-value str">&quot;people&quot;</span>,<span class="ruby-value str">&quot;nick_name&quot;</span>)
645:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span>(<span class="ruby-value str">&quot;people&quot;</span>,<span class="ruby-value str">&quot;first_name&quot;</span>, <span class="ruby-identifier">:string</span>)
646:       <span class="ruby-keyword kw">end</span>
647:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005794" class="method">
  <div id="M005794_title" class="title">
    <b>test_rename_column_with_an_index</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005794_source')" id="l_M005794_source">show source</a> ]</p>
  <div id="M005794_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 704</span>
704:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_rename_column_with_an_index</span>
705:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span>(<span class="ruby-identifier">:hats</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">table</span><span class="ruby-operator">|</span>
706:         <span class="ruby-identifier">table</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:hat_name</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">100</span>
707:         <span class="ruby-identifier">table</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:hat_size</span>, <span class="ruby-identifier">:integer</span>
708:       <span class="ruby-keyword kw">end</span>
709:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span> <span class="ruby-identifier">:hats</span>, <span class="ruby-identifier">:hat_name</span>
710:       <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
711:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">rename_column</span> <span class="ruby-value str">&quot;hats&quot;</span>, <span class="ruby-value str">&quot;hat_name&quot;</span>, <span class="ruby-value str">&quot;name&quot;</span>
712:       <span class="ruby-keyword kw">end</span>
713:     <span class="ruby-keyword kw">ensure</span>
714:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span>(<span class="ruby-identifier">:hats</span>)
715:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005793" class="method">
  <div id="M005793_title" class="title">
    <b>test_rename_column_with_sql_reserved_word</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005793_source')" id="l_M005793_source">show source</a> ]</p>
  <div id="M005793_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 693</span>
693:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_rename_column_with_sql_reserved_word</span>
694:       <span class="ruby-keyword kw">begin</span>
695:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">rename_column</span> <span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>, <span class="ruby-value str">&quot;group&quot;</span> }
696:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
697:         <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">column_names</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;group&quot;</span>)
698:       <span class="ruby-keyword kw">ensure</span>
699:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">remove_column</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;group&quot;</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
700:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_column</span>(<span class="ruby-value str">&quot;people&quot;</span>, <span class="ruby-value str">&quot;first_name&quot;</span>, <span class="ruby-identifier">:string</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
701:       <span class="ruby-keyword kw">end</span>
702:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005761" class="method">
  <div id="M005761_title" class="title">
    <b>test_rename_index</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005761_source')" id="l_M005761_source">show source</a> ]</p>
  <div id="M005761_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 138</span>
138:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_rename_index</span>
139:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:OpenBaseAdapter</span>)
140:         <span class="ruby-comment cmt"># keep the names short to make Oracle and similar behave</span>
141:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span>(<span class="ruby-value str">'people'</span>, [<span class="ruby-identifier">:first_name</span>], <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'old_idx'</span>)
142:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">rename_index</span>(<span class="ruby-value str">'people'</span>, <span class="ruby-value str">'old_idx'</span>, <span class="ruby-value str">'new_idx'</span>) }
143:         <span class="ruby-comment cmt"># if the adapter doesn't support the indexes call, pick defaults that let the test pass</span>
144:         <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">index_exists?</span>(<span class="ruby-value str">'people'</span>, <span class="ruby-value str">'old_idx'</span>, <span class="ruby-keyword kw">false</span>)
145:         <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">index_exists?</span>(<span class="ruby-value str">'people'</span>, <span class="ruby-value str">'new_idx'</span>, <span class="ruby-keyword kw">true</span>)
146:       <span class="ruby-keyword kw">end</span>
147:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005792" class="method">
  <div id="M005792_title" class="title">
    <b>test_rename_nonexistent_column</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005792_source')" id="l_M005792_source">show source</a> ]</p>
  <div id="M005792_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 677</span>
677:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_rename_nonexistent_column</span>
678:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span>(<span class="ruby-identifier">:hats</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">table</span><span class="ruby-operator">|</span>
679:         <span class="ruby-identifier">table</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:hat_name</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>
680:       <span class="ruby-keyword kw">end</span>
681:       <span class="ruby-identifier">exception</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:PostgreSQLAdapter</span>)
682:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">StatementInvalid</span>
683:       <span class="ruby-keyword kw">else</span>
684:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">ActiveRecordError</span>
685:       <span class="ruby-keyword kw">end</span>
686:       <span class="ruby-identifier">assert_raise</span>(<span class="ruby-identifier">exception</span>) <span class="ruby-keyword kw">do</span>
687:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">rename_column</span> <span class="ruby-value str">&quot;hats&quot;</span>, <span class="ruby-value str">&quot;nonexistent&quot;</span>, <span class="ruby-value str">&quot;should_fail&quot;</span>
688:       <span class="ruby-keyword kw">end</span>
689:     <span class="ruby-keyword kw">ensure</span>
690:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span>(<span class="ruby-identifier">:hats</span>)
691:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005798" class="method">
  <div id="M005798_title" class="title">
    <b>test_rename_table</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005798_source')" id="l_M005798_source">show source</a> ]</p>
  <div id="M005798_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 752</span>
752:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_rename_table</span>
753:       <span class="ruby-keyword kw">begin</span>
754:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:octopuses</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
755:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:url</span>, <span class="ruby-identifier">:string</span>
756:         <span class="ruby-keyword kw">end</span>
757:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">rename_table</span> <span class="ruby-identifier">:octopuses</span>, <span class="ruby-identifier">:octopi</span>
758: 
759:         <span class="ruby-comment cmt"># Using explicit id in insert for compatibility across all databases</span>
760:         <span class="ruby-identifier">con</span> = <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>
761:         <span class="ruby-identifier">con</span>.<span class="ruby-identifier">enable_identity_insert</span>(<span class="ruby-value str">&quot;octopi&quot;</span>, <span class="ruby-keyword kw">true</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:SybaseAdapter</span>)
762:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">con</span>.<span class="ruby-identifier">execute</span> <span class="ruby-node">&quot;INSERT INTO octopi (#{con.quote_column_name('id')}, #{con.quote_column_name('url')}) VALUES (1, 'http://www.foreverflying.com/octopus-black7.jpg')&quot;</span> }
763:         <span class="ruby-identifier">con</span>.<span class="ruby-identifier">enable_identity_insert</span>(<span class="ruby-value str">&quot;octopi&quot;</span>, <span class="ruby-keyword kw">false</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:SybaseAdapter</span>)
764: 
765:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'http://www.foreverflying.com/octopus-black7.jpg'</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_value</span>(<span class="ruby-value str">&quot;SELECT url FROM octopi WHERE id=1&quot;</span>)
766: 
767:       <span class="ruby-keyword kw">ensure</span>
768:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:octopuses</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
769:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:octopi</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
770:       <span class="ruby-keyword kw">end</span>
771:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005800" class="method">
  <div id="M005800_title" class="title">
    <b>test_rename_table_with_an_index</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005800_source')" id="l_M005800_source">show source</a> ]</p>
  <div id="M005800_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 786</span>
786:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_rename_table_with_an_index</span>
787:       <span class="ruby-keyword kw">begin</span>
788:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:octopuses</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
789:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:url</span>, <span class="ruby-identifier">:string</span>
790:         <span class="ruby-keyword kw">end</span>
791:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">add_index</span> <span class="ruby-identifier">:octopuses</span>, <span class="ruby-identifier">:url</span>
792: 
793:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">rename_table</span> <span class="ruby-identifier">:octopuses</span>, <span class="ruby-identifier">:octopi</span>
794: 
795:         <span class="ruby-comment cmt"># Using explicit id in insert for compatibility across all databases</span>
796:         <span class="ruby-identifier">con</span> = <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>
797:         <span class="ruby-identifier">con</span>.<span class="ruby-identifier">enable_identity_insert</span>(<span class="ruby-value str">&quot;octopi&quot;</span>, <span class="ruby-keyword kw">true</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:SybaseAdapter</span>)
798:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">con</span>.<span class="ruby-identifier">execute</span> <span class="ruby-node">&quot;INSERT INTO octopi (#{con.quote_column_name('id')}, #{con.quote_column_name('url')}) VALUES (1, 'http://www.foreverflying.com/octopus-black7.jpg')&quot;</span> }
799:         <span class="ruby-identifier">con</span>.<span class="ruby-identifier">enable_identity_insert</span>(<span class="ruby-value str">&quot;octopi&quot;</span>, <span class="ruby-keyword kw">false</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:SybaseAdapter</span>)
800: 
801:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'http://www.foreverflying.com/octopus-black7.jpg'</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">select_value</span>(<span class="ruby-value str">&quot;SELECT url FROM octopi WHERE id=1&quot;</span>)
802:         <span class="ruby-identifier">assert</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">indexes</span>(<span class="ruby-identifier">:octopi</span>).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">columns</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;url&quot;</span>)
803:       <span class="ruby-keyword kw">ensure</span>
804:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:octopuses</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
805:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:octopi</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
806:       <span class="ruby-keyword kw">end</span>
807:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005827" class="method">
  <div id="M005827_title" class="title">
    <b>test_schema_migrations_table_name</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005827_source')" id="l_M005827_source">show source</a> ]</p>
  <div id="M005827_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1213</span>
1213:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_schema_migrations_table_name</span>
1214:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_prefix</span> = <span class="ruby-value str">&quot;prefix_&quot;</span>
1215:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_suffix</span> = <span class="ruby-value str">&quot;_suffix&quot;</span>
1216:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">reset_table_name</span>
1217:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;prefix_schema_migrations_suffix&quot;</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">schema_migrations_table_name</span>
1218:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_prefix</span> = <span class="ruby-value str">&quot;&quot;</span>
1219:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_suffix</span> = <span class="ruby-value str">&quot;&quot;</span>
1220:       <span class="ruby-constant">Reminder</span>.<span class="ruby-identifier">reset_table_name</span>
1221:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;schema_migrations&quot;</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">schema_migrations_table_name</span>
1222:     <span class="ruby-keyword kw">ensure</span>
1223:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_prefix</span> = <span class="ruby-value str">&quot;&quot;</span>
1224:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">table_name_suffix</span> = <span class="ruby-value str">&quot;&quot;</span>
1225:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005820" class="method">
  <div id="M005820_title" class="title">
    <b>test_target_version_zero_should_run_only_once</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005820_source')" id="l_M005820_source">show source</a> ]</p>
  <div id="M005820_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1122</span>
1122:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_target_version_zero_should_run_only_once</span>
1123:       <span class="ruby-comment cmt"># migrate up to 1</span>
1124:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">migrate</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">1</span>)
1125: 
1126:       <span class="ruby-comment cmt"># migrate down to 0</span>
1127:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">migrate</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">0</span>)
1128: 
1129:       <span class="ruby-comment cmt"># now unload the migrations that have been defined</span>
1130:       <span class="ruby-constant">PeopleHaveLastNames</span>.<span class="ruby-identifier">unloadable</span>
1131:       <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">Dependencies</span>.<span class="ruby-identifier">remove_unloadable_constants!</span>
1132: 
1133:       <span class="ruby-comment cmt"># migrate down to 0 again</span>
1134:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migrator</span>.<span class="ruby-identifier">migrate</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid&quot;</span>, <span class="ruby-value">0</span>)
1135: 
1136:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-keyword kw">defined?</span> <span class="ruby-constant">PeopleHaveLastNames</span>
1137:     <span class="ruby-keyword kw">ensure</span>
1138:       <span class="ruby-identifier">load</span>(<span class="ruby-constant">MIGRATIONS_ROOT</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/valid/1_people_have_last_names.rb&quot;</span>)
1139:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005781" class="method">
  <div id="M005781_title" class="title">
    <b>test_unabstracted_database_dependent_types</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005781_source')" id="l_M005781_source">show source</a> ]</p>
  <div id="M005781_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 529</span>
529:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_unabstracted_database_dependent_types</span>
530:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">delete_all</span>
531: 
532:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migration</span>.<span class="ruby-identifier">add_column</span> <span class="ruby-identifier">:people</span>, <span class="ruby-identifier">:intelligence_quotient</span>, <span class="ruby-identifier">:tinyint</span>
533:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">reset_column_information</span>
534:         <span class="ruby-identifier">assert_match</span> <span class="ruby-regexp re">/tinyint/</span>, <span class="ruby-constant">Person</span>.<span class="ruby-identifier">columns_hash</span>[<span class="ruby-value str">'intelligence_quotient'</span>].<span class="ruby-identifier">sql_type</span>
535:       <span class="ruby-keyword kw">ensure</span>
536:         <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migration</span>.<span class="ruby-identifier">remove_column</span> <span class="ruby-identifier">:people</span>, <span class="ruby-identifier">:intelligence_quotient</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
537:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005784" class="method">
  <div id="M005784_title" class="title">
    <b>testing_table_for_positioning</b>() {|Person.connection| ...}
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005784_source')" id="l_M005784_source">show source</a> ]</p>
  <div id="M005784_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 569</span>
569:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">testing_table_for_positioning</span>
570:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:testings</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
571:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:integer</span>
572:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:second</span>, <span class="ruby-identifier">:integer</span>
573:           <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:third</span>, <span class="ruby-identifier">:integer</span>
574:         <span class="ruby-keyword kw">end</span>
575: 
576:         <span class="ruby-keyword kw">yield</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>
577:       <span class="ruby-keyword kw">ensure</span>
578:         <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
579:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="sectiontitle">Protected Instance methods</div>
<div id="M005763" class="method">
  <div id="M005763_title" class="title">
    <b>testing_table_with_only_foo_attribute</b>() {|Person.connection| ...}
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005763_source')" id="l_M005763_source">show source</a> ]</p>
  <div id="M005763_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 156</span>
156:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">testing_table_with_only_foo_attribute</span>
157:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">create_table</span> <span class="ruby-identifier">:testings</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
158:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> <span class="ruby-identifier">:foo</span>, <span class="ruby-identifier">:string</span>
159:       <span class="ruby-keyword kw">end</span>
160: 
161:       <span class="ruby-keyword kw">yield</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>
162:     <span class="ruby-keyword kw">ensure</span>
163:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">drop_table</span> <span class="ruby-identifier">:testings</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
164:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005835" class="method">
  <div id="M005835_title" class="title">
    <b>with_env_tz</b>(new_tz = 'US/Eastern') {|| ...}
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005835_source')" id="l_M005835_source">show source</a> ]</p>
  <div id="M005835_source" class="dyn-source">
<pre>
      <span class="ruby-comment cmt"># File activerecord/test/cases/migration_test.rb, line 1352</span>
1352:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">with_env_tz</span>(<span class="ruby-identifier">new_tz</span> = <span class="ruby-value str">'US/Eastern'</span>)
1353:         <span class="ruby-identifier">old_tz</span>, <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'TZ'</span>] = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'TZ'</span>], <span class="ruby-identifier">new_tz</span>
1354:         <span class="ruby-keyword kw">yield</span>
1355:       <span class="ruby-keyword kw">ensure</span>
1356:         <span class="ruby-identifier">old_tz</span> <span class="ruby-value">? </span><span class="ruby-constant">ENV</span>[<span class="ruby-value str">'TZ'</span>] = <span class="ruby-identifier">old_tz</span> <span class="ruby-operator">:</span> <span class="ruby-constant">ENV</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">'TZ'</span>)
1357:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>