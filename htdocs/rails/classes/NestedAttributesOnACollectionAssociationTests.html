  <div id="C00001288">
<div class='banner'>
  <span class="file-title-prefix">Module</span><br />NestedAttributesOnACollectionAssociationTests<br/>
  In:
<a href="#" onclick="jsHref('files/activerecord/test/cases/nested_attributes_test_rb.html');">activerecord/test/cases/nested_attributes_test.rb</a>

</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">




  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M008308&name=test_should_also_work_with_a_HashWithIndifferentAccess" >test_should_also_work_with_a_HashWithIndifferentAccess</a></li>
  <li><a href="index.html?a=M008313&name=test_should_automatically_build_new_associated_models_for_each_entry_in_a_hash_where_the_id_is_missing" >test_should_automatically_build_new_associated_models_for_each_entry_in_a_hash_where_the_id_is_missing</a></li>
  <li><a href="index.html?a=M008324&name=test_should_automatically_enable_autosave_on_the_association" >test_should_automatically_enable_autosave_on_the_association</a></li>
  <li><a href="index.html?a=M008321&name=test_should_be_possible_to_destroy_a_record" >test_should_be_possible_to_destroy_a_record</a></li>
  <li><a href="index.html?a=M008304&name=test_should_define_an_attribute_writer_method_for_the_association" >test_should_define_an_attribute_writer_method_for_the_association</a></li>
  <li><a href="index.html?a=M008316&name=test_should_ignore_new_associated_records_if_a_reject_if_proc_returns_false" >test_should_ignore_new_associated_records_if_a_reject_if_proc_returns_false</a></li>
  <li><a href="index.html?a=M008315&name=test_should_ignore_new_associated_records_with_truthy_destroy_attribute" >test_should_ignore_new_associated_records_with_truthy_destroy_attribute</a></li>
  <li><a href="index.html?a=M008314&name=test_should_not_assign_destroy_key_to_a_record" >test_should_not_assign_destroy_key_to_a_record</a></li>
  <li><a href="index.html?a=M008323&name=test_should_not_destroy_the_associated_model_until_the_parent_is_saved" >test_should_not_destroy_the_associated_model_until_the_parent_is_saved</a></li>
  <li><a href="index.html?a=M008322&name=test_should_not_destroy_the_associated_model_with_a_non_truthy_argument" >test_should_not_destroy_the_associated_model_with_a_non_truthy_argument</a></li>
  <li><a href="index.html?a=M008310&name=test_should_not_load_association_when_updating_existing_records" >test_should_not_load_association_when_updating_existing_records</a></li>
  <li><a href="index.html?a=M008312&name=test_should_raise_RecordNotFound_if_an_id_is_given_but_doesnt_return_a_record" >test_should_raise_RecordNotFound_if_an_id_is_given_but_doesnt_return_a_record</a></li>
  <li><a href="index.html?a=M008318&name=test_should_raise_an_argument_error_if_something_else_than_a_hash_is_passed" >test_should_raise_an_argument_error_if_something_else_than_a_hash_is_passed</a></li>
  <li><a href="index.html?a=M008305&name=test_should_save_only_one_association_on_create" >test_should_save_only_one_association_on_create</a></li>
  <li><a href="index.html?a=M008317&name=test_should_sort_the_hash_by_the_keys_before_building_new_associated_models" >test_should_sort_the_hash_by_the_keys_before_building_new_associated_models</a></li>
  <li><a href="index.html?a=M008309&name=test_should_take_a_hash_and_assign_the_attributes_to_the_associated_models" >test_should_take_a_hash_and_assign_the_attributes_to_the_associated_models</a></li>
  <li><a href="index.html?a=M008311&name=test_should_take_a_hash_with_composite_id_keys_and_assign_the_attributes_to_the_associated_models" >test_should_take_a_hash_with_composite_id_keys_and_assign_the_attributes_to_the_associated_models</a></li>
  <li><a href="index.html?a=M008306&name=test_should_take_a_hash_with_string_keys_and_assign_the_attributes_to_the_associated_models" >test_should_take_a_hash_with_string_keys_and_assign_the_attributes_to_the_associated_models</a></li>
  <li><a href="index.html?a=M008307&name=test_should_take_an_array_and_assign_the_attributes_to_the_associated_models" >test_should_take_an_array_and_assign_the_attributes_to_the_associated_models</a></li>
  <li><a href="index.html?a=M008320&name=test_should_update_existing_records_and_add_new_ones_that_have_no_id" >test_should_update_existing_records_and_add_new_ones_that_have_no_id</a></li>
  <li><a href="index.html?a=M008319&name=test_should_work_with_update_attributes_as_well" >test_should_work_with_update_attributes_as_well</a></li>
  <li><a href="index.html?a=M008326&name=test_validate_presence_of_parent_fails_without_inverse_of" >test_validate_presence_of_parent_fails_without_inverse_of</a></li>
  <li><a href="index.html?a=M008325&name=test_validate_presence_of_parent_works_with_inverse_of" >test_validate_presence_of_parent_works_with_inverse_of</a></li>
  </ul>

<div class="sectiontitle">Included Modules</div>
<ul>
  <li><a href="#" onclick="jsHref('classes/AssertRaiseWithMessage.html');">AssertRaiseWithMessage</a></li>
</ul>





<div class="sectiontitle">Public Instance methods</div>
<div id="M008308" class="method">
  <div id="M008308_title" class="title">
    <b>test_should_also_work_with_a_HashWithIndifferentAccess</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008308_source')" id="l_M008308_source">show source</a> ]</p>
  <div id="M008308_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 446</span>
446:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_also_work_with_a_HashWithIndifferentAccess</span>
447:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">association_setter</span>, <span class="ruby-constant">HashWithIndifferentAccess</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'foo'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">HashWithIndifferentAccess</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Grace OMalley'</span>)))
448:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">save</span>
449:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Grace OMalley'</span>, <span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">name</span>
450:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008313" class="method">
  <div id="M008313_title" class="title">
    <b>test_should_automatically_build_new_associated_models_for_each_entry_in_a_hash_where_the_id_is_missing</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008313_source')" id="l_M008313_source">show source</a> ]</p>
  <div id="M008313_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 488</span>
488:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_automatically_build_new_associated_models_for_each_entry_in_a_hash_where_the_id_is_missing</span>
489:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">destroy_all</span>
490:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">attributes</span> = {
491:       <span class="ruby-identifier">association_getter</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-value str">'foo'</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Grace OMalley'</span> }, <span class="ruby-value str">'bar'</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Privateers Greed'</span> }}
492:     }
493: 
494:     <span class="ruby-identifier">assert</span> <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">new_record?</span>
495:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Grace OMalley'</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">name</span>
496: 
497:     <span class="ruby-identifier">assert</span> <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">last</span>.<span class="ruby-identifier">new_record?</span>
498:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Privateers Greed'</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">last</span>.<span class="ruby-identifier">name</span>
499:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008324" class="method">
  <div id="M008324_title" class="title">
    <b>test_should_automatically_enable_autosave_on_the_association</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008324_source')" id="l_M008324_source">show source</a> ]</p>
  <div id="M008324_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 589</span>
589:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_automatically_enable_autosave_on_the_association</span>
590:     <span class="ruby-identifier">assert</span> <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">reflect_on_association</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:autosave</span>]
591:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008321" class="method">
  <div id="M008321_title" class="title">
    <b>test_should_be_possible_to_destroy_a_record</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008321_source')" id="l_M008321_source">show source</a> ]</p>
  <div id="M008321_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 560</span>
560:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_be_possible_to_destroy_a_record</span>
561:     [<span class="ruby-value str">'1'</span>, <span class="ruby-value">1</span>, <span class="ruby-value str">'true'</span>, <span class="ruby-keyword kw">true</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">true_variable</span><span class="ruby-operator">|</span>
562:       <span class="ruby-identifier">record</span> = <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Grace OMalley'</span>)
563:       <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">association_setter</span>,
564:         <span class="ruby-ivar">@alternate_params</span>[<span class="ruby-identifier">association_getter</span>].<span class="ruby-identifier">merge</span>(<span class="ruby-value str">'baz'</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">record</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value str">'_destroy'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">true_variable</span> })
565:       )
566: 
567:       <span class="ruby-identifier">assert_difference</span>(<span class="ruby-value str">'@pirate.send(@association_name).count'</span>, <span class="ruby-value">-1</span>) <span class="ruby-keyword kw">do</span>
568:         <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">save</span>
569:       <span class="ruby-keyword kw">end</span>
570:     <span class="ruby-keyword kw">end</span>
571:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008304" class="method">
  <div id="M008304_title" class="title">
    <b>test_should_define_an_attribute_writer_method_for_the_association</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008304_source')" id="l_M008304_source">show source</a> ]</p>
  <div id="M008304_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 421</span>
421:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_define_an_attribute_writer_method_for_the_association</span>
422:     <span class="ruby-identifier">assert_respond_to</span> <span class="ruby-ivar">@pirate</span>, <span class="ruby-identifier">association_setter</span>
423:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008316" class="method">
  <div id="M008316_title" class="title">
    <b>test_should_ignore_new_associated_records_if_a_reject_if_proc_returns_false</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008316_source')" id="l_M008316_source">show source</a> ]</p>
  <div id="M008316_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 520</span>
520:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_ignore_new_associated_records_if_a_reject_if_proc_returns_false</span>
521:     <span class="ruby-ivar">@alternate_params</span>[<span class="ruby-identifier">association_getter</span>][<span class="ruby-value str">'baz'</span>] = {}
522:     <span class="ruby-identifier">assert_no_difference</span>(<span class="ruby-value str">&quot;@pirate.send(@association_name).count&quot;</span>) <span class="ruby-keyword kw">do</span>
523:       <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">attributes</span> = <span class="ruby-ivar">@alternate_params</span>
524:     <span class="ruby-keyword kw">end</span>
525:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008315" class="method">
  <div id="M008315_title" class="title">
    <b>test_should_ignore_new_associated_records_with_truthy_destroy_attribute</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008315_source')" id="l_M008315_source">show source</a> ]</p>
  <div id="M008315_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 507</span>
507:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_ignore_new_associated_records_with_truthy_destroy_attribute</span>
508:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">destroy_all</span>
509:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">attributes</span> = {
510:       <span class="ruby-identifier">association_getter</span> =<span class="ruby-operator">&gt;</span> {
511:         <span class="ruby-value str">'foo'</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Grace OMalley'</span> },
512:         <span class="ruby-value str">'bar'</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Privateers Greed'</span>, <span class="ruby-value str">'_destroy'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'1'</span> }
513:       }
514:     }
515: 
516:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">length</span>
517:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Grace OMalley'</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">name</span>
518:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008314" class="method">
  <div id="M008314_title" class="title">
    <b>test_should_not_assign_destroy_key_to_a_record</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008314_source')" id="l_M008314_source">show source</a> ]</p>
  <div id="M008314_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 501</span>
501:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_not_assign_destroy_key_to_a_record</span>
502:     <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">UnknownAttributeError</span> <span class="ruby-keyword kw">do</span>
503:       <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">association_setter</span>, { <span class="ruby-value str">'foo'</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-value str">'_destroy'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'0'</span> }})
504:     <span class="ruby-keyword kw">end</span>
505:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008323" class="method">
  <div id="M008323_title" class="title">
    <b>test_should_not_destroy_the_associated_model_until_the_parent_is_saved</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008323_source')" id="l_M008323_source">show source</a> ]</p>
  <div id="M008323_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 582</span>
582:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_not_destroy_the_associated_model_until_the_parent_is_saved</span>
583:     <span class="ruby-identifier">assert_no_difference</span>(<span class="ruby-value str">'@pirate.send(@association_name).count'</span>) <span class="ruby-keyword kw">do</span>
584:       <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">association_setter</span>, <span class="ruby-ivar">@alternate_params</span>[<span class="ruby-identifier">association_getter</span>].<span class="ruby-identifier">merge</span>(<span class="ruby-value str">'baz'</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value str">'_destroy'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span> }))
585:     <span class="ruby-keyword kw">end</span>
586:     <span class="ruby-identifier">assert_difference</span>(<span class="ruby-value str">'@pirate.send(@association_name).count'</span>, <span class="ruby-value">-1</span>) { <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">save</span> }
587:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008322" class="method">
  <div id="M008322_title" class="title">
    <b>test_should_not_destroy_the_associated_model_with_a_non_truthy_argument</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008322_source')" id="l_M008322_source">show source</a> ]</p>
  <div id="M008322_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 573</span>
573:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_not_destroy_the_associated_model_with_a_non_truthy_argument</span>
574:     [<span class="ruby-keyword kw">nil</span>, <span class="ruby-value str">''</span>, <span class="ruby-value str">'0'</span>, <span class="ruby-value">0</span>, <span class="ruby-value str">'false'</span>, <span class="ruby-keyword kw">false</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">false_variable</span><span class="ruby-operator">|</span>
575:       <span class="ruby-ivar">@alternate_params</span>[<span class="ruby-identifier">association_getter</span>][<span class="ruby-value str">'foo'</span>][<span class="ruby-value str">'_destroy'</span>] = <span class="ruby-identifier">false_variable</span>
576:       <span class="ruby-identifier">assert_no_difference</span>(<span class="ruby-value str">'@pirate.send(@association_name).count'</span>) <span class="ruby-keyword kw">do</span>
577:         <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-ivar">@alternate_params</span>)
578:       <span class="ruby-keyword kw">end</span>
579:     <span class="ruby-keyword kw">end</span>
580:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008310" class="method">
  <div id="M008310_title" class="title">
    <b>test_should_not_load_association_when_updating_existing_records</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008310_source')" id="l_M008310_source">show source</a> ]</p>
  <div id="M008310_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 458</span>
458:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_not_load_association_when_updating_existing_records</span>
459:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">reload</span>
460:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">association_setter</span>, [{ <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Grace OMalley'</span> }])
461:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span> <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">loaded?</span>
462: 
463:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">save</span>
464:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span> <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">loaded?</span>
465:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Grace OMalley'</span>, <span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">name</span>
466:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008312" class="method">
  <div id="M008312_title" class="title">
    <b>test_should_raise_RecordNotFound_if_an_id_is_given_but_doesnt_return_a_record</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008312_source')" id="l_M008312_source">show source</a> ]</p>
  <div id="M008312_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 482</span>
482:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_raise_RecordNotFound_if_an_id_is_given_but_doesnt_return_a_record</span>
483:     <span class="ruby-identifier">assert_raise_with_message</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">RecordNotFound</span>, <span class="ruby-node">&quot;Couldn't find #{@child_1.class.name} with ID=1234567890 for Pirate with ID=#{@pirate.id}&quot;</span> <span class="ruby-keyword kw">do</span>
484:       <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">attributes</span> = { <span class="ruby-identifier">association_getter</span> =<span class="ruby-operator">&gt;</span> [{ <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1234567890</span> }] }
485:     <span class="ruby-keyword kw">end</span>
486:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008318" class="method">
  <div id="M008318_title" class="title">
    <b>test_should_raise_an_argument_error_if_something_else_than_a_hash_is_passed</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008318_source')" id="l_M008318_source">show source</a> ]</p>
  <div id="M008318_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 536</span>
536:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_raise_an_argument_error_if_something_else_than_a_hash_is_passed</span>
537:     <span class="ruby-identifier">assert_nothing_raised</span>(<span class="ruby-constant">ArgumentError</span>) { <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">association_setter</span>, {}) }
538:     <span class="ruby-identifier">assert_nothing_raised</span>(<span class="ruby-constant">ArgumentError</span>) { <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">association_setter</span>, <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">OrderedHash</span>.<span class="ruby-identifier">new</span>) }
539: 
540:     <span class="ruby-identifier">assert_raise_with_message</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">'Hash or Array expected, got String (&quot;foo&quot;)'</span> <span class="ruby-keyword kw">do</span>
541:       <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">association_setter</span>, <span class="ruby-value str">&quot;foo&quot;</span>)
542:     <span class="ruby-keyword kw">end</span>
543:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008305" class="method">
  <div id="M008305_title" class="title">
    <b>test_should_save_only_one_association_on_create</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008305_source')" id="l_M008305_source">show source</a> ]</p>
  <div id="M008305_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 425</span>
425:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_save_only_one_association_on_create</span>
426:     <span class="ruby-identifier">pirate</span> = <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">create!</span>({
427:       <span class="ruby-identifier">:catchphrase</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Arr'</span>,
428:       <span class="ruby-identifier">association_getter</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-value str">'foo'</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Grace OMalley'</span> } }
429:     })
430: 
431:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">count</span>
432:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008317" class="method">
  <div id="M008317_title" class="title">
    <b>test_should_sort_the_hash_by_the_keys_before_building_new_associated_models</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008317_source')" id="l_M008317_source">show source</a> ]</p>
  <div id="M008317_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 527</span>
527:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_sort_the_hash_by_the_keys_before_building_new_associated_models</span>
528:     <span class="ruby-identifier">attributes</span> = <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">OrderedHash</span>.<span class="ruby-identifier">new</span>
529:     <span class="ruby-identifier">attributes</span>[<span class="ruby-value str">'123726353'</span>] = { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Grace OMalley'</span> }
530:     <span class="ruby-identifier">attributes</span>[<span class="ruby-value str">'2'</span>] = { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Privateers Greed'</span> } <span class="ruby-comment cmt"># 2 is lower then 123726353</span>
531:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">association_setter</span>, <span class="ruby-identifier">attributes</span>)
532: 
533:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-value str">'Posideons Killer'</span>, <span class="ruby-value str">'Killer bandita Dionne'</span>, <span class="ruby-value str">'Privateers Greed'</span>, <span class="ruby-value str">'Grace OMalley'</span>].<span class="ruby-identifier">to_set</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:name</span>).<span class="ruby-identifier">to_set</span>
534:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008309" class="method">
  <div id="M008309_title" class="title">
    <b>test_should_take_a_hash_and_assign_the_attributes_to_the_associated_models</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008309_source')" id="l_M008309_source">show source</a> ]</p>
  <div id="M008309_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 452</span>
452:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_take_a_hash_and_assign_the_attributes_to_the_associated_models</span>
453:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">attributes</span> = <span class="ruby-ivar">@alternate_params</span>
454:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Grace OMalley'</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">name</span>
455:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Privateers Greed'</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">last</span>.<span class="ruby-identifier">name</span>
456:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008311" class="method">
  <div id="M008311_title" class="title">
    <b>test_should_take_a_hash_with_composite_id_keys_and_assign_the_attributes_to_the_associated_models</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008311_source')" id="l_M008311_source">show source</a> ]</p>
  <div id="M008311_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 468</span>
468:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_take_a_hash_with_composite_id_keys_and_assign_the_attributes_to_the_associated_models</span>
469:     <span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">stubs</span>(<span class="ruby-identifier">:id</span>).<span class="ruby-identifier">returns</span>(<span class="ruby-value str">'ABC1X'</span>)
470:     <span class="ruby-ivar">@child_2</span>.<span class="ruby-identifier">stubs</span>(<span class="ruby-identifier">:id</span>).<span class="ruby-identifier">returns</span>(<span class="ruby-value str">'ABC2X'</span>)
471: 
472:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">attributes</span> = {
473:       <span class="ruby-identifier">association_getter</span> =<span class="ruby-operator">&gt;</span> [
474:         { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Grace OMalley'</span> },
475:         { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@child_2</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Privateers Greed'</span> }
476:       ]
477:     }
478: 
479:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-value str">'Grace OMalley'</span>, <span class="ruby-value str">'Privateers Greed'</span>], [<span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">name</span>, <span class="ruby-ivar">@child_2</span>.<span class="ruby-identifier">name</span>]
480:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008306" class="method">
  <div id="M008306_title" class="title">
    <b>test_should_take_a_hash_with_string_keys_and_assign_the_attributes_to_the_associated_models</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008306_source')" id="l_M008306_source">show source</a> ]</p>
  <div id="M008306_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 434</span>
434:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_take_a_hash_with_string_keys_and_assign_the_attributes_to_the_associated_models</span>
435:     <span class="ruby-ivar">@alternate_params</span>[<span class="ruby-identifier">association_getter</span>].<span class="ruby-identifier">stringify_keys!</span>
436:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">update_attributes</span> <span class="ruby-ivar">@alternate_params</span>
437:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-value str">'Grace OMalley'</span>, <span class="ruby-value str">'Privateers Greed'</span>], [<span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">name</span>, <span class="ruby-ivar">@child_2</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">name</span>]
438:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008307" class="method">
  <div id="M008307_title" class="title">
    <b>test_should_take_an_array_and_assign_the_attributes_to_the_associated_models</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008307_source')" id="l_M008307_source">show source</a> ]</p>
  <div id="M008307_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 440</span>
440:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_take_an_array_and_assign_the_attributes_to_the_associated_models</span>
441:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">association_setter</span>, <span class="ruby-ivar">@alternate_params</span>[<span class="ruby-identifier">association_getter</span>].<span class="ruby-identifier">values</span>)
442:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">save</span>
443:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-value str">'Grace OMalley'</span>, <span class="ruby-value str">'Privateers Greed'</span>], [<span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">name</span>, <span class="ruby-ivar">@child_2</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">name</span>]
444:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008320" class="method">
  <div id="M008320_title" class="title">
    <b>test_should_update_existing_records_and_add_new_ones_that_have_no_id</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008320_source')" id="l_M008320_source">show source</a> ]</p>
  <div id="M008320_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 552</span>
552:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_update_existing_records_and_add_new_ones_that_have_no_id</span>
553:     <span class="ruby-ivar">@alternate_params</span>[<span class="ruby-identifier">association_getter</span>][<span class="ruby-value str">'baz'</span>] = { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Buccaneers Servant'</span> }
554:     <span class="ruby-identifier">assert_difference</span>(<span class="ruby-value str">'@pirate.send(@association_name).count'</span>, <span class="ruby-value">+1</span>) <span class="ruby-keyword kw">do</span>
555:       <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">update_attributes</span> <span class="ruby-ivar">@alternate_params</span>
556:     <span class="ruby-keyword kw">end</span>
557:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-value str">'Grace OMalley'</span>, <span class="ruby-value str">'Privateers Greed'</span>, <span class="ruby-value str">'Buccaneers Servant'</span>].<span class="ruby-identifier">to_set</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:name</span>).<span class="ruby-identifier">to_set</span>
558:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008319" class="method">
  <div id="M008319_title" class="title">
    <b>test_should_work_with_update_attributes_as_well</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008319_source')" id="l_M008319_source">show source</a> ]</p>
  <div id="M008319_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 545</span>
545:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_work_with_update_attributes_as_well</span>
546:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">:catchphrase</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Arr'</span>,
547:       <span class="ruby-identifier">association_getter</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-value str">'foo'</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Grace OMalley'</span> }})
548: 
549:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Grace OMalley'</span>, <span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">name</span>
550:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008326" class="method">
  <div id="M008326_title" class="title">
    <b>test_validate_presence_of_parent_fails_without_inverse_of</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008326_source')" id="l_M008326_source">show source</a> ]</p>
  <div id="M008326_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 610</span>
610:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_validate_presence_of_parent_fails_without_inverse_of</span>
611:     <span class="ruby-constant">Man</span>.<span class="ruby-identifier">accepts_nested_attributes_for</span>(<span class="ruby-identifier">:interests</span>)
612:     <span class="ruby-constant">Man</span>.<span class="ruby-identifier">reflect_on_association</span>(<span class="ruby-identifier">:interests</span>).<span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:inverse_of</span>)
613:     <span class="ruby-constant">Interest</span>.<span class="ruby-identifier">reflect_on_association</span>(<span class="ruby-identifier">:man</span>).<span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:inverse_of</span>)
614: 
615:     <span class="ruby-identifier">repair_validations</span>(<span class="ruby-constant">Interest</span>) <span class="ruby-keyword kw">do</span>
616:       <span class="ruby-constant">Interest</span>.<span class="ruby-identifier">validates_presence_of</span>(<span class="ruby-identifier">:man</span>)
617:       <span class="ruby-identifier">assert_no_difference</span> [<span class="ruby-value str">'Man.count'</span>, <span class="ruby-value str">'Interest.count'</span>] <span class="ruby-keyword kw">do</span>
618:         <span class="ruby-identifier">man</span> = <span class="ruby-constant">Man</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'John'</span>,
619:                          <span class="ruby-identifier">:interests_attributes</span> =<span class="ruby-operator">&gt;</span> [{<span class="ruby-identifier">:topic=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'Cars'</span>}, {<span class="ruby-identifier">:topic=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'Sports'</span>}])
620:         <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">man</span>.<span class="ruby-identifier">errors</span>[<span class="ruby-value str">'interests.man'</span><span class="ruby-value str">'interests.man'</span>].<span class="ruby-identifier">empty?</span>
621:       <span class="ruby-keyword kw">end</span>
622:     <span class="ruby-keyword kw">end</span>
623:     <span class="ruby-comment cmt"># restore :inverse_of</span>
624:     <span class="ruby-constant">Man</span>.<span class="ruby-identifier">reflect_on_association</span>(<span class="ruby-identifier">:interests</span>).<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:inverse_of</span>] = <span class="ruby-identifier">:man</span>
625:     <span class="ruby-constant">Interest</span>.<span class="ruby-identifier">reflect_on_association</span>(<span class="ruby-identifier">:man</span>).<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:inverse_of</span>] = <span class="ruby-identifier">:interests</span>
626:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008325" class="method">
  <div id="M008325_title" class="title">
    <b>test_validate_presence_of_parent_works_with_inverse_of</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008325_source')" id="l_M008325_source">show source</a> ]</p>
  <div id="M008325_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 593</span>
593:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_validate_presence_of_parent_works_with_inverse_of</span>
594:     <span class="ruby-constant">Man</span>.<span class="ruby-identifier">accepts_nested_attributes_for</span>(<span class="ruby-identifier">:interests</span>)
595:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">:man</span>, <span class="ruby-constant">Man</span>.<span class="ruby-identifier">reflect_on_association</span>(<span class="ruby-identifier">:interests</span>).<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:inverse_of</span>]
596:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">:interests</span>, <span class="ruby-constant">Interest</span>.<span class="ruby-identifier">reflect_on_association</span>(<span class="ruby-identifier">:man</span>).<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:inverse_of</span>]
597: 
598:     <span class="ruby-identifier">repair_validations</span>(<span class="ruby-constant">Interest</span>) <span class="ruby-keyword kw">do</span>
599:       <span class="ruby-constant">Interest</span>.<span class="ruby-identifier">validates_presence_of</span>(<span class="ruby-identifier">:man</span>)
600:       <span class="ruby-identifier">assert_difference</span> <span class="ruby-value str">'Man.count'</span> <span class="ruby-keyword kw">do</span>
601:         <span class="ruby-identifier">assert_difference</span> <span class="ruby-value str">'Interest.count'</span>, <span class="ruby-value">2</span> <span class="ruby-keyword kw">do</span>
602:           <span class="ruby-identifier">man</span> = <span class="ruby-constant">Man</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'John'</span>,
603:                             <span class="ruby-identifier">:interests_attributes</span> =<span class="ruby-operator">&gt;</span> [{<span class="ruby-identifier">:topic=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'Cars'</span>}, {<span class="ruby-identifier">:topic=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'Sports'</span>}])
604:           <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">man</span>.<span class="ruby-identifier">interests</span>.<span class="ruby-identifier">count</span>
605:         <span class="ruby-keyword kw">end</span>
606:       <span class="ruby-keyword kw">end</span>
607:     <span class="ruby-keyword kw">end</span>
608:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>