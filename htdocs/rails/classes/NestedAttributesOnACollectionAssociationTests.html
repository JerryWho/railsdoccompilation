  <div id="C00001379">
<div class='banner'>
  <span class="file-title-prefix">Module</span><br />NestedAttributesOnACollectionAssociationTests<br/>
  In:
<a href="#" onclick="jsHref('files/activerecord/test/cases/nested_attributes_test_rb.html');">activerecord/test/cases/nested_attributes_test.rb</a>

</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">




  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M008300&name=test_should_also_work_with_a_HashWithIndifferentAccess" >test_should_also_work_with_a_HashWithIndifferentAccess</a></li>
  <li><a href="index.html?a=M008303&name=test_should_automatically_build_new_associated_models_for_each_entry_in_a_hash_where_the_id_is_missing" >test_should_automatically_build_new_associated_models_for_each_entry_in_a_hash_where_the_id_is_missing</a></li>
  <li><a href="index.html?a=M008314&name=test_should_automatically_enable_autosave_on_the_association" >test_should_automatically_enable_autosave_on_the_association</a></li>
  <li><a href="index.html?a=M008311&name=test_should_be_possible_to_destroy_a_record" >test_should_be_possible_to_destroy_a_record</a></li>
  <li><a href="index.html?a=M008297&name=test_should_define_an_attribute_writer_method_for_the_association" >test_should_define_an_attribute_writer_method_for_the_association</a></li>
  <li><a href="index.html?a=M008306&name=test_should_ignore_new_associated_records_if_a_reject_if_proc_returns_false" >test_should_ignore_new_associated_records_if_a_reject_if_proc_returns_false</a></li>
  <li><a href="index.html?a=M008305&name=test_should_ignore_new_associated_records_with_truthy_destroy_attribute" >test_should_ignore_new_associated_records_with_truthy_destroy_attribute</a></li>
  <li><a href="index.html?a=M008304&name=test_should_not_assign_destroy_key_to_a_record" >test_should_not_assign_destroy_key_to_a_record</a></li>
  <li><a href="index.html?a=M008313&name=test_should_not_destroy_the_associated_model_until_the_parent_is_saved" >test_should_not_destroy_the_associated_model_until_the_parent_is_saved</a></li>
  <li><a href="index.html?a=M008312&name=test_should_not_destroy_the_associated_model_with_a_non_truthy_argument" >test_should_not_destroy_the_associated_model_with_a_non_truthy_argument</a></li>
  <li><a href="index.html?a=M008308&name=test_should_raise_an_argument_error_if_something_else_than_a_hash_is_passed" >test_should_raise_an_argument_error_if_something_else_than_a_hash_is_passed</a></li>
  <li><a href="index.html?a=M008307&name=test_should_sort_the_hash_by_the_keys_before_building_new_associated_models" >test_should_sort_the_hash_by_the_keys_before_building_new_associated_models</a></li>
  <li><a href="index.html?a=M008301&name=test_should_take_a_hash_and_assign_the_attributes_to_the_associated_models" >test_should_take_a_hash_and_assign_the_attributes_to_the_associated_models</a></li>
  <li><a href="index.html?a=M008302&name=test_should_take_a_hash_with_composite_id_keys_and_assign_the_attributes_to_the_associated_models" >test_should_take_a_hash_with_composite_id_keys_and_assign_the_attributes_to_the_associated_models</a></li>
  <li><a href="index.html?a=M008298&name=test_should_take_a_hash_with_string_keys_and_assign_the_attributes_to_the_associated_models" >test_should_take_a_hash_with_string_keys_and_assign_the_attributes_to_the_associated_models</a></li>
  <li><a href="index.html?a=M008299&name=test_should_take_an_array_and_assign_the_attributes_to_the_associated_models" >test_should_take_an_array_and_assign_the_attributes_to_the_associated_models</a></li>
  <li><a href="index.html?a=M008310&name=test_should_update_existing_records_and_add_new_ones_that_have_no_id" >test_should_update_existing_records_and_add_new_ones_that_have_no_id</a></li>
  <li><a href="index.html?a=M008309&name=test_should_work_with_update_attributes_as_well" >test_should_work_with_update_attributes_as_well</a></li>
  </ul>

<div class="sectiontitle">Included Modules</div>
<ul>
  <li><a href="#" onclick="jsHref('classes/AssertRaiseWithMessage.html');">AssertRaiseWithMessage</a></li>
</ul>





<div class="sectiontitle">Public Instance methods</div>
<div id="M008300" class="method">
  <div id="M008300_title" class="title">
    <b>test_should_also_work_with_a_HashWithIndifferentAccess</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008300_source')" id="l_M008300_source">show source</a> ]</p>
  <div id="M008300_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 367</span>
367:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_also_work_with_a_HashWithIndifferentAccess</span>
368:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">association_setter</span>, <span class="ruby-constant">HashWithIndifferentAccess</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'foo'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">HashWithIndifferentAccess</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Grace OMalley'</span>)))
369:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">save</span>
370:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Grace OMalley'</span>, <span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">name</span>
371:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008303" class="method">
  <div id="M008303_title" class="title">
    <b>test_should_automatically_build_new_associated_models_for_each_entry_in_a_hash_where_the_id_is_missing</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008303_source')" id="l_M008303_source">show source</a> ]</p>
  <div id="M008303_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 393</span>
393:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_automatically_build_new_associated_models_for_each_entry_in_a_hash_where_the_id_is_missing</span>
394:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">destroy_all</span>
395:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">attributes</span> = {
396:       <span class="ruby-identifier">association_getter</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-value str">'foo'</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Grace OMalley'</span> }, <span class="ruby-value str">'bar'</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Privateers Greed'</span> }}
397:     }
398: 
399:     <span class="ruby-identifier">assert</span> <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">new_record?</span>
400:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Grace OMalley'</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">name</span>
401: 
402:     <span class="ruby-identifier">assert</span> <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">last</span>.<span class="ruby-identifier">new_record?</span>
403:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Privateers Greed'</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">last</span>.<span class="ruby-identifier">name</span>
404:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008314" class="method">
  <div id="M008314_title" class="title">
    <b>test_should_automatically_enable_autosave_on_the_association</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008314_source')" id="l_M008314_source">show source</a> ]</p>
  <div id="M008314_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 494</span>
494:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_automatically_enable_autosave_on_the_association</span>
495:     <span class="ruby-identifier">assert</span> <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">reflect_on_association</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:autosave</span>]
496:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008311" class="method">
  <div id="M008311_title" class="title">
    <b>test_should_be_possible_to_destroy_a_record</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008311_source')" id="l_M008311_source">show source</a> ]</p>
  <div id="M008311_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 465</span>
465:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_be_possible_to_destroy_a_record</span>
466:     [<span class="ruby-value str">'1'</span>, <span class="ruby-value">1</span>, <span class="ruby-value str">'true'</span>, <span class="ruby-keyword kw">true</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">true_variable</span><span class="ruby-operator">|</span>
467:       <span class="ruby-identifier">record</span> = <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Grace OMalley'</span>)
468:       <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">association_setter</span>,
469:         <span class="ruby-ivar">@alternate_params</span>[<span class="ruby-identifier">association_getter</span>].<span class="ruby-identifier">merge</span>(<span class="ruby-value str">'baz'</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">record</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value str">'_destroy'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">true_variable</span> })
470:       )
471: 
472:       <span class="ruby-identifier">assert_difference</span>(<span class="ruby-value str">'@pirate.send(@association_name).count'</span>, <span class="ruby-value">-1</span>) <span class="ruby-keyword kw">do</span>
473:         <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">save</span>
474:       <span class="ruby-keyword kw">end</span>
475:     <span class="ruby-keyword kw">end</span>
476:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008297" class="method">
  <div id="M008297_title" class="title">
    <b>test_should_define_an_attribute_writer_method_for_the_association</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008297_source')" id="l_M008297_source">show source</a> ]</p>
  <div id="M008297_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 351</span>
351:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_define_an_attribute_writer_method_for_the_association</span>
352:     <span class="ruby-identifier">assert_respond_to</span> <span class="ruby-ivar">@pirate</span>, <span class="ruby-identifier">association_setter</span>
353:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008306" class="method">
  <div id="M008306_title" class="title">
    <b>test_should_ignore_new_associated_records_if_a_reject_if_proc_returns_false</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008306_source')" id="l_M008306_source">show source</a> ]</p>
  <div id="M008306_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 425</span>
425:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_ignore_new_associated_records_if_a_reject_if_proc_returns_false</span>
426:     <span class="ruby-ivar">@alternate_params</span>[<span class="ruby-identifier">association_getter</span>][<span class="ruby-value str">'baz'</span>] = {}
427:     <span class="ruby-identifier">assert_no_difference</span>(<span class="ruby-value str">&quot;@pirate.send(@association_name).length&quot;</span>) <span class="ruby-keyword kw">do</span>
428:       <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">attributes</span> = <span class="ruby-ivar">@alternate_params</span>
429:     <span class="ruby-keyword kw">end</span>
430:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008305" class="method">
  <div id="M008305_title" class="title">
    <b>test_should_ignore_new_associated_records_with_truthy_destroy_attribute</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008305_source')" id="l_M008305_source">show source</a> ]</p>
  <div id="M008305_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 412</span>
412:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_ignore_new_associated_records_with_truthy_destroy_attribute</span>
413:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">destroy_all</span>
414:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">attributes</span> = {
415:       <span class="ruby-identifier">association_getter</span> =<span class="ruby-operator">&gt;</span> {
416:         <span class="ruby-value str">'foo'</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Grace OMalley'</span> },
417:         <span class="ruby-value str">'bar'</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Privateers Greed'</span>, <span class="ruby-value str">'_destroy'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'1'</span> }
418:       }
419:     }
420: 
421:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">length</span>
422:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Grace OMalley'</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">name</span>
423:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008304" class="method">
  <div id="M008304_title" class="title">
    <b>test_should_not_assign_destroy_key_to_a_record</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008304_source')" id="l_M008304_source">show source</a> ]</p>
  <div id="M008304_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 406</span>
406:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_not_assign_destroy_key_to_a_record</span>
407:     <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">UnknownAttributeError</span> <span class="ruby-keyword kw">do</span>
408:       <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">association_setter</span>, { <span class="ruby-value str">'foo'</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-value str">'_destroy'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'0'</span> }})
409:     <span class="ruby-keyword kw">end</span>
410:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008313" class="method">
  <div id="M008313_title" class="title">
    <b>test_should_not_destroy_the_associated_model_until_the_parent_is_saved</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008313_source')" id="l_M008313_source">show source</a> ]</p>
  <div id="M008313_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 487</span>
487:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_not_destroy_the_associated_model_until_the_parent_is_saved</span>
488:     <span class="ruby-identifier">assert_no_difference</span>(<span class="ruby-value str">'@pirate.send(@association_name).count'</span>) <span class="ruby-keyword kw">do</span>
489:       <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">association_setter</span>, <span class="ruby-ivar">@alternate_params</span>[<span class="ruby-identifier">association_getter</span>].<span class="ruby-identifier">merge</span>(<span class="ruby-value str">'baz'</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value str">'_destroy'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span> }))
490:     <span class="ruby-keyword kw">end</span>
491:     <span class="ruby-identifier">assert_difference</span>(<span class="ruby-value str">'@pirate.send(@association_name).count'</span>, <span class="ruby-value">-1</span>) { <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">save</span> }
492:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008312" class="method">
  <div id="M008312_title" class="title">
    <b>test_should_not_destroy_the_associated_model_with_a_non_truthy_argument</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008312_source')" id="l_M008312_source">show source</a> ]</p>
  <div id="M008312_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 478</span>
478:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_not_destroy_the_associated_model_with_a_non_truthy_argument</span>
479:     [<span class="ruby-keyword kw">nil</span>, <span class="ruby-value str">''</span>, <span class="ruby-value str">'0'</span>, <span class="ruby-value">0</span>, <span class="ruby-value str">'false'</span>, <span class="ruby-keyword kw">false</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">false_variable</span><span class="ruby-operator">|</span>
480:       <span class="ruby-ivar">@alternate_params</span>[<span class="ruby-identifier">association_getter</span>][<span class="ruby-value str">'foo'</span>][<span class="ruby-value str">'_destroy'</span>] = <span class="ruby-identifier">false_variable</span>
481:       <span class="ruby-identifier">assert_no_difference</span>(<span class="ruby-value str">'@pirate.send(@association_name).count'</span>) <span class="ruby-keyword kw">do</span>
482:         <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-ivar">@alternate_params</span>)
483:       <span class="ruby-keyword kw">end</span>
484:     <span class="ruby-keyword kw">end</span>
485:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008308" class="method">
  <div id="M008308_title" class="title">
    <b>test_should_raise_an_argument_error_if_something_else_than_a_hash_is_passed</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008308_source')" id="l_M008308_source">show source</a> ]</p>
  <div id="M008308_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 441</span>
441:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_raise_an_argument_error_if_something_else_than_a_hash_is_passed</span>
442:     <span class="ruby-identifier">assert_nothing_raised</span>(<span class="ruby-constant">ArgumentError</span>) { <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">association_setter</span>, {}) }
443:     <span class="ruby-identifier">assert_nothing_raised</span>(<span class="ruby-constant">ArgumentError</span>) { <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">association_setter</span>, <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">OrderedHash</span>.<span class="ruby-identifier">new</span>) }
444: 
445:     <span class="ruby-identifier">assert_raise_with_message</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">'Hash or Array expected, got String (&quot;foo&quot;)'</span> <span class="ruby-keyword kw">do</span>
446:       <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">association_setter</span>, <span class="ruby-value str">&quot;foo&quot;</span>)
447:     <span class="ruby-keyword kw">end</span>
448:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008307" class="method">
  <div id="M008307_title" class="title">
    <b>test_should_sort_the_hash_by_the_keys_before_building_new_associated_models</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008307_source')" id="l_M008307_source">show source</a> ]</p>
  <div id="M008307_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 432</span>
432:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_sort_the_hash_by_the_keys_before_building_new_associated_models</span>
433:     <span class="ruby-identifier">attributes</span> = <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">OrderedHash</span>.<span class="ruby-identifier">new</span>
434:     <span class="ruby-identifier">attributes</span>[<span class="ruby-value str">'123726353'</span>] = { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Grace OMalley'</span> }
435:     <span class="ruby-identifier">attributes</span>[<span class="ruby-value str">'2'</span>] = { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Privateers Greed'</span> } <span class="ruby-comment cmt"># 2 is lower then 123726353</span>
436:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">association_setter</span>, <span class="ruby-identifier">attributes</span>)
437: 
438:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-value str">'Posideons Killer'</span>, <span class="ruby-value str">'Killer bandita Dionne'</span>, <span class="ruby-value str">'Privateers Greed'</span>, <span class="ruby-value str">'Grace OMalley'</span>].<span class="ruby-identifier">to_set</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:name</span>).<span class="ruby-identifier">to_set</span>
439:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008301" class="method">
  <div id="M008301_title" class="title">
    <b>test_should_take_a_hash_and_assign_the_attributes_to_the_associated_models</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008301_source')" id="l_M008301_source">show source</a> ]</p>
  <div id="M008301_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 373</span>
373:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_take_a_hash_and_assign_the_attributes_to_the_associated_models</span>
374:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">attributes</span> = <span class="ruby-ivar">@alternate_params</span>
375:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Grace OMalley'</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">name</span>
376:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Privateers Greed'</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">last</span>.<span class="ruby-identifier">name</span>
377:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008302" class="method">
  <div id="M008302_title" class="title">
    <b>test_should_take_a_hash_with_composite_id_keys_and_assign_the_attributes_to_the_associated_models</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008302_source')" id="l_M008302_source">show source</a> ]</p>
  <div id="M008302_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 379</span>
379:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_take_a_hash_with_composite_id_keys_and_assign_the_attributes_to_the_associated_models</span>
380:     <span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">stubs</span>(<span class="ruby-identifier">:id</span>).<span class="ruby-identifier">returns</span>(<span class="ruby-value str">'ABC1X'</span>)
381:     <span class="ruby-ivar">@child_2</span>.<span class="ruby-identifier">stubs</span>(<span class="ruby-identifier">:id</span>).<span class="ruby-identifier">returns</span>(<span class="ruby-value str">'ABC2X'</span>)
382: 
383:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">attributes</span> = {
384:       <span class="ruby-identifier">association_getter</span> =<span class="ruby-operator">&gt;</span> [
385:         { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Grace OMalley'</span> },
386:         { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@child_2</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Privateers Greed'</span> }
387:       ]
388:     }
389: 
390:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-value str">'Grace OMalley'</span>, <span class="ruby-value str">'Privateers Greed'</span>], [<span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">name</span>, <span class="ruby-ivar">@child_2</span>.<span class="ruby-identifier">name</span>]
391:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008298" class="method">
  <div id="M008298_title" class="title">
    <b>test_should_take_a_hash_with_string_keys_and_assign_the_attributes_to_the_associated_models</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008298_source')" id="l_M008298_source">show source</a> ]</p>
  <div id="M008298_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 355</span>
355:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_take_a_hash_with_string_keys_and_assign_the_attributes_to_the_associated_models</span>
356:     <span class="ruby-ivar">@alternate_params</span>[<span class="ruby-identifier">association_getter</span>].<span class="ruby-identifier">stringify_keys!</span>
357:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">update_attributes</span> <span class="ruby-ivar">@alternate_params</span>
358:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-value str">'Grace OMalley'</span>, <span class="ruby-value str">'Privateers Greed'</span>], [<span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">name</span>, <span class="ruby-ivar">@child_2</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">name</span>]
359:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008299" class="method">
  <div id="M008299_title" class="title">
    <b>test_should_take_an_array_and_assign_the_attributes_to_the_associated_models</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008299_source')" id="l_M008299_source">show source</a> ]</p>
  <div id="M008299_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 361</span>
361:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_take_an_array_and_assign_the_attributes_to_the_associated_models</span>
362:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">association_setter</span>, <span class="ruby-ivar">@alternate_params</span>[<span class="ruby-identifier">association_getter</span>].<span class="ruby-identifier">values</span>)
363:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">save</span>
364:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-value str">'Grace OMalley'</span>, <span class="ruby-value str">'Privateers Greed'</span>], [<span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">name</span>, <span class="ruby-ivar">@child_2</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">name</span>]
365:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008310" class="method">
  <div id="M008310_title" class="title">
    <b>test_should_update_existing_records_and_add_new_ones_that_have_no_id</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008310_source')" id="l_M008310_source">show source</a> ]</p>
  <div id="M008310_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 457</span>
457:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_update_existing_records_and_add_new_ones_that_have_no_id</span>
458:     <span class="ruby-ivar">@alternate_params</span>[<span class="ruby-identifier">association_getter</span>][<span class="ruby-value str">'baz'</span>] = { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Buccaneers Servant'</span> }
459:     <span class="ruby-identifier">assert_difference</span>(<span class="ruby-value str">'@pirate.send(@association_name).count'</span>, <span class="ruby-value">+1</span>) <span class="ruby-keyword kw">do</span>
460:       <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">update_attributes</span> <span class="ruby-ivar">@alternate_params</span>
461:     <span class="ruby-keyword kw">end</span>
462:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-value str">'Grace OMalley'</span>, <span class="ruby-value str">'Privateers Greed'</span>, <span class="ruby-value str">'Buccaneers Servant'</span>].<span class="ruby-identifier">to_set</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:name</span>).<span class="ruby-identifier">to_set</span>
463:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008309" class="method">
  <div id="M008309_title" class="title">
    <b>test_should_work_with_update_attributes_as_well</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008309_source')" id="l_M008309_source">show source</a> ]</p>
  <div id="M008309_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 450</span>
450:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_work_with_update_attributes_as_well</span>
451:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">:catchphrase</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Arr'</span>,
452:       <span class="ruby-identifier">association_getter</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-value str">'foo'</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Grace OMalley'</span> }})
453: 
454:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Grace OMalley'</span>, <span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">name</span>
455:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>