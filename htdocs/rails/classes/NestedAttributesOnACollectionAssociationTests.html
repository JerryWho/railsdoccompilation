  <div id="C00001350">
<div class='banner'>
  <span class="file-title-prefix">Module</span><br />NestedAttributesOnACollectionAssociationTests<br/>
  In:
<a href="#" onclick="jsHref('files/activerecord/test/cases/nested_attributes_test_rb.html');">activerecord/test/cases/nested_attributes_test.rb</a>

</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">




  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M008216&name=test_should_also_work_with_a_HashWithIndifferentAccess" >test_should_also_work_with_a_HashWithIndifferentAccess</a></li>
  <li><a href="index.html?a=M008219&name=test_should_automatically_build_new_associated_models_for_each_entry_in_a_hash_where_the_id_is_missing" >test_should_automatically_build_new_associated_models_for_each_entry_in_a_hash_where_the_id_is_missing</a></li>
  <li><a href="index.html?a=M008230&name=test_should_automatically_enable_autosave_on_the_association" >test_should_automatically_enable_autosave_on_the_association</a></li>
  <li><a href="index.html?a=M008227&name=test_should_be_possible_to_destroy_a_record" >test_should_be_possible_to_destroy_a_record</a></li>
  <li><a href="index.html?a=M008213&name=test_should_define_an_attribute_writer_method_for_the_association" >test_should_define_an_attribute_writer_method_for_the_association</a></li>
  <li><a href="index.html?a=M008222&name=test_should_ignore_new_associated_records_if_a_reject_if_proc_returns_false" >test_should_ignore_new_associated_records_if_a_reject_if_proc_returns_false</a></li>
  <li><a href="index.html?a=M008221&name=test_should_ignore_new_associated_records_with_truthy_delete_attribute" >test_should_ignore_new_associated_records_with_truthy_delete_attribute</a></li>
  <li><a href="index.html?a=M008220&name=test_should_not_assign_delete_key_to_a_record" >test_should_not_assign_delete_key_to_a_record</a></li>
  <li><a href="index.html?a=M008229&name=test_should_not_destroy_the_associated_model_until_the_parent_is_saved" >test_should_not_destroy_the_associated_model_until_the_parent_is_saved</a></li>
  <li><a href="index.html?a=M008228&name=test_should_not_destroy_the_associated_model_with_a_non_truthy_argument" >test_should_not_destroy_the_associated_model_with_a_non_truthy_argument</a></li>
  <li><a href="index.html?a=M008224&name=test_should_raise_an_argument_error_if_something_else_than_a_hash_is_passed" >test_should_raise_an_argument_error_if_something_else_than_a_hash_is_passed</a></li>
  <li><a href="index.html?a=M008223&name=test_should_sort_the_hash_by_the_keys_before_building_new_associated_models" >test_should_sort_the_hash_by_the_keys_before_building_new_associated_models</a></li>
  <li><a href="index.html?a=M008217&name=test_should_take_a_hash_and_assign_the_attributes_to_the_associated_models" >test_should_take_a_hash_and_assign_the_attributes_to_the_associated_models</a></li>
  <li><a href="index.html?a=M008218&name=test_should_take_a_hash_with_composite_id_keys_and_assign_the_attributes_to_the_associated_models" >test_should_take_a_hash_with_composite_id_keys_and_assign_the_attributes_to_the_associated_models</a></li>
  <li><a href="index.html?a=M008214&name=test_should_take_a_hash_with_string_keys_and_assign_the_attributes_to_the_associated_models" >test_should_take_a_hash_with_string_keys_and_assign_the_attributes_to_the_associated_models</a></li>
  <li><a href="index.html?a=M008215&name=test_should_take_an_array_and_assign_the_attributes_to_the_associated_models" >test_should_take_an_array_and_assign_the_attributes_to_the_associated_models</a></li>
  <li><a href="index.html?a=M008226&name=test_should_update_existing_records_and_add_new_ones_that_have_no_id" >test_should_update_existing_records_and_add_new_ones_that_have_no_id</a></li>
  <li><a href="index.html?a=M008225&name=test_should_work_with_update_attributes_as_well" >test_should_work_with_update_attributes_as_well</a></li>
  </ul>

<div class="sectiontitle">Included Modules</div>
<ul>
  <li><a href="#" onclick="jsHref('classes/AssertRaiseWithMessage.html');">AssertRaiseWithMessage</a></li>
</ul>





<div class="sectiontitle">Public Instance methods</div>
<div id="M008216" class="method">
  <div id="M008216_title" class="title">
    <b>test_should_also_work_with_a_HashWithIndifferentAccess</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008216_source')" id="l_M008216_source">show source</a> ]</p>
  <div id="M008216_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 325</span>
325:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_also_work_with_a_HashWithIndifferentAccess</span>
326:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">association_setter</span>, <span class="ruby-constant">HashWithIndifferentAccess</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'foo'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">HashWithIndifferentAccess</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Grace OMalley'</span>)))
327:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">save</span>
328:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Grace OMalley'</span>, <span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">name</span>
329:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008219" class="method">
  <div id="M008219_title" class="title">
    <b>test_should_automatically_build_new_associated_models_for_each_entry_in_a_hash_where_the_id_is_missing</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008219_source')" id="l_M008219_source">show source</a> ]</p>
  <div id="M008219_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 351</span>
351:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_automatically_build_new_associated_models_for_each_entry_in_a_hash_where_the_id_is_missing</span>
352:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">destroy_all</span>
353:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">attributes</span> = {
354:       <span class="ruby-identifier">association_getter</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-value str">'foo'</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Grace OMalley'</span> }, <span class="ruby-value str">'bar'</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Privateers Greed'</span> }}
355:     }
356: 
357:     <span class="ruby-identifier">assert</span> <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">new_record?</span>
358:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Grace OMalley'</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">name</span>
359: 
360:     <span class="ruby-identifier">assert</span> <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">last</span>.<span class="ruby-identifier">new_record?</span>
361:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Privateers Greed'</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">last</span>.<span class="ruby-identifier">name</span>
362:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008230" class="method">
  <div id="M008230_title" class="title">
    <b>test_should_automatically_enable_autosave_on_the_association</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008230_source')" id="l_M008230_source">show source</a> ]</p>
  <div id="M008230_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 452</span>
452:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_automatically_enable_autosave_on_the_association</span>
453:     <span class="ruby-identifier">assert</span> <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">reflect_on_association</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:autosave</span>]
454:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008227" class="method">
  <div id="M008227_title" class="title">
    <b>test_should_be_possible_to_destroy_a_record</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008227_source')" id="l_M008227_source">show source</a> ]</p>
  <div id="M008227_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 423</span>
423:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_be_possible_to_destroy_a_record</span>
424:     [<span class="ruby-value str">'1'</span>, <span class="ruby-value">1</span>, <span class="ruby-value str">'true'</span>, <span class="ruby-keyword kw">true</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">true_variable</span><span class="ruby-operator">|</span>
425:       <span class="ruby-identifier">record</span> = <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Grace OMalley'</span>)
426:       <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">association_setter</span>,
427:         <span class="ruby-ivar">@alternate_params</span>[<span class="ruby-identifier">association_getter</span>].<span class="ruby-identifier">merge</span>(<span class="ruby-value str">'baz'</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">record</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value str">'_delete'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">true_variable</span> })
428:       )
429: 
430:       <span class="ruby-identifier">assert_difference</span>(<span class="ruby-value str">'@pirate.send(@association_name).count'</span>, <span class="ruby-value">-1</span>) <span class="ruby-keyword kw">do</span>
431:         <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">save</span>
432:       <span class="ruby-keyword kw">end</span>
433:     <span class="ruby-keyword kw">end</span>
434:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008213" class="method">
  <div id="M008213_title" class="title">
    <b>test_should_define_an_attribute_writer_method_for_the_association</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008213_source')" id="l_M008213_source">show source</a> ]</p>
  <div id="M008213_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 309</span>
309:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_define_an_attribute_writer_method_for_the_association</span>
310:     <span class="ruby-identifier">assert_respond_to</span> <span class="ruby-ivar">@pirate</span>, <span class="ruby-identifier">association_setter</span>
311:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008222" class="method">
  <div id="M008222_title" class="title">
    <b>test_should_ignore_new_associated_records_if_a_reject_if_proc_returns_false</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008222_source')" id="l_M008222_source">show source</a> ]</p>
  <div id="M008222_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 383</span>
383:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_ignore_new_associated_records_if_a_reject_if_proc_returns_false</span>
384:     <span class="ruby-ivar">@alternate_params</span>[<span class="ruby-identifier">association_getter</span>][<span class="ruby-value str">'baz'</span>] = {}
385:     <span class="ruby-identifier">assert_no_difference</span>(<span class="ruby-value str">&quot;@pirate.send(@association_name).length&quot;</span>) <span class="ruby-keyword kw">do</span>
386:       <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">attributes</span> = <span class="ruby-ivar">@alternate_params</span>
387:     <span class="ruby-keyword kw">end</span>
388:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008221" class="method">
  <div id="M008221_title" class="title">
    <b>test_should_ignore_new_associated_records_with_truthy_delete_attribute</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008221_source')" id="l_M008221_source">show source</a> ]</p>
  <div id="M008221_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 370</span>
370:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_ignore_new_associated_records_with_truthy_delete_attribute</span>
371:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">destroy_all</span>
372:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">attributes</span> = {
373:       <span class="ruby-identifier">association_getter</span> =<span class="ruby-operator">&gt;</span> {
374:         <span class="ruby-value str">'foo'</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Grace OMalley'</span> },
375:         <span class="ruby-value str">'bar'</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Privateers Greed'</span>, <span class="ruby-value str">'_delete'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'1'</span> }
376:       }
377:     }
378: 
379:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">length</span>
380:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Grace OMalley'</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">name</span>
381:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008220" class="method">
  <div id="M008220_title" class="title">
    <b>test_should_not_assign_delete_key_to_a_record</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008220_source')" id="l_M008220_source">show source</a> ]</p>
  <div id="M008220_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 364</span>
364:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_not_assign_delete_key_to_a_record</span>
365:     <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">UnknownAttributeError</span> <span class="ruby-keyword kw">do</span>
366:       <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">association_setter</span>, { <span class="ruby-value str">'foo'</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-value str">'_delete'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'0'</span> }})
367:     <span class="ruby-keyword kw">end</span>
368:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008229" class="method">
  <div id="M008229_title" class="title">
    <b>test_should_not_destroy_the_associated_model_until_the_parent_is_saved</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008229_source')" id="l_M008229_source">show source</a> ]</p>
  <div id="M008229_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 445</span>
445:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_not_destroy_the_associated_model_until_the_parent_is_saved</span>
446:     <span class="ruby-identifier">assert_no_difference</span>(<span class="ruby-value str">'@pirate.send(@association_name).count'</span>) <span class="ruby-keyword kw">do</span>
447:       <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">association_setter</span>, <span class="ruby-ivar">@alternate_params</span>[<span class="ruby-identifier">association_getter</span>].<span class="ruby-identifier">merge</span>(<span class="ruby-value str">'baz'</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value str">'_delete'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span> }))
448:     <span class="ruby-keyword kw">end</span>
449:     <span class="ruby-identifier">assert_difference</span>(<span class="ruby-value str">'@pirate.send(@association_name).count'</span>, <span class="ruby-value">-1</span>) { <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">save</span> }
450:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008228" class="method">
  <div id="M008228_title" class="title">
    <b>test_should_not_destroy_the_associated_model_with_a_non_truthy_argument</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008228_source')" id="l_M008228_source">show source</a> ]</p>
  <div id="M008228_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 436</span>
436:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_not_destroy_the_associated_model_with_a_non_truthy_argument</span>
437:     [<span class="ruby-keyword kw">nil</span>, <span class="ruby-value str">''</span>, <span class="ruby-value str">'0'</span>, <span class="ruby-value">0</span>, <span class="ruby-value str">'false'</span>, <span class="ruby-keyword kw">false</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">false_variable</span><span class="ruby-operator">|</span>
438:       <span class="ruby-ivar">@alternate_params</span>[<span class="ruby-identifier">association_getter</span>][<span class="ruby-value str">'foo'</span>][<span class="ruby-value str">'_delete'</span>] = <span class="ruby-identifier">false_variable</span>
439:       <span class="ruby-identifier">assert_no_difference</span>(<span class="ruby-value str">'@pirate.send(@association_name).count'</span>) <span class="ruby-keyword kw">do</span>
440:         <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-ivar">@alternate_params</span>)
441:       <span class="ruby-keyword kw">end</span>
442:     <span class="ruby-keyword kw">end</span>
443:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008224" class="method">
  <div id="M008224_title" class="title">
    <b>test_should_raise_an_argument_error_if_something_else_than_a_hash_is_passed</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008224_source')" id="l_M008224_source">show source</a> ]</p>
  <div id="M008224_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 399</span>
399:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_raise_an_argument_error_if_something_else_than_a_hash_is_passed</span>
400:     <span class="ruby-identifier">assert_nothing_raised</span>(<span class="ruby-constant">ArgumentError</span>) { <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">association_setter</span>, {}) }
401:     <span class="ruby-identifier">assert_nothing_raised</span>(<span class="ruby-constant">ArgumentError</span>) { <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">association_setter</span>, <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">OrderedHash</span>.<span class="ruby-identifier">new</span>) }
402: 
403:     <span class="ruby-identifier">assert_raise_with_message</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">'Hash or Array expected, got String (&quot;foo&quot;)'</span> <span class="ruby-keyword kw">do</span>
404:       <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">association_setter</span>, <span class="ruby-value str">&quot;foo&quot;</span>)
405:     <span class="ruby-keyword kw">end</span>
406:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008223" class="method">
  <div id="M008223_title" class="title">
    <b>test_should_sort_the_hash_by_the_keys_before_building_new_associated_models</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008223_source')" id="l_M008223_source">show source</a> ]</p>
  <div id="M008223_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 390</span>
390:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_sort_the_hash_by_the_keys_before_building_new_associated_models</span>
391:     <span class="ruby-identifier">attributes</span> = <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">OrderedHash</span>.<span class="ruby-identifier">new</span>
392:     <span class="ruby-identifier">attributes</span>[<span class="ruby-value str">'123726353'</span>] = { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Grace OMalley'</span> }
393:     <span class="ruby-identifier">attributes</span>[<span class="ruby-value str">'2'</span>] = { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Privateers Greed'</span> } <span class="ruby-comment cmt"># 2 is lower then 123726353</span>
394:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">association_setter</span>, <span class="ruby-identifier">attributes</span>)
395: 
396:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-value str">'Posideons Killer'</span>, <span class="ruby-value str">'Killer bandita Dionne'</span>, <span class="ruby-value str">'Privateers Greed'</span>, <span class="ruby-value str">'Grace OMalley'</span>].<span class="ruby-identifier">to_set</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:name</span>).<span class="ruby-identifier">to_set</span>
397:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008217" class="method">
  <div id="M008217_title" class="title">
    <b>test_should_take_a_hash_and_assign_the_attributes_to_the_associated_models</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008217_source')" id="l_M008217_source">show source</a> ]</p>
  <div id="M008217_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 331</span>
331:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_take_a_hash_and_assign_the_attributes_to_the_associated_models</span>
332:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">attributes</span> = <span class="ruby-ivar">@alternate_params</span>
333:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Grace OMalley'</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">name</span>
334:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Privateers Greed'</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">last</span>.<span class="ruby-identifier">name</span>
335:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008218" class="method">
  <div id="M008218_title" class="title">
    <b>test_should_take_a_hash_with_composite_id_keys_and_assign_the_attributes_to_the_associated_models</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008218_source')" id="l_M008218_source">show source</a> ]</p>
  <div id="M008218_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 337</span>
337:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_take_a_hash_with_composite_id_keys_and_assign_the_attributes_to_the_associated_models</span>
338:     <span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">stubs</span>(<span class="ruby-identifier">:id</span>).<span class="ruby-identifier">returns</span>(<span class="ruby-value str">'ABC1X'</span>)
339:     <span class="ruby-ivar">@child_2</span>.<span class="ruby-identifier">stubs</span>(<span class="ruby-identifier">:id</span>).<span class="ruby-identifier">returns</span>(<span class="ruby-value str">'ABC2X'</span>)
340: 
341:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">attributes</span> = {
342:       <span class="ruby-identifier">association_getter</span> =<span class="ruby-operator">&gt;</span> [
343:         { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Grace OMalley'</span> },
344:         { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@child_2</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Privateers Greed'</span> }
345:       ]
346:     }
347: 
348:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-value str">'Grace OMalley'</span>, <span class="ruby-value str">'Privateers Greed'</span>], [<span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">name</span>, <span class="ruby-ivar">@child_2</span>.<span class="ruby-identifier">name</span>]
349:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008214" class="method">
  <div id="M008214_title" class="title">
    <b>test_should_take_a_hash_with_string_keys_and_assign_the_attributes_to_the_associated_models</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008214_source')" id="l_M008214_source">show source</a> ]</p>
  <div id="M008214_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 313</span>
313:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_take_a_hash_with_string_keys_and_assign_the_attributes_to_the_associated_models</span>
314:     <span class="ruby-ivar">@alternate_params</span>[<span class="ruby-identifier">association_getter</span>].<span class="ruby-identifier">stringify_keys!</span>
315:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">update_attributes</span> <span class="ruby-ivar">@alternate_params</span>
316:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-value str">'Grace OMalley'</span>, <span class="ruby-value str">'Privateers Greed'</span>], [<span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">name</span>, <span class="ruby-ivar">@child_2</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">name</span>]
317:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008215" class="method">
  <div id="M008215_title" class="title">
    <b>test_should_take_an_array_and_assign_the_attributes_to_the_associated_models</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008215_source')" id="l_M008215_source">show source</a> ]</p>
  <div id="M008215_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 319</span>
319:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_take_an_array_and_assign_the_attributes_to_the_associated_models</span>
320:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">association_setter</span>, <span class="ruby-ivar">@alternate_params</span>[<span class="ruby-identifier">association_getter</span>].<span class="ruby-identifier">values</span>)
321:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">save</span>
322:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-value str">'Grace OMalley'</span>, <span class="ruby-value str">'Privateers Greed'</span>], [<span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">name</span>, <span class="ruby-ivar">@child_2</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">name</span>]
323:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008226" class="method">
  <div id="M008226_title" class="title">
    <b>test_should_update_existing_records_and_add_new_ones_that_have_no_id</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008226_source')" id="l_M008226_source">show source</a> ]</p>
  <div id="M008226_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 415</span>
415:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_update_existing_records_and_add_new_ones_that_have_no_id</span>
416:     <span class="ruby-ivar">@alternate_params</span>[<span class="ruby-identifier">association_getter</span>][<span class="ruby-value str">'baz'</span>] = { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Buccaneers Servant'</span> }
417:     <span class="ruby-identifier">assert_difference</span>(<span class="ruby-value str">'@pirate.send(@association_name).count'</span>, <span class="ruby-value">+1</span>) <span class="ruby-keyword kw">do</span>
418:       <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">update_attributes</span> <span class="ruby-ivar">@alternate_params</span>
419:     <span class="ruby-keyword kw">end</span>
420:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-value str">'Grace OMalley'</span>, <span class="ruby-value str">'Privateers Greed'</span>, <span class="ruby-value str">'Buccaneers Servant'</span>].<span class="ruby-identifier">to_set</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">send</span>(<span class="ruby-ivar">@association_name</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:name</span>).<span class="ruby-identifier">to_set</span>
421:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M008225" class="method">
  <div id="M008225_title" class="title">
    <b>test_should_work_with_update_attributes_as_well</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M008225_source')" id="l_M008225_source">show source</a> ]</p>
  <div id="M008225_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 408</span>
408:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_work_with_update_attributes_as_well</span>
409:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">:catchphrase</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Arr'</span>,
410:       <span class="ruby-identifier">association_getter</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-value str">'foo'</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Grace OMalley'</span> }})
411: 
412:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Grace OMalley'</span>, <span class="ruby-ivar">@child_1</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">name</span>
413:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>