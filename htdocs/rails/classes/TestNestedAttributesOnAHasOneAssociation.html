  <div id="C00000258">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />TestNestedAttributesOnAHasOneAssociation<br/>
  In:
<a href="#" onclick="jsHref('files/activerecord/test/cases/nested_attributes_test_rb.html');">activerecord/test/cases/nested_attributes_test.rb</a>

Parent:&nbsp;
ActiveRecord::TestCase
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">




  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M001621&name=setup" >setup</a></li>
  <li><a href="index.html?a=M001640&name=test_should_accept_update_only_option" >test_should_accept_update_only_option</a></li>
  <li><a href="index.html?a=M001636&name=test_should_also_work_with_a_HashWithIndifferentAccess" >test_should_also_work_with_a_HashWithIndifferentAccess</a></li>
  <li><a href="index.html?a=M001639&name=test_should_automatically_enable_autosave_on_the_association" >test_should_automatically_enable_autosave_on_the_association</a></li>
  <li><a href="index.html?a=M001624&name=test_should_build_a_new_record_if_there_is_no_id" >test_should_build_a_new_record_if_there_is_no_id</a></li>
  <li><a href="index.html?a=M001641&name=test_should_create_new_model_when_nothing_is_there_and_update_only_is_true" >test_should_create_new_model_when_nothing_is_there_and_update_only_is_true</a></li>
  <li><a href="index.html?a=M001623&name=test_should_define_an_attribute_writer_method_for_the_association" >test_should_define_an_attribute_writer_method_for_the_association</a></li>
  <li><a href="index.html?a=M001633&name=test_should_destroy_an_existing_record_if_there_is_a_matching_id_and_destroy_is_truthy" >test_should_destroy_an_existing_record_if_there_is_a_matching_id_and_destroy_is_truthy</a></li>
  <li><a href="index.html?a=M001632&name=test_should_modify_an_existing_record_if_there_is_a_matching_composite_id" >test_should_modify_an_existing_record_if_there_is_a_matching_composite_id</a></li>
  <li><a href="index.html?a=M001629&name=test_should_modify_an_existing_record_if_there_is_a_matching_id" >test_should_modify_an_existing_record_if_there_is_a_matching_id</a></li>
  <li><a href="index.html?a=M001626&name=test_should_not_build_a_new_record_if_a_reject_if_proc_returns_false" >test_should_not_build_a_new_record_if_a_reject_if_proc_returns_false</a></li>
  <li><a href="index.html?a=M001625&name=test_should_not_build_a_new_record_if_there_is_no_id_and_destroy_is_truthy" >test_should_not_build_a_new_record_if_there_is_no_id_and_destroy_is_truthy</a></li>
  <li><a href="index.html?a=M001635&name=test_should_not_destroy_an_existing_record_if_allow_destroy_is_false" >test_should_not_destroy_an_existing_record_if_allow_destroy_is_false</a></li>
  <li><a href="index.html?a=M001634&name=test_should_not_destroy_an_existing_record_if_destroy_is_not_truthy" >test_should_not_destroy_an_existing_record_if_destroy_is_not_truthy</a></li>
  <li><a href="index.html?a=M001638&name=test_should_not_destroy_the_associated_model_until_the_parent_is_saved" >test_should_not_destroy_the_associated_model_until_the_parent_is_saved</a></li>
  <li><a href="index.html?a=M001628&name=test_should_not_replace_an_existing_record_if_there_is_no_id_and_destroy_is_truthy" >test_should_not_replace_an_existing_record_if_there_is_no_id_and_destroy_is_truthy</a></li>
  <li><a href="index.html?a=M001630&name=test_should_raise_RecordNotFound_if_an_id_is_given_but_doesnt_return_a_record" >test_should_raise_RecordNotFound_if_an_id_is_given_but_doesnt_return_a_record</a></li>
  <li><a href="index.html?a=M001622&name=test_should_raise_argument_error_if_trying_to_build_polymorphic_belongs_to" >test_should_raise_argument_error_if_trying_to_build_polymorphic_belongs_to</a></li>
  <li><a href="index.html?a=M001627&name=test_should_replace_an_existing_record_if_there_is_no_id" >test_should_replace_an_existing_record_if_there_is_no_id</a></li>
  <li><a href="index.html?a=M001631&name=test_should_take_a_hash_with_string_keys_and_update_the_associated_model" >test_should_take_a_hash_with_string_keys_and_update_the_associated_model</a></li>
  <li><a href="index.html?a=M001642&name=test_should_update_existing_when_update_only_is_true_and_no_id_is_given" >test_should_update_existing_when_update_only_is_true_and_no_id_is_given</a></li>
  <li><a href="index.html?a=M001637&name=test_should_work_with_update_attributes_as_well" >test_should_work_with_update_attributes_as_well</a></li>
  </ul>

<div class="sectiontitle">Included Modules</div>
<ul>
  <li><a href="#" onclick="jsHref('classes/AssertRaiseWithMessage.html');">AssertRaiseWithMessage</a></li>
</ul>





<div class="sectiontitle">Public Instance methods</div>
<div id="M001621" class="method">
  <div id="M001621_title" class="title">
    <b>setup</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001621_source')" id="l_M001621_source">show source</a> ]</p>
  <div id="M001621_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 119</span>
119:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setup</span>
120:     <span class="ruby-ivar">@pirate</span> = <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:catchphrase</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Don' botharrr talkin' like one, savvy?&quot;</span>)
121:     <span class="ruby-ivar">@ship</span> = <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">create_ship</span>(<span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Nights Dirty Lightning'</span>)
122:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001640" class="method">
  <div id="M001640_title" class="title">
    <b>test_should_accept_update_only_option</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001640_source')" id="l_M001640_source">show source</a> ]</p>
  <div id="M001640_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 254</span>
254:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_accept_update_only_option</span>
255:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">update_attribute</span>(<span class="ruby-identifier">:update_only_ship_attributes</span>, { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">ship</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Mayflower'</span> })
256:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001636" class="method">
  <div id="M001636_title" class="title">
    <b>test_should_also_work_with_a_HashWithIndifferentAccess</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001636_source')" id="l_M001636_source">show source</a> ]</p>
  <div id="M001636_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 226</span>
226:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_also_work_with_a_HashWithIndifferentAccess</span>
227:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">ship_attributes</span> = <span class="ruby-constant">HashWithIndifferentAccess</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Davy Jones Gold Dagger'</span>)
228: 
229:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">ship</span>.<span class="ruby-identifier">new_record?</span>
230:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Davy Jones Gold Dagger'</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">ship</span>.<span class="ruby-identifier">name</span>
231:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001639" class="method">
  <div id="M001639_title" class="title">
    <b>test_should_automatically_enable_autosave_on_the_association</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001639_source')" id="l_M001639_source">show source</a> ]</p>
  <div id="M001639_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 250</span>
250:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_automatically_enable_autosave_on_the_association</span>
251:     <span class="ruby-identifier">assert</span> <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">reflect_on_association</span>(<span class="ruby-identifier">:ship</span>).<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:autosave</span>]
252:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001624" class="method">
  <div id="M001624_title" class="title">
    <b>test_should_build_a_new_record_if_there_is_no_id</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001624_source')" id="l_M001624_source">show source</a> ]</p>
  <div id="M001624_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 134</span>
134:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_build_a_new_record_if_there_is_no_id</span>
135:     <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">destroy</span>
136:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">ship_attributes</span> = { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Davy Jones Gold Dagger'</span> }
137: 
138:     <span class="ruby-identifier">assert</span> <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">ship</span>.<span class="ruby-identifier">new_record?</span>
139:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Davy Jones Gold Dagger'</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">ship</span>.<span class="ruby-identifier">name</span>
140:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001641" class="method">
  <div id="M001641_title" class="title">
    <b>test_should_create_new_model_when_nothing_is_there_and_update_only_is_true</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001641_source')" id="l_M001641_source">show source</a> ]</p>
  <div id="M001641_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 258</span>
258:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_create_new_model_when_nothing_is_there_and_update_only_is_true</span>
259:     <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">delete</span>
260:     <span class="ruby-identifier">assert_difference</span>(<span class="ruby-value str">'Ship.count'</span>, <span class="ruby-value">1</span>) <span class="ruby-keyword kw">do</span>
261:       <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">update_attribute</span>(<span class="ruby-identifier">:update_only_ship_attributes</span>, { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Mayflower'</span> })
262:     <span class="ruby-keyword kw">end</span>
263:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001623" class="method">
  <div id="M001623_title" class="title">
    <b>test_should_define_an_attribute_writer_method_for_the_association</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001623_source')" id="l_M001623_source">show source</a> ]</p>
  <div id="M001623_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 130</span>
130:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_define_an_attribute_writer_method_for_the_association</span>
131:     <span class="ruby-identifier">assert_respond_to</span> <span class="ruby-ivar">@pirate</span>, <span class="ruby-identifier">:ship_attributes=</span>
132:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001633" class="method">
  <div id="M001633_title" class="title">
    <b>test_should_destroy_an_existing_record_if_there_is_a_matching_id_and_destroy_is_truthy</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001633_source')" id="l_M001633_source">show source</a> ]</p>
  <div id="M001633_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 198</span>
198:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_destroy_an_existing_record_if_there_is_a_matching_id_and_destroy_is_truthy</span>
199:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">ship</span>.<span class="ruby-identifier">destroy</span>
200:     [<span class="ruby-value">1</span>, <span class="ruby-value str">'1'</span>, <span class="ruby-keyword kw">true</span>, <span class="ruby-value str">'true'</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">truth</span><span class="ruby-operator">|</span>
201:       <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">create_ship</span>(<span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Mister Pablo'</span>)
202:       <span class="ruby-identifier">assert_difference</span>(<span class="ruby-value str">'Ship.count'</span>, <span class="ruby-value">-1</span>) <span class="ruby-keyword kw">do</span>
203:         <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">update_attribute</span>(<span class="ruby-identifier">:ship_attributes</span>, { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">ship</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:_destroy</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">truth</span> })
204:       <span class="ruby-keyword kw">end</span>
205:     <span class="ruby-keyword kw">end</span>
206:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001632" class="method">
  <div id="M001632_title" class="title">
    <b>test_should_modify_an_existing_record_if_there_is_a_matching_composite_id</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001632_source')" id="l_M001632_source">show source</a> ]</p>
  <div id="M001632_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 191</span>
191:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_modify_an_existing_record_if_there_is_a_matching_composite_id</span>
192:     <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">stubs</span>(<span class="ruby-identifier">:id</span>).<span class="ruby-identifier">returns</span>(<span class="ruby-value str">'ABC1X'</span>)
193:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">ship_attributes</span> = { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Davy Jones Gold Dagger'</span> }
194: 
195:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Davy Jones Gold Dagger'</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">ship</span>.<span class="ruby-identifier">name</span>
196:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001629" class="method">
  <div id="M001629_title" class="title">
    <b>test_should_modify_an_existing_record_if_there_is_a_matching_id</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001629_source')" id="l_M001629_source">show source</a> ]</p>
  <div id="M001629_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 171</span>
171:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_modify_an_existing_record_if_there_is_a_matching_id</span>
172:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">ship_attributes</span> = { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Davy Jones Gold Dagger'</span> }
173: 
174:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-ivar">@ship</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">ship</span>
175:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Davy Jones Gold Dagger'</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">ship</span>.<span class="ruby-identifier">name</span>
176:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001626" class="method">
  <div id="M001626_title" class="title">
    <b>test_should_not_build_a_new_record_if_a_reject_if_proc_returns_false</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001626_source')" id="l_M001626_source">show source</a> ]</p>
  <div id="M001626_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 149</span>
149:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_not_build_a_new_record_if_a_reject_if_proc_returns_false</span>
150:     <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">destroy</span>
151:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">ship_attributes</span> = {}
152: 
153:     <span class="ruby-identifier">assert_nil</span> <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">ship</span>
154:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001625" class="method">
  <div id="M001625_title" class="title">
    <b>test_should_not_build_a_new_record_if_there_is_no_id_and_destroy_is_truthy</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001625_source')" id="l_M001625_source">show source</a> ]</p>
  <div id="M001625_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 142</span>
142:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_not_build_a_new_record_if_there_is_no_id_and_destroy_is_truthy</span>
143:     <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">destroy</span>
144:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">ship_attributes</span> = { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Davy Jones Gold Dagger'</span>, <span class="ruby-identifier">:_destroy</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'1'</span> }
145: 
146:     <span class="ruby-identifier">assert_nil</span> <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">ship</span>
147:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001635" class="method">
  <div id="M001635_title" class="title">
    <b>test_should_not_destroy_an_existing_record_if_allow_destroy_is_false</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001635_source')" id="l_M001635_source">show source</a> ]</p>
  <div id="M001635_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 216</span>
216:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_not_destroy_an_existing_record_if_allow_destroy_is_false</span>
217:     <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">accepts_nested_attributes_for</span> <span class="ruby-identifier">:ship</span>, <span class="ruby-identifier">:allow_destroy</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">:reject_if</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">proc</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">attributes</span><span class="ruby-operator">|</span> <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">empty?</span> }
218: 
219:     <span class="ruby-identifier">assert_no_difference</span>(<span class="ruby-value str">'Ship.count'</span>) <span class="ruby-keyword kw">do</span>
220:       <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">update_attribute</span>(<span class="ruby-identifier">:ship_attributes</span>, { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">ship</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:_destroy</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'1'</span> })
221:     <span class="ruby-keyword kw">end</span>
222: 
223:     <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">accepts_nested_attributes_for</span> <span class="ruby-identifier">:ship</span>, <span class="ruby-identifier">:allow_destroy</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:reject_if</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">proc</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">attributes</span><span class="ruby-operator">|</span> <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">empty?</span> }
224:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001634" class="method">
  <div id="M001634_title" class="title">
    <b>test_should_not_destroy_an_existing_record_if_destroy_is_not_truthy</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001634_source')" id="l_M001634_source">show source</a> ]</p>
  <div id="M001634_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 208</span>
208:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_not_destroy_an_existing_record_if_destroy_is_not_truthy</span>
209:     [<span class="ruby-keyword kw">nil</span>, <span class="ruby-value str">'0'</span>, <span class="ruby-value">0</span>, <span class="ruby-value str">'false'</span>, <span class="ruby-keyword kw">false</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">not_truth</span><span class="ruby-operator">|</span>
210:       <span class="ruby-identifier">assert_no_difference</span>(<span class="ruby-value str">'Ship.count'</span>) <span class="ruby-keyword kw">do</span>
211:         <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">update_attribute</span>(<span class="ruby-identifier">:ship_attributes</span>, { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">ship</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:_destroy</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">not_truth</span> })
212:       <span class="ruby-keyword kw">end</span>
213:     <span class="ruby-keyword kw">end</span>
214:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001638" class="method">
  <div id="M001638_title" class="title">
    <b>test_should_not_destroy_the_associated_model_until_the_parent_is_saved</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001638_source')" id="l_M001638_source">show source</a> ]</p>
  <div id="M001638_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 241</span>
241:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_not_destroy_the_associated_model_until_the_parent_is_saved</span>
242:     <span class="ruby-identifier">assert_no_difference</span>(<span class="ruby-value str">'Ship.count'</span>) <span class="ruby-keyword kw">do</span>
243:       <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">attributes</span> = { <span class="ruby-identifier">:ship_attributes</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:_destroy</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'1'</span> } }
244:     <span class="ruby-keyword kw">end</span>
245:     <span class="ruby-identifier">assert_difference</span>(<span class="ruby-value str">'Ship.count'</span>, <span class="ruby-value">-1</span>) <span class="ruby-keyword kw">do</span>
246:       <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">save</span>
247:     <span class="ruby-keyword kw">end</span>
248:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001628" class="method">
  <div id="M001628_title" class="title">
    <b>test_should_not_replace_an_existing_record_if_there_is_no_id_and_destroy_is_truthy</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001628_source')" id="l_M001628_source">show source</a> ]</p>
  <div id="M001628_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 164</span>
164:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_not_replace_an_existing_record_if_there_is_no_id_and_destroy_is_truthy</span>
165:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">ship_attributes</span> = { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Davy Jones Gold Dagger'</span>, <span class="ruby-identifier">:_destroy</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'1'</span> }
166: 
167:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-ivar">@ship</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">ship</span>
168:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Nights Dirty Lightning'</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">ship</span>.<span class="ruby-identifier">name</span>
169:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001630" class="method">
  <div id="M001630_title" class="title">
    <b>test_should_raise_RecordNotFound_if_an_id_is_given_but_doesnt_return_a_record</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001630_source')" id="l_M001630_source">show source</a> ]</p>
  <div id="M001630_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 178</span>
178:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_raise_RecordNotFound_if_an_id_is_given_but_doesnt_return_a_record</span>
179:     <span class="ruby-identifier">assert_raise_with_message</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">RecordNotFound</span>, <span class="ruby-node">&quot;Couldn't find Ship with ID=1234567890 for Pirate with ID=#{@pirate.id}&quot;</span> <span class="ruby-keyword kw">do</span>
180:       <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">ship_attributes</span> = { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1234567890</span> }
181:     <span class="ruby-keyword kw">end</span>
182:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001622" class="method">
  <div id="M001622_title" class="title">
    <b>test_should_raise_argument_error_if_trying_to_build_polymorphic_belongs_to</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001622_source')" id="l_M001622_source">show source</a> ]</p>
  <div id="M001622_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 124</span>
124:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_raise_argument_error_if_trying_to_build_polymorphic_belongs_to</span>
125:     <span class="ruby-identifier">assert_raise_with_message</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">&quot;Cannot build association looter. Are you trying to build a polymorphic one-to-one association?&quot;</span> <span class="ruby-keyword kw">do</span>
126:       <span class="ruby-constant">Treasure</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'pearl'</span>, <span class="ruby-identifier">:looter_attributes</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:catchphrase</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Arrr&quot;</span>})
127:     <span class="ruby-keyword kw">end</span>
128:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001627" class="method">
  <div id="M001627_title" class="title">
    <b>test_should_replace_an_existing_record_if_there_is_no_id</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001627_source')" id="l_M001627_source">show source</a> ]</p>
  <div id="M001627_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 156</span>
156:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_replace_an_existing_record_if_there_is_no_id</span>
157:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">ship_attributes</span> = { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Davy Jones Gold Dagger'</span> }
158: 
159:     <span class="ruby-identifier">assert</span> <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">ship</span>.<span class="ruby-identifier">new_record?</span>
160:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Davy Jones Gold Dagger'</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">ship</span>.<span class="ruby-identifier">name</span>
161:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Nights Dirty Lightning'</span>, <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">name</span>
162:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001631" class="method">
  <div id="M001631_title" class="title">
    <b>test_should_take_a_hash_with_string_keys_and_update_the_associated_model</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001631_source')" id="l_M001631_source">show source</a> ]</p>
  <div id="M001631_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 184</span>
184:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_take_a_hash_with_string_keys_and_update_the_associated_model</span>
185:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">ship_attributes</span> = { <span class="ruby-value str">'id'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">id</span>, <span class="ruby-value str">'name'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Davy Jones Gold Dagger'</span> }
186: 
187:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-ivar">@ship</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">ship</span>
188:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Davy Jones Gold Dagger'</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">ship</span>.<span class="ruby-identifier">name</span>
189:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001642" class="method">
  <div id="M001642_title" class="title">
    <b>test_should_update_existing_when_update_only_is_true_and_no_id_is_given</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001642_source')" id="l_M001642_source">show source</a> ]</p>
  <div id="M001642_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 265</span>
265:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_update_existing_when_update_only_is_true_and_no_id_is_given</span>
266:     <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">delete</span>
267:     <span class="ruby-ivar">@ship</span> = <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">create_update_only_ship</span>(<span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Nights Dirty Lightning'</span>)
268: 
269:     <span class="ruby-identifier">assert_no_difference</span>(<span class="ruby-value str">'Ship.count'</span>) <span class="ruby-keyword kw">do</span>
270:       <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">:update_only_ship_attributes</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Mayflower'</span> })
271:     <span class="ruby-keyword kw">end</span>
272:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Mayflower'</span>, <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">name</span>
273:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001637" class="method">
  <div id="M001637_title" class="title">
    <b>test_should_work_with_update_attributes_as_well</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001637_source')" id="l_M001637_source">show source</a> ]</p>
  <div id="M001637_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 233</span>
233:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_work_with_update_attributes_as_well</span>
234:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">update_attributes</span>({ <span class="ruby-identifier">:catchphrase</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Arr'</span>, <span class="ruby-identifier">:ship_attributes</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Mister Pablo'</span> } })
235:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">reload</span>
236: 
237:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Arr'</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">catchphrase</span>
238:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Mister Pablo'</span>, <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">ship</span>.<span class="ruby-identifier">name</span>
239:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>