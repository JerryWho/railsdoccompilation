  <div id="C00000077">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />RequestTest<br/>
  In:
<a href="#" onclick="jsHref('files/actionpack/test/controller/request_test_rb.html');">actionpack/test/controller/request_test.rb</a>

Parent:&nbsp;
ActiveSupport::TestCase
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">




  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M000541&name=setup" >setup</a></li>
  <li><a href="index.html?a=M000570&name=stub_request" >stub_request</a></li>
  <li><a href="index.html?a=M000542&name=teardown" >teardown</a></li>
  <li><a href="index.html?a=M000556&name=test_allow_method_hacking_on_post" >test_allow_method_hacking_on_post</a></li>
  <li><a href="index.html?a=M000564&name=test_can_override_format_with_parameter" >test_can_override_format_with_parameter</a></li>
  <li><a href="index.html?a=M000565&name=test_content_no_type" >test_content_no_type</a></li>
  <li><a href="index.html?a=M000563&name=test_content_type" >test_content_type</a></li>
  <li><a href="index.html?a=M000567&name=test_content_type_with_charset" >test_content_type_with_charset</a></li>
  <li><a href="index.html?a=M000566&name=test_content_type_xml" >test_content_type_xml</a></li>
  <li><a href="index.html?a=M000544&name=test_domains" >test_domains</a></li>
  <li><a href="index.html?a=M000558&name=test_head_masquerading_as_get" >test_head_masquerading_as_get</a></li>
  <li><a href="index.html?a=M000548&name=test_host_with_default_port" >test_host_with_default_port</a></li>
  <li><a href="index.html?a=M000549&name=test_host_with_non_default_port" >test_host_with_non_default_port</a></li>
  <li><a href="index.html?a=M000555&name=test_invalid_http_method_raises_exception" >test_invalid_http_method_raises_exception</a></li>
  <li><a href="index.html?a=M000569&name=test_parameters" >test_parameters</a></li>
  <li><a href="index.html?a=M000546&name=test_port_string" >test_port_string</a></li>
  <li><a href="index.html?a=M000543&name=test_remote_ip" >test_remote_ip</a></li>
  <li><a href="index.html?a=M000552&name=test_reports_ssl" >test_reports_ssl</a></li>
  <li><a href="index.html?a=M000553&name=test_reports_ssl_when_proxied_via_lighttpd" >test_reports_ssl_when_proxied_via_lighttpd</a></li>
  <li><a href="index.html?a=M000547&name=test_request_uri" >test_request_uri</a></li>
  <li><a href="index.html?a=M000557&name=test_restrict_method_hacking" >test_restrict_method_hacking</a></li>
  <li><a href="index.html?a=M000550&name=test_server_software" >test_server_software</a></li>
  <li><a href="index.html?a=M000545&name=test_subdomains" >test_subdomains</a></li>
  <li><a href="index.html?a=M000554&name=test_symbolized_request_methods" >test_symbolized_request_methods</a></li>
  <li><a href="index.html?a=M000561&name=test_txt_format" >test_txt_format</a></li>
  <li><a href="index.html?a=M000568&name=test_user_agent" >test_user_agent</a></li>
  <li><a href="index.html?a=M000560&name=test_xhtml_format" >test_xhtml_format</a></li>
  <li><a href="index.html?a=M000559&name=test_xml_format" >test_xml_format</a></li>
  <li><a href="index.html?a=M000551&name=test_xml_http_request" >test_xml_http_request</a></li>
  <li><a href="index.html?a=M000562&name=test_xml_http_request" >test_xml_http_request</a></li>
  </ul>






<div class="sectiontitle">Public Instance methods</div>
<div id="M000541" class="method">
  <div id="M000541_title" class="title">
    <b>setup</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000541_source')" id="l_M000541_source">show source</a> ]</p>
  <div id="M000541_source" class="dyn-source">
<pre>
   <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 4</span>
4:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setup</span>
5:     <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">relative_url_root</span> = <span class="ruby-keyword kw">nil</span>
6:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000542" class="method">
  <div id="M000542_title" class="title">
    <b>teardown</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000542_source')" id="l_M000542_source">show source</a> ]</p>
  <div id="M000542_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 8</span>
 8:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">teardown</span>
 9:     <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">relative_url_root</span> = <span class="ruby-keyword kw">nil</span>
10:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000556" class="method">
  <div id="M000556_title" class="title">
    <b>test_allow_method_hacking_on_post</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000556_source')" id="l_M000556_source">show source</a> ]</p>
  <div id="M000556_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 292</span>
292:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_allow_method_hacking_on_post</span>
293:     [<span class="ruby-identifier">:get</span>, <span class="ruby-identifier">:head</span>, <span class="ruby-identifier">:options</span>, <span class="ruby-identifier">:put</span>, <span class="ruby-identifier">:post</span>, <span class="ruby-identifier">:delete</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">method</span><span class="ruby-operator">|</span>
294:       <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'REQUEST_METHOD'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">method</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">upcase</span>
295:       <span class="ruby-identifier">assert_equal</span>(<span class="ruby-identifier">method</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:head</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">:get</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">method</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">method</span>)
296:     <span class="ruby-keyword kw">end</span>
297:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000564" class="method">
  <div id="M000564_title" class="title">
    <b>test_can_override_format_with_parameter</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000564_source')" id="l_M000564_source">show source</a> ]</p>
  <div id="M000564_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 349</span>
349:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_can_override_format_with_parameter</span>
350:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span>
351:     <span class="ruby-identifier">request</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:parameters</span>).<span class="ruby-identifier">at_least_once</span>.<span class="ruby-identifier">returns</span>({ <span class="ruby-identifier">:format</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:txt</span> })
352:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">request</span>.<span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml?</span>
353: 
354:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span>
355:     <span class="ruby-identifier">request</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:parameters</span>).<span class="ruby-identifier">at_least_once</span>.<span class="ruby-identifier">returns</span>({ <span class="ruby-identifier">:format</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:xml</span> })
356:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">format</span>.<span class="ruby-identifier">xml?</span>
357:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000565" class="method">
  <div id="M000565_title" class="title">
    <b>test_content_no_type</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000565_source')" id="l_M000565_source">show source</a> ]</p>
  <div id="M000565_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 359</span>
359:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_content_no_type</span>
360:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span>
361:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">content_type</span>
362:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000563" class="method">
  <div id="M000563_title" class="title">
    <b>test_content_type</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000563_source')" id="l_M000563_source">show source</a> ]</p>
  <div id="M000563_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 344</span>
344:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_content_type</span>
345:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'CONTENT_TYPE'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'text/html'</span>
346:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Mime</span><span class="ruby-operator">::</span><span class="ruby-constant">HTML</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">content_type</span>
347:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000567" class="method">
  <div id="M000567_title" class="title">
    <b>test_content_type_with_charset</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000567_source')" id="l_M000567_source">show source</a> ]</p>
  <div id="M000567_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 369</span>
369:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_content_type_with_charset</span>
370:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'CONTENT_TYPE'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'application/xml; charset=UTF-8'</span>
371:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Mime</span><span class="ruby-operator">::</span><span class="ruby-constant">XML</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">content_type</span>
372:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000566" class="method">
  <div id="M000566_title" class="title">
    <b>test_content_type_xml</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000566_source')" id="l_M000566_source">show source</a> ]</p>
  <div id="M000566_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 364</span>
364:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_content_type_xml</span>
365:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'CONTENT_TYPE'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'application/xml'</span>
366:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Mime</span><span class="ruby-operator">::</span><span class="ruby-constant">XML</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">content_type</span>
367:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000544" class="method">
  <div id="M000544_title" class="title">
    <b>test_domains</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000544_source')" id="l_M000544_source">show source</a> ]</p>
  <div id="M000544_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 75</span>
75:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_domains</span>
76:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_HOST'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'www.rubyonrails.org'</span>
77:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;rubyonrails.org&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">domain</span>
78: 
79:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_HOST'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;www.rubyonrails.co.uk&quot;</span>
80:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;rubyonrails.co.uk&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">domain</span>(<span class="ruby-value">2</span>)
81: 
82:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_HOST'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;192.168.1.200&quot;</span>
83:     <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">domain</span>
84: 
85:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_HOST'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;foo.192.168.1.200&quot;</span>
86:     <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">domain</span>
87: 
88:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_HOST'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;192.168.1.200.com&quot;</span>
89:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;200.com&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">domain</span>
90:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000558" class="method">
  <div id="M000558_title" class="title">
    <b>test_head_masquerading_as_get</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000558_source')" id="l_M000558_source">show source</a> ]</p>
  <div id="M000558_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 307</span>
307:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_head_masquerading_as_get</span>
308:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'REQUEST_METHOD'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'HEAD'</span>
309:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">:get</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">method</span>
310:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">get?</span>
311:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">head?</span>
312:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000548" class="method">
  <div id="M000548_title" class="title">
    <b>test_host_with_default_port</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000548_source')" id="l_M000548_source">show source</a> ]</p>
  <div id="M000548_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 226</span>
226:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_host_with_default_port</span>
227:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_HOST'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'rubyonrails.org:80'</span>
228:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;rubyonrails.org&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">host_with_port</span>
229:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000549" class="method">
  <div id="M000549_title" class="title">
    <b>test_host_with_non_default_port</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000549_source')" id="l_M000549_source">show source</a> ]</p>
  <div id="M000549_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 231</span>
231:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_host_with_non_default_port</span>
232:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_HOST'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'rubyonrails.org:81'</span>
233:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;rubyonrails.org:81&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">host_with_port</span>
234:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000555" class="method">
  <div id="M000555_title" class="title">
    <b>test_invalid_http_method_raises_exception</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000555_source')" id="l_M000555_source">show source</a> ]</p>
  <div id="M000555_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 285</span>
285:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_invalid_http_method_raises_exception</span>
286:     <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">UnknownHttpMethod</span>) <span class="ruby-keyword kw">do</span>
287:       <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'REQUEST_METHOD'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'RANDOM_METHOD'</span>
288:       <span class="ruby-identifier">request</span>.<span class="ruby-identifier">request_method</span>
289:     <span class="ruby-keyword kw">end</span>
290:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000569" class="method">
  <div id="M000569_title" class="title">
    <b>test_parameters</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000569_source')" id="l_M000569_source">show source</a> ]</p>
  <div id="M000569_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 379</span>
379:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_parameters</span>
380:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span>
381:     <span class="ruby-identifier">request</span>.<span class="ruby-identifier">stubs</span>(<span class="ruby-identifier">:request_parameters</span>).<span class="ruby-identifier">returns</span>({ <span class="ruby-value str">&quot;foo&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> })
382:     <span class="ruby-identifier">request</span>.<span class="ruby-identifier">stubs</span>(<span class="ruby-identifier">:query_parameters</span>).<span class="ruby-identifier">returns</span>({ <span class="ruby-value str">&quot;bar&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span> })
383: 
384:     <span class="ruby-identifier">assert_equal</span>({<span class="ruby-value str">&quot;foo&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-value str">&quot;bar&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span>}, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">parameters</span>)
385:     <span class="ruby-identifier">assert_equal</span>({<span class="ruby-value str">&quot;foo&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>}, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">request_parameters</span>)
386:     <span class="ruby-identifier">assert_equal</span>({<span class="ruby-value str">&quot;bar&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span>}, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">query_parameters</span>)
387:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000546" class="method">
  <div id="M000546_title" class="title">
    <b>test_port_string</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000546_source')" id="l_M000546_source">show source</a> ]</p>
  <div id="M000546_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 118</span>
118:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_port_string</span>
119:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_HOST'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'www.example.org:80'</span>
120:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">port_string</span>
121: 
122:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_HOST'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'www.example.org:8080'</span>
123:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;:8080&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">port_string</span>
124:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000543" class="method">
  <div id="M000543_title" class="title">
    <b>test_remote_ip</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000543_source')" id="l_M000543_source">show source</a> ]</p>
  <div id="M000543_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 12</span>
12:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_remote_ip</span>
13:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'REMOTE_ADDR'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'1.2.3.4'</span>
14:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'1.2.3.4'</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_ip</span>
15: 
16:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'REMOTE_ADDR'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'1.2.3.4,3.4.5.6'</span>
17:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'1.2.3.4'</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_ip</span>
18: 
19:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'REMOTE_ADDR'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'1.2.3.4'</span>,
20:       <span class="ruby-value str">'HTTP_X_FORWARDED_FOR'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'3.4.5.6'</span>
21:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'1.2.3.4'</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_ip</span>
22: 
23:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'REMOTE_ADDR'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'127.0.0.1'</span>,
24:       <span class="ruby-value str">'HTTP_X_FORWARDED_FOR'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'3.4.5.6'</span>
25:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'3.4.5.6'</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_ip</span>
26: 
27:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_X_FORWARDED_FOR'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'unknown,3.4.5.6'</span>
28:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'3.4.5.6'</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_ip</span>
29: 
30:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_X_FORWARDED_FOR'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'172.16.0.1,3.4.5.6'</span>
31:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'3.4.5.6'</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_ip</span>
32: 
33:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_X_FORWARDED_FOR'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'192.168.0.1,3.4.5.6'</span>
34:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'3.4.5.6'</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_ip</span>
35: 
36:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_X_FORWARDED_FOR'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'10.0.0.1,3.4.5.6'</span>
37:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'3.4.5.6'</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_ip</span>
38: 
39:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_X_FORWARDED_FOR'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'10.0.0.1, 10.0.0.1, 3.4.5.6'</span>
40:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'3.4.5.6'</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_ip</span>
41: 
42:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_X_FORWARDED_FOR'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'127.0.0.1,3.4.5.6'</span>
43:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'3.4.5.6'</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_ip</span>
44: 
45:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_X_FORWARDED_FOR'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'unknown,192.168.0.1'</span>
46:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'unknown'</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_ip</span>
47: 
48:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_X_FORWARDED_FOR'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'9.9.9.9, 3.4.5.6, 10.0.0.1, 172.31.4.4'</span>
49:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'3.4.5.6'</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_ip</span>
50: 
51:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_X_FORWARDED_FOR'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'1.1.1.1'</span>,
52:                            <span class="ruby-value str">'HTTP_CLIENT_IP'</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'2.2.2.2'</span>
53:     <span class="ruby-identifier">e</span> = <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">ActionControllerError</span>) {
54:       <span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_ip</span>
55:     }
56:     <span class="ruby-identifier">assert_match</span> <span class="ruby-regexp re">/IP spoofing attack/</span>, <span class="ruby-identifier">e</span>.<span class="ruby-identifier">message</span>
57:     <span class="ruby-identifier">assert_match</span> <span class="ruby-regexp re">/HTTP_X_FORWARDED_FOR=&quot;1.1.1.1&quot;/</span>, <span class="ruby-identifier">e</span>.<span class="ruby-identifier">message</span>
58:     <span class="ruby-identifier">assert_match</span> <span class="ruby-regexp re">/HTTP_CLIENT_IP=&quot;2.2.2.2&quot;/</span>, <span class="ruby-identifier">e</span>.<span class="ruby-identifier">message</span>
59: 
60:     <span class="ruby-comment cmt"># turn IP Spoofing detection off.</span>
61:     <span class="ruby-comment cmt"># This is useful for sites that are aimed at non-IP clients.  The typical</span>
62:     <span class="ruby-comment cmt"># example is WAP.  Since the cellular network is not IP based, it's a</span>
63:     <span class="ruby-comment cmt"># leap of faith to assume that their proxies are ever going to set the</span>
64:     <span class="ruby-comment cmt"># HTTP_CLIENT_IP/HTTP_X_FORWARDED_FOR headers properly.</span>
65:     <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">ip_spoofing_check</span> = <span class="ruby-keyword kw">false</span>
66:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_X_FORWARDED_FOR'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'1.1.1.1'</span>,
67:                            <span class="ruby-value str">'HTTP_CLIENT_IP'</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'2.2.2.2'</span>
68:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'2.2.2.2'</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_ip</span>
69:     <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">ip_spoofing_check</span> = <span class="ruby-keyword kw">true</span>
70: 
71:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_X_FORWARDED_FOR'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'8.8.8.8, 9.9.9.9'</span>
72:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'9.9.9.9'</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">remote_ip</span>
73:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000552" class="method">
  <div id="M000552_title" class="title">
    <b>test_reports_ssl</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000552_source')" id="l_M000552_source">show source</a> ]</p>
  <div id="M000552_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 262</span>
262:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_reports_ssl</span>
263:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span>
264:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">request</span>.<span class="ruby-identifier">ssl?</span>
265: 
266:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTPS'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'on'</span>
267:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">ssl?</span>
268:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000553" class="method">
  <div id="M000553_title" class="title">
    <b>test_reports_ssl_when_proxied_via_lighttpd</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000553_source')" id="l_M000553_source">show source</a> ]</p>
  <div id="M000553_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 270</span>
270:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_reports_ssl_when_proxied_via_lighttpd</span>
271:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span>
272:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">request</span>.<span class="ruby-identifier">ssl?</span>
273: 
274:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_X_FORWARDED_PROTO'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'https'</span>
275:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">ssl?</span>
276:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000547" class="method">
  <div id="M000547_title" class="title">
    <b>test_request_uri</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000547_source')" id="l_M000547_source">show source</a> ]</p>
  <div id="M000547_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 126</span>
126:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_request_uri</span>
127:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'REQUEST_URI'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;http://www.rubyonrails.org/path/of/some/uri?mapped=1&quot;</span>
128:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/path/of/some/uri?mapped=1&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">request_uri</span>
129:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/path/of/some/uri&quot;</span>,          <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path</span>
130: 
131:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'REQUEST_URI'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;http://www.rubyonrails.org/path/of/some/uri&quot;</span>
132:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/path/of/some/uri&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">request_uri</span>
133:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/path/of/some/uri&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path</span>
134: 
135:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'REQUEST_URI'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/path/of/some/uri&quot;</span>
136:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/path/of/some/uri&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">request_uri</span>
137:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/path/of/some/uri&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path</span>
138: 
139:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'REQUEST_URI'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/&quot;</span>
140:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">request_uri</span>
141:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path</span>
142: 
143:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'REQUEST_URI'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/?m=b&quot;</span>
144:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/?m=b&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">request_uri</span>
145:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/&quot;</span>,     <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path</span>
146: 
147:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'REQUEST_URI'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/&quot;</span>, <span class="ruby-value str">'SCRIPT_NAME'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'/dispatch.cgi'</span>
148:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">request_uri</span>
149:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path</span>
150: 
151:     <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">relative_url_root</span> = <span class="ruby-value str">&quot;/hieraki&quot;</span>
152:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'REQUEST_URI'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/hieraki/&quot;</span>, <span class="ruby-value str">'SCRIPT_NAME'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/hieraki/dispatch.cgi&quot;</span>
153:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/hieraki/&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">request_uri</span>
154:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/&quot;</span>,         <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path</span>
155:     <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">relative_url_root</span> = <span class="ruby-keyword kw">nil</span>
156: 
157:     <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">relative_url_root</span> = <span class="ruby-value str">&quot;/collaboration/hieraki&quot;</span>
158:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'REQUEST_URI'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/collaboration/hieraki/books/edit/2&quot;</span>,
159:       <span class="ruby-value str">'SCRIPT_NAME'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/collaboration/hieraki/dispatch.cgi&quot;</span>
160:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/collaboration/hieraki/books/edit/2&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">request_uri</span>
161:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/books/edit/2&quot;</span>,                       <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path</span>
162:     <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">relative_url_root</span> = <span class="ruby-keyword kw">nil</span>
163: 
164:     <span class="ruby-comment cmt"># The following tests are for when REQUEST_URI is not supplied (as in IIS)</span>
165:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'PATH_INFO'</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/path/of/some/uri?mapped=1&quot;</span>,
166:                            <span class="ruby-value str">'SCRIPT_NAME'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>,
167:                            <span class="ruby-value str">'REQUEST_URI'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>
168:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/path/of/some/uri?mapped=1&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">request_uri</span>
169:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/path/of/some/uri&quot;</span>,          <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path</span>
170: 
171:     <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">relative_url_root</span> = <span class="ruby-value str">'/path'</span>
172:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'PATH_INFO'</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/path/of/some/uri?mapped=1&quot;</span>,
173:                            <span class="ruby-value str">'SCRIPT_NAME'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/path/dispatch.rb&quot;</span>,
174:                            <span class="ruby-value str">'REQUEST_URI'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>
175:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/path/of/some/uri?mapped=1&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">request_uri</span>
176:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/of/some/uri&quot;</span>,               <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path</span>
177:     <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">relative_url_root</span> = <span class="ruby-keyword kw">nil</span>
178: 
179:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'PATH_INFO'</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/path/of/some/uri&quot;</span>,
180:                            <span class="ruby-value str">'SCRIPT_NAME'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>,
181:                            <span class="ruby-value str">'REQUEST_URI'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>
182:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/path/of/some/uri&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">request_uri</span>
183:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/path/of/some/uri&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path</span>
184: 
185:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'PATH_INFO'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'/'</span>, <span class="ruby-value str">'REQUEST_URI'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>
186:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">request_uri</span>
187:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path</span>
188: 
189:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'PATH_INFO'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'/?m=b'</span>, <span class="ruby-value str">'REQUEST_URI'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>
190:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/?m=b&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">request_uri</span>
191:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/&quot;</span>,     <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path</span>
192: 
193:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'PATH_INFO'</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/&quot;</span>,
194:                            <span class="ruby-value str">'SCRIPT_NAME'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/dispatch.cgi&quot;</span>,
195:                            <span class="ruby-value str">'REQUEST_URI'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>
196:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">request_uri</span>
197:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path</span>
198: 
199:     <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">relative_url_root</span> = <span class="ruby-value str">'/hieraki'</span>
200:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'PATH_INFO'</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/hieraki/&quot;</span>,
201:                            <span class="ruby-value str">'SCRIPT_NAME'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/hieraki/dispatch.cgi&quot;</span>,
202:                            <span class="ruby-value str">'REQUEST_URI'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>
203:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/hieraki/&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">request_uri</span>
204:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/&quot;</span>,         <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path</span>
205:     <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">relative_url_root</span> = <span class="ruby-keyword kw">nil</span>
206: 
207:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'REQUEST_URI'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'/hieraki/dispatch.cgi'</span>
208:     <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">relative_url_root</span> = <span class="ruby-value str">'/hieraki'</span>
209:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/dispatch.cgi&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path</span>
210:     <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">relative_url_root</span> = <span class="ruby-keyword kw">nil</span>
211: 
212:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'REQUEST_URI'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'/hieraki/dispatch.cgi'</span>
213:     <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">relative_url_root</span> = <span class="ruby-value str">'/foo'</span>
214:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/hieraki/dispatch.cgi&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path</span>
215:     <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">relative_url_root</span> = <span class="ruby-keyword kw">nil</span>
216: 
217:     <span class="ruby-comment cmt"># This test ensures that Rails uses REQUEST_URI over PATH_INFO</span>
218:     <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">relative_url_root</span> = <span class="ruby-keyword kw">nil</span>
219:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'REQUEST_URI'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/some/path&quot;</span>,
220:                            <span class="ruby-value str">'PATH_INFO'</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/another/path&quot;</span>,
221:                            <span class="ruby-value str">'SCRIPT_NAME'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/dispatch.cgi&quot;</span>
222:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/some/path&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">request_uri</span>
223:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;/some/path&quot;</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path</span>
224:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000557" class="method">
  <div id="M000557_title" class="title">
    <b>test_restrict_method_hacking</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000557_source')" id="l_M000557_source">show source</a> ]</p>
  <div id="M000557_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 299</span>
299:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_restrict_method_hacking</span>
300:     [<span class="ruby-identifier">:get</span>, <span class="ruby-identifier">:put</span>, <span class="ruby-identifier">:delete</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">method</span><span class="ruby-operator">|</span>
301:       <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'REQUEST_METHOD'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">method</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">upcase</span>,
302:         <span class="ruby-value str">'action_controller.request.request_parameters'</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:_method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'put'</span> }
303:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">method</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">method</span>
304:     <span class="ruby-keyword kw">end</span>
305:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000550" class="method">
  <div id="M000550_title" class="title">
    <b>test_server_software</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000550_source')" id="l_M000550_source">show source</a> ]</p>
  <div id="M000550_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 236</span>
236:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_server_software</span>
237:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span>
238:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">server_software</span>
239: 
240:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'SERVER_SOFTWARE'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Apache3.422'</span>
241:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'apache'</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">server_software</span>
242: 
243:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'SERVER_SOFTWARE'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'lighttpd(1.1.4)'</span>
244:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'lighttpd'</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">server_software</span>
245:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000545" class="method">
  <div id="M000545_title" class="title">
    <b>test_subdomains</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000545_source')" id="l_M000545_source">show source</a> ]</p>
  <div id="M000545_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 92</span>
 92:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_subdomains</span>
 93:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_HOST'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;www.rubyonrails.org&quot;</span>
 94:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w( www )</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">subdomains</span>
 95: 
 96:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_HOST'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;www.rubyonrails.co.uk&quot;</span>
 97:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w( www )</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">subdomains</span>(<span class="ruby-value">2</span>)
 98: 
 99:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_HOST'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;dev.www.rubyonrails.co.uk&quot;</span>
100:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w( dev www )</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">subdomains</span>(<span class="ruby-value">2</span>)
101: 
102:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_HOST'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;foobar.foobar.com&quot;</span>
103:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w( foobar )</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">subdomains</span>
104: 
105:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_HOST'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;192.168.1.200&quot;</span>
106:     <span class="ruby-identifier">assert_equal</span> [], <span class="ruby-identifier">request</span>.<span class="ruby-identifier">subdomains</span>
107: 
108:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_HOST'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;foo.192.168.1.200&quot;</span>
109:     <span class="ruby-identifier">assert_equal</span> [], <span class="ruby-identifier">request</span>.<span class="ruby-identifier">subdomains</span>
110: 
111:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_HOST'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;192.168.1.200.com&quot;</span>
112:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w( 192 168 1 )</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">subdomains</span>
113: 
114:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_HOST'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>
115:     <span class="ruby-identifier">assert_equal</span> [], <span class="ruby-identifier">request</span>.<span class="ruby-identifier">subdomains</span>
116:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000554" class="method">
  <div id="M000554_title" class="title">
    <b>test_symbolized_request_methods</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000554_source')" id="l_M000554_source">show source</a> ]</p>
  <div id="M000554_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 278</span>
278:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_symbolized_request_methods</span>
279:     [<span class="ruby-identifier">:get</span>, <span class="ruby-identifier">:post</span>, <span class="ruby-identifier">:put</span>, <span class="ruby-identifier">:delete</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">method</span><span class="ruby-operator">|</span>
280:       <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'REQUEST_METHOD'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">method</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">upcase</span>
281:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">method</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">method</span>
282:     <span class="ruby-keyword kw">end</span>
283:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000561" class="method">
  <div id="M000561_title" class="title">
    <b>test_txt_format</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000561_source')" id="l_M000561_source">show source</a> ]</p>
  <div id="M000561_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 326</span>
326:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_txt_format</span>
327:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span>
328:     <span class="ruby-identifier">request</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:parameters</span>).<span class="ruby-identifier">at_least_once</span>.<span class="ruby-identifier">returns</span>({ <span class="ruby-identifier">:format</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'txt'</span> })
329:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Mime</span><span class="ruby-operator">::</span><span class="ruby-constant">TEXT</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">format</span>
330:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000568" class="method">
  <div id="M000568_title" class="title">
    <b>test_user_agent</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000568_source')" id="l_M000568_source">show source</a> ]</p>
  <div id="M000568_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 374</span>
374:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_user_agent</span>
375:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_USER_AGENT'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'TestAgent'</span>
376:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'TestAgent'</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">user_agent</span>
377:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000560" class="method">
  <div id="M000560_title" class="title">
    <b>test_xhtml_format</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000560_source')" id="l_M000560_source">show source</a> ]</p>
  <div id="M000560_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 320</span>
320:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_xhtml_format</span>
321:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span>
322:     <span class="ruby-identifier">request</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:parameters</span>).<span class="ruby-identifier">at_least_once</span>.<span class="ruby-identifier">returns</span>({ <span class="ruby-identifier">:format</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'xhtml'</span> })
323:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Mime</span><span class="ruby-operator">::</span><span class="ruby-constant">HTML</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">format</span>
324:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000559" class="method">
  <div id="M000559_title" class="title">
    <b>test_xml_format</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000559_source')" id="l_M000559_source">show source</a> ]</p>
  <div id="M000559_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 314</span>
314:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_xml_format</span>
315:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span>
316:     <span class="ruby-identifier">request</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:parameters</span>).<span class="ruby-identifier">at_least_once</span>.<span class="ruby-identifier">returns</span>({ <span class="ruby-identifier">:format</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'xml'</span> })
317:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Mime</span><span class="ruby-operator">::</span><span class="ruby-constant">XML</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">format</span>
318:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000551" class="method">
  <div id="M000551_title" class="title">
    <b>test_xml_http_request</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000551_source')" id="l_M000551_source">show source</a> ]</p>
  <div id="M000551_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 247</span>
247:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_xml_http_request</span>
248:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span>
249: 
250:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">request</span>.<span class="ruby-identifier">xml_http_request?</span>
251:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">request</span>.<span class="ruby-identifier">xhr?</span>
252: 
253:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_X_REQUESTED_WITH'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'DefinitelyNotAjax1.0'</span>
254:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">request</span>.<span class="ruby-identifier">xml_http_request?</span>
255:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">request</span>.<span class="ruby-identifier">xhr?</span>
256: 
257:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_X_REQUESTED_WITH'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'XMLHttpRequest'</span>
258:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">xml_http_request?</span>
259:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">xhr?</span>
260:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000562" class="method">
  <div id="M000562_title" class="title">
    <b>test_xml_http_request</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000562_source')" id="l_M000562_source">show source</a> ]</p>
  <div id="M000562_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 332</span>
332:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_xml_http_request</span>
333:     <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">use_accept_header</span>, <span class="ruby-identifier">old</span> =
334:       <span class="ruby-keyword kw">false</span>, <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">use_accept_header</span>
335: 
336:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">stub_request</span> <span class="ruby-value str">'HTTP_X_REQUESTED_WITH'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'XMLHttpRequest'</span>
337:     <span class="ruby-identifier">request</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:parameters</span>).<span class="ruby-identifier">at_least_once</span>.<span class="ruby-identifier">returns</span>({})
338:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">xhr?</span>
339:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Mime</span><span class="ruby-operator">::</span><span class="ruby-constant">JS</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">format</span>
340:   <span class="ruby-keyword kw">ensure</span>
341:     <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">use_accept_header</span> = <span class="ruby-identifier">old</span>
342:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="sectiontitle">Protected Instance methods</div>
<div id="M000570" class="method">
  <div id="M000570_title" class="title">
    <b>stub_request</b>(env={})
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000570_source')" id="l_M000570_source">show source</a> ]</p>
  <div id="M000570_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionpack/test/controller/request_test.rb, line 391</span>
391:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">stub_request</span>(<span class="ruby-identifier">env</span>={})
392:     <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">Request</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">env</span>)
393:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>