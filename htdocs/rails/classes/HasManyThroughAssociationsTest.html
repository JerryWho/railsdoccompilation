  <div id="C00000568">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />HasManyThroughAssociationsTest<br/>
  In:
<a href="#" onclick="jsHref('files/activerecord/test/cases/associations/has_many_through_associations_test_rb.html');">activerecord/test/cases/associations/has_many_through_associations_test.rb</a>

Parent:&nbsp;
ActiveRecord::TestCase
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">




  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M003647&name=test_associate_existing" >test_associate_existing</a></li>
  <li><a href="index.html?a=M003649&name=test_associate_new_by_building" >test_associate_new_by_building</a></li>
  <li><a href="index.html?a=M003656&name=test_associate_with_create" >test_associate_with_create</a></li>
  <li><a href="index.html?a=M003659&name=test_associate_with_create_and_invalid_options" >test_associate_with_create_and_invalid_options</a></li>
  <li><a href="index.html?a=M003657&name=test_associate_with_create_and_no_options" >test_associate_with_create_and_no_options</a></li>
  <li><a href="index.html?a=M003660&name=test_associate_with_create_and_valid_options" >test_associate_with_create_and_valid_options</a></li>
  <li><a href="index.html?a=M003661&name=test_associate_with_create_bang_and_invalid_options" >test_associate_with_create_bang_and_invalid_options</a></li>
  <li><a href="index.html?a=M003662&name=test_associate_with_create_bang_and_valid_options" >test_associate_with_create_bang_and_valid_options</a></li>
  <li><a href="index.html?a=M003658&name=test_associate_with_create_exclamation_and_no_options" >test_associate_with_create_exclamation_and_no_options</a></li>
  <li><a href="index.html?a=M003648&name=test_associating_new" >test_associating_new</a></li>
  <li><a href="index.html?a=M003664&name=test_association_callback_ordering" >test_association_callback_ordering</a></li>
  <li><a href="index.html?a=M003671&name=test_association_proxy_transaction_method_starts_transaction_in_association_class" >test_association_proxy_transaction_method_starts_transaction_in_association_class</a></li>
  <li><a href="index.html?a=M003663&name=test_clear_associations" >test_clear_associations</a></li>
  <li><a href="index.html?a=M003666&name=test_count_with_include_should_alias_join_table" >test_count_with_include_should_alias_join_table</a></li>
  <li><a href="index.html?a=M003650&name=test_delete_association" >test_delete_association</a></li>
  <li><a href="index.html?a=M003652&name=test_destroy_all" >test_destroy_all</a></li>
  <li><a href="index.html?a=M003651&name=test_destroy_association" >test_destroy_association</a></li>
  <li><a href="index.html?a=M003665&name=test_dynamic_find_should_respect_association_include" >test_dynamic_find_should_respect_association_include</a></li>
  <li><a href="index.html?a=M003675&name=test_find_on_has_many_association_collection_with_include_and_conditions" >test_find_on_has_many_association_collection_with_include_and_conditions</a></li>
  <li><a href="index.html?a=M003668&name=test_get_ids" >test_get_ids</a></li>
  <li><a href="index.html?a=M003669&name=test_get_ids_for_loaded_associations" >test_get_ids_for_loaded_associations</a></li>
  <li><a href="index.html?a=M003670&name=test_get_ids_for_unloaded_associations_does_not_load_them" >test_get_ids_for_unloaded_associations_does_not_load_them</a></li>
  <li><a href="index.html?a=M003673&name=test_has_many_association_through_a_belongs_to_association" >test_has_many_association_through_a_belongs_to_association</a></li>
  <li><a href="index.html?a=M003672&name=test_has_many_association_through_a_belongs_to_association_where_the_association_doesnt_exist" >test_has_many_association_through_a_belongs_to_association_where_the_association_doesnt_exist</a></li>
  <li><a href="index.html?a=M003674&name=test_has_many_association_through_a_has_many_association_with_nonstandard_primary_keys" >test_has_many_association_through_a_has_many_association_with_nonstandard_primary_keys</a></li>
  <li><a href="index.html?a=M003676&name=test_has_many_through_has_one_reflection" >test_has_many_through_has_one_reflection</a></li>
  <li><a href="index.html?a=M003667&name=test_inner_join_with_quoted_table_name" >test_inner_join_with_quoted_table_name</a></li>
  <li><a href="index.html?a=M003677&name=test_modifying_has_many_through_has_one_reflection_should_raise" >test_modifying_has_many_through_has_one_reflection_should_raise</a></li>
  <li><a href="index.html?a=M003653&name=test_replace_association" >test_replace_association</a></li>
  <li><a href="index.html?a=M003655&name=test_replace_by_id_order_is_preserved" >test_replace_by_id_order_is_preserved</a></li>
  <li><a href="index.html?a=M003654&name=test_replace_order_is_preserved" >test_replace_order_is_preserved</a></li>
  </ul>






<div class="sectiontitle">Public Instance methods</div>
<div id="M003647" class="method">
  <div id="M003647_title" class="title">
    <b>test_associate_existing</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003647_source')" id="l_M003647_source">show source</a> ]</p>
  <div id="M003647_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 22</span>
22:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_associate_existing</span>
23:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">2</span>) { <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>);<span class="ruby-identifier">people</span>(<span class="ruby-identifier">:david</span>) }
24: 
25:     <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>).<span class="ruby-identifier">people</span>
26: 
27:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">1</span>) <span class="ruby-keyword kw">do</span>
28:       <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>).<span class="ruby-identifier">people</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">people</span>(<span class="ruby-identifier">:david</span>)
29:     <span class="ruby-keyword kw">end</span>
30:     
31:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">1</span>) <span class="ruby-keyword kw">do</span>
32:       <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">people</span>(<span class="ruby-identifier">:david</span>))
33:     <span class="ruby-keyword kw">end</span>
34:     
35:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>).<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">people</span>(<span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">people</span>(<span class="ruby-identifier">:david</span>))
36:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003649" class="method">
  <div id="M003649_title" class="title">
    <b>test_associate_new_by_building</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003649_source')" id="l_M003649_source">show source</a> ]</p>
  <div id="M003649_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 59</span>
59:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_associate_new_by_building</span>
60:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">1</span>) { <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>) }
61:     
62:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">0</span>) <span class="ruby-keyword kw">do</span>
63:       <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">build</span>(<span class="ruby-identifier">:first_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;Bob&quot;</span>)
64:       <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:first_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;Ted&quot;</span>)
65:     <span class="ruby-keyword kw">end</span>
66:     
67:     <span class="ruby-comment cmt"># Should only need to load the association once</span>
68:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">1</span>) <span class="ruby-keyword kw">do</span>
69:       <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">collect</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:first_name</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;Bob&quot;</span>)
70:       <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">collect</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:first_name</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;Ted&quot;</span>)
71:     <span class="ruby-keyword kw">end</span>
72:     
73:     <span class="ruby-comment cmt"># 2 queries for each new record (1 to save the record itself, 1 for the join model)</span>
74:     <span class="ruby-comment cmt">#    * 2 new records = 4</span>
75:     <span class="ruby-comment cmt"># + 1 query to save the actual post = 5</span>
76:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">5</span>) <span class="ruby-keyword kw">do</span>
77:       <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>).<span class="ruby-identifier">body</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">'-changed'</span>
78:       <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>).<span class="ruby-identifier">save</span>
79:     <span class="ruby-keyword kw">end</span>
80:     
81:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>).<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">people</span>(<span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">collect</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:first_name</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;Bob&quot;</span>)
82:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>).<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">people</span>(<span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">collect</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:first_name</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;Ted&quot;</span>)
83:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003656" class="method">
  <div id="M003656_title" class="title">
    <b>test_associate_with_create</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003656_source')" id="l_M003656_source">show source</a> ]</p>
  <div id="M003656_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 157</span>
157:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_associate_with_create</span>
158:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">1</span>) { <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>) }
159:     
160:     <span class="ruby-comment cmt"># 1 query for the new record, 1 for the join table record</span>
161:     <span class="ruby-comment cmt"># No need to update the actual collection yet!</span>
162:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">2</span>) <span class="ruby-keyword kw">do</span>
163:       <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">:first_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;Jeb&quot;</span>)
164:     <span class="ruby-keyword kw">end</span>
165:     
166:     <span class="ruby-comment cmt"># *Now* we actually need the collection so it's loaded</span>
167:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">1</span>) <span class="ruby-keyword kw">do</span>
168:       <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">collect</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:first_name</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;Jeb&quot;</span>)
169:     <span class="ruby-keyword kw">end</span>
170:     
171:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>).<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">people</span>(<span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">collect</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:first_name</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;Jeb&quot;</span>)
172:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003659" class="method">
  <div id="M003659_title" class="title">
    <b>test_associate_with_create_and_invalid_options</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003659_source')" id="l_M003659_source">show source</a> ]</p>
  <div id="M003659_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 186</span>
186:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_associate_with_create_and_invalid_options</span>
187:     <span class="ruby-identifier">peeps</span> = <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>).<span class="ruby-identifier">developers</span>.<span class="ruby-identifier">count</span>
188:     <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>).<span class="ruby-identifier">developers</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'0'</span>) }
189:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">peeps</span>, <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>).<span class="ruby-identifier">developers</span>.<span class="ruby-identifier">count</span>
190:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003657" class="method">
  <div id="M003657_title" class="title">
    <b>test_associate_with_create_and_no_options</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003657_source')" id="l_M003657_source">show source</a> ]</p>
  <div id="M003657_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 174</span>
174:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_associate_with_create_and_no_options</span>
175:     <span class="ruby-identifier">peeps</span> = <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">count</span>
176:     <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'foo'</span>)
177:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">peeps</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">count</span>
178:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003660" class="method">
  <div id="M003660_title" class="title">
    <b>test_associate_with_create_and_valid_options</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003660_source')" id="l_M003660_source">show source</a> ]</p>
  <div id="M003660_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 192</span>
192:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_associate_with_create_and_valid_options</span>
193:     <span class="ruby-identifier">peeps</span> = <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>).<span class="ruby-identifier">developers</span>.<span class="ruby-identifier">count</span>
194:     <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>).<span class="ruby-identifier">developers</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'developer'</span>) }
195:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">peeps</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>).<span class="ruby-identifier">developers</span>.<span class="ruby-identifier">count</span>
196:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003661" class="method">
  <div id="M003661_title" class="title">
    <b>test_associate_with_create_bang_and_invalid_options</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003661_source')" id="l_M003661_source">show source</a> ]</p>
  <div id="M003661_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 198</span>
198:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_associate_with_create_bang_and_invalid_options</span>
199:     <span class="ruby-identifier">peeps</span> = <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>).<span class="ruby-identifier">developers</span>.<span class="ruby-identifier">count</span>
200:     <span class="ruby-identifier">assert_raises</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">RecordInvalid</span>) { <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>).<span class="ruby-identifier">developers</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'0'</span>) }
201:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">peeps</span>, <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>).<span class="ruby-identifier">developers</span>.<span class="ruby-identifier">count</span>
202:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003662" class="method">
  <div id="M003662_title" class="title">
    <b>test_associate_with_create_bang_and_valid_options</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003662_source')" id="l_M003662_source">show source</a> ]</p>
  <div id="M003662_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 204</span>
204:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_associate_with_create_bang_and_valid_options</span>
205:     <span class="ruby-identifier">peeps</span> = <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>).<span class="ruby-identifier">developers</span>.<span class="ruby-identifier">count</span>
206:     <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>).<span class="ruby-identifier">developers</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'developer'</span>) }
207:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">peeps</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>).<span class="ruby-identifier">developers</span>.<span class="ruby-identifier">count</span>
208:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003658" class="method">
  <div id="M003658_title" class="title">
    <b>test_associate_with_create_exclamation_and_no_options</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003658_source')" id="l_M003658_source">show source</a> ]</p>
  <div id="M003658_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 180</span>
180:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_associate_with_create_exclamation_and_no_options</span>
181:     <span class="ruby-identifier">peeps</span> = <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">count</span>
182:     <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'foo'</span>)
183:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">peeps</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">count</span>
184:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003648" class="method">
  <div id="M003648_title" class="title">
    <b>test_associating_new</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003648_source')" id="l_M003648_source">show source</a> ]</p>
  <div id="M003648_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 38</span>
38:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_associating_new</span>
39:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">1</span>) { <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>) }
40:     <span class="ruby-identifier">new_person</span> = <span class="ruby-keyword kw">nil</span> <span class="ruby-comment cmt"># so block binding catches it</span>
41:     
42:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">0</span>) <span class="ruby-keyword kw">do</span>
43:       <span class="ruby-identifier">new_person</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'bob'</span>
44:     <span class="ruby-keyword kw">end</span>
45:     
46:     <span class="ruby-comment cmt"># Associating new records always saves them</span>
47:     <span class="ruby-comment cmt"># Thus, 1 query for the new person record, 1 query for the new join table record</span>
48:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">2</span>) <span class="ruby-keyword kw">do</span>
49:       <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>).<span class="ruby-identifier">people</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">new_person</span>
50:     <span class="ruby-keyword kw">end</span>
51:     
52:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">1</span>) <span class="ruby-keyword kw">do</span>
53:       <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">new_person</span>)
54:     <span class="ruby-keyword kw">end</span>
55:     
56:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>).<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">people</span>(<span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">new_person</span>)
57:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003664" class="method">
  <div id="M003664_title" class="title">
    <b>test_association_callback_ordering</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003664_source')" id="l_M003664_source">show source</a> ]</p>
  <div id="M003664_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 224</span>
224:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_association_callback_ordering</span>
225:     <span class="ruby-constant">Post</span>.<span class="ruby-identifier">reset_log</span>
226:     <span class="ruby-identifier">log</span> = <span class="ruby-constant">Post</span>.<span class="ruby-identifier">log</span>
227:     <span class="ruby-identifier">post</span> = <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:thinking</span>)
228: 
229:     <span class="ruby-identifier">post</span>.<span class="ruby-identifier">people_with_callbacks</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">people</span>(<span class="ruby-identifier">:michael</span>)
230:     <span class="ruby-identifier">assert_equal</span> [
231:       [<span class="ruby-identifier">:added</span>, <span class="ruby-identifier">:before</span>, <span class="ruby-value str">&quot;Michael&quot;</span>],
232:       [<span class="ruby-identifier">:added</span>, <span class="ruby-identifier">:after</span>, <span class="ruby-value str">&quot;Michael&quot;</span>]
233:     ], <span class="ruby-identifier">log</span>.<span class="ruby-identifier">last</span>(<span class="ruby-value">2</span>)
234: 
235:     <span class="ruby-identifier">post</span>.<span class="ruby-identifier">people_with_callbacks</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">people</span>(<span class="ruby-identifier">:david</span>), <span class="ruby-constant">Person</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Bob&quot;</span>), <span class="ruby-constant">Person</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Lary&quot;</span>))
236:     <span class="ruby-identifier">assert_equal</span> [
237:       [<span class="ruby-identifier">:added</span>, <span class="ruby-identifier">:before</span>, <span class="ruby-value str">&quot;David&quot;</span>],
238:       [<span class="ruby-identifier">:added</span>, <span class="ruby-identifier">:after</span>, <span class="ruby-value str">&quot;David&quot;</span>],
239:       [<span class="ruby-identifier">:added</span>, <span class="ruby-identifier">:before</span>, <span class="ruby-value str">&quot;Bob&quot;</span>],
240:       [<span class="ruby-identifier">:added</span>, <span class="ruby-identifier">:after</span>, <span class="ruby-value str">&quot;Bob&quot;</span>],
241:       [<span class="ruby-identifier">:added</span>, <span class="ruby-identifier">:before</span>, <span class="ruby-value str">&quot;Lary&quot;</span>],
242:       [<span class="ruby-identifier">:added</span>, <span class="ruby-identifier">:after</span>, <span class="ruby-value str">&quot;Lary&quot;</span>]
243:     ],<span class="ruby-identifier">log</span>.<span class="ruby-identifier">last</span>(<span class="ruby-value">6</span>)
244: 
245:     <span class="ruby-identifier">post</span>.<span class="ruby-identifier">people_with_callbacks</span>.<span class="ruby-identifier">build</span>(<span class="ruby-identifier">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Ted&quot;</span>)
246:     <span class="ruby-identifier">assert_equal</span> [
247:       [<span class="ruby-identifier">:added</span>, <span class="ruby-identifier">:before</span>, <span class="ruby-value str">&quot;Ted&quot;</span>],
248:       [<span class="ruby-identifier">:added</span>, <span class="ruby-identifier">:after</span>, <span class="ruby-value str">&quot;Ted&quot;</span>]
249:     ], <span class="ruby-identifier">log</span>.<span class="ruby-identifier">last</span>(<span class="ruby-value">2</span>)
250: 
251:     <span class="ruby-identifier">post</span>.<span class="ruby-identifier">people_with_callbacks</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Sam&quot;</span>)
252:     <span class="ruby-identifier">assert_equal</span> [
253:       [<span class="ruby-identifier">:added</span>, <span class="ruby-identifier">:before</span>, <span class="ruby-value str">&quot;Sam&quot;</span>],
254:       [<span class="ruby-identifier">:added</span>, <span class="ruby-identifier">:after</span>, <span class="ruby-value str">&quot;Sam&quot;</span>]
255:     ], <span class="ruby-identifier">log</span>.<span class="ruby-identifier">last</span>(<span class="ruby-value">2</span>)
256: 
257:     <span class="ruby-identifier">post</span>.<span class="ruby-identifier">people_with_callbacks</span> = [<span class="ruby-identifier">people</span>(<span class="ruby-identifier">:michael</span>),<span class="ruby-identifier">people</span>(<span class="ruby-identifier">:david</span>), <span class="ruby-constant">Person</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Julian&quot;</span>), <span class="ruby-constant">Person</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Roger&quot;</span>)]
258:     <span class="ruby-identifier">assert_equal</span> (<span class="ruby-node">%w(Ted Bob Sam Lary)</span> <span class="ruby-operator">*</span> <span class="ruby-value">2</span>).<span class="ruby-identifier">sort</span>, <span class="ruby-identifier">log</span>[<span class="ruby-value">-12</span><span class="ruby-operator">..</span><span class="ruby-value">-5</span>].<span class="ruby-identifier">collect</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:last</span>).<span class="ruby-identifier">sort</span>
259:     <span class="ruby-identifier">assert_equal</span> [
260:       [<span class="ruby-identifier">:added</span>, <span class="ruby-identifier">:before</span>, <span class="ruby-value str">&quot;Julian&quot;</span>],
261:       [<span class="ruby-identifier">:added</span>, <span class="ruby-identifier">:after</span>, <span class="ruby-value str">&quot;Julian&quot;</span>],
262:       [<span class="ruby-identifier">:added</span>, <span class="ruby-identifier">:before</span>, <span class="ruby-value str">&quot;Roger&quot;</span>],
263:       [<span class="ruby-identifier">:added</span>, <span class="ruby-identifier">:after</span>, <span class="ruby-value str">&quot;Roger&quot;</span>]
264:     ], <span class="ruby-identifier">log</span>.<span class="ruby-identifier">last</span>(<span class="ruby-value">4</span>)
265: 
266:     <span class="ruby-identifier">post</span>.<span class="ruby-identifier">people_with_callbacks</span>.<span class="ruby-identifier">clear</span>
267:     <span class="ruby-identifier">assert_equal</span> (<span class="ruby-node">%w(Michael David Julian Roger)</span> <span class="ruby-operator">*</span> <span class="ruby-value">2</span>).<span class="ruby-identifier">sort</span>, <span class="ruby-identifier">log</span>.<span class="ruby-identifier">last</span>(<span class="ruby-value">8</span>).<span class="ruby-identifier">collect</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:last</span>).<span class="ruby-identifier">sort</span>
268:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003671" class="method">
  <div id="M003671_title" class="title">
    <b>test_association_proxy_transaction_method_starts_transaction_in_association_class</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003671_source')" id="l_M003671_source">show source</a> ]</p>
  <div id="M003671_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 304</span>
304:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_association_proxy_transaction_method_starts_transaction_in_association_class</span>
305:     <span class="ruby-constant">Tag</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:transaction</span>)
306:     <span class="ruby-constant">Post</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>).<span class="ruby-identifier">tags</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword kw">do</span>
307:       <span class="ruby-comment cmt"># nothing</span>
308:     <span class="ruby-keyword kw">end</span>
309:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003663" class="method">
  <div id="M003663_title" class="title">
    <b>test_clear_associations</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003663_source')" id="l_M003663_source">show source</a> ]</p>
  <div id="M003663_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 210</span>
210:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_clear_associations</span>
211:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">2</span>) { <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>);<span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">people</span>(<span class="ruby-keyword kw">true</span>) }
212:     
213:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">1</span>) <span class="ruby-keyword kw">do</span>
214:       <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">clear</span>
215:     <span class="ruby-keyword kw">end</span>
216:     
217:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">0</span>) <span class="ruby-keyword kw">do</span>
218:       <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">empty?</span>
219:     <span class="ruby-keyword kw">end</span>
220:     
221:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">people</span>(<span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">empty?</span>
222:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003666" class="method">
  <div id="M003666_title" class="title">
    <b>test_count_with_include_should_alias_join_table</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003666_source')" id="l_M003666_source">show source</a> ]</p>
  <div id="M003666_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 276</span>
276:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_count_with_include_should_alias_join_table</span>
277:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">people</span>(<span class="ruby-identifier">:michael</span>).<span class="ruby-identifier">posts</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:readers</span>)
278:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003650" class="method">
  <div id="M003650_title" class="title">
    <b>test_delete_association</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003650_source')" id="l_M003650_source">show source</a> ]</p>
  <div id="M003650_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 85</span>
85:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_delete_association</span>
86:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">2</span>){<span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>);<span class="ruby-identifier">people</span>(<span class="ruby-identifier">:michael</span>); }
87:     
88:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">1</span>) <span class="ruby-keyword kw">do</span>
89:       <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">people</span>(<span class="ruby-identifier">:michael</span>))
90:     <span class="ruby-keyword kw">end</span>
91:     
92:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">1</span>) <span class="ruby-keyword kw">do</span>
93:       <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">empty?</span>
94:     <span class="ruby-keyword kw">end</span>
95:     
96:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">people</span>(<span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">empty?</span>
97:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003652" class="method">
  <div id="M003652_title" class="title">
    <b>test_destroy_all</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003652_source')" id="l_M003652_source">show source</a> ]</p>
  <div id="M003652_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 108</span>
108:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_destroy_all</span>
109:     <span class="ruby-identifier">assert_difference</span> <span class="ruby-value str">&quot;Person.count&quot;</span>, <span class="ruby-value">-1</span> <span class="ruby-keyword kw">do</span>
110:       <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">destroy_all</span>
111:     <span class="ruby-keyword kw">end</span>
112: 
113:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">people</span>.<span class="ruby-identifier">empty?</span>
114:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">people</span>(<span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">empty?</span>
115:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003651" class="method">
  <div id="M003651_title" class="title">
    <b>test_destroy_association</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003651_source')" id="l_M003651_source">show source</a> ]</p>
  <div id="M003651_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 99</span>
 99:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_destroy_association</span>
100:     <span class="ruby-identifier">assert_difference</span> <span class="ruby-value str">&quot;Person.count&quot;</span>, <span class="ruby-value">-1</span> <span class="ruby-keyword kw">do</span>
101:       <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">destroy</span>(<span class="ruby-identifier">people</span>(<span class="ruby-identifier">:michael</span>))
102:     <span class="ruby-keyword kw">end</span>
103: 
104:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">people</span>.<span class="ruby-identifier">empty?</span>
105:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">people</span>(<span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">empty?</span>
106:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003665" class="method">
  <div id="M003665_title" class="title">
    <b>test_dynamic_find_should_respect_association_include</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003665_source')" id="l_M003665_source">show source</a> ]</p>
  <div id="M003665_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 270</span>
270:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_dynamic_find_should_respect_association_include</span>
271:     <span class="ruby-comment cmt"># SQL error in sort clause if :include is not included</span>
272:     <span class="ruby-comment cmt"># due to Unknown column 'comments.id'</span>
273:     <span class="ruby-identifier">assert</span> <span class="ruby-constant">Person</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>).<span class="ruby-identifier">posts_with_comments_sorted_by_comment_id</span>.<span class="ruby-identifier">find_by_title</span>(<span class="ruby-value str">'Welcome to the weblog'</span>)
274:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003675" class="method">
  <div id="M003675_title" class="title">
    <b>test_find_on_has_many_association_collection_with_include_and_conditions</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003675_source')" id="l_M003675_source">show source</a> ]</p>
  <div id="M003675_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 330</span>
330:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_find_on_has_many_association_collection_with_include_and_conditions</span>
331:     <span class="ruby-identifier">post_with_no_comments</span> = <span class="ruby-identifier">people</span>(<span class="ruby-identifier">:michael</span>).<span class="ruby-identifier">posts_with_no_comments</span>.<span class="ruby-identifier">first</span>
332:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">post_with_no_comments</span>, <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:authorless</span>)
333:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003668" class="method">
  <div id="M003668_title" class="title">
    <b>test_get_ids</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003668_source')" id="l_M003668_source">show source</a> ]</p>
  <div id="M003668_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 284</span>
284:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_get_ids</span>
285:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">id</span>, <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:authorless</span>).<span class="ruby-identifier">id</span>].<span class="ruby-identifier">sort</span>, <span class="ruby-identifier">people</span>(<span class="ruby-identifier">:michael</span>).<span class="ruby-identifier">post_ids</span>.<span class="ruby-identifier">sort</span>
286:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003669" class="method">
  <div id="M003669_title" class="title">
    <b>test_get_ids_for_loaded_associations</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003669_source')" id="l_M003669_source">show source</a> ]</p>
  <div id="M003669_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 288</span>
288:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_get_ids_for_loaded_associations</span>
289:     <span class="ruby-identifier">person</span> = <span class="ruby-identifier">people</span>(<span class="ruby-identifier">:michael</span>)
290:     <span class="ruby-identifier">person</span>.<span class="ruby-identifier">posts</span>(<span class="ruby-keyword kw">true</span>)
291:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">0</span>) <span class="ruby-keyword kw">do</span>
292:       <span class="ruby-identifier">person</span>.<span class="ruby-identifier">post_ids</span>
293:       <span class="ruby-identifier">person</span>.<span class="ruby-identifier">post_ids</span>
294:     <span class="ruby-keyword kw">end</span>
295:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003670" class="method">
  <div id="M003670_title" class="title">
    <b>test_get_ids_for_unloaded_associations_does_not_load_them</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003670_source')" id="l_M003670_source">show source</a> ]</p>
  <div id="M003670_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 297</span>
297:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_get_ids_for_unloaded_associations_does_not_load_them</span>
298:     <span class="ruby-identifier">person</span> = <span class="ruby-identifier">people</span>(<span class="ruby-identifier">:michael</span>)
299:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">person</span>.<span class="ruby-identifier">posts</span>.<span class="ruby-identifier">loaded?</span>
300:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">id</span>, <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:authorless</span>).<span class="ruby-identifier">id</span>].<span class="ruby-identifier">sort</span>, <span class="ruby-identifier">person</span>.<span class="ruby-identifier">post_ids</span>.<span class="ruby-identifier">sort</span>
301:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">person</span>.<span class="ruby-identifier">posts</span>.<span class="ruby-identifier">loaded?</span>
302:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003673" class="method">
  <div id="M003673_title" class="title">
    <b>test_has_many_association_through_a_belongs_to_association</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003673_source')" id="l_M003673_source">show source</a> ]</p>
  <div id="M003673_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 317</span>
317:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_has_many_association_through_a_belongs_to_association</span>
318:     <span class="ruby-identifier">author</span> = <span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:mary</span>)
319:     <span class="ruby-identifier">post</span> = <span class="ruby-constant">Post</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:author</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">author</span>, <span class="ruby-identifier">:title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;TITLE&quot;</span>, <span class="ruby-identifier">:body</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;BODY&quot;</span>)
320:     <span class="ruby-identifier">author</span>.<span class="ruby-identifier">author_favorites</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">:favorite_author_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>)
321:     <span class="ruby-identifier">author</span>.<span class="ruby-identifier">author_favorites</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">:favorite_author_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span>)
322:     <span class="ruby-identifier">author</span>.<span class="ruby-identifier">author_favorites</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">:favorite_author_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">3</span>)
323:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">post</span>.<span class="ruby-identifier">author</span>.<span class="ruby-identifier">author_favorites</span>, <span class="ruby-identifier">post</span>.<span class="ruby-identifier">author_favorites</span>
324:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003672" class="method">
  <div id="M003672_title" class="title">
    <b>test_has_many_association_through_a_belongs_to_association_where_the_association_doesnt_exist</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003672_source')" id="l_M003672_source">show source</a> ]</p>
  <div id="M003672_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 311</span>
311:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_has_many_association_through_a_belongs_to_association_where_the_association_doesnt_exist</span>
312:     <span class="ruby-identifier">author</span> = <span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:mary</span>)
313:     <span class="ruby-identifier">post</span> = <span class="ruby-constant">Post</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;TITLE&quot;</span>, <span class="ruby-identifier">:body</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;BODY&quot;</span>)
314:     <span class="ruby-identifier">assert_equal</span> [], <span class="ruby-identifier">post</span>.<span class="ruby-identifier">author_favorites</span>
315:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003674" class="method">
  <div id="M003674_title" class="title">
    <b>test_has_many_association_through_a_has_many_association_with_nonstandard_primary_keys</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003674_source')" id="l_M003674_source">show source</a> ]</p>
  <div id="M003674_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 326</span>
326:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_has_many_association_through_a_has_many_association_with_nonstandard_primary_keys</span>
327:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">owners</span>(<span class="ruby-identifier">:blackbeard</span>).<span class="ruby-identifier">toys</span>.<span class="ruby-identifier">count</span>
328:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003676" class="method">
  <div id="M003676_title" class="title">
    <b>test_has_many_through_has_one_reflection</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003676_source')" id="l_M003676_source">show source</a> ]</p>
  <div id="M003676_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 335</span>
335:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_has_many_through_has_one_reflection</span>
336:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-identifier">comments</span>(<span class="ruby-identifier">:eager_sti_on_associations_vs_comment</span>)], <span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">very_special_comments</span>
337:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003667" class="method">
  <div id="M003667_title" class="title">
    <b>test_inner_join_with_quoted_table_name</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003667_source')" id="l_M003667_source">show source</a> ]</p>
  <div id="M003667_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 280</span>
280:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_inner_join_with_quoted_table_name</span>
281:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">people</span>(<span class="ruby-identifier">:michael</span>).<span class="ruby-identifier">jobs</span>.<span class="ruby-identifier">size</span>
282:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003677" class="method">
  <div id="M003677_title" class="title">
    <b>test_modifying_has_many_through_has_one_reflection_should_raise</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003677_source')" id="l_M003677_source">show source</a> ]</p>
  <div id="M003677_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 339</span>
339:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_modifying_has_many_through_has_one_reflection_should_raise</span>
340:     [
341:       <span class="ruby-identifier">lambda</span> { <span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">very_special_comments</span> = [<span class="ruby-constant">VerySpecialComment</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:body</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Gorp!&quot;</span>, <span class="ruby-identifier">:post_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1011</span>), <span class="ruby-constant">VerySpecialComment</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:body</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Eep!&quot;</span>, <span class="ruby-identifier">:post_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1012</span>)] },
342:       <span class="ruby-identifier">lambda</span> { <span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">very_special_comments</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">VerySpecialComment</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:body</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Hoohah!&quot;</span>, <span class="ruby-identifier">:post_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1013</span>) },
343:       <span class="ruby-identifier">lambda</span> { <span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">very_special_comments</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">very_special_comments</span>.<span class="ruby-identifier">first</span>) },
344:     ].<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">block</span><span class="ruby-operator">|</span> <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">HasManyThroughCantAssociateThroughHasOneOrManyReflection</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>) }
345:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003653" class="method">
  <div id="M003653_title" class="title">
    <b>test_replace_association</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003653_source')" id="l_M003653_source">show source</a> ]</p>
  <div id="M003653_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 117</span>
117:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_replace_association</span>
118:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">4</span>){<span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>);<span class="ruby-identifier">people</span>(<span class="ruby-identifier">:david</span>);<span class="ruby-identifier">people</span>(<span class="ruby-identifier">:michael</span>); <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">people</span>(<span class="ruby-keyword kw">true</span>)}
119:     
120:     <span class="ruby-comment cmt"># 1 query to delete the existing reader (michael)</span>
121:     <span class="ruby-comment cmt"># 1 query to associate the new reader (david)</span>
122:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">2</span>) <span class="ruby-keyword kw">do</span>
123:       <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">people</span> = [<span class="ruby-identifier">people</span>(<span class="ruby-identifier">:david</span>)]
124:     <span class="ruby-keyword kw">end</span>
125:     
126:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">0</span>){
127:       <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">people</span>(<span class="ruby-identifier">:david</span>))
128:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">people</span>(<span class="ruby-identifier">:michael</span>))
129:     }
130:     
131:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">people</span>(<span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">people</span>(<span class="ruby-identifier">:david</span>))
132:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">people</span>(<span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">people</span>(<span class="ruby-identifier">:michael</span>))
133:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003655" class="method">
  <div id="M003655_title" class="title">
    <b>test_replace_by_id_order_is_preserved</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003655_source')" id="l_M003655_source">show source</a> ]</p>
  <div id="M003655_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 146</span>
146:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_replace_by_id_order_is_preserved</span>
147:     <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">clear</span>
148:     <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">person_ids</span> = [<span class="ruby-identifier">people</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">id</span>, <span class="ruby-identifier">people</span>(<span class="ruby-identifier">:michael</span>).<span class="ruby-identifier">id</span>]
149:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-identifier">people</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">id</span>, <span class="ruby-identifier">people</span>(<span class="ruby-identifier">:michael</span>).<span class="ruby-identifier">id</span>], <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">readers</span>.<span class="ruby-identifier">all</span>(<span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'id'</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:person_id</span>)
150: 
151:     <span class="ruby-comment cmt"># Test the inverse order in case the first success was a coincidence</span>
152:     <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">clear</span>
153:     <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">person_ids</span> = [<span class="ruby-identifier">people</span>(<span class="ruby-identifier">:michael</span>).<span class="ruby-identifier">id</span>, <span class="ruby-identifier">people</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">id</span>]
154:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-identifier">people</span>(<span class="ruby-identifier">:michael</span>).<span class="ruby-identifier">id</span>, <span class="ruby-identifier">people</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">id</span>], <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">readers</span>.<span class="ruby-identifier">all</span>(<span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'id'</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:person_id</span>)
155:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003654" class="method">
  <div id="M003654_title" class="title">
    <b>test_replace_order_is_preserved</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003654_source')" id="l_M003654_source">show source</a> ]</p>
  <div id="M003654_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/associations/has_many_through_associations_test.rb, line 135</span>
135:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_replace_order_is_preserved</span>
136:     <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">clear</span>
137:     <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">people</span> = [<span class="ruby-identifier">people</span>(<span class="ruby-identifier">:david</span>), <span class="ruby-identifier">people</span>(<span class="ruby-identifier">:michael</span>)]
138:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-identifier">people</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">id</span>, <span class="ruby-identifier">people</span>(<span class="ruby-identifier">:michael</span>).<span class="ruby-identifier">id</span>], <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">readers</span>.<span class="ruby-identifier">all</span>(<span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'id'</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:person_id</span>)
139: 
140:     <span class="ruby-comment cmt"># Test the inverse order in case the first success was a coincidence</span>
141:     <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">people</span>.<span class="ruby-identifier">clear</span>
142:     <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">people</span> = [<span class="ruby-identifier">people</span>(<span class="ruby-identifier">:michael</span>), <span class="ruby-identifier">people</span>(<span class="ruby-identifier">:david</span>)]
143:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-identifier">people</span>(<span class="ruby-identifier">:michael</span>).<span class="ruby-identifier">id</span>, <span class="ruby-identifier">people</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">id</span>], <span class="ruby-identifier">posts</span>(<span class="ruby-identifier">:welcome</span>).<span class="ruby-identifier">readers</span>.<span class="ruby-identifier">all</span>(<span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'id'</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:person_id</span>)
144:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>