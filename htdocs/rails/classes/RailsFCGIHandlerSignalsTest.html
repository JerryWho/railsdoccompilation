  <div id="C00000723">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />RailsFCGIHandlerSignalsTest<br/>
  In:
<a href="#" onclick="jsHref('files/railties/test/fcgi_dispatcher_test_rb.html');">railties/test/fcgi_dispatcher_test.rb</a>

Parent:&nbsp;
Test::Unit::TestCase
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">




  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M004667&name=setup" >setup</a></li>
  <li><a href="index.html?a=M004668&name=test_interrupted_via_HUP_when_not_in_request" >test_interrupted_via_HUP_when_not_in_request</a></li>
  <li><a href="index.html?a=M004671&name=test_interrupted_via_TERM" >test_interrupted_via_TERM</a></li>
  <li><a href="index.html?a=M004669&name=test_interrupted_via_USR1_when_not_in_request" >test_interrupted_via_USR1_when_not_in_request</a></li>
  <li><a href="index.html?a=M004670&name=test_restart_via_USR2_when_in_request" >test_restart_via_USR2_when_in_request</a></li>
  <li><a href="index.html?a=M004673&name=test_runtime_error_in_dispatcher" >test_runtime_error_in_dispatcher</a></li>
  <li><a href="index.html?a=M004672&name=test_runtime_exception_in_fcgi" >test_runtime_exception_in_fcgi</a></li>
  <li><a href="index.html?a=M004675&name=test_signal_exception_in_dispatcher" >test_signal_exception_in_dispatcher</a></li>
  <li><a href="index.html?a=M004674&name=test_signal_exception_in_fcgi" >test_signal_exception_in_fcgi</a></li>
  </ul>






<div class="sectiontitle">Public Instance methods</div>
<div id="M004667" class="method">
  <div id="M004667_title" class="title">
    <b>setup</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004667_source')" id="l_M004667_source">show source</a> ]</p>
  <div id="M004667_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File railties/test/fcgi_dispatcher_test.rb, line 137</span>
137:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setup</span>
138:     <span class="ruby-ivar">@log</span> = <span class="ruby-constant">StringIO</span>.<span class="ruby-identifier">new</span>
139:     <span class="ruby-ivar">@handler</span> = <span class="ruby-constant">RailsFCGIHandler</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@log</span>)
140:     <span class="ruby-ivar">@dispatcher</span> = <span class="ruby-identifier">mock</span>
141:     <span class="ruby-constant">Dispatcher</span>.<span class="ruby-identifier">stubs</span>(<span class="ruby-identifier">:new</span>).<span class="ruby-identifier">returns</span>(<span class="ruby-ivar">@dispatcher</span>)
142:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004668" class="method">
  <div id="M004668_title" class="title">
    <b>test_interrupted_via_HUP_when_not_in_request</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004668_source')" id="l_M004668_source">show source</a> ]</p>
  <div id="M004668_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File railties/test/fcgi_dispatcher_test.rb, line 144</span>
144:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_interrupted_via_HUP_when_not_in_request</span>
145:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">mock</span>
146:     <span class="ruby-constant">FCGI</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:each</span>).<span class="ruby-identifier">once</span>.<span class="ruby-identifier">yields</span>(<span class="ruby-identifier">request</span>)
147:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:signal</span>).<span class="ruby-identifier">times</span>(<span class="ruby-value">2</span>).<span class="ruby-identifier">returns</span>(<span class="ruby-value str">'HUP'</span>)
148: 
149:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:reload!</span>).<span class="ruby-identifier">once</span>
150:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:close_connection</span>).<span class="ruby-identifier">never</span>
151:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:exit</span>).<span class="ruby-identifier">never</span>
152: 
153:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">process!</span>
154:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">:reload</span>, <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">when_ready</span>
155:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004671" class="method">
  <div id="M004671_title" class="title">
    <b>test_interrupted_via_TERM</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004671_source')" id="l_M004671_source">show source</a> ]</p>
  <div id="M004671_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File railties/test/fcgi_dispatcher_test.rb, line 186</span>
186:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_interrupted_via_TERM</span>
187:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">mock</span>
188:     <span class="ruby-constant">FCGI</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:each</span>).<span class="ruby-identifier">once</span>.<span class="ruby-identifier">yields</span>(<span class="ruby-identifier">request</span>)
189:     <span class="ruby-operator">::</span><span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Handler</span><span class="ruby-operator">::</span><span class="ruby-constant">FastCGI</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:serve</span>).<span class="ruby-identifier">once</span>.<span class="ruby-identifier">returns</span>(<span class="ruby-value str">'TERM'</span>)
190: 
191:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:reload!</span>).<span class="ruby-identifier">never</span>
192:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:close_connection</span>).<span class="ruby-identifier">never</span>
193: 
194:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">process!</span>
195:     <span class="ruby-identifier">assert_nil</span> <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">when_ready</span>
196:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004669" class="method">
  <div id="M004669_title" class="title">
    <b>test_interrupted_via_USR1_when_not_in_request</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004669_source')" id="l_M004669_source">show source</a> ]</p>
  <div id="M004669_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File railties/test/fcgi_dispatcher_test.rb, line 157</span>
157:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_interrupted_via_USR1_when_not_in_request</span>
158:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">mock</span>
159:     <span class="ruby-constant">FCGI</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:each</span>).<span class="ruby-identifier">once</span>.<span class="ruby-identifier">yields</span>(<span class="ruby-identifier">request</span>)
160:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:signal</span>).<span class="ruby-identifier">times</span>(<span class="ruby-value">2</span>).<span class="ruby-identifier">returns</span>(<span class="ruby-value str">'USR1'</span>)
161:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:exit_handler</span>).<span class="ruby-identifier">never</span>
162: 
163:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:reload!</span>).<span class="ruby-identifier">never</span>
164:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:close_connection</span>).<span class="ruby-identifier">with</span>(<span class="ruby-identifier">request</span>).<span class="ruby-identifier">once</span>
165:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:exit</span>).<span class="ruby-identifier">never</span>
166: 
167:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">process!</span>
168:     <span class="ruby-identifier">assert_nil</span> <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">when_ready</span>
169:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004670" class="method">
  <div id="M004670_title" class="title">
    <b>test_restart_via_USR2_when_in_request</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004670_source')" id="l_M004670_source">show source</a> ]</p>
  <div id="M004670_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File railties/test/fcgi_dispatcher_test.rb, line 171</span>
171:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_restart_via_USR2_when_in_request</span>
172:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">mock</span>
173:     <span class="ruby-constant">FCGI</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:each</span>).<span class="ruby-identifier">once</span>.<span class="ruby-identifier">yields</span>(<span class="ruby-identifier">request</span>)
174:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:signal</span>).<span class="ruby-identifier">times</span>(<span class="ruby-value">2</span>).<span class="ruby-identifier">returns</span>(<span class="ruby-value str">'USR2'</span>)
175:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:exit_handler</span>).<span class="ruby-identifier">never</span>
176: 
177:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:reload!</span>).<span class="ruby-identifier">never</span>
178:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:close_connection</span>).<span class="ruby-identifier">with</span>(<span class="ruby-identifier">request</span>).<span class="ruby-identifier">once</span>
179:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:exit</span>).<span class="ruby-identifier">never</span>
180:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:restart!</span>).<span class="ruby-identifier">once</span>
181: 
182:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">process!</span>
183:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">:restart</span>, <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">when_ready</span>
184:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004673" class="method">
  <div id="M004673_title" class="title">
    <b>test_runtime_error_in_dispatcher</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004673_source')" id="l_M004673_source">show source</a> ]</p>
  <div id="M004673_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File railties/test/fcgi_dispatcher_test.rb, line 206</span>
206:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_runtime_error_in_dispatcher</span>
207:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">mock</span>
208:     <span class="ruby-identifier">error</span> = <span class="ruby-constant">RuntimeError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'foo'</span>)
209:     <span class="ruby-constant">FCGI</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:each</span>).<span class="ruby-identifier">once</span>.<span class="ruby-identifier">yields</span>(<span class="ruby-identifier">request</span>)
210:     <span class="ruby-operator">::</span><span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Handler</span><span class="ruby-operator">::</span><span class="ruby-constant">FastCGI</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:serve</span>).<span class="ruby-identifier">once</span>.<span class="ruby-identifier">raises</span>(<span class="ruby-identifier">error</span>)
211:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:dispatcher_error</span>).<span class="ruby-identifier">with</span>(<span class="ruby-identifier">error</span>, <span class="ruby-identifier">regexp_matches</span>(<span class="ruby-regexp re">/^unhandled/</span>))
212:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">process!</span>
213:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004672" class="method">
  <div id="M004672_title" class="title">
    <b>test_runtime_exception_in_fcgi</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004672_source')" id="l_M004672_source">show source</a> ]</p>
  <div id="M004672_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File railties/test/fcgi_dispatcher_test.rb, line 198</span>
198:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_runtime_exception_in_fcgi</span>
199:     <span class="ruby-identifier">error</span> = <span class="ruby-constant">RuntimeError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'foo'</span>)
200:     <span class="ruby-constant">FCGI</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:each</span>).<span class="ruby-identifier">times</span>(<span class="ruby-value">2</span>).<span class="ruby-identifier">raises</span>(<span class="ruby-identifier">error</span>)
201:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:dispatcher_error</span>).<span class="ruby-identifier">with</span>(<span class="ruby-identifier">error</span>, <span class="ruby-identifier">regexp_matches</span>(<span class="ruby-regexp re">/^retrying/</span>))
202:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:dispatcher_error</span>).<span class="ruby-identifier">with</span>(<span class="ruby-identifier">error</span>, <span class="ruby-identifier">regexp_matches</span>(<span class="ruby-regexp re">/^stopping/</span>))
203:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">process!</span>
204:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004675" class="method">
  <div id="M004675_title" class="title">
    <b>test_signal_exception_in_dispatcher</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004675_source')" id="l_M004675_source">show source</a> ]</p>
  <div id="M004675_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File railties/test/fcgi_dispatcher_test.rb, line 222</span>
222:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_signal_exception_in_dispatcher</span>
223:     <span class="ruby-identifier">request</span> = <span class="ruby-identifier">mock</span>
224:     <span class="ruby-identifier">error</span> = <span class="ruby-constant">SignalException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'USR2'</span>)
225:     <span class="ruby-constant">FCGI</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:each</span>).<span class="ruby-identifier">once</span>.<span class="ruby-identifier">yields</span>(<span class="ruby-identifier">request</span>)
226:     <span class="ruby-operator">::</span><span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Handler</span><span class="ruby-operator">::</span><span class="ruby-constant">FastCGI</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:serve</span>).<span class="ruby-identifier">once</span>.<span class="ruby-identifier">raises</span>(<span class="ruby-identifier">error</span>)
227:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:dispatcher_error</span>).<span class="ruby-identifier">with</span>(<span class="ruby-identifier">error</span>, <span class="ruby-identifier">regexp_matches</span>(<span class="ruby-regexp re">/^stopping/</span>))
228:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">process!</span>
229:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004674" class="method">
  <div id="M004674_title" class="title">
    <b>test_signal_exception_in_fcgi</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004674_source')" id="l_M004674_source">show source</a> ]</p>
  <div id="M004674_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File railties/test/fcgi_dispatcher_test.rb, line 215</span>
215:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_signal_exception_in_fcgi</span>
216:     <span class="ruby-identifier">error</span> = <span class="ruby-constant">SignalException</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'USR2'</span>)
217:     <span class="ruby-constant">FCGI</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:each</span>).<span class="ruby-identifier">once</span>.<span class="ruby-identifier">raises</span>(<span class="ruby-identifier">error</span>)
218:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:dispatcher_error</span>).<span class="ruby-identifier">with</span>(<span class="ruby-identifier">error</span>, <span class="ruby-identifier">regexp_matches</span>(<span class="ruby-regexp re">/^stopping/</span>))
219:     <span class="ruby-ivar">@handler</span>.<span class="ruby-identifier">process!</span>
220:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>