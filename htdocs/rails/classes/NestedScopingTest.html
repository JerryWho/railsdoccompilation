  <div id="C00000743">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />NestedScopingTest<br/>
  In:
<a href="#" onclick="jsHref('files/activerecord/test/cases/method_scoping_test_rb.html');">activerecord/test/cases/method_scoping_test.rb</a>

Parent:&nbsp;
ActiveRecord::TestCase
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">




  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M004763&name=test_append_conditions" >test_append_conditions</a></li>
  <li><a href="index.html?a=M004780&name=test_ensure_that_method_scoping_is_correctly_restored" >test_ensure_that_method_scoping_is_correctly_restored</a></li>
  <li><a href="index.html?a=M004779&name=test_immutable_merged_scope" >test_immutable_merged_scope</a></li>
  <li><a href="index.html?a=M004778&name=test_immutable_nested_scope" >test_immutable_nested_scope</a></li>
  <li><a href="index.html?a=M004764&name=test_merge_and_append_options" >test_merge_and_append_options</a></li>
  <li><a href="index.html?a=M004761&name=test_merge_inner_scope_has_priority" >test_merge_inner_scope_has_priority</a></li>
  <li><a href="index.html?a=M004760&name=test_merge_options" >test_merge_options</a></li>
  <li><a href="index.html?a=M004770&name=test_merged_scoped_find" >test_merged_scoped_find</a></li>
  <li><a href="index.html?a=M004773&name=test_merged_scoped_find_combines_and_sanitizes_conditions" >test_merged_scoped_find_combines_and_sanitizes_conditions</a></li>
  <li><a href="index.html?a=M004777&name=test_merged_scoped_find_on_blank_bind_conditions" >test_merged_scoped_find_on_blank_bind_conditions</a></li>
  <li><a href="index.html?a=M004776&name=test_merged_scoped_find_on_blank_conditions" >test_merged_scoped_find_on_blank_conditions</a></li>
  <li><a href="index.html?a=M004771&name=test_merged_scoped_find_sanitizes_conditions" >test_merged_scoped_find_sanitizes_conditions</a></li>
  <li><a href="index.html?a=M004775&name=test_nested_exclusive_scope_for_create" >test_nested_exclusive_scope_for_create</a></li>
  <li><a href="index.html?a=M004774&name=test_nested_scoped_create" >test_nested_scoped_create</a></li>
  <li><a href="index.html?a=M004765&name=test_nested_scoped_find" >test_nested_scoped_find</a></li>
  <li><a href="index.html?a=M004772&name=test_nested_scoped_find_combines_and_sanitizes_conditions" >test_nested_scoped_find_combines_and_sanitizes_conditions</a></li>
  <li><a href="index.html?a=M004766&name=test_nested_scoped_find_include" >test_nested_scoped_find_include</a></li>
  <li><a href="index.html?a=M004767&name=test_nested_scoped_find_merged_include" >test_nested_scoped_find_merged_include</a></li>
  <li><a href="index.html?a=M004783&name=test_nested_scoped_find_merges_new_and_old_style_joins" >test_nested_scoped_find_merges_new_and_old_style_joins</a></li>
  <li><a href="index.html?a=M004782&name=test_nested_scoped_find_merges_new_style_joins" >test_nested_scoped_find_merges_new_style_joins</a></li>
  <li><a href="index.html?a=M004781&name=test_nested_scoped_find_merges_old_style_joins" >test_nested_scoped_find_merges_old_style_joins</a></li>
  <li><a href="index.html?a=M004768&name=test_nested_scoped_find_replace_include" >test_nested_scoped_find_replace_include</a></li>
  <li><a href="index.html?a=M004762&name=test_replace_options" >test_replace_options</a></li>
  <li><a href="index.html?a=M004769&name=test_three_level_nested_exclusive_scoped_find" >test_three_level_nested_exclusive_scoped_find</a></li>
  </ul>






<div class="sectiontitle">Public Instance methods</div>
<div id="M004763" class="method">
  <div id="M004763_title" class="title">
    <b>test_append_conditions</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004763_source')" id="l_M004763_source">show source</a> ]</p>
  <div id="M004763_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 283</span>
283:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_append_conditions</span>
284:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;name = 'David'&quot;</span> }) <span class="ruby-keyword kw">do</span>
285:       <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'salary = 80000'</span> }) <span class="ruby-keyword kw">do</span>
286:         <span class="ruby-identifier">appended_condition</span> = <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">instance_eval</span>(<span class="ruby-value str">'current_scoped_methods'</span>)[<span class="ruby-identifier">:find</span>][<span class="ruby-identifier">:conditions</span>]
287:         <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value str">&quot;(name = 'David') AND (salary = 80000)&quot;</span>, <span class="ruby-identifier">appended_condition</span>)
288:         <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value">1</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">count</span>)
289:       <span class="ruby-keyword kw">end</span>
290:       <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;name = 'Maiha'&quot;</span> }) <span class="ruby-keyword kw">do</span>
291:         <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value">0</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">count</span>)
292:       <span class="ruby-keyword kw">end</span>
293:     <span class="ruby-keyword kw">end</span>
294:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004780" class="method">
  <div id="M004780_title" class="title">
    <b>test_ensure_that_method_scoping_is_correctly_restored</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004780_source')" id="l_M004780_source">show source</a> ]</p>
  <div id="M004780_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 481</span>
481:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_ensure_that_method_scoping_is_correctly_restored</span>
482:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;name = 'David'&quot;</span> }) <span class="ruby-keyword kw">do</span>
483:       <span class="ruby-identifier">scoped_methods</span> = <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">instance_eval</span>(<span class="ruby-value str">'current_scoped_methods'</span>)
484:       <span class="ruby-keyword kw">begin</span>
485:         <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;name = 'Maiha'&quot;</span> }) <span class="ruby-keyword kw">do</span>
486:           <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;an exception&quot;</span>
487:         <span class="ruby-keyword kw">end</span>
488:       <span class="ruby-keyword kw">rescue</span>
489:       <span class="ruby-keyword kw">end</span>
490:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">scoped_methods</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">instance_eval</span>(<span class="ruby-value str">'current_scoped_methods'</span>)
491:     <span class="ruby-keyword kw">end</span>
492:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004779" class="method">
  <div id="M004779_title" class="title">
    <b>test_immutable_merged_scope</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004779_source')" id="l_M004779_source">show source</a> ]</p>
  <div id="M004779_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 469</span>
469:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_immutable_merged_scope</span>
470:     <span class="ruby-identifier">options1</span> = { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;name = 'Jamis'&quot;</span> }
471:     <span class="ruby-identifier">options2</span> = { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;salary &gt; 10000&quot;</span> }
472:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options1</span>) <span class="ruby-keyword kw">do</span>
473:       <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options2</span>) <span class="ruby-keyword kw">do</span>
474:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w(Jamis)</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-identifier">d</span>.<span class="ruby-identifier">name</span> }
475:         <span class="ruby-identifier">options1</span>[<span class="ruby-identifier">:conditions</span>] = <span class="ruby-identifier">options2</span>[<span class="ruby-identifier">:conditions</span>] = <span class="ruby-keyword kw">nil</span>
476:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w(Jamis)</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-identifier">d</span>.<span class="ruby-identifier">name</span> }
477:       <span class="ruby-keyword kw">end</span>
478:     <span class="ruby-keyword kw">end</span>
479:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004778" class="method">
  <div id="M004778_title" class="title">
    <b>test_immutable_nested_scope</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004778_source')" id="l_M004778_source">show source</a> ]</p>
  <div id="M004778_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 457</span>
457:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_immutable_nested_scope</span>
458:     <span class="ruby-identifier">options1</span> = { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;name = 'Jamis'&quot;</span> }
459:     <span class="ruby-identifier">options2</span> = { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;name = 'David'&quot;</span> }
460:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options1</span>) <span class="ruby-keyword kw">do</span>
461:       <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_exclusive_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options2</span>) <span class="ruby-keyword kw">do</span>
462:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w(David)</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-identifier">d</span>.<span class="ruby-identifier">name</span> }
463:         <span class="ruby-identifier">options1</span>[<span class="ruby-identifier">:conditions</span>] = <span class="ruby-identifier">options2</span>[<span class="ruby-identifier">:conditions</span>] = <span class="ruby-keyword kw">nil</span>
464:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w(David)</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-identifier">d</span>.<span class="ruby-identifier">name</span> }
465:       <span class="ruby-keyword kw">end</span>
466:     <span class="ruby-keyword kw">end</span>
467:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004764" class="method">
  <div id="M004764_title" class="title">
    <b>test_merge_and_append_options</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004764_source')" id="l_M004764_source">show source</a> ]</p>
  <div id="M004764_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 296</span>
296:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_merge_and_append_options</span>
297:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'salary = 80000'</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">10</span> }) <span class="ruby-keyword kw">do</span>
298:       <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;name = 'David'&quot;</span> }) <span class="ruby-keyword kw">do</span>
299:         <span class="ruby-identifier">merged_option</span> = <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">instance_eval</span>(<span class="ruby-value str">'current_scoped_methods'</span>)[<span class="ruby-identifier">:find</span>]
300:         <span class="ruby-identifier">assert_equal</span>({ <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;(salary = 80000) AND (name = 'David')&quot;</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">10</span> }, <span class="ruby-identifier">merged_option</span>)
301:       <span class="ruby-keyword kw">end</span>
302:     <span class="ruby-keyword kw">end</span>
303:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004761" class="method">
  <div id="M004761_title" class="title">
    <b>test_merge_inner_scope_has_priority</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004761_source')" id="l_M004761_source">show source</a> ]</p>
  <div id="M004761_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 265</span>
265:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_merge_inner_scope_has_priority</span>
266:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">5</span> }) <span class="ruby-keyword kw">do</span>
267:       <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">10</span> }) <span class="ruby-keyword kw">do</span>
268:         <span class="ruby-identifier">merged_option</span> = <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">instance_eval</span>(<span class="ruby-value str">'current_scoped_methods'</span>)[<span class="ruby-identifier">:find</span>]
269:         <span class="ruby-identifier">assert_equal</span>({ <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">10</span> }, <span class="ruby-identifier">merged_option</span>)
270:       <span class="ruby-keyword kw">end</span>
271:     <span class="ruby-keyword kw">end</span>
272:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004760" class="method">
  <div id="M004760_title" class="title">
    <b>test_merge_options</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004760_source')" id="l_M004760_source">show source</a> ]</p>
  <div id="M004760_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 256</span>
256:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_merge_options</span>
257:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'salary = 80000'</span> }) <span class="ruby-keyword kw">do</span>
258:       <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">10</span> }) <span class="ruby-keyword kw">do</span>
259:         <span class="ruby-identifier">merged_option</span> = <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">instance_eval</span>(<span class="ruby-value str">'current_scoped_methods'</span>)[<span class="ruby-identifier">:find</span>]
260:         <span class="ruby-identifier">assert_equal</span>({ <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'salary = 80000'</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">10</span> }, <span class="ruby-identifier">merged_option</span>)
261:       <span class="ruby-keyword kw">end</span>
262:     <span class="ruby-keyword kw">end</span>
263:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004770" class="method">
  <div id="M004770_title" class="title">
    <b>test_merged_scoped_find</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004770_source')" id="l_M004770_source">show source</a> ]</p>
  <div id="M004770_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 378</span>
378:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_merged_scoped_find</span>
379:     <span class="ruby-identifier">poor_jamis</span> = <span class="ruby-identifier">developers</span>(<span class="ruby-identifier">:poor_jamis</span>)
380:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;salary &lt; 100000&quot;</span> }) <span class="ruby-keyword kw">do</span>
381:       <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:offset</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'id asc'</span> }) <span class="ruby-keyword kw">do</span>
382:         <span class="ruby-identifier">assert_sql</span> <span class="ruby-regexp re">/ORDER BY id asc /</span> <span class="ruby-keyword kw">do</span>
383:           <span class="ruby-identifier">assert_equal</span>(<span class="ruby-identifier">poor_jamis</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'id asc'</span>))
384:         <span class="ruby-keyword kw">end</span>
385:       <span class="ruby-keyword kw">end</span>
386:     <span class="ruby-keyword kw">end</span>
387:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004773" class="method">
  <div id="M004773_title" class="title">
    <b>test_merged_scoped_find_combines_and_sanitizes_conditions</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004773_source')" id="l_M004773_source">show source</a> ]</p>
  <div id="M004773_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 406</span>
406:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_merged_scoped_find_combines_and_sanitizes_conditions</span>
407:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;name = ?&quot;</span>, <span class="ruby-value str">'David'</span>] }) <span class="ruby-keyword kw">do</span>
408:       <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">'salary &gt; ?'</span>, <span class="ruby-value">9000</span>] }) <span class="ruby-keyword kw">do</span>
409:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w(David)</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-identifier">d</span>.<span class="ruby-identifier">name</span> }
410:       <span class="ruby-keyword kw">end</span>
411:     <span class="ruby-keyword kw">end</span>
412:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004777" class="method">
  <div id="M004777_title" class="title">
    <b>test_merged_scoped_find_on_blank_bind_conditions</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004777_source')" id="l_M004777_source">show source</a> ]</p>
  <div id="M004777_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 447</span>
447:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_merged_scoped_find_on_blank_bind_conditions</span>
448:     [ [<span class="ruby-value str">&quot;&quot;</span>], [<span class="ruby-value str">&quot;&quot;</span>,{}] ].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">blank</span><span class="ruby-operator">|</span>
449:       <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">blank</span>}) <span class="ruby-keyword kw">do</span>
450:         <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">blank</span>}) <span class="ruby-keyword kw">do</span>
451:           <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>) }
452:         <span class="ruby-keyword kw">end</span>
453:       <span class="ruby-keyword kw">end</span>
454:     <span class="ruby-keyword kw">end</span>
455:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004776" class="method">
  <div id="M004776_title" class="title">
    <b>test_merged_scoped_find_on_blank_conditions</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004776_source')" id="l_M004776_source">show source</a> ]</p>
  <div id="M004776_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 437</span>
437:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_merged_scoped_find_on_blank_conditions</span>
438:     [<span class="ruby-keyword kw">nil</span>, <span class="ruby-value str">&quot; &quot;</span>, [], {}].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">blank</span><span class="ruby-operator">|</span>
439:       <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">blank</span>}) <span class="ruby-keyword kw">do</span>
440:         <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">blank</span>}) <span class="ruby-keyword kw">do</span>
441:           <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>) }
442:         <span class="ruby-keyword kw">end</span>
443:       <span class="ruby-keyword kw">end</span>
444:     <span class="ruby-keyword kw">end</span>
445:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004771" class="method">
  <div id="M004771_title" class="title">
    <b>test_merged_scoped_find_sanitizes_conditions</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004771_source')" id="l_M004771_source">show source</a> ]</p>
  <div id="M004771_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 389</span>
389:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_merged_scoped_find_sanitizes_conditions</span>
390:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;name = ?&quot;</span>, <span class="ruby-value str">'David'</span>] }) <span class="ruby-keyword kw">do</span>
391:       <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">'salary = ?'</span>, <span class="ruby-value">9000</span>] }) <span class="ruby-keyword kw">do</span>
392:         <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">RecordNotFound</span>) { <span class="ruby-identifier">developers</span>(<span class="ruby-identifier">:poor_jamis</span>) }
393:       <span class="ruby-keyword kw">end</span>
394:     <span class="ruby-keyword kw">end</span>
395:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004775" class="method">
  <div id="M004775_title" class="title">
    <b>test_nested_exclusive_scope_for_create</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004775_source')" id="l_M004775_source">show source</a> ]</p>
  <div id="M004775_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 425</span>
425:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_nested_exclusive_scope_for_create</span>
426:     <span class="ruby-identifier">comment</span> = <span class="ruby-keyword kw">nil</span>
427:     <span class="ruby-constant">Comment</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:create</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:body</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Hey guys, nested scopes are broken. Please fix!&quot;</span> }) <span class="ruby-keyword kw">do</span>
428:       <span class="ruby-constant">Comment</span>.<span class="ruby-identifier">with_exclusive_scope</span>(<span class="ruby-identifier">:create</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:post_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> }) <span class="ruby-keyword kw">do</span>
429:         <span class="ruby-identifier">assert_equal</span>({ <span class="ruby-identifier">:post_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> }, <span class="ruby-constant">Comment</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">:current_scoped_methods</span>)[<span class="ruby-identifier">:create</span>])
430:         <span class="ruby-identifier">comment</span> = <span class="ruby-constant">Comment</span>.<span class="ruby-identifier">create</span> <span class="ruby-identifier">:body</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Hey guys&quot;</span>
431:       <span class="ruby-keyword kw">end</span>
432:     <span class="ruby-keyword kw">end</span>
433:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">post_id</span>
434:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Hey guys'</span>, <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">body</span>
435:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004774" class="method">
  <div id="M004774_title" class="title">
    <b>test_nested_scoped_create</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004774_source')" id="l_M004774_source">show source</a> ]</p>
  <div id="M004774_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 414</span>
414:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_nested_scoped_create</span>
415:     <span class="ruby-identifier">comment</span> = <span class="ruby-keyword kw">nil</span>
416:     <span class="ruby-constant">Comment</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:create</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:post_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>}) <span class="ruby-keyword kw">do</span>
417:       <span class="ruby-constant">Comment</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:create</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:post_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span>}) <span class="ruby-keyword kw">do</span>
418:         <span class="ruby-identifier">assert_equal</span>({ <span class="ruby-identifier">:post_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span> }, <span class="ruby-constant">Comment</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">:current_scoped_methods</span>)[<span class="ruby-identifier">:create</span>])
419:         <span class="ruby-identifier">comment</span> = <span class="ruby-constant">Comment</span>.<span class="ruby-identifier">create</span> <span class="ruby-identifier">:body</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Hey guys, nested scopes are broken. Please fix!&quot;</span>
420:       <span class="ruby-keyword kw">end</span>
421:     <span class="ruby-keyword kw">end</span>
422:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">post_id</span>
423:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004765" class="method">
  <div id="M004765_title" class="title">
    <b>test_nested_scoped_find</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004765_source')" id="l_M004765_source">show source</a> ]</p>
  <div id="M004765_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 305</span>
305:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_nested_scoped_find</span>
306:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;name = 'Jamis'&quot;</span> }) <span class="ruby-keyword kw">do</span>
307:       <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_exclusive_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;name = 'David'&quot;</span> }) <span class="ruby-keyword kw">do</span>
308:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>) }
309:         <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value str">'David'</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>).<span class="ruby-identifier">name</span>)
310:       <span class="ruby-keyword kw">end</span>
311:       <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value str">'Jamis'</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>).<span class="ruby-identifier">name</span>)
312:     <span class="ruby-keyword kw">end</span>
313:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004772" class="method">
  <div id="M004772_title" class="title">
    <b>test_nested_scoped_find_combines_and_sanitizes_conditions</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004772_source')" id="l_M004772_source">show source</a> ]</p>
  <div id="M004772_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 397</span>
397:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_nested_scoped_find_combines_and_sanitizes_conditions</span>
398:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;name = ?&quot;</span>, <span class="ruby-value str">'David'</span>] }) <span class="ruby-keyword kw">do</span>
399:       <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_exclusive_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">'salary = ?'</span>, <span class="ruby-value">9000</span>] }) <span class="ruby-keyword kw">do</span>
400:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">developers</span>(<span class="ruby-identifier">:poor_jamis</span>), <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>)
401:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">developers</span>(<span class="ruby-identifier">:poor_jamis</span>), <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">'name = ?'</span>, <span class="ruby-value str">'Jamis'</span>])
402:       <span class="ruby-keyword kw">end</span>
403:     <span class="ruby-keyword kw">end</span>
404:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004766" class="method">
  <div id="M004766_title" class="title">
    <b>test_nested_scoped_find_include</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004766_source')" id="l_M004766_source">show source</a> ]</p>
  <div id="M004766_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 315</span>
315:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_nested_scoped_find_include</span>
316:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:projects</span> }) <span class="ruby-keyword kw">do</span>
317:       <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;projects.id = 2&quot;</span> }) <span class="ruby-keyword kw">do</span>
318:         <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>) }
319:         <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value str">'David'</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>).<span class="ruby-identifier">name</span>)
320:       <span class="ruby-keyword kw">end</span>
321:     <span class="ruby-keyword kw">end</span>
322:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004767" class="method">
  <div id="M004767_title" class="title">
    <b>test_nested_scoped_find_merged_include</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004767_source')" id="l_M004767_source">show source</a> ]</p>
  <div id="M004767_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 324</span>
324:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_nested_scoped_find_merged_include</span>
325:     <span class="ruby-comment cmt"># :include's remain unique and don't &quot;double up&quot; when merging</span>
326:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:projects</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;projects.id = 2&quot;</span> }) <span class="ruby-keyword kw">do</span>
327:       <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:projects</span> }) <span class="ruby-keyword kw">do</span>
328:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">instance_eval</span>(<span class="ruby-value str">'current_scoped_methods'</span>)[<span class="ruby-identifier">:find</span>][<span class="ruby-identifier">:include</span>].<span class="ruby-identifier">length</span>
329:         <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value str">'David'</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>).<span class="ruby-identifier">name</span>)
330:       <span class="ruby-keyword kw">end</span>
331:     <span class="ruby-keyword kw">end</span>
332: 
333:     <span class="ruby-comment cmt"># the nested scope doesn't remove the first :include</span>
334:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:projects</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;projects.id = 2&quot;</span> }) <span class="ruby-keyword kw">do</span>
335:       <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> [] }) <span class="ruby-keyword kw">do</span>
336:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">instance_eval</span>(<span class="ruby-value str">'current_scoped_methods'</span>)[<span class="ruby-identifier">:find</span>][<span class="ruby-identifier">:include</span>].<span class="ruby-identifier">length</span>
337:         <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value str">'David'</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>).<span class="ruby-identifier">name</span>)
338:       <span class="ruby-keyword kw">end</span>
339:     <span class="ruby-keyword kw">end</span>
340: 
341:     <span class="ruby-comment cmt"># mixing array and symbol include's will merge correctly</span>
342:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:projects</span>], <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;projects.id = 2&quot;</span> }) <span class="ruby-keyword kw">do</span>
343:       <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:projects</span> }) <span class="ruby-keyword kw">do</span>
344:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">instance_eval</span>(<span class="ruby-value str">'current_scoped_methods'</span>)[<span class="ruby-identifier">:find</span>][<span class="ruby-identifier">:include</span>].<span class="ruby-identifier">length</span>
345:         <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value str">'David'</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>).<span class="ruby-identifier">name</span>)
346:       <span class="ruby-keyword kw">end</span>
347:     <span class="ruby-keyword kw">end</span>
348:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004783" class="method">
  <div id="M004783_title" class="title">
    <b>test_nested_scoped_find_merges_new_and_old_style_joins</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004783_source')" id="l_M004783_source">show source</a> ]</p>
  <div id="M004783_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 518</span>
518:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_nested_scoped_find_merges_new_and_old_style_joins</span>
519:     <span class="ruby-identifier">scoped_authors</span> = <span class="ruby-constant">Author</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:posts</span> }) <span class="ruby-keyword kw">do</span>
520:       <span class="ruby-constant">Author</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'INNER JOIN comments ON posts.id = comments.post_id'</span> }) <span class="ruby-keyword kw">do</span>
521:         <span class="ruby-constant">Author</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'DISTINCT authors.*'</span>, <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">''</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'comments.id = 1'</span>)
522:       <span class="ruby-keyword kw">end</span>
523:     <span class="ruby-keyword kw">end</span>
524:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>))
525:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:mary</span>))
526:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">size</span>
527:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">attributes</span>, <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">attributes</span>
528:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004782" class="method">
  <div id="M004782_title" class="title">
    <b>test_nested_scoped_find_merges_new_style_joins</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004782_source')" id="l_M004782_source">show source</a> ]</p>
  <div id="M004782_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 506</span>
506:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_nested_scoped_find_merges_new_style_joins</span>
507:     <span class="ruby-identifier">scoped_authors</span> = <span class="ruby-constant">Author</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:posts</span> }) <span class="ruby-keyword kw">do</span>
508:       <span class="ruby-constant">Author</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:comments</span> }) <span class="ruby-keyword kw">do</span>
509:         <span class="ruby-constant">Author</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'DISTINCT authors.*'</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'comments.id = 1'</span>)
510:       <span class="ruby-keyword kw">end</span>
511:     <span class="ruby-keyword kw">end</span>
512:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>))
513:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:mary</span>))
514:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">size</span>
515:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">attributes</span>, <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">attributes</span>
516:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004781" class="method">
  <div id="M004781_title" class="title">
    <b>test_nested_scoped_find_merges_old_style_joins</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004781_source')" id="l_M004781_source">show source</a> ]</p>
  <div id="M004781_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 494</span>
494:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_nested_scoped_find_merges_old_style_joins</span>
495:     <span class="ruby-identifier">scoped_authors</span> = <span class="ruby-constant">Author</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'INNER JOIN posts ON authors.id = posts.author_id'</span> }) <span class="ruby-keyword kw">do</span>
496:       <span class="ruby-constant">Author</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'INNER JOIN comments ON posts.id = comments.post_id'</span> }) <span class="ruby-keyword kw">do</span>
497:         <span class="ruby-constant">Author</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'DISTINCT authors.*'</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'comments.id = 1'</span>)
498:       <span class="ruby-keyword kw">end</span>
499:     <span class="ruby-keyword kw">end</span>
500:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>))
501:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:mary</span>))
502:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">size</span>
503:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">attributes</span>, <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">attributes</span>
504:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004768" class="method">
  <div id="M004768_title" class="title">
    <b>test_nested_scoped_find_replace_include</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004768_source')" id="l_M004768_source">show source</a> ]</p>
  <div id="M004768_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 350</span>
350:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_nested_scoped_find_replace_include</span>
351:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:projects</span> }) <span class="ruby-keyword kw">do</span>
352:       <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_exclusive_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> [] }) <span class="ruby-keyword kw">do</span>
353:         <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">0</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">instance_eval</span>(<span class="ruby-value str">'current_scoped_methods'</span>)[<span class="ruby-identifier">:find</span>][<span class="ruby-identifier">:include</span>].<span class="ruby-identifier">length</span>
354:       <span class="ruby-keyword kw">end</span>
355:     <span class="ruby-keyword kw">end</span>
356:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004762" class="method">
  <div id="M004762_title" class="title">
    <b>test_replace_options</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004762_source')" id="l_M004762_source">show source</a> ]</p>
  <div id="M004762_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 274</span>
274:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_replace_options</span>
275:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;name = 'David'&quot;</span> }) <span class="ruby-keyword kw">do</span>
276:       <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_exclusive_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;name = 'Jamis'&quot;</span> }) <span class="ruby-keyword kw">do</span>
277:         <span class="ruby-identifier">assert_equal</span>({<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;name = 'Jamis'&quot;</span> }}, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">instance_eval</span>(<span class="ruby-value str">'current_scoped_methods'</span>))
278:         <span class="ruby-identifier">assert_equal</span>({<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;name = 'Jamis'&quot;</span> }}, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">:scoped_methods</span>)[<span class="ruby-value">-1</span>])
279:       <span class="ruby-keyword kw">end</span>
280:     <span class="ruby-keyword kw">end</span>
281:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M004769" class="method">
  <div id="M004769_title" class="title">
    <b>test_three_level_nested_exclusive_scoped_find</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M004769_source')" id="l_M004769_source">show source</a> ]</p>
  <div id="M004769_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 358</span>
358:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_three_level_nested_exclusive_scoped_find</span>
359:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;name = 'Jamis'&quot;</span> }) <span class="ruby-keyword kw">do</span>
360:       <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value str">'Jamis'</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>).<span class="ruby-identifier">name</span>)
361: 
362:       <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_exclusive_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;name = 'David'&quot;</span> }) <span class="ruby-keyword kw">do</span>
363:         <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value str">'David'</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>).<span class="ruby-identifier">name</span>)
364: 
365:         <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_exclusive_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;name = 'Maiha'&quot;</span> }) <span class="ruby-keyword kw">do</span>
366:           <span class="ruby-identifier">assert_equal</span>(<span class="ruby-keyword kw">nil</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>))
367:         <span class="ruby-keyword kw">end</span>
368: 
369:         <span class="ruby-comment cmt"># ensure that scoping is restored</span>
370:         <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value str">'David'</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>).<span class="ruby-identifier">name</span>)
371:       <span class="ruby-keyword kw">end</span>
372: 
373:       <span class="ruby-comment cmt"># ensure that scoping is restored</span>
374:       <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value str">'Jamis'</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>).<span class="ruby-identifier">name</span>)
375:     <span class="ruby-keyword kw">end</span>
376:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>