  <div id="C00000428">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />TestNestedAttributesInGeneral<br/>
  In:
<a href="#" onclick="jsHref('files/activerecord/test/cases/nested_attributes_test_rb.html');">activerecord/test/cases/nested_attributes_test.rb</a>

Parent:&nbsp;
ActiveRecord::TestCase
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">




  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M002837&name=teardown" >teardown</a></li>
  <li><a href="index.html?a=M002844&name=test_a_model_should_respond_to_underscore_destroy_and_return_if_it_is_marked_for_destruction" >test_a_model_should_respond_to_underscore_destroy_and_return_if_it_is_marked_for_destruction</a></li>
  <li><a href="index.html?a=M002838&name=test_base_should_have_an_empty_nested_attributes_options" >test_base_should_have_an_empty_nested_attributes_options</a></li>
  <li><a href="index.html?a=M002846&name=test_reject_if_method_with_arguments" >test_reject_if_method_with_arguments</a></li>
  <li><a href="index.html?a=M002845&name=test_reject_if_method_without_arguments" >test_reject_if_method_without_arguments</a></li>
  <li><a href="index.html?a=M002847&name=test_reject_if_with_indifferent_keys" >test_reject_if_with_indifferent_keys</a></li>
  <li><a href="index.html?a=M002839&name=test_should_add_a_proc_to_nested_attributes_options" >test_should_add_a_proc_to_nested_attributes_options</a></li>
  <li><a href="index.html?a=M002841&name=test_should_build_a_new_record_if_reject_all_blank_does_not_return_false" >test_should_build_a_new_record_if_reject_all_blank_does_not_return_false</a></li>
  <li><a href="index.html?a=M002843&name=test_should_disable_allow_destroy_by_default" >test_should_disable_allow_destroy_by_default</a></li>
  <li><a href="index.html?a=M002840&name=test_should_not_build_a_new_record_if_reject_all_blank_returns_false" >test_should_not_build_a_new_record_if_reject_all_blank_returns_false</a></li>
  <li><a href="index.html?a=M002842&name=test_should_raise_an_ArgumentError_for_non_existing_associations" >test_should_raise_an_ArgumentError_for_non_existing_associations</a></li>
  </ul>

<div class="sectiontitle">Included Modules</div>
<ul>
  <li><a href="#" onclick="jsHref('classes/AssertRaiseWithMessage.html');">AssertRaiseWithMessage</a></li>
</ul>





<div class="sectiontitle">Public Instance methods</div>
<div id="M002837" class="method">
  <div id="M002837_title" class="title">
    <b>teardown</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002837_source')" id="l_M002837_source">show source</a> ]</p>
  <div id="M002837_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 30</span>
30:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">teardown</span>
31:     <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">accepts_nested_attributes_for</span> <span class="ruby-identifier">:ship</span>, <span class="ruby-identifier">:allow_destroy</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:reject_if</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">proc</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">attributes</span><span class="ruby-operator">|</span> <span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">empty?</span> }
32:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002844" class="method">
  <div id="M002844_title" class="title">
    <b>test_a_model_should_respond_to_underscore_destroy_and_return_if_it_is_marked_for_destruction</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002844_source')" id="l_M002844_source">show source</a> ]</p>
  <div id="M002844_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 80</span>
80:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_a_model_should_respond_to_underscore_destroy_and_return_if_it_is_marked_for_destruction</span>
81:     <span class="ruby-identifier">ship</span> = <span class="ruby-constant">Ship</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Nights Dirty Lightning'</span>)
82:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">ship</span>.<span class="ruby-identifier">_destroy</span>
83:     <span class="ruby-identifier">ship</span>.<span class="ruby-identifier">mark_for_destruction</span>
84:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">ship</span>.<span class="ruby-identifier">_destroy</span>
85:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002838" class="method">
  <div id="M002838_title" class="title">
    <b>test_base_should_have_an_empty_nested_attributes_options</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002838_source')" id="l_M002838_source">show source</a> ]</p>
  <div id="M002838_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 34</span>
34:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_base_should_have_an_empty_nested_attributes_options</span>
35:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>, <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">nested_attributes_options</span>
36:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002846" class="method">
  <div id="M002846_title" class="title">
    <b>test_reject_if_method_with_arguments</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002846_source')" id="l_M002846_source">show source</a> ]</p>
  <div id="M002846_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 95</span>
 95:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_reject_if_method_with_arguments</span>
 96:     <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">accepts_nested_attributes_for</span> <span class="ruby-identifier">:ship</span>, <span class="ruby-identifier">:reject_if</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:reject_empty_ships_on_create</span>
 97: 
 98:     <span class="ruby-identifier">pirate</span> = <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:catchphrase</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Stop wastin' me time&quot;</span>)
 99:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">ship_attributes</span> = { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Red Pearl'</span>, <span class="ruby-identifier">:_reject_me_if_new</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span> }
100:     <span class="ruby-identifier">assert_no_difference</span>(<span class="ruby-value str">'Ship.count'</span>) { <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">save!</span> }
101: 
102:     <span class="ruby-comment cmt"># pirate.reject_empty_ships_on_create returns false for saved records</span>
103:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">ship_attributes</span> = { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Red Pearl'</span>, <span class="ruby-identifier">:_reject_me_if_new</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span> }
104:     <span class="ruby-identifier">assert_difference</span>(<span class="ruby-value str">'Ship.count'</span>) { <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">save!</span> }
105:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002845" class="method">
  <div id="M002845_title" class="title">
    <b>test_reject_if_method_without_arguments</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002845_source')" id="l_M002845_source">show source</a> ]</p>
  <div id="M002845_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 87</span>
87:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_reject_if_method_without_arguments</span>
88:     <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">accepts_nested_attributes_for</span> <span class="ruby-identifier">:ship</span>, <span class="ruby-identifier">:reject_if</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:new_record?</span>
89: 
90:     <span class="ruby-identifier">pirate</span> = <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:catchphrase</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Stop wastin' me time&quot;</span>)
91:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">ship_attributes</span> = { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Black Pearl'</span> }
92:     <span class="ruby-identifier">assert_no_difference</span>(<span class="ruby-value str">'Ship.count'</span>) { <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">save!</span> }
93:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002847" class="method">
  <div id="M002847_title" class="title">
    <b>test_reject_if_with_indifferent_keys</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002847_source')" id="l_M002847_source">show source</a> ]</p>
  <div id="M002847_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 107</span>
107:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_reject_if_with_indifferent_keys</span>
108:     <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">accepts_nested_attributes_for</span> <span class="ruby-identifier">:ship</span>, <span class="ruby-identifier">:reject_if</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">proc</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">attributes</span><span class="ruby-operator">|</span> <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:name</span>].<span class="ruby-identifier">blank?</span> }
109: 
110:     <span class="ruby-identifier">pirate</span> = <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:catchphrase</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Stop wastin' me time&quot;</span>)
111:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">ship_attributes</span> = { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Hello Pearl'</span> }
112:     <span class="ruby-identifier">assert_difference</span>(<span class="ruby-value str">'Ship.count'</span>) { <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">save!</span> }
113:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002839" class="method">
  <div id="M002839_title" class="title">
    <b>test_should_add_a_proc_to_nested_attributes_options</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002839_source')" id="l_M002839_source">show source</a> ]</p>
  <div id="M002839_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 38</span>
38:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_add_a_proc_to_nested_attributes_options</span>
39:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">NestedAttributes</span><span class="ruby-operator">::</span><span class="ruby-constant">ClassMethods</span><span class="ruby-operator">::</span><span class="ruby-constant">REJECT_ALL_BLANK_PROC</span>,
40:                  <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">nested_attributes_options</span>[<span class="ruby-identifier">:birds_with_reject_all_blank</span>][<span class="ruby-identifier">:reject_if</span>]
41:     
42:     [<span class="ruby-identifier">:parrots</span>, <span class="ruby-identifier">:birds</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span>
43:       <span class="ruby-identifier">assert_instance_of</span> <span class="ruby-constant">Proc</span>, <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">nested_attributes_options</span>[<span class="ruby-identifier">name</span>][<span class="ruby-identifier">:reject_if</span>]
44:     <span class="ruby-keyword kw">end</span>
45:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002841" class="method">
  <div id="M002841_title" class="title">
    <b>test_should_build_a_new_record_if_reject_all_blank_does_not_return_false</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002841_source')" id="l_M002841_source">show source</a> ]</p>
  <div id="M002841_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 55</span>
55:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_build_a_new_record_if_reject_all_blank_does_not_return_false</span>
56:     <span class="ruby-identifier">pirate</span> = <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:catchphrase</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Don' botharrr talkin' like one, savvy?&quot;</span>)
57:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">birds_with_reject_all_blank_attributes</span> = [{<span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Tweetie'</span>, <span class="ruby-identifier">:color</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">''</span>}]
58:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">save!</span>
59: 
60:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">birds_with_reject_all_blank</span>.<span class="ruby-identifier">count</span>
61:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002843" class="method">
  <div id="M002843_title" class="title">
    <b>test_should_disable_allow_destroy_by_default</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002843_source')" id="l_M002843_source">show source</a> ]</p>
  <div id="M002843_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 69</span>
69:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_disable_allow_destroy_by_default</span>
70:     <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">accepts_nested_attributes_for</span> <span class="ruby-identifier">:ship</span>
71: 
72:     <span class="ruby-identifier">pirate</span> = <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:catchphrase</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Don' botharrr talkin' like one, savvy?&quot;</span>)
73:     <span class="ruby-identifier">ship</span> = <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">create_ship</span>(<span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Nights Dirty Lightning'</span>)
74: 
75:     <span class="ruby-identifier">assert_no_difference</span>(<span class="ruby-value str">'Ship.count'</span>) <span class="ruby-keyword kw">do</span>
76:       <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">:ship_attributes</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-value str">'_destroy'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span> })
77:     <span class="ruby-keyword kw">end</span>
78:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002840" class="method">
  <div id="M002840_title" class="title">
    <b>test_should_not_build_a_new_record_if_reject_all_blank_returns_false</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002840_source')" id="l_M002840_source">show source</a> ]</p>
  <div id="M002840_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 47</span>
47:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_not_build_a_new_record_if_reject_all_blank_returns_false</span>
48:     <span class="ruby-identifier">pirate</span> = <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:catchphrase</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Don' botharrr talkin' like one, savvy?&quot;</span>)
49:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">birds_with_reject_all_blank_attributes</span> = [{<span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">''</span>, <span class="ruby-identifier">:color</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">''</span>}]
50:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">save!</span>
51: 
52:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">birds_with_reject_all_blank</span>.<span class="ruby-identifier">empty?</span>
53:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002842" class="method">
  <div id="M002842_title" class="title">
    <b>test_should_raise_an_ArgumentError_for_non_existing_associations</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002842_source')" id="l_M002842_source">show source</a> ]</p>
  <div id="M002842_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/nested_attributes_test.rb, line 63</span>
63:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_raise_an_ArgumentError_for_non_existing_associations</span>
64:     <span class="ruby-identifier">assert_raise_with_message</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">&quot;No association found for name `honesty'. Has it been defined yet?&quot;</span> <span class="ruby-keyword kw">do</span>
65:       <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">accepts_nested_attributes_for</span> <span class="ruby-identifier">:honesty</span>
66:     <span class="ruby-keyword kw">end</span>
67:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>