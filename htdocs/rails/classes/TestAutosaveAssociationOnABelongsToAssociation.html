  <div id="C00000825">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />TestAutosaveAssociationOnABelongsToAssociation<br/>
  In:
<a href="#" onclick="jsHref('files/activerecord/test/cases/autosave_association_test_rb.html');">activerecord/test/cases/autosave_association_test.rb</a>

Parent:&nbsp;
ActiveRecord::TestCase
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">




  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M005517&name=setup" >setup</a></li>
  <li><a href="index.html?a=M005520&name=test_should_automatically_save_bang_the_associated_model" >test_should_automatically_save_bang_the_associated_model</a></li>
  <li><a href="index.html?a=M005519&name=test_should_automatically_save_the_associated_model" >test_should_automatically_save_the_associated_model</a></li>
  <li><a href="index.html?a=M005521&name=test_should_automatically_validate_the_associated_model" >test_should_automatically_validate_the_associated_model</a></li>
  <li><a href="index.html?a=M005522&name=test_should_merge_errors_on_the_associated_model_onto_the_parent_even_if_it_is_not_valid" >test_should_merge_errors_on_the_associated_model_onto_the_parent_even_if_it_is_not_valid</a></li>
  <li><a href="index.html?a=M005526&name=test_should_not_load_the_associated_model" >test_should_not_load_the_associated_model</a></li>
  <li><a href="index.html?a=M005525&name=test_should_rollback_any_changes_if_an_exception_occurred_while_saving" >test_should_rollback_any_changes_if_an_exception_occurred_while_saving</a></li>
  <li><a href="index.html?a=M005523&name=test_should_still_allow_to_bypass_validations_on_the_associated_model" >test_should_still_allow_to_bypass_validations_on_the_associated_model</a></li>
  <li><a href="index.html?a=M005524&name=test_should_still_raise_an_ActiveRecordRecord_Invalid_exception_if_we_want_that" >test_should_still_raise_an_ActiveRecordRecord_Invalid_exception_if_we_want_that</a></li>
  <li><a href="index.html?a=M005518&name=test_should_still_work_without_an_associated_model" >test_should_still_work_without_an_associated_model</a></li>
  </ul>






<div class="sectiontitle">Public Instance methods</div>
<div id="M005517" class="method">
  <div id="M005517_title" class="title">
    <b>setup</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005517_source')" id="l_M005517_source">show source</a> ]</p>
  <div id="M005517_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 712</span>
712:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setup</span>
713:     <span class="ruby-ivar">@ship</span> = <span class="ruby-constant">Ship</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Nights Dirty Lightning'</span>)
714:     <span class="ruby-ivar">@pirate</span> = <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">create_pirate</span>(<span class="ruby-identifier">:catchphrase</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Don' botharrr talkin' like one, savvy?&quot;</span>)
715:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005520" class="method">
  <div id="M005520_title" class="title">
    <b>test_should_automatically_save_bang_the_associated_model</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005520_source')" id="l_M005520_source">show source</a> ]</p>
  <div id="M005520_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 730</span>
730:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_automatically_save_bang_the_associated_model</span>
731:     <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase</span> = <span class="ruby-value str">'Arr'</span>
732:     <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">save!</span>
733:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Arr'</span>, <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase</span>
734:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005519" class="method">
  <div id="M005519_title" class="title">
    <b>test_should_automatically_save_the_associated_model</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005519_source')" id="l_M005519_source">show source</a> ]</p>
  <div id="M005519_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 724</span>
724:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_automatically_save_the_associated_model</span>
725:     <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase</span> = <span class="ruby-value str">'Arr'</span>
726:     <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">save</span>
727:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'Arr'</span>, <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase</span>
728:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005521" class="method">
  <div id="M005521_title" class="title">
    <b>test_should_automatically_validate_the_associated_model</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005521_source')" id="l_M005521_source">show source</a> ]</p>
  <div id="M005521_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 736</span>
736:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_automatically_validate_the_associated_model</span>
737:     <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase</span> = <span class="ruby-value str">''</span>
738:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">valid?</span>
739:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">on</span>(<span class="ruby-identifier">:pirate_catchphrase</span>).<span class="ruby-identifier">blank?</span>
740:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005522" class="method">
  <div id="M005522_title" class="title">
    <b>test_should_merge_errors_on_the_associated_model_onto_the_parent_even_if_it_is_not_valid</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005522_source')" id="l_M005522_source">show source</a> ]</p>
  <div id="M005522_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 742</span>
742:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_merge_errors_on_the_associated_model_onto_the_parent_even_if_it_is_not_valid</span>
743:     <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">name</span> = <span class="ruby-keyword kw">nil</span>
744:     <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase</span> = <span class="ruby-keyword kw">nil</span>
745:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">valid?</span>
746:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">on</span>(<span class="ruby-identifier">:name</span>).<span class="ruby-identifier">blank?</span>
747:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">on</span>(<span class="ruby-identifier">:pirate_catchphrase</span>).<span class="ruby-identifier">blank?</span>
748:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005526" class="method">
  <div id="M005526_title" class="title">
    <b>test_should_not_load_the_associated_model</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005526_source')" id="l_M005526_source">show source</a> ]</p>
  <div id="M005526_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 783</span>
783:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_not_load_the_associated_model</span>
784:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">1</span>) { <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">name</span> = <span class="ruby-value str">'The Vile Insanity'</span>; <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">save!</span> }
785:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005525" class="method">
  <div id="M005525_title" class="title">
    <b>test_should_rollback_any_changes_if_an_exception_occurred_while_saving</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005525_source')" id="l_M005525_source">show source</a> ]</p>
  <div id="M005525_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 764</span>
764:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_rollback_any_changes_if_an_exception_occurred_while_saving</span>
765:     <span class="ruby-identifier">before</span> = [<span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase</span>, <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">name</span>]
766: 
767:     <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase</span> = <span class="ruby-value str">'Arr'</span>
768:     <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">name</span> = <span class="ruby-value str">'The Vile Insanity'</span>
769: 
770:     <span class="ruby-comment cmt"># Stub the save method of the @ship.pirate instance to raise an exception</span>
771:     <span class="ruby-keyword kw">class</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">pirate</span>
772:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">save</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
773:         <span class="ruby-keyword kw">super</span>
774:         <span class="ruby-identifier">raise</span> <span class="ruby-value str">'Oh noes!'</span>
775:       <span class="ruby-keyword kw">end</span>
776:     <span class="ruby-keyword kw">end</span>
777: 
778:     <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">RuntimeError</span>) { <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">save</span> }
779:     <span class="ruby-comment cmt"># TODO: Why does using reload on @ship looses the associated pirate?</span>
780:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">before</span>, [<span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">catchphrase</span>, <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">name</span>]
781:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005523" class="method">
  <div id="M005523_title" class="title">
    <b>test_should_still_allow_to_bypass_validations_on_the_associated_model</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005523_source')" id="l_M005523_source">show source</a> ]</p>
  <div id="M005523_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 750</span>
750:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_still_allow_to_bypass_validations_on_the_associated_model</span>
751:     <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase</span> = <span class="ruby-value str">''</span>
752:     <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">name</span> = <span class="ruby-value str">''</span>
753:     <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">save</span>(<span class="ruby-keyword kw">false</span>)
754:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-value str">''</span>, <span class="ruby-value str">''</span>], [<span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">name</span>, <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase</span>]
755:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005524" class="method">
  <div id="M005524_title" class="title">
    <b>test_should_still_raise_an_ActiveRecordRecord_Invalid_exception_if_we_want_that</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005524_source')" id="l_M005524_source">show source</a> ]</p>
  <div id="M005524_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 757</span>
757:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_still_raise_an_ActiveRecordRecord_Invalid_exception_if_we_want_that</span>
758:     <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase</span> = <span class="ruby-value str">''</span>
759:     <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">RecordInvalid</span>) <span class="ruby-keyword kw">do</span>
760:       <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">save!</span>
761:     <span class="ruby-keyword kw">end</span>
762:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M005518" class="method">
  <div id="M005518_title" class="title">
    <b>test_should_still_work_without_an_associated_model</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M005518_source')" id="l_M005518_source">show source</a> ]</p>
  <div id="M005518_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 717</span>
717:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_still_work_without_an_associated_model</span>
718:     <span class="ruby-ivar">@pirate</span>.<span class="ruby-identifier">destroy</span>
719:     <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">name</span> = <span class="ruby-value str">&quot;The Vile Insanity&quot;</span>
720:     <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">save</span>
721:     <span class="ruby-identifier">assert</span> <span class="ruby-value str">'The Vile Insanity'</span>, <span class="ruby-ivar">@ship</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">name</span>
722:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>