  <div id="C00000263">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />ReadOnlyTest<br/>
  In:
<a href="#" onclick="jsHref('files/activerecord/test/cases/readonly_test_rb.html');">activerecord/test/cases/readonly_test.rb</a>

Parent:&nbsp;
ActiveRecord::TestCase
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">




  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M001553&name=test_association_collection_method_missing_scoping_not_readonly" >test_association_collection_method_missing_scoping_not_readonly</a></li>
  <li><a href="index.html?a=M001546&name=test_cant_save_readonly_record" >test_cant_save_readonly_record</a></li>
  <li><a href="index.html?a=M001548&name=test_find_with_joins_option_implies_readonly" >test_find_with_joins_option_implies_readonly</a></li>
  <li><a href="index.html?a=M001547&name=test_find_with_readonly_option" >test_find_with_readonly_option</a></li>
  <li><a href="index.html?a=M001549&name=test_habtm_find_readonly" >test_habtm_find_readonly</a></li>
  <li><a href="index.html?a=M001550&name=test_has_many_find_readonly" >test_has_many_find_readonly</a></li>
  <li><a href="index.html?a=M001551&name=test_has_many_with_through_is_not_implicitly_marked_readonly" >test_has_many_with_through_is_not_implicitly_marked_readonly</a></li>
  <li><a href="index.html?a=M001552&name=test_readonly_scoping" >test_readonly_scoping</a></li>
  </ul>






<div class="sectiontitle">Public Instance methods</div>
<div id="M001553" class="method">
  <div id="M001553_title" class="title">
    <b>test_association_collection_method_missing_scoping_not_readonly</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001553_source')" id="l_M001553_source">show source</a> ]</p>
  <div id="M001553_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/readonly_test.rb, line 103</span>
103:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_association_collection_method_missing_scoping_not_readonly</span>
104:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>).<span class="ruby-identifier">projects</span>.<span class="ruby-identifier">foo</span>.<span class="ruby-identifier">readonly?</span>
105:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Post</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>).<span class="ruby-identifier">comments</span>.<span class="ruby-identifier">foo</span>.<span class="ruby-identifier">readonly?</span>
106:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001546" class="method">
  <div id="M001546_title" class="title">
    <b>test_cant_save_readonly_record</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001546_source')" id="l_M001546_source">show source</a> ]</p>
  <div id="M001546_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/readonly_test.rb, line 17</span>
17:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_cant_save_readonly_record</span>
18:     <span class="ruby-identifier">dev</span> = <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>)
19:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">dev</span>.<span class="ruby-identifier">readonly?</span>
20: 
21:     <span class="ruby-identifier">dev</span>.<span class="ruby-identifier">readonly!</span>
22:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">dev</span>.<span class="ruby-identifier">readonly?</span>
23: 
24:     <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
25:       <span class="ruby-identifier">dev</span>.<span class="ruby-identifier">name</span> = <span class="ruby-value str">'Luscious forbidden fruit.'</span>
26:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">dev</span>.<span class="ruby-identifier">save</span>
27:       <span class="ruby-identifier">dev</span>.<span class="ruby-identifier">name</span> = <span class="ruby-value str">'Forbidden.'</span>
28:     <span class="ruby-keyword kw">end</span>
29:     <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">ReadOnlyRecord</span>) { <span class="ruby-identifier">dev</span>.<span class="ruby-identifier">save</span>  }
30:     <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">ReadOnlyRecord</span>) { <span class="ruby-identifier">dev</span>.<span class="ruby-identifier">save!</span> }
31:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001548" class="method">
  <div id="M001548_title" class="title">
    <b>test_find_with_joins_option_implies_readonly</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001548_source')" id="l_M001548_source">show source</a> ]</p>
  <div id="M001548_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/readonly_test.rb, line 41</span>
41:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_find_with_joins_option_implies_readonly</span>
42:     <span class="ruby-comment cmt"># Blank joins don't count.</span>
43:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'  '</span>).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">d</span>.<span class="ruby-identifier">readonly?</span> }
44:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'  '</span>, <span class="ruby-identifier">:readonly</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">d</span>.<span class="ruby-identifier">readonly?</span> }
45: 
46:     <span class="ruby-comment cmt"># Others do.</span>
47:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">', projects'</span>).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-identifier">assert</span> <span class="ruby-identifier">d</span>.<span class="ruby-identifier">readonly?</span> }
48:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">', projects'</span>, <span class="ruby-identifier">:readonly</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">d</span>.<span class="ruby-identifier">readonly?</span> }
49:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001547" class="method">
  <div id="M001547_title" class="title">
    <b>test_find_with_readonly_option</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001547_source')" id="l_M001547_source">show source</a> ]</p>
  <div id="M001547_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/readonly_test.rb, line 34</span>
34:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_find_with_readonly_option</span>
35:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">d</span>.<span class="ruby-identifier">readonly?</span> }
36:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:readonly</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">d</span>.<span class="ruby-identifier">readonly?</span> }
37:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:readonly</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-identifier">assert</span> <span class="ruby-identifier">d</span>.<span class="ruby-identifier">readonly?</span> }
38:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001549" class="method">
  <div id="M001549_title" class="title">
    <b>test_habtm_find_readonly</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001549_source')" id="l_M001549_source">show source</a> ]</p>
  <div id="M001549_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/readonly_test.rb, line 52</span>
52:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_habtm_find_readonly</span>
53:     <span class="ruby-identifier">dev</span> = <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>)
54:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">dev</span>.<span class="ruby-identifier">projects</span>.<span class="ruby-identifier">empty?</span>
55:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">dev</span>.<span class="ruby-identifier">projects</span>.<span class="ruby-identifier">all?</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:readonly?</span>)
56:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">dev</span>.<span class="ruby-identifier">projects</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>).<span class="ruby-identifier">all?</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:readonly?</span>)
57:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">dev</span>.<span class="ruby-identifier">projects</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:readonly</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">all?</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:readonly?</span>)
58:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001550" class="method">
  <div id="M001550_title" class="title">
    <b>test_has_many_find_readonly</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001550_source')" id="l_M001550_source">show source</a> ]</p>
  <div id="M001550_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/readonly_test.rb, line 60</span>
60:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_has_many_find_readonly</span>
61:     <span class="ruby-identifier">post</span> = <span class="ruby-constant">Post</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>)
62:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">post</span>.<span class="ruby-identifier">comments</span>.<span class="ruby-identifier">empty?</span>
63:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">post</span>.<span class="ruby-identifier">comments</span>.<span class="ruby-identifier">any?</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:readonly?</span>)
64:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">post</span>.<span class="ruby-identifier">comments</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>).<span class="ruby-identifier">any?</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:readonly?</span>)
65:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">post</span>.<span class="ruby-identifier">comments</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:readonly</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">all?</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:readonly?</span>)
66:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001551" class="method">
  <div id="M001551_title" class="title">
    <b>test_has_many_with_through_is_not_implicitly_marked_readonly</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001551_source')" id="l_M001551_source">show source</a> ]</p>
  <div id="M001551_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/readonly_test.rb, line 68</span>
68:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_has_many_with_through_is_not_implicitly_marked_readonly</span>
69:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">people</span> = <span class="ruby-constant">Post</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>).<span class="ruby-identifier">people</span>
70:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">people</span>.<span class="ruby-identifier">any?</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:readonly?</span>)
71:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001552" class="method">
  <div id="M001552_title" class="title">
    <b>test_readonly_scoping</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001552_source')" id="l_M001552_source">show source</a> ]</p>
  <div id="M001552_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/readonly_test.rb, line 73</span>
 73:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_readonly_scoping</span>
 74:     <span class="ruby-constant">Post</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'1=1'</span> }) <span class="ruby-keyword kw">do</span>
 75:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Post</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>).<span class="ruby-identifier">readonly?</span>
 76:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Post</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>, <span class="ruby-identifier">:readonly</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">readonly?</span>
 77:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Post</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>, <span class="ruby-identifier">:readonly</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>).<span class="ruby-identifier">readonly?</span>
 78:     <span class="ruby-keyword kw">end</span>
 79: 
 80:     <span class="ruby-constant">Post</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'   '</span> }) <span class="ruby-keyword kw">do</span>
 81:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Post</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>).<span class="ruby-identifier">readonly?</span>
 82:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Post</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>, <span class="ruby-identifier">:readonly</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">readonly?</span>
 83:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Post</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>, <span class="ruby-identifier">:readonly</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>).<span class="ruby-identifier">readonly?</span>
 84:     <span class="ruby-keyword kw">end</span>
 85: 
 86:     <span class="ruby-comment cmt"># Oracle barfs on this because the join includes unqualified and</span>
 87:     <span class="ruby-comment cmt"># conflicting column names</span>
 88:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">current_adapter?</span>(<span class="ruby-identifier">:OracleAdapter</span>)
 89:       <span class="ruby-constant">Post</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">', developers'</span> }) <span class="ruby-keyword kw">do</span>
 90:         <span class="ruby-identifier">assert</span> <span class="ruby-constant">Post</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>).<span class="ruby-identifier">readonly?</span>
 91:         <span class="ruby-identifier">assert</span> <span class="ruby-constant">Post</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>, <span class="ruby-identifier">:readonly</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">readonly?</span>
 92:         <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Post</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>, <span class="ruby-identifier">:readonly</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>).<span class="ruby-identifier">readonly?</span>
 93:       <span class="ruby-keyword kw">end</span>
 94:     <span class="ruby-keyword kw">end</span>
 95: 
 96:     <span class="ruby-constant">Post</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:readonly</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span> }) <span class="ruby-keyword kw">do</span>
 97:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Post</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>).<span class="ruby-identifier">readonly?</span>
 98:       <span class="ruby-identifier">assert</span> <span class="ruby-constant">Post</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>, <span class="ruby-identifier">:readonly</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">readonly?</span>
 99:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-constant">Post</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>, <span class="ruby-identifier">:readonly</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>).<span class="ruby-identifier">readonly?</span>
100:     <span class="ruby-keyword kw">end</span>
101:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>