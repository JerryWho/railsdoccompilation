  <div id="C00000922">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />DatabaseConnectedXmlSerializationTest<br/>
  In:
<a href="#" onclick="jsHref('files/activerecord/test/cases/xml_serialization_test_rb.html');">activerecord/test/cases/xml_serialization_test.rb</a>

Parent:&nbsp;
ActiveRecord::TestCase
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">




  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M006470&name=test_include_uses_association_name" >test_include_uses_association_name</a></li>
  <li><a href="index.html?a=M006471&name=test_included_associations_should_skip_types" >test_included_associations_should_skip_types</a></li>
  <li><a href="index.html?a=M006472&name=test_methods_are_called_on_object" >test_methods_are_called_on_object</a></li>
  <li><a href="index.html?a=M006469&name=test_passing_hash_shouldnt_reuse_builder" >test_passing_hash_shouldnt_reuse_builder</a></li>
  <li><a href="index.html?a=M006474&name=test_procs_are_called_on_object" >test_procs_are_called_on_object</a></li>
  <li><a href="index.html?a=M006476&name=test_procs_on_included_associations_are_called" >test_procs_on_included_associations_are_called</a></li>
  <li><a href="index.html?a=M006478&name=test_should_has_many_array_elements_should_include_type_when_different_from_guessed_value" >test_should_has_many_array_elements_should_include_type_when_different_from_guessed_value</a></li>
  <li><a href="index.html?a=M006477&name=test_should_include_empty_has_many_as_empty_array" >test_should_include_empty_has_many_as_empty_array</a></li>
  <li><a href="index.html?a=M006473&name=test_should_not_call_methods_on_associations_that_dont_respond" >test_should_not_call_methods_on_associations_that_dont_respond</a></li>
  <li><a href="index.html?a=M006475&name=test_top_level_procs_arent_applied_to_associations" >test_top_level_procs_arent_applied_to_associations</a></li>
  </ul>






<div class="sectiontitle">Public Instance methods</div>
<div id="M006470" class="method">
  <div id="M006470_title" class="title">
    <b>test_include_uses_association_name</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M006470_source')" id="l_M006470_source">show source</a> ]</p>
  <div id="M006470_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/xml_serialization_test.rb, line 165</span>
165:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_include_uses_association_name</span>
166:     <span class="ruby-identifier">xml</span> = <span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">to_xml</span> <span class="ruby-identifier">:include=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">:hello_posts</span>, <span class="ruby-identifier">:indent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
167:     <span class="ruby-identifier">assert_match</span> <span class="ruby-regexp re">%r{&lt;hello-posts type=&quot;array&quot;&gt;}</span>, <span class="ruby-identifier">xml</span>
168:     <span class="ruby-identifier">assert_match</span> <span class="ruby-regexp re">%r{&lt;hello-post type=&quot;Post&quot;&gt;}</span>, <span class="ruby-identifier">xml</span>
169:     <span class="ruby-identifier">assert_match</span> <span class="ruby-regexp re">%r{&lt;hello-post type=&quot;StiPost&quot;&gt;}</span>, <span class="ruby-identifier">xml</span>
170:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M006471" class="method">
  <div id="M006471_title" class="title">
    <b>test_included_associations_should_skip_types</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M006471_source')" id="l_M006471_source">show source</a> ]</p>
  <div id="M006471_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/xml_serialization_test.rb, line 172</span>
172:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_included_associations_should_skip_types</span>
173:     <span class="ruby-identifier">xml</span> = <span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">to_xml</span> <span class="ruby-identifier">:include=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">:hello_posts</span>, <span class="ruby-identifier">:indent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">:skip_types</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>
174:     <span class="ruby-identifier">assert_match</span> <span class="ruby-regexp re">%r{&lt;hello-posts&gt;}</span>, <span class="ruby-identifier">xml</span>
175:     <span class="ruby-identifier">assert_match</span> <span class="ruby-regexp re">%r{&lt;hello-post&gt;}</span>, <span class="ruby-identifier">xml</span>
176:     <span class="ruby-identifier">assert_match</span> <span class="ruby-regexp re">%r{&lt;hello-post&gt;}</span>, <span class="ruby-identifier">xml</span>
177:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M006472" class="method">
  <div id="M006472_title" class="title">
    <b>test_methods_are_called_on_object</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M006472_source')" id="l_M006472_source">show source</a> ]</p>
  <div id="M006472_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/xml_serialization_test.rb, line 179</span>
179:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_methods_are_called_on_object</span>
180:     <span class="ruby-identifier">xml</span> = <span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">to_xml</span> <span class="ruby-identifier">:methods</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:label</span>, <span class="ruby-identifier">:indent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
181:     <span class="ruby-identifier">assert_match</span> <span class="ruby-regexp re">%r{&lt;label&gt;.*&lt;/label&gt;}</span>, <span class="ruby-identifier">xml</span>
182:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M006469" class="method">
  <div id="M006469_title" class="title">
    <b>test_passing_hash_shouldnt_reuse_builder</b>()
  </div>
  <div class="description">
  <p>
to_xml used to mess with the hash the user provided which caused the
builder to be reused. This meant the document kept getting appended to.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M006469_source')" id="l_M006469_source">show source</a> ]</p>
  <div id="M006469_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/xml_serialization_test.rb, line 157</span>
157:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_passing_hash_shouldnt_reuse_builder</span>
158:     <span class="ruby-identifier">options</span> = {<span class="ruby-identifier">:include=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">:posts</span>}
159:     <span class="ruby-identifier">david</span> = <span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>)
160:     <span class="ruby-identifier">first_xml_size</span> = <span class="ruby-identifier">david</span>.<span class="ruby-identifier">to_xml</span>(<span class="ruby-identifier">options</span>).<span class="ruby-identifier">size</span>
161:     <span class="ruby-identifier">second_xml_size</span> = <span class="ruby-identifier">david</span>.<span class="ruby-identifier">to_xml</span>(<span class="ruby-identifier">options</span>).<span class="ruby-identifier">size</span>
162:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">first_xml_size</span>, <span class="ruby-identifier">second_xml_size</span>
163:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M006474" class="method">
  <div id="M006474_title" class="title">
    <b>test_procs_are_called_on_object</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M006474_source')" id="l_M006474_source">show source</a> ]</p>
  <div id="M006474_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/xml_serialization_test.rb, line 191</span>
191:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_procs_are_called_on_object</span>
192:     <span class="ruby-identifier">proc</span> = <span class="ruby-constant">Proc</span>.<span class="ruby-identifier">new</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">options</span><span class="ruby-operator">|</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:builder</span>].<span class="ruby-identifier">tag!</span>(<span class="ruby-value str">'nationality'</span>, <span class="ruby-value str">'Danish'</span>) }
193:     <span class="ruby-identifier">xml</span> = <span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">to_xml</span>(<span class="ruby-identifier">:procs</span> =<span class="ruby-operator">&gt;</span> [ <span class="ruby-identifier">proc</span> ])
194:     <span class="ruby-identifier">assert_match</span> <span class="ruby-regexp re">%r{&lt;nationality&gt;Danish&lt;/nationality&gt;}</span>, <span class="ruby-identifier">xml</span>
195:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M006476" class="method">
  <div id="M006476_title" class="title">
    <b>test_procs_on_included_associations_are_called</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M006476_source')" id="l_M006476_source">show source</a> ]</p>
  <div id="M006476_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/xml_serialization_test.rb, line 205</span>
205:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_procs_on_included_associations_are_called</span>
206:     <span class="ruby-identifier">posts_proc</span> = <span class="ruby-constant">Proc</span>.<span class="ruby-identifier">new</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">options</span><span class="ruby-operator">|</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:builder</span>].<span class="ruby-identifier">tag!</span>(<span class="ruby-value str">'copyright'</span>, <span class="ruby-value str">'DHH'</span>) }
207:     <span class="ruby-identifier">xml</span> = <span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">to_xml</span>(
208:       <span class="ruby-identifier">:indent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span>,
209:       <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> {
210:         <span class="ruby-identifier">:posts</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:procs</span> =<span class="ruby-operator">&gt;</span> [ <span class="ruby-identifier">posts_proc</span> ] }
211:       }
212:     )
213: 
214:     <span class="ruby-identifier">assert_no_match</span> <span class="ruby-regexp re">%r{^  &lt;copyright&gt;DHH&lt;/copyright&gt;}</span>, <span class="ruby-identifier">xml</span>
215:     <span class="ruby-identifier">assert_match</span> <span class="ruby-regexp re">%r{^ {6}&lt;copyright&gt;DHH&lt;/copyright&gt;}</span>, <span class="ruby-identifier">xml</span>
216:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M006478" class="method">
  <div id="M006478_title" class="title">
    <b>test_should_has_many_array_elements_should_include_type_when_different_from_guessed_value</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M006478_source')" id="l_M006478_source">show source</a> ]</p>
  <div id="M006478_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/xml_serialization_test.rb, line 226</span>
226:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_has_many_array_elements_should_include_type_when_different_from_guessed_value</span>
227:     <span class="ruby-identifier">xml</span> = <span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">to_xml</span> <span class="ruby-identifier">:include=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">:posts_with_comments</span>, <span class="ruby-identifier">:indent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span>
228: 
229:     <span class="ruby-identifier">assert</span> <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">from_xml</span>(<span class="ruby-identifier">xml</span>)
230:     <span class="ruby-identifier">assert_match</span> <span class="ruby-regexp re">%r{^  &lt;posts-with-comments type=&quot;array&quot;&gt;}</span>, <span class="ruby-identifier">xml</span>
231:     <span class="ruby-identifier">assert_match</span> <span class="ruby-regexp re">%r{^    &lt;posts-with-comment type=&quot;Post&quot;&gt;}</span>, <span class="ruby-identifier">xml</span>
232:     <span class="ruby-identifier">assert_match</span> <span class="ruby-regexp re">%r{^    &lt;posts-with-comment type=&quot;StiPost&quot;&gt;}</span>, <span class="ruby-identifier">xml</span>
233: 
234:     <span class="ruby-identifier">types</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">from_xml</span>(<span class="ruby-identifier">xml</span>)[<span class="ruby-value str">'author'</span>][<span class="ruby-value str">'posts_with_comments'</span>].<span class="ruby-identifier">collect</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span>[<span class="ruby-value str">'type'</span>] }
235:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">types</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">'SpecialPost'</span>)
236:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">types</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">'Post'</span>)
237:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">types</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">'StiPost'</span>)
238:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M006477" class="method">
  <div id="M006477_title" class="title">
    <b>test_should_include_empty_has_many_as_empty_array</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M006477_source')" id="l_M006477_source">show source</a> ]</p>
  <div id="M006477_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/xml_serialization_test.rb, line 218</span>
218:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_include_empty_has_many_as_empty_array</span>
219:     <span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">posts</span>.<span class="ruby-identifier">delete_all</span>
220:     <span class="ruby-identifier">xml</span> = <span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">to_xml</span> <span class="ruby-identifier">:include=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">:posts</span>, <span class="ruby-identifier">:indent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span>
221: 
222:     <span class="ruby-identifier">assert_equal</span> [], <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">from_xml</span>(<span class="ruby-identifier">xml</span>)[<span class="ruby-value str">'author'</span>][<span class="ruby-value str">'posts'</span>]
223:     <span class="ruby-identifier">assert_match</span> <span class="ruby-regexp re">%r{^  &lt;posts type=&quot;array&quot;/&gt;}</span>, <span class="ruby-identifier">xml</span>
224:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M006473" class="method">
  <div id="M006473_title" class="title">
    <b>test_should_not_call_methods_on_associations_that_dont_respond</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M006473_source')" id="l_M006473_source">show source</a> ]</p>
  <div id="M006473_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/xml_serialization_test.rb, line 184</span>
184:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_not_call_methods_on_associations_that_dont_respond</span>
185:     <span class="ruby-identifier">xml</span> = <span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">to_xml</span> <span class="ruby-identifier">:include=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">:hello_posts</span>, <span class="ruby-identifier">:methods</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:label</span>, <span class="ruby-identifier">:indent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span>
186:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">hello_posts</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:label</span>)
187:     <span class="ruby-identifier">assert_match</span> <span class="ruby-regexp re">%r{^  &lt;label&gt;.*&lt;/label&gt;}</span>, <span class="ruby-identifier">xml</span>
188:     <span class="ruby-identifier">assert_no_match</span> <span class="ruby-regexp re">%r{^      &lt;label&gt;}</span>, <span class="ruby-identifier">xml</span>
189:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M006475" class="method">
  <div id="M006475_title" class="title">
    <b>test_top_level_procs_arent_applied_to_associations</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M006475_source')" id="l_M006475_source">show source</a> ]</p>
  <div id="M006475_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/xml_serialization_test.rb, line 197</span>
197:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_top_level_procs_arent_applied_to_associations</span>
198:     <span class="ruby-identifier">author_proc</span> = <span class="ruby-constant">Proc</span>.<span class="ruby-identifier">new</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">options</span><span class="ruby-operator">|</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:builder</span>].<span class="ruby-identifier">tag!</span>(<span class="ruby-value str">'nationality'</span>, <span class="ruby-value str">'Danish'</span>) }
199:     <span class="ruby-identifier">xml</span> = <span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">to_xml</span>(<span class="ruby-identifier">:procs</span> =<span class="ruby-operator">&gt;</span> [ <span class="ruby-identifier">author_proc</span> ], <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:posts</span>, <span class="ruby-identifier">:indent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span>)
200: 
201:     <span class="ruby-identifier">assert_match</span> <span class="ruby-regexp re">%r{^  &lt;nationality&gt;Danish&lt;/nationality&gt;}</span>, <span class="ruby-identifier">xml</span>
202:     <span class="ruby-identifier">assert_no_match</span> <span class="ruby-regexp re">%r{^ {6}&lt;nationality&gt;Danish&lt;/nationality&gt;}</span>, <span class="ruby-identifier">xml</span>
203:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>