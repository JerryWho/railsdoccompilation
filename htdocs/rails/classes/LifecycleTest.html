  <div id="C00000248">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />LifecycleTest<br/>
  In:
<a href="#" onclick="jsHref('files/activerecord/test/cases/lifecycle_test_rb.html');">activerecord/test/cases/lifecycle_test.rb</a>

Parent:&nbsp;
ActiveRecord::TestCase
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">




  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M001503&name=after_find" >after_find</a></li>
  <li><a href="index.html?a=M001504&name=after_find" >after_find</a></li>
  <li><a href="index.html?a=M001500&name=test_after_find_can_be_observed_when_its_defined_on_the_model" >test_after_find_can_be_observed_when_its_defined_on_the_model</a></li>
  <li><a href="index.html?a=M001499&name=test_after_find_can_be_observed_when_its_not_defined_on_the_model" >test_after_find_can_be_observed_when_its_not_defined_on_the_model</a></li>
  <li><a href="index.html?a=M001502&name=test_after_find_is_not_clobbered_if_it_already_exists" >test_after_find_is_not_clobbered_if_it_already_exists</a></li>
  <li><a href="index.html?a=M001501&name=test_after_find_is_not_created_if_its_not_used" >test_after_find_is_not_created_if_its_not_used</a></li>
  <li><a href="index.html?a=M001493&name=test_after_save" >test_after_save</a></li>
  <li><a href="index.html?a=M001495&name=test_auto_observer" >test_auto_observer</a></li>
  <li><a href="index.html?a=M001492&name=test_before_destroy" >test_before_destroy</a></li>
  <li><a href="index.html?a=M001496&name=test_inferred_auto_observer" >test_inferred_auto_observer</a></li>
  <li><a href="index.html?a=M001505&name=test_invalid_observer" >test_invalid_observer</a></li>
  <li><a href="index.html?a=M001494&name=test_observer_update_on_save" >test_observer_update_on_save</a></li>
  <li><a href="index.html?a=M001498&name=test_observing_subclasses" >test_observing_subclasses</a></li>
  <li><a href="index.html?a=M001497&name=test_observing_two_classes" >test_observing_two_classes</a></li>
  </ul>






<div class="sectiontitle">Public Instance methods</div>
<div id="M001503" class="method">
  <div id="M001503_title" class="title">
    <b>after_find</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001503_source')" id="l_M001503_source">show source</a> ]</p>
  <div id="M001503_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/lifecycle_test.rb, line 178</span>
178:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">after_find</span>; <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001504" class="method">
  <div id="M001504_title" class="title">
    <b>after_find</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001504_source')" id="l_M001504_source">show source</a> ]</p>
  <div id="M001504_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/lifecycle_test.rb, line 182</span>
182:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">after_find</span>; <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001500" class="method">
  <div id="M001500_title" class="title">
    <b>test_after_find_can_be_observed_when_its_defined_on_the_model</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001500_source')" id="l_M001500_source">show source</a> ]</p>
  <div id="M001500_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/lifecycle_test.rb, line 154</span>
154:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_after_find_can_be_observed_when_its_defined_on_the_model</span>
155:     <span class="ruby-identifier">observer</span> = <span class="ruby-constant">TopicObserver</span>.<span class="ruby-identifier">instance</span>
156:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Topic</span>, <span class="ruby-constant">TopicObserver</span>.<span class="ruby-identifier">observed_class</span>
157: 
158:     <span class="ruby-identifier">topic</span> = <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>)
159:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">topic</span>, <span class="ruby-identifier">observer</span>.<span class="ruby-identifier">topic</span>
160:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001499" class="method">
  <div id="M001499_title" class="title">
    <b>test_after_find_can_be_observed_when_its_not_defined_on_the_model</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001499_source')" id="l_M001499_source">show source</a> ]</p>
  <div id="M001499_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/lifecycle_test.rb, line 146</span>
146:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_after_find_can_be_observed_when_its_not_defined_on_the_model</span>
147:     <span class="ruby-identifier">observer</span> = <span class="ruby-constant">MinimalisticObserver</span>.<span class="ruby-identifier">instance</span>
148:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Minimalistic</span>, <span class="ruby-constant">MinimalisticObserver</span>.<span class="ruby-identifier">observed_class</span>
149: 
150:     <span class="ruby-identifier">minimalistic</span> = <span class="ruby-constant">Minimalistic</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>)
151:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">minimalistic</span>, <span class="ruby-identifier">observer</span>.<span class="ruby-identifier">minimalistic</span>
152:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001502" class="method">
  <div id="M001502_title" class="title">
    <b>test_after_find_is_not_clobbered_if_it_already_exists</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001502_source')" id="l_M001502_source">show source</a> ]</p>
  <div id="M001502_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/lifecycle_test.rb, line 174</span>
174:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_after_find_is_not_clobbered_if_it_already_exists</span>
175:     <span class="ruby-comment cmt"># use a fresh observer class so we can instantiate it (Observer is</span>
176:     <span class="ruby-comment cmt"># a Singleton)</span>
177:     <span class="ruby-identifier">model_class</span> = <span class="ruby-constant">Class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>) <span class="ruby-keyword kw">do</span>
178:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">after_find</span>; <span class="ruby-keyword kw">end</span>
179:     <span class="ruby-keyword kw">end</span>
180:     <span class="ruby-identifier">original_method</span> = <span class="ruby-identifier">model_class</span>.<span class="ruby-identifier">instance_method</span>(<span class="ruby-identifier">:after_find</span>)
181:     <span class="ruby-identifier">observer_class</span> = <span class="ruby-constant">Class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Observer</span>) <span class="ruby-keyword kw">do</span>
182:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">after_find</span>; <span class="ruby-keyword kw">end</span>
183:     <span class="ruby-keyword kw">end</span>
184:     <span class="ruby-identifier">observer_class</span>.<span class="ruby-identifier">observe</span>(<span class="ruby-identifier">model_class</span>)
185: 
186:     <span class="ruby-identifier">observer</span> = <span class="ruby-identifier">observer_class</span>.<span class="ruby-identifier">instance</span>
187:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">original_method</span>, <span class="ruby-identifier">model_class</span>.<span class="ruby-identifier">instance_method</span>(<span class="ruby-identifier">:after_find</span>)
188:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001501" class="method">
  <div id="M001501_title" class="title">
    <b>test_after_find_is_not_created_if_its_not_used</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001501_source')" id="l_M001501_source">show source</a> ]</p>
  <div id="M001501_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/lifecycle_test.rb, line 162</span>
162:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_after_find_is_not_created_if_its_not_used</span>
163:     <span class="ruby-comment cmt"># use a fresh class so an observer can't have defined an</span>
164:     <span class="ruby-comment cmt"># after_find on it</span>
165:     <span class="ruby-identifier">model_class</span> = <span class="ruby-constant">Class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>)
166:     <span class="ruby-identifier">observer_class</span> = <span class="ruby-constant">Class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Observer</span>)
167:     <span class="ruby-identifier">observer_class</span>.<span class="ruby-identifier">observe</span>(<span class="ruby-identifier">model_class</span>)
168: 
169:     <span class="ruby-identifier">observer</span> = <span class="ruby-identifier">observer_class</span>.<span class="ruby-identifier">instance</span>
170: 
171:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">model_class</span>.<span class="ruby-identifier">method_defined?</span>(<span class="ruby-identifier">:after_find</span>)
172:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001493" class="method">
  <div id="M001493_title" class="title">
    <b>test_after_save</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001493_source')" id="l_M001493_source">show source</a> ]</p>
  <div id="M001493_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/lifecycle_test.rb, line 85</span>
85:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_after_save</span>
86:     <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">observers</span> = <span class="ruby-identifier">:topic_manual_observer</span>
87:     <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">instantiate_observers</span>
88: 
89:     <span class="ruby-identifier">topic</span> = <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>)
90:     <span class="ruby-identifier">topic</span>.<span class="ruby-identifier">title</span> = <span class="ruby-value str">&quot;hello&quot;</span>
91:     <span class="ruby-identifier">topic</span>.<span class="ruby-identifier">save</span>
92: 
93:     <span class="ruby-identifier">assert</span> <span class="ruby-constant">TopicManualObserver</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">has_been_notified?</span>
94:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">:after_save</span>, <span class="ruby-constant">TopicManualObserver</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">callbacks</span>.<span class="ruby-identifier">last</span>[<span class="ruby-value str">&quot;callback_method&quot;</span>]
95:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001495" class="method">
  <div id="M001495_title" class="title">
    <b>test_auto_observer</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001495_source')" id="l_M001495_source">show source</a> ]</p>
  <div id="M001495_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/lifecycle_test.rb, line 106</span>
106:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_auto_observer</span>
107:     <span class="ruby-identifier">topic_observer</span> = <span class="ruby-constant">TopicaAuditor</span>.<span class="ruby-identifier">instance</span>
108:     <span class="ruby-identifier">assert_nil</span> <span class="ruby-constant">TopicaAuditor</span>.<span class="ruby-identifier">observed_class</span>
109:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-constant">Topic</span>], <span class="ruby-constant">TopicaAuditor</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">observed_classes</span>.<span class="ruby-identifier">to_a</span>
110: 
111:     <span class="ruby-identifier">topic</span> = <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>)
112:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">topic</span>.<span class="ruby-identifier">title</span>, <span class="ruby-identifier">topic_observer</span>.<span class="ruby-identifier">topic</span>.<span class="ruby-identifier">title</span>
113:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001492" class="method">
  <div id="M001492_title" class="title">
    <b>test_before_destroy</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001492_source')" id="l_M001492_source">show source</a> ]</p>
  <div id="M001492_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/lifecycle_test.rb, line 79</span>
79:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_before_destroy</span>
80:     <span class="ruby-identifier">original_count</span> = <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">count</span>
81:     (<span class="ruby-identifier">topic_to_be_destroyed</span> = <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>)).<span class="ruby-identifier">destroy</span>
82:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">original_count</span> <span class="ruby-operator">-</span> (<span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">topic_to_be_destroyed</span>.<span class="ruby-identifier">replies</span>.<span class="ruby-identifier">size</span>), <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">count</span>
83:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001496" class="method">
  <div id="M001496_title" class="title">
    <b>test_inferred_auto_observer</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001496_source')" id="l_M001496_source">show source</a> ]</p>
  <div id="M001496_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/lifecycle_test.rb, line 115</span>
115:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_inferred_auto_observer</span>
116:     <span class="ruby-identifier">topic_observer</span> = <span class="ruby-constant">TopicObserver</span>.<span class="ruby-identifier">instance</span>
117:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Topic</span>, <span class="ruby-constant">TopicObserver</span>.<span class="ruby-identifier">observed_class</span>
118: 
119:     <span class="ruby-identifier">topic</span> = <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>)
120:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">topic</span>.<span class="ruby-identifier">title</span>, <span class="ruby-identifier">topic_observer</span>.<span class="ruby-identifier">topic</span>.<span class="ruby-identifier">title</span>
121:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001505" class="method">
  <div id="M001505_title" class="title">
    <b>test_invalid_observer</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001505_source')" id="l_M001505_source">show source</a> ]</p>
  <div id="M001505_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/lifecycle_test.rb, line 190</span>
190:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_invalid_observer</span>
191:     <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ArgumentError</span>) { <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">observers</span> = <span class="ruby-constant">Object</span>.<span class="ruby-identifier">new</span>; <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">instantiate_observers</span> }
192:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001494" class="method">
  <div id="M001494_title" class="title">
    <b>test_observer_update_on_save</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001494_source')" id="l_M001494_source">show source</a> ]</p>
  <div id="M001494_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/lifecycle_test.rb, line 97</span>
 97:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_observer_update_on_save</span>
 98:     <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">observers</span> = <span class="ruby-constant">TopicManualObserver</span>
 99:     <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">instantiate_observers</span>
100: 
101:     <span class="ruby-identifier">topic</span> = <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>)
102:     <span class="ruby-identifier">assert</span> <span class="ruby-constant">TopicManualObserver</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">has_been_notified?</span>
103:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">:after_find</span>, <span class="ruby-constant">TopicManualObserver</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">callbacks</span>.<span class="ruby-identifier">first</span>[<span class="ruby-value str">&quot;callback_method&quot;</span>]
104:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001498" class="method">
  <div id="M001498_title" class="title">
    <b>test_observing_subclasses</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001498_source')" id="l_M001498_source">show source</a> ]</p>
  <div id="M001498_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/lifecycle_test.rb, line 133</span>
133:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_observing_subclasses</span>
134:     <span class="ruby-identifier">multi_observer</span> = <span class="ruby-constant">MultiObserver</span>.<span class="ruby-identifier">instance</span>
135: 
136:     <span class="ruby-identifier">developer</span> = <span class="ruby-constant">SpecialDeveloper</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>)
137:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">developer</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">multi_observer</span>.<span class="ruby-identifier">record</span>.<span class="ruby-identifier">name</span>
138: 
139:     <span class="ruby-identifier">klass</span> = <span class="ruby-constant">Class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Developer</span>)
140:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">klass</span>, <span class="ruby-identifier">multi_observer</span>.<span class="ruby-identifier">last_inherited</span>
141: 
142:     <span class="ruby-identifier">developer</span> = <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>)
143:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">developer</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">multi_observer</span>.<span class="ruby-identifier">record</span>.<span class="ruby-identifier">name</span>
144:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001497" class="method">
  <div id="M001497_title" class="title">
    <b>test_observing_two_classes</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001497_source')" id="l_M001497_source">show source</a> ]</p>
  <div id="M001497_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/lifecycle_test.rb, line 123</span>
123:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_observing_two_classes</span>
124:     <span class="ruby-identifier">multi_observer</span> = <span class="ruby-constant">MultiObserver</span>.<span class="ruby-identifier">instance</span>
125: 
126:     <span class="ruby-identifier">topic</span> = <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>)
127:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">topic</span>.<span class="ruby-identifier">title</span>, <span class="ruby-identifier">multi_observer</span>.<span class="ruby-identifier">record</span>.<span class="ruby-identifier">title</span>
128: 
129:     <span class="ruby-identifier">developer</span> = <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>)
130:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">developer</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">multi_observer</span>.<span class="ruby-identifier">record</span>.<span class="ruby-identifier">name</span>
131:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>