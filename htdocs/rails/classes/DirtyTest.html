  <div id="C00000436">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />DirtyTest<br/>
  In:
<a href="#" onclick="jsHref('files/activerecord/test/cases/dirty_test_rb.html');">activerecord/test/cases/dirty_test.rb</a>

Parent:&nbsp;
ActiveRecord::TestCase
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">




  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M002636&name=test_aliased_attribute_changes" >test_aliased_attribute_changes</a></li>
  <li><a href="index.html?a=M002644&name=test_association_assignment_changes_foreign_key" >test_association_assignment_changes_foreign_key</a></li>
  <li><a href="index.html?a=M002635&name=test_attribute_changes" >test_attribute_changes</a></li>
  <li><a href="index.html?a=M002645&name=test_attribute_should_be_compared_with_type_cast" >test_attribute_should_be_compared_with_type_cast</a></li>
  <li><a href="index.html?a=M002643&name=test_attribute_will_change!" >test_attribute_will_change!</a></li>
  <li><a href="index.html?a=M002648&name=test_changed_attributes_should_be_preserved_if_save_failure" >test_changed_attributes_should_be_preserved_if_save_failure</a></li>
  <li><a href="index.html?a=M002638&name=test_nullable_decimal_not_marked_as_changed_if_new_value_is_blank" >test_nullable_decimal_not_marked_as_changed_if_new_value_is_blank</a></li>
  <li><a href="index.html?a=M002639&name=test_nullable_float_not_marked_as_changed_if_new_value_is_blank" >test_nullable_float_not_marked_as_changed_if_new_value_is_blank</a></li>
  <li><a href="index.html?a=M002640&name=test_nullable_integer_zero_to_string_zero_not_marked_as_changed" >test_nullable_integer_zero_to_string_zero_not_marked_as_changed</a></li>
  <li><a href="index.html?a=M002637&name=test_nullable_number_not_marked_as_changed_if_new_value_is_blank" >test_nullable_number_not_marked_as_changed_if_new_value_is_blank</a></li>
  <li><a href="index.html?a=M002642&name=test_object_should_be_changed_if_any_attribute_is_changed" >test_object_should_be_changed_if_any_attribute_is_changed</a></li>
  <li><a href="index.html?a=M002646&name=test_partial_update" >test_partial_update</a></li>
  <li><a href="index.html?a=M002647&name=test_partial_update_with_optimistic_locking" >test_partial_update_with_optimistic_locking</a></li>
  <li><a href="index.html?a=M002649&name=test_reload_should_clear_changed_attributes" >test_reload_should_clear_changed_attributes</a></li>
  <li><a href="index.html?a=M002650&name=test_reverted_changes_are_not_dirty" >test_reverted_changes_are_not_dirty</a></li>
  <li><a href="index.html?a=M002651&name=test_reverted_changes_are_not_dirty_after_multiple_changes" >test_reverted_changes_are_not_dirty_after_multiple_changes</a></li>
  <li><a href="index.html?a=M002652&name=test_reverted_changes_are_not_dirty_going_from_nil_to_value_and_back" >test_reverted_changes_are_not_dirty_going_from_nil_to_value_and_back</a></li>
  <li><a href="index.html?a=M002654&name=test_save_should_not_save_serialized_attribute_with_partial_updates_if_not_present" >test_save_should_not_save_serialized_attribute_with_partial_updates_if_not_present</a></li>
  <li><a href="index.html?a=M002653&name=test_save_should_store_serialized_attributes_even_with_partial_updates" >test_save_should_store_serialized_attributes_even_with_partial_updates</a></li>
  <li><a href="index.html?a=M002641&name=test_zero_to_blank_marked_as_changed" >test_zero_to_blank_marked_as_changed</a></li>
  </ul>






<div class="sectiontitle">Public Instance methods</div>
<div id="M002636" class="method">
  <div id="M002636_title" class="title">
    <b>test_aliased_attribute_changes</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002636_source')" id="l_M002636_source">show source</a> ]</p>
  <div id="M002636_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/dirty_test.rb, line 52</span>
52:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_aliased_attribute_changes</span>
53:     <span class="ruby-comment cmt"># the actual attribute here is name, title is an</span>
54:     <span class="ruby-comment cmt"># alias setup via alias_attribute</span>
55:     <span class="ruby-identifier">parrot</span> = <span class="ruby-constant">Parrot</span>.<span class="ruby-identifier">new</span>
56:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">parrot</span>.<span class="ruby-identifier">title_changed?</span>
57:     <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">parrot</span>.<span class="ruby-identifier">title_change</span>
58: 
59:     <span class="ruby-identifier">parrot</span>.<span class="ruby-identifier">name</span> = <span class="ruby-value str">'Sam'</span>
60:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">parrot</span>.<span class="ruby-identifier">title_changed?</span>
61:     <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">parrot</span>.<span class="ruby-identifier">title_was</span>
62:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">parrot</span>.<span class="ruby-identifier">name_change</span>, <span class="ruby-identifier">parrot</span>.<span class="ruby-identifier">title_change</span>
63:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002644" class="method">
  <div id="M002644_title" class="title">
    <b>test_association_assignment_changes_foreign_key</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002644_source')" id="l_M002644_source">show source</a> ]</p>
  <div id="M002644_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/dirty_test.rb, line 167</span>
167:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_association_assignment_changes_foreign_key</span>
168:     <span class="ruby-identifier">pirate</span> = <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:catchphrase</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'jarl'</span>)
169:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">parrot</span> = <span class="ruby-constant">Parrot</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Lorre'</span>)
170:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">changed?</span>
171:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w(parrot_id)</span>, <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">changed</span>
172:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002635" class="method">
  <div id="M002635_title" class="title">
    <b>test_attribute_changes</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002635_source')" id="l_M002635_source">show source</a> ]</p>
  <div id="M002635_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/dirty_test.rb, line 29</span>
29:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_attribute_changes</span>
30:     <span class="ruby-comment cmt"># New record - no changes.</span>
31:     <span class="ruby-identifier">pirate</span> = <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">new</span>
32:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase_changed?</span>
33:     <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase_change</span>
34: 
35:     <span class="ruby-comment cmt"># Change catchphrase.</span>
36:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase</span> = <span class="ruby-value str">'arrr'</span>
37:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase_changed?</span>
38:     <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase_was</span>
39:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-keyword kw">nil</span>, <span class="ruby-value str">'arrr'</span>], <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase_change</span>
40: 
41:     <span class="ruby-comment cmt"># Saved - no changes.</span>
42:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">save!</span>
43:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase_changed?</span>
44:     <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase_change</span>
45: 
46:     <span class="ruby-comment cmt"># Same value - no changes.</span>
47:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase</span> = <span class="ruby-value str">'arrr'</span>
48:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase_changed?</span>
49:     <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase_change</span>
50:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002645" class="method">
  <div id="M002645_title" class="title">
    <b>test_attribute_should_be_compared_with_type_cast</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002645_source')" id="l_M002645_source">show source</a> ]</p>
  <div id="M002645_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/dirty_test.rb, line 174</span>
174:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_attribute_should_be_compared_with_type_cast</span>
175:     <span class="ruby-identifier">topic</span> = <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">new</span>
176:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">topic</span>.<span class="ruby-identifier">approved?</span>
177:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">topic</span>.<span class="ruby-identifier">approved_changed?</span>
178: 
179:     <span class="ruby-comment cmt"># Coming from web form.</span>
180:     <span class="ruby-identifier">params</span> = {<span class="ruby-identifier">:topic</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:approved</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>}}
181:     <span class="ruby-comment cmt"># In the controller.</span>
182:     <span class="ruby-identifier">topic</span>.<span class="ruby-identifier">attributes</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:topic</span>]
183:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">topic</span>.<span class="ruby-identifier">approved?</span>
184:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">topic</span>.<span class="ruby-identifier">approved_changed?</span>
185:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002643" class="method">
  <div id="M002643_title" class="title">
    <b>test_attribute_will_change!</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002643_source')" id="l_M002643_source">show source</a> ]</p>
  <div id="M002643_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/dirty_test.rb, line 152</span>
152:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_attribute_will_change!</span>
153:     <span class="ruby-identifier">pirate</span> = <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:catchphrase</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'arr'</span>)
154: 
155:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">' matey'</span>
156:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase_changed?</span>
157: 
158:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase_will_change!</span>
159:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase_changed?</span>
160:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-value str">'arr matey'</span>, <span class="ruby-value str">'arr matey'</span>], <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase_change</span>
161: 
162:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'!'</span>
163:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase_changed?</span>
164:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-value str">'arr matey'</span>, <span class="ruby-value str">'arr matey!'</span>], <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase_change</span>
165:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002648" class="method">
  <div id="M002648_title" class="title">
    <b>test_changed_attributes_should_be_preserved_if_save_failure</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002648_source')" id="l_M002648_source">show source</a> ]</p>
  <div id="M002648_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/dirty_test.rb, line 223</span>
223:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_changed_attributes_should_be_preserved_if_save_failure</span>
224:     <span class="ruby-identifier">pirate</span> = <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">new</span>
225:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">parrot_id</span> = <span class="ruby-value">1</span>
226:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">save</span>
227:     <span class="ruby-identifier">check_pirate_after_save_failure</span>(<span class="ruby-identifier">pirate</span>)
228: 
229:     <span class="ruby-identifier">pirate</span> = <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">new</span>
230:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">parrot_id</span> = <span class="ruby-value">1</span>
231:     <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">RecordInvalid</span>) { <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">save!</span> }
232:     <span class="ruby-identifier">check_pirate_after_save_failure</span>(<span class="ruby-identifier">pirate</span>)
233:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002638" class="method">
  <div id="M002638_title" class="title">
    <b>test_nullable_decimal_not_marked_as_changed_if_new_value_is_blank</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002638_source')" id="l_M002638_source">show source</a> ]</p>
  <div id="M002638_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/dirty_test.rb, line 75</span>
75:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_nullable_decimal_not_marked_as_changed_if_new_value_is_blank</span>
76:     <span class="ruby-identifier">numeric_data</span> = <span class="ruby-constant">NumericData</span>.<span class="ruby-identifier">new</span>
77: 
78:     [<span class="ruby-value str">&quot;&quot;</span>, <span class="ruby-keyword kw">nil</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
79:       <span class="ruby-identifier">numeric_data</span>.<span class="ruby-identifier">bank_balance</span> = <span class="ruby-identifier">value</span>
80:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">numeric_data</span>.<span class="ruby-identifier">bank_balance_changed?</span>
81:       <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">numeric_data</span>.<span class="ruby-identifier">bank_balance_change</span>
82:     <span class="ruby-keyword kw">end</span>
83:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002639" class="method">
  <div id="M002639_title" class="title">
    <b>test_nullable_float_not_marked_as_changed_if_new_value_is_blank</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002639_source')" id="l_M002639_source">show source</a> ]</p>
  <div id="M002639_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/dirty_test.rb, line 85</span>
85:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_nullable_float_not_marked_as_changed_if_new_value_is_blank</span>
86:     <span class="ruby-identifier">numeric_data</span> = <span class="ruby-constant">NumericData</span>.<span class="ruby-identifier">new</span>
87: 
88:     [<span class="ruby-value str">&quot;&quot;</span>, <span class="ruby-keyword kw">nil</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
89:       <span class="ruby-identifier">numeric_data</span>.<span class="ruby-identifier">temperature</span> = <span class="ruby-identifier">value</span>
90:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">numeric_data</span>.<span class="ruby-identifier">temperature_changed?</span>
91:       <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">numeric_data</span>.<span class="ruby-identifier">temperature_change</span>
92:     <span class="ruby-keyword kw">end</span>
93:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002640" class="method">
  <div id="M002640_title" class="title">
    <b>test_nullable_integer_zero_to_string_zero_not_marked_as_changed</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002640_source')" id="l_M002640_source">show source</a> ]</p>
  <div id="M002640_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/dirty_test.rb, line 95</span>
 95:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_nullable_integer_zero_to_string_zero_not_marked_as_changed</span>
 96:     <span class="ruby-identifier">pirate</span> = <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">new</span>
 97:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">parrot_id</span> = <span class="ruby-value">0</span>
 98:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase</span> = <span class="ruby-value str">'arrr'</span>
 99:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">save!</span>
100: 
101:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">changed?</span>
102: 
103:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">parrot_id</span> = <span class="ruby-value str">'0'</span>
104:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">changed?</span>
105:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002637" class="method">
  <div id="M002637_title" class="title">
    <b>test_nullable_number_not_marked_as_changed_if_new_value_is_blank</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002637_source')" id="l_M002637_source">show source</a> ]</p>
  <div id="M002637_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/dirty_test.rb, line 65</span>
65:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_nullable_number_not_marked_as_changed_if_new_value_is_blank</span>
66:     <span class="ruby-identifier">pirate</span> = <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">new</span>
67: 
68:     [<span class="ruby-value str">&quot;&quot;</span>, <span class="ruby-keyword kw">nil</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
69:       <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">parrot_id</span> = <span class="ruby-identifier">value</span>
70:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">parrot_id_changed?</span>
71:       <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">parrot_id_change</span>
72:     <span class="ruby-keyword kw">end</span>
73:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002642" class="method">
  <div id="M002642_title" class="title">
    <b>test_object_should_be_changed_if_any_attribute_is_changed</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002642_source')" id="l_M002642_source">show source</a> ]</p>
  <div id="M002642_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/dirty_test.rb, line 134</span>
134:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_object_should_be_changed_if_any_attribute_is_changed</span>
135:     <span class="ruby-identifier">pirate</span> = <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">new</span>
136:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">changed?</span>
137:     <span class="ruby-identifier">assert_equal</span> [], <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">changed</span>
138:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>, <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">changes</span>
139: 
140:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase</span> = <span class="ruby-value str">'arrr'</span>
141:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">changed?</span>
142:     <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase_was</span>
143:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w(catchphrase)</span>, <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">changed</span>
144:     <span class="ruby-identifier">assert_equal</span>({<span class="ruby-value str">'catchphrase'</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-keyword kw">nil</span>, <span class="ruby-value str">'arrr'</span>]}, <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">changes</span>)
145: 
146:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">save</span>
147:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">changed?</span>
148:     <span class="ruby-identifier">assert_equal</span> [], <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">changed</span>
149:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>, <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">changes</span>
150:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002646" class="method">
  <div id="M002646_title" class="title">
    <b>test_partial_update</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002646_source')" id="l_M002646_source">show source</a> ]</p>
  <div id="M002646_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/dirty_test.rb, line 187</span>
187:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_partial_update</span>
188:     <span class="ruby-identifier">pirate</span> = <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:catchphrase</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'foo'</span>)
189:     <span class="ruby-identifier">old_updated_on</span> = <span class="ruby-value">1</span>.<span class="ruby-identifier">hour</span>.<span class="ruby-identifier">ago</span>.<span class="ruby-identifier">beginning_of_day</span>
190: 
191:     <span class="ruby-identifier">with_partial_updates</span> <span class="ruby-constant">Pirate</span>, <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">do</span>
192:       <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">2</span>) { <span class="ruby-value">2</span>.<span class="ruby-identifier">times</span> { <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">save!</span> } }
193:       <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">update_all</span>({ <span class="ruby-identifier">:updated_on</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">old_updated_on</span> }, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">id</span>)
194:     <span class="ruby-keyword kw">end</span>
195: 
196:     <span class="ruby-identifier">with_partial_updates</span> <span class="ruby-constant">Pirate</span>, <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">do</span>
197:       <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">0</span>) { <span class="ruby-value">2</span>.<span class="ruby-identifier">times</span> { <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">save!</span> } }
198:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">old_updated_on</span>, <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">updated_on</span>
199: 
200:       <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">1</span>) { <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase</span> = <span class="ruby-value str">'bar'</span>; <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">save!</span> }
201:       <span class="ruby-identifier">assert_not_equal</span> <span class="ruby-identifier">old_updated_on</span>, <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">updated_on</span>
202:     <span class="ruby-keyword kw">end</span>
203:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002647" class="method">
  <div id="M002647_title" class="title">
    <b>test_partial_update_with_optimistic_locking</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002647_source')" id="l_M002647_source">show source</a> ]</p>
  <div id="M002647_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/dirty_test.rb, line 205</span>
205:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_partial_update_with_optimistic_locking</span>
206:     <span class="ruby-identifier">person</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'foo'</span>)
207:     <span class="ruby-identifier">old_lock_version</span> = <span class="ruby-value">1</span>
208: 
209:     <span class="ruby-identifier">with_partial_updates</span> <span class="ruby-constant">Person</span>, <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">do</span>
210:       <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">2</span>) { <span class="ruby-value">2</span>.<span class="ruby-identifier">times</span> { <span class="ruby-identifier">person</span>.<span class="ruby-identifier">save!</span> } }
211:       <span class="ruby-constant">Person</span>.<span class="ruby-identifier">update_all</span>({ <span class="ruby-identifier">:first_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'baz'</span> }, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">person</span>.<span class="ruby-identifier">id</span>)
212:     <span class="ruby-keyword kw">end</span>
213: 
214:     <span class="ruby-identifier">with_partial_updates</span> <span class="ruby-constant">Person</span>, <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">do</span>
215:       <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">0</span>) { <span class="ruby-value">2</span>.<span class="ruby-identifier">times</span> { <span class="ruby-identifier">person</span>.<span class="ruby-identifier">save!</span> } }
216:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">old_lock_version</span>, <span class="ruby-identifier">person</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">lock_version</span>
217: 
218:       <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">1</span>) { <span class="ruby-identifier">person</span>.<span class="ruby-identifier">first_name</span> = <span class="ruby-value str">'bar'</span>; <span class="ruby-identifier">person</span>.<span class="ruby-identifier">save!</span> }
219:       <span class="ruby-identifier">assert_not_equal</span> <span class="ruby-identifier">old_lock_version</span>, <span class="ruby-identifier">person</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">lock_version</span>
220:     <span class="ruby-keyword kw">end</span>
221:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002649" class="method">
  <div id="M002649_title" class="title">
    <b>test_reload_should_clear_changed_attributes</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002649_source')" id="l_M002649_source">show source</a> ]</p>
  <div id="M002649_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/dirty_test.rb, line 235</span>
235:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_reload_should_clear_changed_attributes</span>
236:     <span class="ruby-identifier">pirate</span> = <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:catchphrase</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;shiver me timbers&quot;</span>)
237:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase</span> = <span class="ruby-value str">&quot;*hic*&quot;</span>
238:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">changed?</span>
239:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">reload</span>
240:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">changed?</span>
241:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002650" class="method">
  <div id="M002650_title" class="title">
    <b>test_reverted_changes_are_not_dirty</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002650_source')" id="l_M002650_source">show source</a> ]</p>
  <div id="M002650_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/dirty_test.rb, line 243</span>
243:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_reverted_changes_are_not_dirty</span>
244:     <span class="ruby-identifier">phrase</span> = <span class="ruby-value str">&quot;shiver me timbers&quot;</span>
245:     <span class="ruby-identifier">pirate</span> = <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:catchphrase</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">phrase</span>)
246:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase</span> = <span class="ruby-value str">&quot;*hic*&quot;</span>
247:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">changed?</span>
248:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase</span> = <span class="ruby-identifier">phrase</span>
249:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">changed?</span>
250:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002651" class="method">
  <div id="M002651_title" class="title">
    <b>test_reverted_changes_are_not_dirty_after_multiple_changes</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002651_source')" id="l_M002651_source">show source</a> ]</p>
  <div id="M002651_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/dirty_test.rb, line 252</span>
252:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_reverted_changes_are_not_dirty_after_multiple_changes</span>
253:     <span class="ruby-identifier">phrase</span> = <span class="ruby-value str">&quot;shiver me timbers&quot;</span>
254:     <span class="ruby-identifier">pirate</span> = <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:catchphrase</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">phrase</span>)
255:     <span class="ruby-value">10</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
256:       <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase</span> = <span class="ruby-value str">&quot;*hic*&quot;</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">i</span>
257:       <span class="ruby-identifier">assert</span> <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">changed?</span>
258:     <span class="ruby-keyword kw">end</span>
259:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">changed?</span>
260:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase</span> = <span class="ruby-identifier">phrase</span>
261:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">changed?</span>
262:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002652" class="method">
  <div id="M002652_title" class="title">
    <b>test_reverted_changes_are_not_dirty_going_from_nil_to_value_and_back</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002652_source')" id="l_M002652_source">show source</a> ]</p>
  <div id="M002652_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/dirty_test.rb, line 265</span>
265:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_reverted_changes_are_not_dirty_going_from_nil_to_value_and_back</span>
266:     <span class="ruby-identifier">pirate</span> = <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:catchphrase</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Yar!&quot;</span>)
267: 
268:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">parrot_id</span> = <span class="ruby-value">1</span>
269:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">changed?</span>
270:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">parrot_id_changed?</span>
271:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase_changed?</span>
272: 
273:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">parrot_id</span> = <span class="ruby-keyword kw">nil</span>
274:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">changed?</span>
275:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">parrot_id_changed?</span>
276:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase_changed?</span>
277:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002654" class="method">
  <div id="M002654_title" class="title">
    <b>test_save_should_not_save_serialized_attribute_with_partial_updates_if_not_present</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002654_source')" id="l_M002654_source">show source</a> ]</p>
  <div id="M002654_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/dirty_test.rb, line 291</span>
291:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_save_should_not_save_serialized_attribute_with_partial_updates_if_not_present</span>
292:     <span class="ruby-identifier">with_partial_updates</span>(<span class="ruby-constant">Topic</span>) <span class="ruby-keyword kw">do</span>
293:       <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:author_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Bill'</span>, <span class="ruby-identifier">:content</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:a</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;a&quot;</span>})
294:       <span class="ruby-identifier">topic</span> = <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">first</span>(<span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'id, author_name'</span>)
295:       <span class="ruby-identifier">topic</span>.<span class="ruby-identifier">update_attribute</span> <span class="ruby-identifier">:author_name</span>, <span class="ruby-value str">'John'</span>
296:       <span class="ruby-identifier">topic</span> = <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">first</span>
297:       <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">topic</span>.<span class="ruby-identifier">content</span>
298:     <span class="ruby-keyword kw">end</span>
299:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002653" class="method">
  <div id="M002653_title" class="title">
    <b>test_save_should_store_serialized_attributes_even_with_partial_updates</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002653_source')" id="l_M002653_source">show source</a> ]</p>
  <div id="M002653_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/dirty_test.rb, line 279</span>
279:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_save_should_store_serialized_attributes_even_with_partial_updates</span>
280:     <span class="ruby-identifier">with_partial_updates</span>(<span class="ruby-constant">Topic</span>) <span class="ruby-keyword kw">do</span>
281:       <span class="ruby-identifier">topic</span> = <span class="ruby-constant">Topic</span>.<span class="ruby-identifier">create!</span>(<span class="ruby-identifier">:content</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:a</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;a&quot;</span>})
282:       <span class="ruby-identifier">topic</span>.<span class="ruby-identifier">content</span>[<span class="ruby-identifier">:b</span>] = <span class="ruby-value str">&quot;b&quot;</span>
283:       <span class="ruby-comment cmt">#assert topic.changed? # Known bug, will fail</span>
284:       <span class="ruby-identifier">topic</span>.<span class="ruby-identifier">save!</span>
285:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;b&quot;</span>, <span class="ruby-identifier">topic</span>.<span class="ruby-identifier">content</span>[<span class="ruby-identifier">:b</span>]
286:       <span class="ruby-identifier">topic</span>.<span class="ruby-identifier">reload</span>
287:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;b&quot;</span>, <span class="ruby-identifier">topic</span>.<span class="ruby-identifier">content</span>[<span class="ruby-identifier">:b</span>]
288:     <span class="ruby-keyword kw">end</span>
289:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002641" class="method">
  <div id="M002641_title" class="title">
    <b>test_zero_to_blank_marked_as_changed</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002641_source')" id="l_M002641_source">show source</a> ]</p>
  <div id="M002641_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/dirty_test.rb, line 107</span>
107:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_zero_to_blank_marked_as_changed</span>
108:     <span class="ruby-identifier">pirate</span> = <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">new</span>
109:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">catchphrase</span> = <span class="ruby-value str">&quot;Yarrrr, me hearties&quot;</span>
110:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">parrot_id</span> = <span class="ruby-value">1</span>
111:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">save</span>
112: 
113:     <span class="ruby-comment cmt"># check the change from 1 to ''</span>
114:     <span class="ruby-identifier">pirate</span> = <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">find_by_catchphrase</span>(<span class="ruby-value str">&quot;Yarrrr, me hearties&quot;</span>)
115:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">parrot_id</span> = <span class="ruby-value str">''</span>
116:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">parrot_id_changed?</span>
117:     <span class="ruby-identifier">assert_equal</span>([<span class="ruby-value">1</span>, <span class="ruby-keyword kw">nil</span>], <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">parrot_id_change</span>)
118:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">save</span>
119: 
120:     <span class="ruby-comment cmt"># check the change from nil to 0</span>
121:     <span class="ruby-identifier">pirate</span> = <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">find_by_catchphrase</span>(<span class="ruby-value str">&quot;Yarrrr, me hearties&quot;</span>)
122:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">parrot_id</span> = <span class="ruby-value">0</span>
123:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">parrot_id_changed?</span>
124:     <span class="ruby-identifier">assert_equal</span>([<span class="ruby-keyword kw">nil</span>, <span class="ruby-value">0</span>], <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">parrot_id_change</span>)
125:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">save</span>
126: 
127:     <span class="ruby-comment cmt"># check the change from 0 to ''</span>
128:     <span class="ruby-identifier">pirate</span> = <span class="ruby-constant">Pirate</span>.<span class="ruby-identifier">find_by_catchphrase</span>(<span class="ruby-value str">&quot;Yarrrr, me hearties&quot;</span>)
129:     <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">parrot_id</span> = <span class="ruby-value str">''</span>
130:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">parrot_id_changed?</span>
131:     <span class="ruby-identifier">assert_equal</span>([<span class="ruby-value">0</span>, <span class="ruby-keyword kw">nil</span>], <span class="ruby-identifier">pirate</span>.<span class="ruby-identifier">parrot_id_change</span>)
132:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>