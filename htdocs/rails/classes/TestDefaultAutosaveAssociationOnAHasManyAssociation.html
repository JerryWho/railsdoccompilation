  <div id="C00000484">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />TestDefaultAutosaveAssociationOnAHasManyAssociation<br/>
  In:
<a href="#" onclick="jsHref('files/activerecord/test/cases/autosave_association_test_rb.html');">activerecord/test/cases/autosave_association_test.rb</a>

Parent:&nbsp;
ActiveRecord::TestCase
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">




  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M003186&name=test_adding_before_save" >test_adding_before_save</a></li>
  <li><a href="index.html?a=M003187&name=test_assign_ids" >test_assign_ids</a></li>
  <li><a href="index.html?a=M003188&name=test_assign_ids_for_through_a_belongs_to" >test_assign_ids_for_through_a_belongs_to</a></li>
  <li><a href="index.html?a=M003189&name=test_build_before_save" >test_build_before_save</a></li>
  <li><a href="index.html?a=M003190&name=test_build_many_before_save" >test_build_many_before_save</a></li>
  <li><a href="index.html?a=M003192&name=test_build_many_via_block_before_save" >test_build_many_via_block_before_save</a></li>
  <li><a href="index.html?a=M003191&name=test_build_via_block_before_save" >test_build_via_block_before_save</a></li>
  <li><a href="index.html?a=M003181&name=test_invalid_adding" >test_invalid_adding</a></li>
  <li><a href="index.html?a=M003182&name=test_invalid_adding_before_save" >test_invalid_adding_before_save</a></li>
  <li><a href="index.html?a=M003183&name=test_invalid_adding_with_validate_false" >test_invalid_adding_with_validate_false</a></li>
  <li><a href="index.html?a=M003185&name=test_invalid_build" >test_invalid_build</a></li>
  <li><a href="index.html?a=M003193&name=test_replace_on_new_object" >test_replace_on_new_object</a></li>
  <li><a href="index.html?a=M003184&name=test_valid_adding_with_validate_false" >test_valid_adding_with_validate_false</a></li>
  </ul>






<div class="sectiontitle">Public Instance methods</div>
<div id="M003186" class="method">
  <div id="M003186_title" class="title">
    <b>test_adding_before_save</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003186_source')" id="l_M003186_source">show source</a> ]</p>
  <div id="M003186_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 373</span>
373:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_adding_before_save</span>
374:     <span class="ruby-identifier">no_of_firms</span> = <span class="ruby-constant">Firm</span>.<span class="ruby-identifier">count</span>
375:     <span class="ruby-identifier">no_of_clients</span> = <span class="ruby-constant">Client</span>.<span class="ruby-identifier">count</span>
376: 
377:     <span class="ruby-identifier">new_firm</span> = <span class="ruby-constant">Firm</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;A New Firm, Inc&quot;</span>)
378:     <span class="ruby-identifier">c</span> = <span class="ruby-constant">Client</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Apple&quot;</span>)
379: 
380:     <span class="ruby-identifier">new_firm</span>.<span class="ruby-identifier">clients_of_firm</span>.<span class="ruby-identifier">push</span> <span class="ruby-constant">Client</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Natural Company&quot;</span>)
381:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">new_firm</span>.<span class="ruby-identifier">clients_of_firm</span>.<span class="ruby-identifier">size</span>
382:     <span class="ruby-identifier">new_firm</span>.<span class="ruby-identifier">clients_of_firm</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">c</span>
383:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">new_firm</span>.<span class="ruby-identifier">clients_of_firm</span>.<span class="ruby-identifier">size</span>
384: 
385:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">no_of_firms</span>, <span class="ruby-constant">Firm</span>.<span class="ruby-identifier">count</span>      <span class="ruby-comment cmt"># Firm was not saved to database.</span>
386:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">no_of_clients</span>, <span class="ruby-constant">Client</span>.<span class="ruby-identifier">count</span>  <span class="ruby-comment cmt"># Clients were not saved to database.</span>
387:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">new_firm</span>.<span class="ruby-identifier">save</span>
388:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">new_firm</span>.<span class="ruby-identifier">new_record?</span>
389:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">c</span>.<span class="ruby-identifier">new_record?</span>
390:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">new_firm</span>, <span class="ruby-identifier">c</span>.<span class="ruby-identifier">firm</span>
391:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">no_of_firms</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>, <span class="ruby-constant">Firm</span>.<span class="ruby-identifier">count</span>      <span class="ruby-comment cmt"># Firm was saved to database.</span>
392:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">no_of_clients</span><span class="ruby-operator">+</span><span class="ruby-value">2</span>, <span class="ruby-constant">Client</span>.<span class="ruby-identifier">count</span>  <span class="ruby-comment cmt"># Clients were saved to database.</span>
393: 
394:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">new_firm</span>.<span class="ruby-identifier">clients_of_firm</span>.<span class="ruby-identifier">size</span>
395:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">new_firm</span>.<span class="ruby-identifier">clients_of_firm</span>(<span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">size</span>
396:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003187" class="method">
  <div id="M003187_title" class="title">
    <b>test_assign_ids</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003187_source')" id="l_M003187_source">show source</a> ]</p>
  <div id="M003187_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 398</span>
398:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_assign_ids</span>
399:     <span class="ruby-identifier">firm</span> = <span class="ruby-constant">Firm</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Apple&quot;</span>)
400:     <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">client_ids</span> = [<span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_client</span>).<span class="ruby-identifier">id</span>, <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:second_client</span>).<span class="ruby-identifier">id</span>]
401:     <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">save</span>
402:     <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">reload</span>
403:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">clients</span>.<span class="ruby-identifier">length</span>
404:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">clients</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:second_client</span>))
405:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003188" class="method">
  <div id="M003188_title" class="title">
    <b>test_assign_ids_for_through_a_belongs_to</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003188_source')" id="l_M003188_source">show source</a> ]</p>
  <div id="M003188_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 407</span>
407:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_assign_ids_for_through_a_belongs_to</span>
408:     <span class="ruby-identifier">post</span> = <span class="ruby-constant">Post</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Assigning IDs works!&quot;</span>, <span class="ruby-identifier">:body</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;You heared it here first, folks!&quot;</span>)
409:     <span class="ruby-identifier">post</span>.<span class="ruby-identifier">person_ids</span> = [<span class="ruby-identifier">people</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">id</span>, <span class="ruby-identifier">people</span>(<span class="ruby-identifier">:michael</span>).<span class="ruby-identifier">id</span>]
410:     <span class="ruby-identifier">post</span>.<span class="ruby-identifier">save</span>
411:     <span class="ruby-identifier">post</span>.<span class="ruby-identifier">reload</span>
412:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">post</span>.<span class="ruby-identifier">people</span>.<span class="ruby-identifier">length</span>
413:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">post</span>.<span class="ruby-identifier">people</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">people</span>(<span class="ruby-identifier">:david</span>))
414:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003189" class="method">
  <div id="M003189_title" class="title">
    <b>test_build_before_save</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003189_source')" id="l_M003189_source">show source</a> ]</p>
  <div id="M003189_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 416</span>
416:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_build_before_save</span>
417:     <span class="ruby-identifier">company</span> = <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>)
418:     <span class="ruby-identifier">new_client</span> = <span class="ruby-identifier">assert_no_queries</span> { <span class="ruby-identifier">company</span>.<span class="ruby-identifier">clients_of_firm</span>.<span class="ruby-identifier">build</span>(<span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Another Client&quot;</span>) }
419:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">company</span>.<span class="ruby-identifier">clients_of_firm</span>.<span class="ruby-identifier">loaded?</span>
420: 
421:     <span class="ruby-identifier">company</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">'-changed'</span>
422:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">2</span>) { <span class="ruby-identifier">assert</span> <span class="ruby-identifier">company</span>.<span class="ruby-identifier">save</span> }
423:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">new_client</span>.<span class="ruby-identifier">new_record?</span>
424:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">company</span>.<span class="ruby-identifier">clients_of_firm</span>(<span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">size</span>
425:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003190" class="method">
  <div id="M003190_title" class="title">
    <b>test_build_many_before_save</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003190_source')" id="l_M003190_source">show source</a> ]</p>
  <div id="M003190_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 427</span>
427:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_build_many_before_save</span>
428:     <span class="ruby-identifier">company</span> = <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>)
429:     <span class="ruby-identifier">new_clients</span> = <span class="ruby-identifier">assert_no_queries</span> { <span class="ruby-identifier">company</span>.<span class="ruby-identifier">clients_of_firm</span>.<span class="ruby-identifier">build</span>([{<span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Another Client&quot;</span>}, {<span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Another Client II&quot;</span>}]) }
430: 
431:     <span class="ruby-identifier">company</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">'-changed'</span>
432:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">3</span>) { <span class="ruby-identifier">assert</span> <span class="ruby-identifier">company</span>.<span class="ruby-identifier">save</span> }
433:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">3</span>, <span class="ruby-identifier">company</span>.<span class="ruby-identifier">clients_of_firm</span>(<span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">size</span>
434:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003192" class="method">
  <div id="M003192_title" class="title">
    <b>test_build_many_via_block_before_save</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003192_source')" id="l_M003192_source">show source</a> ]</p>
  <div id="M003192_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 447</span>
447:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_build_many_via_block_before_save</span>
448:     <span class="ruby-identifier">company</span> = <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>)
449:     <span class="ruby-identifier">new_clients</span> = <span class="ruby-identifier">assert_no_queries</span> <span class="ruby-keyword kw">do</span>
450:       <span class="ruby-identifier">company</span>.<span class="ruby-identifier">clients_of_firm</span>.<span class="ruby-identifier">build</span>([{<span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Another Client&quot;</span>}, {<span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Another Client II&quot;</span>}]) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">client</span><span class="ruby-operator">|</span>
451:         <span class="ruby-identifier">client</span>.<span class="ruby-identifier">name</span> = <span class="ruby-value str">&quot;changed&quot;</span>
452:       <span class="ruby-keyword kw">end</span>
453:     <span class="ruby-keyword kw">end</span>
454: 
455:     <span class="ruby-identifier">company</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">'-changed'</span>
456:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">3</span>) { <span class="ruby-identifier">assert</span> <span class="ruby-identifier">company</span>.<span class="ruby-identifier">save</span> }
457:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">3</span>, <span class="ruby-identifier">company</span>.<span class="ruby-identifier">clients_of_firm</span>(<span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">size</span>
458:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003191" class="method">
  <div id="M003191_title" class="title">
    <b>test_build_via_block_before_save</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003191_source')" id="l_M003191_source">show source</a> ]</p>
  <div id="M003191_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 436</span>
436:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_build_via_block_before_save</span>
437:     <span class="ruby-identifier">company</span> = <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>)
438:     <span class="ruby-identifier">new_client</span> = <span class="ruby-identifier">assert_no_queries</span> { <span class="ruby-identifier">company</span>.<span class="ruby-identifier">clients_of_firm</span>.<span class="ruby-identifier">build</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">client</span><span class="ruby-operator">|</span> <span class="ruby-identifier">client</span>.<span class="ruby-identifier">name</span> = <span class="ruby-value str">&quot;Another Client&quot;</span> } }
439:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">company</span>.<span class="ruby-identifier">clients_of_firm</span>.<span class="ruby-identifier">loaded?</span>
440: 
441:     <span class="ruby-identifier">company</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">'-changed'</span>
442:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">2</span>) { <span class="ruby-identifier">assert</span> <span class="ruby-identifier">company</span>.<span class="ruby-identifier">save</span> }
443:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">new_client</span>.<span class="ruby-identifier">new_record?</span>
444:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">company</span>.<span class="ruby-identifier">clients_of_firm</span>(<span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">size</span>
445:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003181" class="method">
  <div id="M003181_title" class="title">
    <b>test_invalid_adding</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003181_source')" id="l_M003181_source">show source</a> ]</p>
  <div id="M003181_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 313</span>
313:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_invalid_adding</span>
314:     <span class="ruby-identifier">firm</span> = <span class="ruby-constant">Firm</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>)
315:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">firm</span>.<span class="ruby-identifier">clients_of_firm</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">c</span> = <span class="ruby-constant">Client</span>.<span class="ruby-identifier">new</span>)
316:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">new_record?</span>
317:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">firm</span>.<span class="ruby-identifier">valid?</span>
318:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">firm</span>.<span class="ruby-identifier">save</span>
319:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">new_record?</span>
320:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003182" class="method">
  <div id="M003182_title" class="title">
    <b>test_invalid_adding_before_save</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003182_source')" id="l_M003182_source">show source</a> ]</p>
  <div id="M003182_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 322</span>
322:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_invalid_adding_before_save</span>
323:     <span class="ruby-identifier">no_of_firms</span> = <span class="ruby-constant">Firm</span>.<span class="ruby-identifier">count</span>
324:     <span class="ruby-identifier">no_of_clients</span> = <span class="ruby-constant">Client</span>.<span class="ruby-identifier">count</span>
325:     <span class="ruby-identifier">new_firm</span> = <span class="ruby-constant">Firm</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;A New Firm, Inc&quot;</span>)
326:     <span class="ruby-identifier">new_firm</span>.<span class="ruby-identifier">clients_of_firm</span>.<span class="ruby-identifier">concat</span>([<span class="ruby-identifier">c</span> = <span class="ruby-constant">Client</span>.<span class="ruby-identifier">new</span>, <span class="ruby-constant">Client</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Apple&quot;</span>)])
327:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">new_record?</span>
328:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">c</span>.<span class="ruby-identifier">valid?</span>
329:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">new_firm</span>.<span class="ruby-identifier">valid?</span>
330:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">new_firm</span>.<span class="ruby-identifier">save</span>
331:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">new_record?</span>
332:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">new_firm</span>.<span class="ruby-identifier">new_record?</span>
333:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003183" class="method">
  <div id="M003183_title" class="title">
    <b>test_invalid_adding_with_validate_false</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003183_source')" id="l_M003183_source">show source</a> ]</p>
  <div id="M003183_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 335</span>
335:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_invalid_adding_with_validate_false</span>
336:     <span class="ruby-identifier">firm</span> = <span class="ruby-constant">Firm</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>)
337:     <span class="ruby-identifier">client</span> = <span class="ruby-constant">Client</span>.<span class="ruby-identifier">new</span>
338:     <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">unvalidated_clients_of_firm</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">client</span>
339: 
340:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">valid?</span>
341:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">client</span>.<span class="ruby-identifier">valid?</span>
342:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">save</span>
343:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">client</span>.<span class="ruby-identifier">new_record?</span>
344:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003185" class="method">
  <div id="M003185_title" class="title">
    <b>test_invalid_build</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003185_source')" id="l_M003185_source">show source</a> ]</p>
  <div id="M003185_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 363</span>
363:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_invalid_build</span>
364:     <span class="ruby-identifier">new_client</span> = <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>).<span class="ruby-identifier">clients_of_firm</span>.<span class="ruby-identifier">build</span>
365:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">new_client</span>.<span class="ruby-identifier">new_record?</span>
366:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">new_client</span>.<span class="ruby-identifier">valid?</span>
367:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">new_client</span>, <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>).<span class="ruby-identifier">clients_of_firm</span>.<span class="ruby-identifier">last</span>
368:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>).<span class="ruby-identifier">save</span>
369:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">new_client</span>.<span class="ruby-identifier">new_record?</span>
370:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>).<span class="ruby-identifier">clients_of_firm</span>(<span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">size</span>
371:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003193" class="method">
  <div id="M003193_title" class="title">
    <b>test_replace_on_new_object</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003193_source')" id="l_M003193_source">show source</a> ]</p>
  <div id="M003193_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 460</span>
460:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_replace_on_new_object</span>
461:     <span class="ruby-identifier">firm</span> = <span class="ruby-constant">Firm</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;New Firm&quot;</span>)
462:     <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">clients</span> = [<span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:second_client</span>), <span class="ruby-constant">Client</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;New Client&quot;</span>)]
463:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">save</span>
464:     <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">reload</span>
465:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">clients</span>.<span class="ruby-identifier">length</span>
466:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">clients</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-constant">Client</span>.<span class="ruby-identifier">find_by_name</span>(<span class="ruby-value str">&quot;New Client&quot;</span>))
467:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003184" class="method">
  <div id="M003184_title" class="title">
    <b>test_valid_adding_with_validate_false</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003184_source')" id="l_M003184_source">show source</a> ]</p>
  <div id="M003184_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 346</span>
346:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_valid_adding_with_validate_false</span>
347:     <span class="ruby-identifier">no_of_clients</span> = <span class="ruby-constant">Client</span>.<span class="ruby-identifier">count</span>
348: 
349:     <span class="ruby-identifier">firm</span> = <span class="ruby-constant">Firm</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>)
350:     <span class="ruby-identifier">client</span> = <span class="ruby-constant">Client</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Apple&quot;</span>)
351: 
352:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">valid?</span>
353:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">client</span>.<span class="ruby-identifier">valid?</span>
354:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">client</span>.<span class="ruby-identifier">new_record?</span>
355: 
356:     <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">unvalidated_clients_of_firm</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">client</span>
357: 
358:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">save</span>
359:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">client</span>.<span class="ruby-identifier">new_record?</span>
360:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">no_of_clients</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>, <span class="ruby-constant">Client</span>.<span class="ruby-identifier">count</span>
361:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>