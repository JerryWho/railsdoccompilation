  <div id="C00000518">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />TestDefaultAutosaveAssociationOnAHasManyAssociation<br/>
  In:
<a href="#" onclick="jsHref('files/activerecord/test/cases/autosave_association_test_rb.html');">activerecord/test/cases/autosave_association_test.rb</a>

Parent:&nbsp;
ActiveRecord::TestCase
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">




  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M003141&name=test_adding_before_save" >test_adding_before_save</a></li>
  <li><a href="index.html?a=M003142&name=test_assign_ids" >test_assign_ids</a></li>
  <li><a href="index.html?a=M003143&name=test_assign_ids_for_through_a_belongs_to" >test_assign_ids_for_through_a_belongs_to</a></li>
  <li><a href="index.html?a=M003144&name=test_build_before_save" >test_build_before_save</a></li>
  <li><a href="index.html?a=M003145&name=test_build_many_before_save" >test_build_many_before_save</a></li>
  <li><a href="index.html?a=M003147&name=test_build_many_via_block_before_save" >test_build_many_via_block_before_save</a></li>
  <li><a href="index.html?a=M003146&name=test_build_via_block_before_save" >test_build_via_block_before_save</a></li>
  <li><a href="index.html?a=M003136&name=test_invalid_adding" >test_invalid_adding</a></li>
  <li><a href="index.html?a=M003137&name=test_invalid_adding_before_save" >test_invalid_adding_before_save</a></li>
  <li><a href="index.html?a=M003138&name=test_invalid_adding_with_validate_false" >test_invalid_adding_with_validate_false</a></li>
  <li><a href="index.html?a=M003140&name=test_invalid_build" >test_invalid_build</a></li>
  <li><a href="index.html?a=M003148&name=test_replace_on_new_object" >test_replace_on_new_object</a></li>
  <li><a href="index.html?a=M003139&name=test_valid_adding_with_validate_false" >test_valid_adding_with_validate_false</a></li>
  </ul>






<div class="sectiontitle">Public Instance methods</div>
<div id="M003141" class="method">
  <div id="M003141_title" class="title">
    <b>test_adding_before_save</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003141_source')" id="l_M003141_source">show source</a> ]</p>
  <div id="M003141_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 342</span>
342:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_adding_before_save</span>
343:     <span class="ruby-identifier">no_of_firms</span> = <span class="ruby-constant">Firm</span>.<span class="ruby-identifier">count</span>
344:     <span class="ruby-identifier">no_of_clients</span> = <span class="ruby-constant">Client</span>.<span class="ruby-identifier">count</span>
345: 
346:     <span class="ruby-identifier">new_firm</span> = <span class="ruby-constant">Firm</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;A New Firm, Inc&quot;</span>)
347:     <span class="ruby-identifier">c</span> = <span class="ruby-constant">Client</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Apple&quot;</span>)
348: 
349:     <span class="ruby-identifier">new_firm</span>.<span class="ruby-identifier">clients_of_firm</span>.<span class="ruby-identifier">push</span> <span class="ruby-constant">Client</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Natural Company&quot;</span>)
350:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">new_firm</span>.<span class="ruby-identifier">clients_of_firm</span>.<span class="ruby-identifier">size</span>
351:     <span class="ruby-identifier">new_firm</span>.<span class="ruby-identifier">clients_of_firm</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">c</span>
352:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">new_firm</span>.<span class="ruby-identifier">clients_of_firm</span>.<span class="ruby-identifier">size</span>
353: 
354:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">no_of_firms</span>, <span class="ruby-constant">Firm</span>.<span class="ruby-identifier">count</span>      <span class="ruby-comment cmt"># Firm was not saved to database.</span>
355:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">no_of_clients</span>, <span class="ruby-constant">Client</span>.<span class="ruby-identifier">count</span>  <span class="ruby-comment cmt"># Clients were not saved to database.</span>
356:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">new_firm</span>.<span class="ruby-identifier">save</span>
357:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">new_firm</span>.<span class="ruby-identifier">new_record?</span>
358:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">c</span>.<span class="ruby-identifier">new_record?</span>
359:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">new_firm</span>, <span class="ruby-identifier">c</span>.<span class="ruby-identifier">firm</span>
360:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">no_of_firms</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>, <span class="ruby-constant">Firm</span>.<span class="ruby-identifier">count</span>      <span class="ruby-comment cmt"># Firm was saved to database.</span>
361:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">no_of_clients</span><span class="ruby-operator">+</span><span class="ruby-value">2</span>, <span class="ruby-constant">Client</span>.<span class="ruby-identifier">count</span>  <span class="ruby-comment cmt"># Clients were saved to database.</span>
362: 
363:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">new_firm</span>.<span class="ruby-identifier">clients_of_firm</span>.<span class="ruby-identifier">size</span>
364:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">new_firm</span>.<span class="ruby-identifier">clients_of_firm</span>(<span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">size</span>
365:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003142" class="method">
  <div id="M003142_title" class="title">
    <b>test_assign_ids</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003142_source')" id="l_M003142_source">show source</a> ]</p>
  <div id="M003142_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 367</span>
367:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_assign_ids</span>
368:     <span class="ruby-identifier">firm</span> = <span class="ruby-constant">Firm</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Apple&quot;</span>)
369:     <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">client_ids</span> = [<span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_client</span>).<span class="ruby-identifier">id</span>, <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:second_client</span>).<span class="ruby-identifier">id</span>]
370:     <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">save</span>
371:     <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">reload</span>
372:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">clients</span>.<span class="ruby-identifier">length</span>
373:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">clients</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:second_client</span>))
374:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003143" class="method">
  <div id="M003143_title" class="title">
    <b>test_assign_ids_for_through_a_belongs_to</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003143_source')" id="l_M003143_source">show source</a> ]</p>
  <div id="M003143_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 376</span>
376:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_assign_ids_for_through_a_belongs_to</span>
377:     <span class="ruby-identifier">post</span> = <span class="ruby-constant">Post</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:title</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Assigning IDs works!&quot;</span>, <span class="ruby-identifier">:body</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;You heared it here first, folks!&quot;</span>)
378:     <span class="ruby-identifier">post</span>.<span class="ruby-identifier">person_ids</span> = [<span class="ruby-identifier">people</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">id</span>, <span class="ruby-identifier">people</span>(<span class="ruby-identifier">:michael</span>).<span class="ruby-identifier">id</span>]
379:     <span class="ruby-identifier">post</span>.<span class="ruby-identifier">save</span>
380:     <span class="ruby-identifier">post</span>.<span class="ruby-identifier">reload</span>
381:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">post</span>.<span class="ruby-identifier">people</span>.<span class="ruby-identifier">length</span>
382:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">post</span>.<span class="ruby-identifier">people</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">people</span>(<span class="ruby-identifier">:david</span>))
383:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003144" class="method">
  <div id="M003144_title" class="title">
    <b>test_build_before_save</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003144_source')" id="l_M003144_source">show source</a> ]</p>
  <div id="M003144_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 385</span>
385:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_build_before_save</span>
386:     <span class="ruby-identifier">company</span> = <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>)
387:     <span class="ruby-identifier">new_client</span> = <span class="ruby-identifier">assert_no_queries</span> { <span class="ruby-identifier">company</span>.<span class="ruby-identifier">clients_of_firm</span>.<span class="ruby-identifier">build</span>(<span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Another Client&quot;</span>) }
388:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">company</span>.<span class="ruby-identifier">clients_of_firm</span>.<span class="ruby-identifier">loaded?</span>
389: 
390:     <span class="ruby-identifier">company</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">'-changed'</span>
391:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">2</span>) { <span class="ruby-identifier">assert</span> <span class="ruby-identifier">company</span>.<span class="ruby-identifier">save</span> }
392:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">new_client</span>.<span class="ruby-identifier">new_record?</span>
393:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">company</span>.<span class="ruby-identifier">clients_of_firm</span>(<span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">size</span>
394:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003145" class="method">
  <div id="M003145_title" class="title">
    <b>test_build_many_before_save</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003145_source')" id="l_M003145_source">show source</a> ]</p>
  <div id="M003145_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 396</span>
396:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_build_many_before_save</span>
397:     <span class="ruby-identifier">company</span> = <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>)
398:     <span class="ruby-identifier">new_clients</span> = <span class="ruby-identifier">assert_no_queries</span> { <span class="ruby-identifier">company</span>.<span class="ruby-identifier">clients_of_firm</span>.<span class="ruby-identifier">build</span>([{<span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Another Client&quot;</span>}, {<span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Another Client II&quot;</span>}]) }
399: 
400:     <span class="ruby-identifier">company</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">'-changed'</span>
401:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">3</span>) { <span class="ruby-identifier">assert</span> <span class="ruby-identifier">company</span>.<span class="ruby-identifier">save</span> }
402:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">3</span>, <span class="ruby-identifier">company</span>.<span class="ruby-identifier">clients_of_firm</span>(<span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">size</span>
403:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003147" class="method">
  <div id="M003147_title" class="title">
    <b>test_build_many_via_block_before_save</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003147_source')" id="l_M003147_source">show source</a> ]</p>
  <div id="M003147_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 416</span>
416:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_build_many_via_block_before_save</span>
417:     <span class="ruby-identifier">company</span> = <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>)
418:     <span class="ruby-identifier">new_clients</span> = <span class="ruby-identifier">assert_no_queries</span> <span class="ruby-keyword kw">do</span>
419:       <span class="ruby-identifier">company</span>.<span class="ruby-identifier">clients_of_firm</span>.<span class="ruby-identifier">build</span>([{<span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Another Client&quot;</span>}, {<span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Another Client II&quot;</span>}]) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">client</span><span class="ruby-operator">|</span>
420:         <span class="ruby-identifier">client</span>.<span class="ruby-identifier">name</span> = <span class="ruby-value str">&quot;changed&quot;</span>
421:       <span class="ruby-keyword kw">end</span>
422:     <span class="ruby-keyword kw">end</span>
423: 
424:     <span class="ruby-identifier">company</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">'-changed'</span>
425:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">3</span>) { <span class="ruby-identifier">assert</span> <span class="ruby-identifier">company</span>.<span class="ruby-identifier">save</span> }
426:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">3</span>, <span class="ruby-identifier">company</span>.<span class="ruby-identifier">clients_of_firm</span>(<span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">size</span>
427:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003146" class="method">
  <div id="M003146_title" class="title">
    <b>test_build_via_block_before_save</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003146_source')" id="l_M003146_source">show source</a> ]</p>
  <div id="M003146_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 405</span>
405:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_build_via_block_before_save</span>
406:     <span class="ruby-identifier">company</span> = <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>)
407:     <span class="ruby-identifier">new_client</span> = <span class="ruby-identifier">assert_no_queries</span> { <span class="ruby-identifier">company</span>.<span class="ruby-identifier">clients_of_firm</span>.<span class="ruby-identifier">build</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">client</span><span class="ruby-operator">|</span> <span class="ruby-identifier">client</span>.<span class="ruby-identifier">name</span> = <span class="ruby-value str">&quot;Another Client&quot;</span> } }
408:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">company</span>.<span class="ruby-identifier">clients_of_firm</span>.<span class="ruby-identifier">loaded?</span>
409: 
410:     <span class="ruby-identifier">company</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">'-changed'</span>
411:     <span class="ruby-identifier">assert_queries</span>(<span class="ruby-value">2</span>) { <span class="ruby-identifier">assert</span> <span class="ruby-identifier">company</span>.<span class="ruby-identifier">save</span> }
412:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">new_client</span>.<span class="ruby-identifier">new_record?</span>
413:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">company</span>.<span class="ruby-identifier">clients_of_firm</span>(<span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">size</span>
414:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003136" class="method">
  <div id="M003136_title" class="title">
    <b>test_invalid_adding</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003136_source')" id="l_M003136_source">show source</a> ]</p>
  <div id="M003136_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 282</span>
282:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_invalid_adding</span>
283:     <span class="ruby-identifier">firm</span> = <span class="ruby-constant">Firm</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>)
284:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">firm</span>.<span class="ruby-identifier">clients_of_firm</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">c</span> = <span class="ruby-constant">Client</span>.<span class="ruby-identifier">new</span>)
285:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">new_record?</span>
286:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">firm</span>.<span class="ruby-identifier">valid?</span>
287:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">firm</span>.<span class="ruby-identifier">save</span>
288:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">new_record?</span>
289:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003137" class="method">
  <div id="M003137_title" class="title">
    <b>test_invalid_adding_before_save</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003137_source')" id="l_M003137_source">show source</a> ]</p>
  <div id="M003137_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 291</span>
291:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_invalid_adding_before_save</span>
292:     <span class="ruby-identifier">no_of_firms</span> = <span class="ruby-constant">Firm</span>.<span class="ruby-identifier">count</span>
293:     <span class="ruby-identifier">no_of_clients</span> = <span class="ruby-constant">Client</span>.<span class="ruby-identifier">count</span>
294:     <span class="ruby-identifier">new_firm</span> = <span class="ruby-constant">Firm</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;A New Firm, Inc&quot;</span>)
295:     <span class="ruby-identifier">new_firm</span>.<span class="ruby-identifier">clients_of_firm</span>.<span class="ruby-identifier">concat</span>([<span class="ruby-identifier">c</span> = <span class="ruby-constant">Client</span>.<span class="ruby-identifier">new</span>, <span class="ruby-constant">Client</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Apple&quot;</span>)])
296:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">new_record?</span>
297:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">c</span>.<span class="ruby-identifier">valid?</span>
298:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">new_firm</span>.<span class="ruby-identifier">valid?</span>
299:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">new_firm</span>.<span class="ruby-identifier">save</span>
300:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">new_record?</span>
301:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">new_firm</span>.<span class="ruby-identifier">new_record?</span>
302:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003138" class="method">
  <div id="M003138_title" class="title">
    <b>test_invalid_adding_with_validate_false</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003138_source')" id="l_M003138_source">show source</a> ]</p>
  <div id="M003138_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 304</span>
304:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_invalid_adding_with_validate_false</span>
305:     <span class="ruby-identifier">firm</span> = <span class="ruby-constant">Firm</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>)
306:     <span class="ruby-identifier">client</span> = <span class="ruby-constant">Client</span>.<span class="ruby-identifier">new</span>
307:     <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">unvalidated_clients_of_firm</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">client</span>
308: 
309:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">valid?</span>
310:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">client</span>.<span class="ruby-identifier">valid?</span>
311:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">save</span>
312:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">client</span>.<span class="ruby-identifier">new_record?</span>
313:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003140" class="method">
  <div id="M003140_title" class="title">
    <b>test_invalid_build</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003140_source')" id="l_M003140_source">show source</a> ]</p>
  <div id="M003140_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 332</span>
332:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_invalid_build</span>
333:     <span class="ruby-identifier">new_client</span> = <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>).<span class="ruby-identifier">clients_of_firm</span>.<span class="ruby-identifier">build</span>
334:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">new_client</span>.<span class="ruby-identifier">new_record?</span>
335:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">new_client</span>.<span class="ruby-identifier">valid?</span>
336:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">new_client</span>, <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>).<span class="ruby-identifier">clients_of_firm</span>.<span class="ruby-identifier">last</span>
337:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>).<span class="ruby-identifier">save</span>
338:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">new_client</span>.<span class="ruby-identifier">new_record?</span>
339:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>).<span class="ruby-identifier">clients_of_firm</span>(<span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">size</span>
340:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003148" class="method">
  <div id="M003148_title" class="title">
    <b>test_replace_on_new_object</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003148_source')" id="l_M003148_source">show source</a> ]</p>
  <div id="M003148_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 429</span>
429:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_replace_on_new_object</span>
430:     <span class="ruby-identifier">firm</span> = <span class="ruby-constant">Firm</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;New Firm&quot;</span>)
431:     <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">clients</span> = [<span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:second_client</span>), <span class="ruby-constant">Client</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;New Client&quot;</span>)]
432:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">save</span>
433:     <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">reload</span>
434:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">clients</span>.<span class="ruby-identifier">length</span>
435:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">clients</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-constant">Client</span>.<span class="ruby-identifier">find_by_name</span>(<span class="ruby-value str">&quot;New Client&quot;</span>))
436:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M003139" class="method">
  <div id="M003139_title" class="title">
    <b>test_valid_adding_with_validate_false</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M003139_source')" id="l_M003139_source">show source</a> ]</p>
  <div id="M003139_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/autosave_association_test.rb, line 315</span>
315:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_valid_adding_with_validate_false</span>
316:     <span class="ruby-identifier">no_of_clients</span> = <span class="ruby-constant">Client</span>.<span class="ruby-identifier">count</span>
317: 
318:     <span class="ruby-identifier">firm</span> = <span class="ruby-constant">Firm</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>)
319:     <span class="ruby-identifier">client</span> = <span class="ruby-constant">Client</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Apple&quot;</span>)
320: 
321:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">valid?</span>
322:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">client</span>.<span class="ruby-identifier">valid?</span>
323:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">client</span>.<span class="ruby-identifier">new_record?</span>
324: 
325:     <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">unvalidated_clients_of_firm</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">client</span>
326: 
327:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">save</span>
328:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">client</span>.<span class="ruby-identifier">new_record?</span>
329:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">no_of_clients</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>, <span class="ruby-constant">Client</span>.<span class="ruby-identifier">count</span>
330:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>