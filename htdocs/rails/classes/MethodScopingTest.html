  <div id="C00000037">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />MethodScopingTest<br/>
  In:
<a href="#" onclick="jsHref('files/activerecord/test/cases/method_scoping_test_rb.html');">activerecord/test/cases/method_scoping_test.rb</a>

Parent:&nbsp;
ActiveRecord::TestCase
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">




  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M000267&name=test_ensure_that_method_scoping_is_correctly_restored" >test_ensure_that_method_scoping_is_correctly_restored</a></li>
  <li><a href="index.html?a=M000265&name=test_immutable_scope" >test_immutable_scope</a></li>
  <li><a href="index.html?a=M000251&name=test_options_select_replaces_scope_select" >test_options_select_replaces_scope_select</a></li>
  <li><a href="index.html?a=M000252&name=test_scoped_count" >test_scoped_count</a></li>
  <li><a href="index.html?a=M000263&name=test_scoped_count_include" >test_scoped_count_include</a></li>
  <li><a href="index.html?a=M000264&name=test_scoped_create" >test_scoped_create</a></li>
  <li><a href="index.html?a=M000242&name=test_scoped_find" >test_scoped_find</a></li>
  <li><a href="index.html?a=M000249&name=test_scoped_find_all" >test_scoped_find_all</a></li>
  <li><a href="index.html?a=M000248&name=test_scoped_find_combines_and_sanitizes_conditions" >test_scoped_find_combines_and_sanitizes_conditions</a></li>
  <li><a href="index.html?a=M000246&name=test_scoped_find_combines_conditions" >test_scoped_find_combines_conditions</a></li>
  <li><a href="index.html?a=M000243&name=test_scoped_find_first" >test_scoped_find_first</a></li>
  <li><a href="index.html?a=M000253&name=test_scoped_find_include" >test_scoped_find_include</a></li>
  <li><a href="index.html?a=M000254&name=test_scoped_find_joins" >test_scoped_find_joins</a></li>
  <li><a href="index.html?a=M000244&name=test_scoped_find_last" >test_scoped_find_last</a></li>
  <li><a href="index.html?a=M000245&name=test_scoped_find_last_preserves_scope" >test_scoped_find_last_preserves_scope</a></li>
  <li><a href="index.html?a=M000261&name=test_scoped_find_merges_joins_and_eliminates_duplicate_string_joins" >test_scoped_find_merges_joins_and_eliminates_duplicate_string_joins</a></li>
  <li><a href="index.html?a=M000258&name=test_scoped_find_merges_new_and_old_style_joins" >test_scoped_find_merges_new_and_old_style_joins</a></li>
  <li><a href="index.html?a=M000257&name=test_scoped_find_merges_new_style_joins" >test_scoped_find_merges_new_style_joins</a></li>
  <li><a href="index.html?a=M000256&name=test_scoped_find_merges_old_style_joins" >test_scoped_find_merges_old_style_joins</a></li>
  <li><a href="index.html?a=M000260&name=test_scoped_find_merges_string_array_style_and_hash_style_joins" >test_scoped_find_merges_string_array_style_and_hash_style_joins</a></li>
  <li><a href="index.html?a=M000259&name=test_scoped_find_merges_string_array_style_and_string_style_joins" >test_scoped_find_merges_string_array_style_and_string_style_joins</a></li>
  <li><a href="index.html?a=M000247&name=test_scoped_find_sanitizes_conditions" >test_scoped_find_sanitizes_conditions</a></li>
  <li><a href="index.html?a=M000250&name=test_scoped_find_select" >test_scoped_find_select</a></li>
  <li><a href="index.html?a=M000262&name=test_scoped_find_strips_spaces_from_string_joins_and_eliminates_duplicate_string_joins" >test_scoped_find_strips_spaces_from_string_joins_and_eliminates_duplicate_string_joins</a></li>
  <li><a href="index.html?a=M000255&name=test_scoped_find_using_new_style_joins" >test_scoped_find_using_new_style_joins</a></li>
  <li><a href="index.html?a=M000266&name=test_scoped_with_duck_typing" >test_scoped_with_duck_typing</a></li>
  <li><a href="index.html?a=M000241&name=test_set_conditions" >test_set_conditions</a></li>
  </ul>






<div class="sectiontitle">Public Instance methods</div>
<div id="M000267" class="method">
  <div id="M000267_title" class="title">
    <b>test_ensure_that_method_scoping_is_correctly_restored</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000267_source')" id="l_M000267_source">show source</a> ]</p>
  <div id="M000267_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 240</span>
240:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_ensure_that_method_scoping_is_correctly_restored</span>
241:     <span class="ruby-identifier">scoped_methods</span> = <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">instance_eval</span>(<span class="ruby-value str">'current_scoped_methods'</span>)
242: 
243:     <span class="ruby-keyword kw">begin</span>
244:       <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;name = 'Jamis'&quot;</span> }) <span class="ruby-keyword kw">do</span>
245:         <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;an exception&quot;</span>
246:       <span class="ruby-keyword kw">end</span>
247:     <span class="ruby-keyword kw">rescue</span>
248:     <span class="ruby-keyword kw">end</span>
249:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">scoped_methods</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">instance_eval</span>(<span class="ruby-value str">'current_scoped_methods'</span>)
250:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000265" class="method">
  <div id="M000265_title" class="title">
    <b>test_immutable_scope</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000265_source')" id="l_M000265_source">show source</a> ]</p>
  <div id="M000265_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 217</span>
217:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_immutable_scope</span>
218:     <span class="ruby-identifier">options</span> = { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;name = 'David'&quot;</span> }
219:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>) <span class="ruby-keyword kw">do</span>
220:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w(David)</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-identifier">d</span>.<span class="ruby-identifier">name</span> }
221:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:conditions</span>] = <span class="ruby-value str">&quot;name != 'David'&quot;</span>
222:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w(David)</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-identifier">d</span>.<span class="ruby-identifier">name</span> }
223:     <span class="ruby-keyword kw">end</span>
224: 
225:     <span class="ruby-identifier">scope</span> = { <span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;name = 'David'&quot;</span> }}
226:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">scope</span>) <span class="ruby-keyword kw">do</span>
227:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w(David)</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-identifier">d</span>.<span class="ruby-identifier">name</span> }
228:       <span class="ruby-identifier">scope</span>[<span class="ruby-identifier">:find</span>][<span class="ruby-identifier">:conditions</span>] = <span class="ruby-value str">&quot;name != 'David'&quot;</span>
229:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w(David)</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-identifier">d</span>.<span class="ruby-identifier">name</span> }
230:     <span class="ruby-keyword kw">end</span>
231:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000251" class="method">
  <div id="M000251_title" class="title">
    <b>test_options_select_replaces_scope_select</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000251_source')" id="l_M000251_source">show source</a> ]</p>
  <div id="M000251_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 80</span>
80:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_options_select_replaces_scope_select</span>
81:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;id, name&quot;</span> }) <span class="ruby-keyword kw">do</span>
82:       <span class="ruby-identifier">developer</span> = <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'id, salary'</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;name = 'David'&quot;</span>)
83:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">80000</span>, <span class="ruby-identifier">developer</span>.<span class="ruby-identifier">salary</span>
84:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">developer</span>.<span class="ruby-identifier">has_attribute?</span>(<span class="ruby-identifier">:name</span>)
85:     <span class="ruby-keyword kw">end</span>
86:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000252" class="method">
  <div id="M000252_title" class="title">
    <b>test_scoped_count</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000252_source')" id="l_M000252_source">show source</a> ]</p>
  <div id="M000252_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 88</span>
88:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_scoped_count</span>
89:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;name = 'David'&quot;</span> }) <span class="ruby-keyword kw">do</span>
90:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">count</span>
91:     <span class="ruby-keyword kw">end</span>
92: 
93:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'salary = 100000'</span> }) <span class="ruby-keyword kw">do</span>
94:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">8</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">count</span>
95:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;name LIKE 'fixture_1%'&quot;</span>)
96:     <span class="ruby-keyword kw">end</span>
97:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000263" class="method">
  <div id="M000263_title" class="title">
    <b>test_scoped_count_include</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000263_source')" id="l_M000263_source">show source</a> ]</p>
  <div id="M000263_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 199</span>
199:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_scoped_count_include</span>
200:     <span class="ruby-comment cmt"># with the include, will retrieve only developers for the given project</span>
201:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:projects</span> }) <span class="ruby-keyword kw">do</span>
202:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'projects.id = 2'</span>)
203:     <span class="ruby-keyword kw">end</span>
204:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000264" class="method">
  <div id="M000264_title" class="title">
    <b>test_scoped_create</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000264_source')" id="l_M000264_source">show source</a> ]</p>
  <div id="M000264_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 206</span>
206:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_scoped_create</span>
207:     <span class="ruby-identifier">new_comment</span> = <span class="ruby-keyword kw">nil</span>
208: 
209:     <span class="ruby-constant">VerySpecialComment</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:create</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:post_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> }) <span class="ruby-keyword kw">do</span>
210:       <span class="ruby-identifier">assert_equal</span>({ <span class="ruby-identifier">:post_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> }, <span class="ruby-constant">VerySpecialComment</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">:current_scoped_methods</span>)[<span class="ruby-identifier">:create</span>])
211:       <span class="ruby-identifier">new_comment</span> = <span class="ruby-constant">VerySpecialComment</span>.<span class="ruby-identifier">create</span> <span class="ruby-identifier">:body</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Wonderful world&quot;</span>
212:     <span class="ruby-keyword kw">end</span>
213: 
214:     <span class="ruby-identifier">assert</span> <span class="ruby-constant">Post</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>).<span class="ruby-identifier">comments</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">new_comment</span>)
215:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000242" class="method">
  <div id="M000242_title" class="title">
    <b>test_scoped_find</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000242_source')" id="l_M000242_source">show source</a> ]</p>
  <div id="M000242_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 18</span>
18:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_scoped_find</span>
19:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;name = 'David'&quot;</span> }) <span class="ruby-keyword kw">do</span>
20:       <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">1</span>) }
21:     <span class="ruby-keyword kw">end</span>
22:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000249" class="method">
  <div id="M000249_title" class="title">
    <b>test_scoped_find_all</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000249_source')" id="l_M000249_source">show source</a> ]</p>
  <div id="M000249_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 66</span>
66:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_scoped_find_all</span>
67:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;name = 'David'&quot;</span> }) <span class="ruby-keyword kw">do</span>
68:       <span class="ruby-identifier">assert_equal</span> [<span class="ruby-identifier">developers</span>(<span class="ruby-identifier">:david</span>)], <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>)
69:     <span class="ruby-keyword kw">end</span>
70:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000248" class="method">
  <div id="M000248_title" class="title">
    <b>test_scoped_find_combines_and_sanitizes_conditions</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000248_source')" id="l_M000248_source">show source</a> ]</p>
  <div id="M000248_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 60</span>
60:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_scoped_find_combines_and_sanitizes_conditions</span>
61:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">'salary = ?'</span>, <span class="ruby-value">9000</span>] }) <span class="ruby-keyword kw">do</span>
62:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">developers</span>(<span class="ruby-identifier">:poor_jamis</span>), <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">'name = ?'</span>, <span class="ruby-value str">'Jamis'</span>])
63:     <span class="ruby-keyword kw">end</span>
64:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000246" class="method">
  <div id="M000246_title" class="title">
    <b>test_scoped_find_combines_conditions</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000246_source')" id="l_M000246_source">show source</a> ]</p>
  <div id="M000246_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 48</span>
48:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_scoped_find_combines_conditions</span>
49:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;salary = 9000&quot;</span> }) <span class="ruby-keyword kw">do</span>
50:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">developers</span>(<span class="ruby-identifier">:poor_jamis</span>), <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;name = 'Jamis'&quot;</span>)
51:     <span class="ruby-keyword kw">end</span>
52:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000243" class="method">
  <div id="M000243_title" class="title">
    <b>test_scoped_find_first</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000243_source')" id="l_M000243_source">show source</a> ]</p>
  <div id="M000243_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 24</span>
24:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_scoped_find_first</span>
25:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;salary = 100000&quot;</span> }) <span class="ruby-keyword kw">do</span>
26:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-value">10</span>), <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'name'</span>)
27:     <span class="ruby-keyword kw">end</span>
28:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000253" class="method">
  <div id="M000253_title" class="title">
    <b>test_scoped_find_include</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000253_source')" id="l_M000253_source">show source</a> ]</p>
  <div id="M000253_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 99</span>
 99:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_scoped_find_include</span>
100:     <span class="ruby-comment cmt"># with the include, will retrieve only developers for the given project</span>
101:     <span class="ruby-identifier">scoped_developers</span> = <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:projects</span> }) <span class="ruby-keyword kw">do</span>
102:       <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'projects.id = 2'</span>)
103:     <span class="ruby-keyword kw">end</span>
104:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">scoped_developers</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">developers</span>(<span class="ruby-identifier">:david</span>))
105:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">scoped_developers</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">developers</span>(<span class="ruby-identifier">:jamis</span>))
106:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">scoped_developers</span>.<span class="ruby-identifier">size</span>
107:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000254" class="method">
  <div id="M000254_title" class="title">
    <b>test_scoped_find_joins</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000254_source')" id="l_M000254_source">show source</a> ]</p>
  <div id="M000254_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 109</span>
109:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_scoped_find_joins</span>
110:     <span class="ruby-identifier">scoped_developers</span> = <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'JOIN developers_projects ON id = developer_id'</span> } ) <span class="ruby-keyword kw">do</span>
111:       <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'developers_projects.project_id = 2'</span>)
112:     <span class="ruby-keyword kw">end</span>
113:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">scoped_developers</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">developers</span>(<span class="ruby-identifier">:david</span>))
114:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">scoped_developers</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">developers</span>(<span class="ruby-identifier">:jamis</span>))
115:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">scoped_developers</span>.<span class="ruby-identifier">size</span>
116:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">developers</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">attributes</span>, <span class="ruby-identifier">scoped_developers</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">attributes</span>
117:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000244" class="method">
  <div id="M000244_title" class="title">
    <b>test_scoped_find_last</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000244_source')" id="l_M000244_source">show source</a> ]</p>
  <div id="M000244_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 30</span>
30:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_scoped_find_last</span>
31:     <span class="ruby-identifier">highest_salary</span> = <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;salary DESC&quot;</span>)
32: 
33:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;salary&quot;</span> }) <span class="ruby-keyword kw">do</span>
34:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">highest_salary</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">last</span>
35:     <span class="ruby-keyword kw">end</span>
36:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000245" class="method">
  <div id="M000245_title" class="title">
    <b>test_scoped_find_last_preserves_scope</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000245_source')" id="l_M000245_source">show source</a> ]</p>
  <div id="M000245_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 38</span>
38:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_scoped_find_last_preserves_scope</span>
39:     <span class="ruby-identifier">lowest_salary</span> = <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;salary ASC&quot;</span>)
40:     <span class="ruby-identifier">highest_salary</span> = <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;salary DESC&quot;</span>)
41: 
42:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;salary&quot;</span> }) <span class="ruby-keyword kw">do</span>
43:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">highest_salary</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">last</span>
44:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">lowest_salary</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">first</span>
45:     <span class="ruby-keyword kw">end</span>
46:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000261" class="method">
  <div id="M000261_title" class="title">
    <b>test_scoped_find_merges_joins_and_eliminates_duplicate_string_joins</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000261_source')" id="l_M000261_source">show source</a> ]</p>
  <div id="M000261_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 179</span>
179:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_scoped_find_merges_joins_and_eliminates_duplicate_string_joins</span>
180:     <span class="ruby-identifier">scoped_authors</span> = <span class="ruby-constant">Author</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'INNER JOIN posts ON posts.author_id = authors.id'</span>}) <span class="ruby-keyword kw">do</span>
181:       <span class="ruby-constant">Author</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'DISTINCT authors.*'</span>, <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;INNER JOIN posts ON posts.author_id = authors.id&quot;</span>, <span class="ruby-value str">&quot;INNER JOIN comments ON posts.id = comments.post_id&quot;</span>], <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'comments.id = 1'</span>)
182:     <span class="ruby-keyword kw">end</span>
183:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>))
184:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:mary</span>))
185:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">size</span>
186:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">attributes</span>, <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">attributes</span>
187:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000258" class="method">
  <div id="M000258_title" class="title">
    <b>test_scoped_find_merges_new_and_old_style_joins</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000258_source')" id="l_M000258_source">show source</a> ]</p>
  <div id="M000258_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 149</span>
149:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_scoped_find_merges_new_and_old_style_joins</span>
150:     <span class="ruby-identifier">scoped_authors</span> = <span class="ruby-constant">Author</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:posts</span> }) <span class="ruby-keyword kw">do</span>
151:       <span class="ruby-constant">Author</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'DISTINCT authors.*'</span>, <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'JOIN comments ON posts.id = comments.post_id'</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'comments.id = 1'</span>)
152:     <span class="ruby-keyword kw">end</span>
153:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>))
154:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:mary</span>))
155:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">size</span>
156:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">attributes</span>, <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">attributes</span>
157:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000257" class="method">
  <div id="M000257_title" class="title">
    <b>test_scoped_find_merges_new_style_joins</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000257_source')" id="l_M000257_source">show source</a> ]</p>
  <div id="M000257_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 139</span>
139:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_scoped_find_merges_new_style_joins</span>
140:     <span class="ruby-identifier">scoped_authors</span> = <span class="ruby-constant">Author</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:posts</span> }) <span class="ruby-keyword kw">do</span>
141:       <span class="ruby-constant">Author</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'DISTINCT authors.*'</span>, <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:comments</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'comments.id = 1'</span>)
142:     <span class="ruby-keyword kw">end</span>
143:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>))
144:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:mary</span>))
145:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">size</span>
146:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">attributes</span>, <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">attributes</span>
147:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000256" class="method">
  <div id="M000256_title" class="title">
    <b>test_scoped_find_merges_old_style_joins</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000256_source')" id="l_M000256_source">show source</a> ]</p>
  <div id="M000256_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 129</span>
129:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_scoped_find_merges_old_style_joins</span>
130:     <span class="ruby-identifier">scoped_authors</span> = <span class="ruby-constant">Author</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'INNER JOIN posts ON authors.id = posts.author_id '</span> }) <span class="ruby-keyword kw">do</span>
131:       <span class="ruby-constant">Author</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'DISTINCT authors.*'</span>, <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'INNER JOIN comments ON posts.id = comments.post_id'</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'comments.id = 1'</span>)
132:     <span class="ruby-keyword kw">end</span>
133:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>))
134:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:mary</span>))
135:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">size</span>
136:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">attributes</span>, <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">attributes</span>
137:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000260" class="method">
  <div id="M000260_title" class="title">
    <b>test_scoped_find_merges_string_array_style_and_hash_style_joins</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000260_source')" id="l_M000260_source">show source</a> ]</p>
  <div id="M000260_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 169</span>
169:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_scoped_find_merges_string_array_style_and_hash_style_joins</span>
170:     <span class="ruby-identifier">scoped_authors</span> = <span class="ruby-constant">Author</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:posts</span>}) <span class="ruby-keyword kw">do</span>
171:       <span class="ruby-constant">Author</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'DISTINCT authors.*'</span>, <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">'INNER JOIN comments ON posts.id = comments.post_id'</span>], <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'comments.id = 1'</span>)
172:     <span class="ruby-keyword kw">end</span>
173:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>))
174:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:mary</span>))
175:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">size</span>
176:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">attributes</span>, <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">attributes</span>
177:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000259" class="method">
  <div id="M000259_title" class="title">
    <b>test_scoped_find_merges_string_array_style_and_string_style_joins</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000259_source')" id="l_M000259_source">show source</a> ]</p>
  <div id="M000259_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 159</span>
159:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_scoped_find_merges_string_array_style_and_string_style_joins</span>
160:     <span class="ruby-identifier">scoped_authors</span> = <span class="ruby-constant">Author</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;INNER JOIN posts ON posts.author_id = authors.id&quot;</span>]}) <span class="ruby-keyword kw">do</span>
161:       <span class="ruby-constant">Author</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'DISTINCT authors.*'</span>, <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'INNER JOIN comments ON posts.id = comments.post_id'</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'comments.id = 1'</span>)
162:     <span class="ruby-keyword kw">end</span>
163:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>))
164:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:mary</span>))
165:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">size</span>
166:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">attributes</span>, <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">attributes</span>
167:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000247" class="method">
  <div id="M000247_title" class="title">
    <b>test_scoped_find_sanitizes_conditions</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000247_source')" id="l_M000247_source">show source</a> ]</p>
  <div id="M000247_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 54</span>
54:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_scoped_find_sanitizes_conditions</span>
55:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">'salary = ?'</span>, <span class="ruby-value">9000</span>] }) <span class="ruby-keyword kw">do</span>
56:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">developers</span>(<span class="ruby-identifier">:poor_jamis</span>), <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>)
57:     <span class="ruby-keyword kw">end</span>
58:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000250" class="method">
  <div id="M000250_title" class="title">
    <b>test_scoped_find_select</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000250_source')" id="l_M000250_source">show source</a> ]</p>
  <div id="M000250_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 72</span>
72:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_scoped_find_select</span>
73:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;id, name&quot;</span> }) <span class="ruby-keyword kw">do</span>
74:       <span class="ruby-identifier">developer</span> = <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;name = 'David'&quot;</span>)
75:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;David&quot;</span>, <span class="ruby-identifier">developer</span>.<span class="ruby-identifier">name</span>
76:       <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">developer</span>.<span class="ruby-identifier">has_attribute?</span>(<span class="ruby-identifier">:salary</span>)
77:     <span class="ruby-keyword kw">end</span>
78:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000262" class="method">
  <div id="M000262_title" class="title">
    <b>test_scoped_find_strips_spaces_from_string_joins_and_eliminates_duplicate_string_joins</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000262_source')" id="l_M000262_source">show source</a> ]</p>
  <div id="M000262_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 189</span>
189:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_scoped_find_strips_spaces_from_string_joins_and_eliminates_duplicate_string_joins</span>
190:     <span class="ruby-identifier">scoped_authors</span> = <span class="ruby-constant">Author</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">' INNER JOIN posts ON posts.author_id = authors.id '</span>}) <span class="ruby-keyword kw">do</span>
191:       <span class="ruby-constant">Author</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'DISTINCT authors.*'</span>, <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">'INNER JOIN posts ON posts.author_id = authors.id'</span>], <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'posts.id = 1'</span>)
192:     <span class="ruby-keyword kw">end</span>
193:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>))
194:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:mary</span>))
195:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">size</span>
196:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">authors</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">attributes</span>, <span class="ruby-identifier">scoped_authors</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">attributes</span>
197:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000255" class="method">
  <div id="M000255_title" class="title">
    <b>test_scoped_find_using_new_style_joins</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000255_source')" id="l_M000255_source">show source</a> ]</p>
  <div id="M000255_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 119</span>
119:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_scoped_find_using_new_style_joins</span>
120:     <span class="ruby-identifier">scoped_developers</span> = <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:projects</span> }) <span class="ruby-keyword kw">do</span>
121:       <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'projects.id = 2'</span>)
122:     <span class="ruby-keyword kw">end</span>
123:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">scoped_developers</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">developers</span>(<span class="ruby-identifier">:david</span>))
124:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">scoped_developers</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">developers</span>(<span class="ruby-identifier">:jamis</span>))
125:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">scoped_developers</span>.<span class="ruby-identifier">size</span>
126:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">developers</span>(<span class="ruby-identifier">:david</span>).<span class="ruby-identifier">attributes</span>, <span class="ruby-identifier">scoped_developers</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">attributes</span>
127:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000266" class="method">
  <div id="M000266_title" class="title">
    <b>test_scoped_with_duck_typing</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000266_source')" id="l_M000266_source">show source</a> ]</p>
  <div id="M000266_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 233</span>
233:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_scoped_with_duck_typing</span>
234:     <span class="ruby-identifier">scoping</span> = <span class="ruby-constant">Struct</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:method_scoping</span>).<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;name = ?&quot;</span>, <span class="ruby-value str">'David'</span>] })
235:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">scoping</span>) <span class="ruby-keyword kw">do</span>
236:        <span class="ruby-identifier">assert_equal</span> <span class="ruby-node">%w(David)</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-identifier">d</span>.<span class="ruby-identifier">name</span> }
237:     <span class="ruby-keyword kw">end</span>
238:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000241" class="method">
  <div id="M000241_title" class="title">
    <b>test_set_conditions</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000241_source')" id="l_M000241_source">show source</a> ]</p>
  <div id="M000241_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/method_scoping_test.rb, line 12</span>
12:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_set_conditions</span>
13:     <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">with_scope</span>(<span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'just a test...'</span> }) <span class="ruby-keyword kw">do</span>
14:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'just a test...'</span>, <span class="ruby-constant">Developer</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">:current_scoped_methods</span>)[<span class="ruby-identifier">:find</span>][<span class="ruby-identifier">:conditions</span>]
15:     <span class="ruby-keyword kw">end</span>
16:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>