  <div id="C00001980">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />Generator<br/>
  In:
<a href="#" onclick="jsHref('files/railties/guides/rails_guides/generator_rb.html');">railties/guides/rails_guides/generator.rb</a>

Parent:&nbsp;
        <a href="#" onclick="jsHref('classes/Object.html');">
Object
         </a>
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">




  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M010505&name=generate" >generate</a></li>
  <li><a href="index.html?a=M010506&name=generate_guide" >generate_guide</a></li>
  <li><a href="index.html?a=M010504&name=new" >new</a></li>
  <li><a href="index.html?a=M010507&name=set_header_section" >set_header_section</a></li>
  <li><a href="index.html?a=M010508&name=set_index" >set_index</a></li>
  <li><a href="index.html?a=M010509&name=textile" >textile</a></li>
  <li><a href="index.html?a=M010510&name=with_workaround_for_notextile" >with_workaround_for_notextile</a></li>
  </ul>





  <div class="sectiontitle">Attributes</div>
  <table border='0' cellpadding='5'>
  <tr valign='top'>
    <td class='attr-rw'>
[R]
    </td>
    <td class='attr-name'>guides_dir</td>
    <td class='attr-desc'></td>
  </tr>
  <tr valign='top'>
    <td class='attr-rw'>
[R]
    </td>
    <td class='attr-name'>output</td>
    <td class='attr-desc'></td>
  </tr>
  <tr valign='top'>
    <td class='attr-rw'>
[R]
    </td>
    <td class='attr-name'>view</td>
    <td class='attr-desc'></td>
  </tr>
  <tr valign='top'>
    <td class='attr-rw'>
[R]
    </td>
    <td class='attr-name'>view_path</td>
    <td class='attr-desc'></td>
  </tr>
  </table>

<div class="sectiontitle">Public Class methods</div>
<div id="M010504" class="method">
  <div id="M010504_title" class="title">
    <b>new</b>(output = nil)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M010504_source')" id="l_M010504_source">show source</a> ]</p>
  <div id="M010504_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File railties/guides/rails_guides/generator.rb, line 7</span>
 7:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">output</span> = <span class="ruby-keyword kw">nil</span>)
 8:       <span class="ruby-ivar">@guides_dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword kw">__FILE__</span>), <span class="ruby-value str">'..'</span>)
 9: 
10:       <span class="ruby-ivar">@output</span> = <span class="ruby-identifier">output</span> <span class="ruby-operator">||</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@guides_dir</span>, <span class="ruby-value str">&quot;output&quot;</span>)
11: 
12:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">&quot;ONLY&quot;</span>]
13:         <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_r</span>(<span class="ruby-ivar">@output</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-ivar">@output</span>)
14:         <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir</span>(<span class="ruby-ivar">@output</span>)
15:       <span class="ruby-keyword kw">end</span>
16: 
17:       <span class="ruby-ivar">@view_path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@guides_dir</span>, <span class="ruby-value str">&quot;source&quot;</span>)
18:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="sectiontitle">Public Instance methods</div>
<div id="M010505" class="method">
  <div id="M010505_title" class="title">
    <b>generate</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M010505_source')" id="l_M010505_source">show source</a> ]</p>
  <div id="M010505_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File railties/guides/rails_guides/generator.rb, line 20</span>
20:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">generate</span>
21:       <span class="ruby-identifier">guides</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">entries</span>(<span class="ruby-identifier">view_path</span>).<span class="ruby-identifier">find_all</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">g</span><span class="ruby-operator">|</span> <span class="ruby-identifier">g</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/textile$/</span> }
22: 
23:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">&quot;ONLY&quot;</span>]
24:         <span class="ruby-identifier">only</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">&quot;ONLY&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;,&quot;</span>).<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">strip</span> }.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">o</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;#{o}.textile&quot;</span> }
25:         <span class="ruby-identifier">guides</span> = <span class="ruby-identifier">guides</span>.<span class="ruby-identifier">find_all</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">g</span><span class="ruby-operator">|</span> <span class="ruby-identifier">only</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">g</span>) }
26:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;GENERATING ONLY #{guides.inspect}&quot;</span>
27:       <span class="ruby-keyword kw">end</span>
28: 
29:       <span class="ruby-identifier">guides</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">guide</span><span class="ruby-operator">|</span>
30:         <span class="ruby-identifier">generate_guide</span>(<span class="ruby-identifier">guide</span>)
31:       <span class="ruby-keyword kw">end</span>
32: 
33:       <span class="ruby-comment cmt"># Copy images and css files to html directory</span>
34:       <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">cp_r</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">guides_dir</span>, <span class="ruby-value str">'images'</span>), <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">output</span>, <span class="ruby-value str">'images'</span>)
35:       <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">cp_r</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">guides_dir</span>, <span class="ruby-value str">'files'</span>), <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">output</span>, <span class="ruby-value str">'files'</span>)
36:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M010506" class="method">
  <div id="M010506_title" class="title">
    <b>generate_guide</b>(guide)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M010506_source')" id="l_M010506_source">show source</a> ]</p>
  <div id="M010506_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File railties/guides/rails_guides/generator.rb, line 38</span>
38:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">generate_guide</span>(<span class="ruby-identifier">guide</span>)
39:       <span class="ruby-identifier">guide</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/(.*?)(\.erb)?\.textile/</span>
40:       <span class="ruby-identifier">name</span> = <span class="ruby-identifier">$1</span>
41: 
42:       <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Generating #{name}&quot;</span>
43: 
44:       <span class="ruby-identifier">file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">output</span>, <span class="ruby-node">&quot;#{name}.html&quot;</span>)
45:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">file</span>, <span class="ruby-value str">'w'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
46:         <span class="ruby-ivar">@view</span> = <span class="ruby-constant">ActionView</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">view_path</span>)
47:         <span class="ruby-ivar">@view</span>.<span class="ruby-identifier">extend</span>(<span class="ruby-constant">Helpers</span>)
48: 
49:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">guide</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\.erb\.textile/</span>
50:           <span class="ruby-comment cmt"># Generate the erb pages with textile formatting - e.g. index/authors</span>
51:           <span class="ruby-identifier">result</span> = <span class="ruby-identifier">view</span>.<span class="ruby-identifier">render</span>(<span class="ruby-identifier">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'layout'</span>, <span class="ruby-identifier">:file</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">name</span>)
52:           <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">textile</span>(<span class="ruby-identifier">result</span>)
53:         <span class="ruby-keyword kw">else</span>
54:           <span class="ruby-identifier">body</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">view_path</span>, <span class="ruby-identifier">guide</span>))
55:           <span class="ruby-identifier">body</span> = <span class="ruby-identifier">set_header_section</span>(<span class="ruby-identifier">body</span>, <span class="ruby-ivar">@view</span>)
56:           <span class="ruby-identifier">body</span> = <span class="ruby-identifier">set_index</span>(<span class="ruby-identifier">body</span>, <span class="ruby-ivar">@view</span>)
57: 
58:           <span class="ruby-identifier">result</span> = <span class="ruby-identifier">view</span>.<span class="ruby-identifier">render</span>(<span class="ruby-identifier">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'layout'</span>, <span class="ruby-identifier">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">textile</span>(<span class="ruby-identifier">body</span>))
59:           <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">result</span>
60:         <span class="ruby-keyword kw">end</span>
61:       <span class="ruby-keyword kw">end</span>
62:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M010507" class="method">
  <div id="M010507_title" class="title">
    <b>set_header_section</b>(body, view)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M010507_source')" id="l_M010507_source">show source</a> ]</p>
  <div id="M010507_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File railties/guides/rails_guides/generator.rb, line 64</span>
64:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_header_section</span>(<span class="ruby-identifier">body</span>, <span class="ruby-identifier">view</span>)
65:       <span class="ruby-identifier">new_body</span> = <span class="ruby-identifier">body</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/(.*?)endprologue\./</span><span class="ruby-identifier">m</span>, <span class="ruby-value str">''</span>).<span class="ruby-identifier">strip</span>
66:       <span class="ruby-identifier">header</span> = <span class="ruby-identifier">$1</span>
67: 
68:       <span class="ruby-identifier">header</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/h2\.(.*)/</span>
69:       <span class="ruby-identifier">page_title</span> = <span class="ruby-identifier">$1</span>.<span class="ruby-identifier">strip</span>
70: 
71:       <span class="ruby-identifier">header</span> = <span class="ruby-identifier">textile</span>(<span class="ruby-identifier">header</span>)
72: 
73:       <span class="ruby-identifier">view</span>.<span class="ruby-identifier">content_for</span>(<span class="ruby-identifier">:page_title</span>) { <span class="ruby-identifier">page_title</span> }
74:       <span class="ruby-identifier">view</span>.<span class="ruby-identifier">content_for</span>(<span class="ruby-identifier">:header_section</span>) { <span class="ruby-identifier">header</span> }
75:       <span class="ruby-identifier">new_body</span>
76:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M010508" class="method">
  <div id="M010508_title" class="title">
    <b>set_index</b>(body, view)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M010508_source')" id="l_M010508_source">show source</a> ]</p>
  <div id="M010508_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File railties/guides/rails_guides/generator.rb, line 78</span>
 78:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_index</span>(<span class="ruby-identifier">body</span>, <span class="ruby-identifier">view</span>)
 79:       <span class="ruby-identifier">index</span> = <span class="ruby-value str">&quot;&lt;div id=\&quot;subCol\&quot;&gt;\n&lt;h3 class=\&quot;chapter\&quot;&gt;&lt;img src=\&quot;images/chapters_icon.gif\&quot; alt=\&quot;\&quot; /&gt;Chapters&lt;/h3&gt;\n&lt;ol class=\&quot;chapters\&quot;&gt;\n&quot;</span>
 80: 
 81:       <span class="ruby-identifier">i</span> = <span class="ruby-constant">Indexer</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">body</span>)
 82:       <span class="ruby-identifier">i</span>.<span class="ruby-identifier">index</span>
 83: 
 84:       <span class="ruby-comment cmt"># Set index for 2 levels</span>
 85:       <span class="ruby-identifier">i</span>.<span class="ruby-identifier">level_hash</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
 86:         <span class="ruby-identifier">link</span> = <span class="ruby-identifier">view</span>.<span class="ruby-identifier">content_tag</span>(<span class="ruby-identifier">:a</span>, <span class="ruby-identifier">:href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">key</span>[<span class="ruby-identifier">:id</span>]) { <span class="ruby-identifier">textile</span>(<span class="ruby-identifier">key</span>[<span class="ruby-identifier">:title</span>]) }
 87: 
 88:         <span class="ruby-identifier">children</span> = <span class="ruby-identifier">value</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span>
 89:           <span class="ruby-identifier">l</span> = <span class="ruby-identifier">view</span>.<span class="ruby-identifier">content_tag</span>(<span class="ruby-identifier">:a</span>, <span class="ruby-identifier">:href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">k</span>[<span class="ruby-identifier">:id</span>]) { <span class="ruby-identifier">textile</span>(<span class="ruby-identifier">k</span>[<span class="ruby-identifier">:title</span>]) }
 90:           <span class="ruby-identifier">view</span>.<span class="ruby-identifier">content_tag</span>(<span class="ruby-identifier">:li</span>, <span class="ruby-identifier">l</span>)
 91:         <span class="ruby-keyword kw">end</span>
 92: 
 93:         <span class="ruby-identifier">children_ul</span> = <span class="ruby-identifier">view</span>.<span class="ruby-identifier">content_tag</span>(<span class="ruby-identifier">:ul</span>, <span class="ruby-identifier">children</span>)
 94: 
 95:         <span class="ruby-identifier">index</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">view</span>.<span class="ruby-identifier">content_tag</span>(<span class="ruby-identifier">:li</span>, <span class="ruby-identifier">link</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">children_ul</span>)
 96:       <span class="ruby-keyword kw">end</span>
 97: 
 98:       <span class="ruby-identifier">index</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'&lt;/ol&gt;'</span>
 99:       <span class="ruby-identifier">index</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'&lt;/div&gt;'</span>
100: 
101:       <span class="ruby-identifier">view</span>.<span class="ruby-identifier">content_for</span>(<span class="ruby-identifier">:index_section</span>) { <span class="ruby-identifier">index</span> }
102: 
103:       <span class="ruby-identifier">i</span>.<span class="ruby-identifier">result</span>
104:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M010509" class="method">
  <div id="M010509_title" class="title">
    <b>textile</b>(body)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M010509_source')" id="l_M010509_source">show source</a> ]</p>
  <div id="M010509_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File railties/guides/rails_guides/generator.rb, line 111</span>
111:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">textile</span>(<span class="ruby-identifier">body</span>)
112:       <span class="ruby-comment cmt"># If the issue with notextile is fixed just remove the wrapper.</span>
113:       <span class="ruby-identifier">with_workaround_for_notextile</span>(<span class="ruby-identifier">body</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">body</span><span class="ruby-operator">|</span>
114:         <span class="ruby-identifier">t</span> = <span class="ruby-constant">RedCloth</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">body</span>)
115:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">hard_breaks</span> = <span class="ruby-keyword kw">false</span>
116:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">to_html</span>(<span class="ruby-identifier">:notestuff</span>, <span class="ruby-identifier">:plusplus</span>, <span class="ruby-identifier">:code</span>, <span class="ruby-identifier">:tip</span>)
117:       <span class="ruby-keyword kw">end</span>
118:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M010510" class="method">
  <div id="M010510_title" class="title">
    <b>with_workaround_for_notextile</b>(body) {|body| ...}
  </div>
  <div class="description">
  <p>
For some reason the notextile tag does not always turn off textile. See LH
ticket of the security guide (7). As a temporary workaround we deal with
code blocks by hand.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M010510_source')" id="l_M010510_source">show source</a> ]</p>
  <div id="M010510_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File railties/guides/rails_guides/generator.rb, line 123</span>
123:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">with_workaround_for_notextile</span>(<span class="ruby-identifier">body</span>)
124:       <span class="ruby-identifier">code_blocks</span> = []
125:       <span class="ruby-identifier">body</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">%r{&lt;(yaml|shell|ruby|erb|html|sql|plain)&gt;(.*?)&lt;/\1&gt;}</span><span class="ruby-identifier">m</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span>
126:         <span class="ruby-identifier">es</span> = <span class="ruby-constant">ERB</span><span class="ruby-operator">::</span><span class="ruby-constant">Util</span>.<span class="ruby-identifier">h</span>(<span class="ruby-identifier">$2</span>)
127:         <span class="ruby-identifier">css_class</span> = [<span class="ruby-value str">'erb'</span>, <span class="ruby-value str">'shell'</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">$1</span>) <span class="ruby-operator">?</span> <span class="ruby-value str">'html'</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">$1</span>
128:         <span class="ruby-identifier">code_blocks</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">%{&lt;div class=&quot;code_container&quot;&gt;&lt;code class=&quot;#{css_class}&quot;&gt;#{es}&lt;/code&gt;&lt;/div&gt;}</span>
129:         <span class="ruby-node">&quot;\ndirty_workaround_for_notextile_#{code_blocks.size - 1}\n&quot;</span>
130:       <span class="ruby-keyword kw">end</span>
131:       
132:       <span class="ruby-identifier">body</span> = <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">body</span>
133:       
134:       <span class="ruby-identifier">body</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">%r{&lt;p&gt;dirty_workaround_for_notextile_(\d+)&lt;/p&gt;}</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_</span><span class="ruby-operator">|</span>
135:         <span class="ruby-identifier">code_blocks</span>[<span class="ruby-identifier">$1</span>.<span class="ruby-identifier">to_i</span>]
136:       <span class="ruby-keyword kw">end</span>
137:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>