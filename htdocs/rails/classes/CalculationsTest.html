  <div id="C00000916">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />CalculationsTest<br/>
  In:
<a href="#" onclick="jsHref('files/activerecord/test/cases/calculations_test_rb.html');">activerecord/test/cases/calculations_test.rb</a>

Parent:&nbsp;
ActiveRecord::TestCase
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">




  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M007163&name=test_average_with_from_option" >test_average_with_from_option</a></li>
  <li><a href="index.html?a=M007156&name=test_count_with_column_and_options_parameter" >test_count_with_column_and_options_parameter</a></li>
  <li><a href="index.html?a=M007155&name=test_count_with_column_parameter" >test_count_with_column_parameter</a></li>
  <li><a href="index.html?a=M007161&name=test_count_with_from_option" >test_count_with_from_option</a></li>
  <li><a href="index.html?a=M007157&name=test_count_with_no_parameters_isnt_deprecated" >test_count_with_no_parameters_isnt_deprecated</a></li>
  <li><a href="index.html?a=M007159&name=test_count_with_scoped_has_many_through_association" >test_count_with_scoped_has_many_through_association</a></li>
  <li><a href="index.html?a=M007158&name=test_count_with_too_many_parameters_raises" >test_count_with_too_many_parameters_raises</a></li>
  <li><a href="index.html?a=M007166&name=test_from_option_with_specified_index" >test_from_option_with_specified_index</a></li>
  <li><a href="index.html?a=M007167&name=test_from_option_with_table_different_than_class" >test_from_option_with_table_different_than_class</a></li>
  <li><a href="index.html?a=M007165&name=test_maximum_with_from_option" >test_maximum_with_from_option</a></li>
  <li><a href="index.html?a=M007164&name=test_minimum_with_from_option" >test_minimum_with_from_option</a></li>
  <li><a href="index.html?a=M007116&name=test_should_average_field" >test_should_average_field</a></li>
  <li><a href="index.html?a=M007142&name=test_should_calculate_grouped_association_with_foreign_key_option" >test_should_calculate_grouped_association_with_foreign_key_option</a></li>
  <li><a href="index.html?a=M007140&name=test_should_calculate_grouped_association_with_invalid_field" >test_should_calculate_grouped_association_with_invalid_field</a></li>
  <li><a href="index.html?a=M007144&name=test_should_calculate_grouped_by_function" >test_should_calculate_grouped_by_function</a></li>
  <li><a href="index.html?a=M007145&name=test_should_calculate_grouped_by_function_with_table_alias" >test_should_calculate_grouped_by_function_with_table_alias</a></li>
  <li><a href="index.html?a=M007139&name=test_should_calculate_grouped_with_invalid_field" >test_should_calculate_grouped_with_invalid_field</a></li>
  <li><a href="index.html?a=M007138&name=test_should_calculate_with_invalid_field" >test_should_calculate_with_invalid_field</a></li>
  <li><a href="index.html?a=M007154&name=test_should_count_manual_select_with_include" >test_should_count_manual_select_with_include</a></li>
  <li><a href="index.html?a=M007153&name=test_should_count_selected_field_with_include" >test_should_count_selected_field_with_include</a></li>
  <li><a href="index.html?a=M007119&name=test_should_get_maximum_of_field" >test_should_get_maximum_of_field</a></li>
  <li><a href="index.html?a=M007120&name=test_should_get_maximum_of_field_with_include" >test_should_get_maximum_of_field_with_include</a></li>
  <li><a href="index.html?a=M007121&name=test_should_get_maximum_of_field_with_scoped_include" >test_should_get_maximum_of_field_with_scoped_include</a></li>
  <li><a href="index.html?a=M007122&name=test_should_get_minimum_of_field" >test_should_get_minimum_of_field</a></li>
  <li><a href="index.html?a=M007141&name=test_should_group_by_association_with_non_numeric_foreign_key" >test_should_group_by_association_with_non_numeric_foreign_key</a></li>
  <li><a href="index.html?a=M007123&name=test_should_group_by_field" >test_should_group_by_field</a></li>
  <li><a href="index.html?a=M007137&name=test_should_group_by_fields_with_table_alias" >test_should_group_by_fields_with_table_alias</a></li>
  <li><a href="index.html?a=M007150&name=test_should_group_by_scoped_field" >test_should_group_by_scoped_field</a></li>
  <li><a href="index.html?a=M007131&name=test_should_group_by_summed_association" >test_should_group_by_summed_association</a></li>
  <li><a href="index.html?a=M007124&name=test_should_group_by_summed_field" >test_should_group_by_summed_field</a></li>
  <li><a href="index.html?a=M007129&name=test_should_group_by_summed_field_having_condition" >test_should_group_by_summed_field_having_condition</a></li>
  <li><a href="index.html?a=M007130&name=test_should_group_by_summed_field_having_sanitized_condition" >test_should_group_by_summed_field_having_sanitized_condition</a></li>
  <li><a href="index.html?a=M007135&name=test_should_group_by_summed_field_with_conditions" >test_should_group_by_summed_field_with_conditions</a></li>
  <li><a href="index.html?a=M007136&name=test_should_group_by_summed_field_with_conditions_and_having" >test_should_group_by_summed_field_with_conditions_and_having</a></li>
  <li><a href="index.html?a=M007151&name=test_should_group_by_summed_field_with_conditions_and_having" >test_should_group_by_summed_field_with_conditions_and_having</a></li>
  <li><a href="index.html?a=M007127&name=test_should_limit_calculation" >test_should_limit_calculation</a></li>
  <li><a href="index.html?a=M007128&name=test_should_limit_calculation_with_offset" >test_should_limit_calculation_with_offset</a></li>
  <li><a href="index.html?a=M007143&name=test_should_not_modify_options_when_using_includes" >test_should_not_modify_options_when_using_includes</a></li>
  <li><a href="index.html?a=M007146&name=test_should_not_overshadow_enumerable_sum" >test_should_not_overshadow_enumerable_sum</a></li>
  <li><a href="index.html?a=M007126&name=test_should_order_by_calculation" >test_should_order_by_calculation</a></li>
  <li><a href="index.html?a=M007125&name=test_should_order_by_grouped_field" >test_should_order_by_grouped_field</a></li>
  <li><a href="index.html?a=M007152&name=test_should_reject_invalid_options" >test_should_reject_invalid_options</a></li>
  <li><a href="index.html?a=M007117&name=test_should_return_nil_as_average" >test_should_return_nil_as_average</a></li>
  <li><a href="index.html?a=M007133&name=test_should_return_zero_if_sum_conditions_return_nothing" >test_should_return_zero_if_sum_conditions_return_nothing</a></li>
  <li><a href="index.html?a=M007160&name=test_should_sum_expression" >test_should_sum_expression</a></li>
  <li><a href="index.html?a=M007115&name=test_should_sum_field" >test_should_sum_field</a></li>
  <li><a href="index.html?a=M007132&name=test_should_sum_field_with_conditions" >test_should_sum_field_with_conditions</a></li>
  <li><a href="index.html?a=M007147&name=test_should_sum_scoped_field" >test_should_sum_scoped_field</a></li>
  <li><a href="index.html?a=M007149&name=test_should_sum_scoped_field_with_conditions" >test_should_sum_scoped_field_with_conditions</a></li>
  <li><a href="index.html?a=M007148&name=test_should_sum_scoped_field_with_from" >test_should_sum_scoped_field_with_from</a></li>
  <li><a href="index.html?a=M007134&name=test_sum_should_return_valid_values_for_decimals" >test_sum_should_return_valid_values_for_decimals</a></li>
  <li><a href="index.html?a=M007162&name=test_sum_with_from_option" >test_sum_with_from_option</a></li>
  <li><a href="index.html?a=M007118&name=test_type_cast_calculated_value_should_convert_db_averages_of_fixnum_class_to_decimal" >test_type_cast_calculated_value_should_convert_db_averages_of_fixnum_class_to_decimal</a></li>
  </ul>






<div class="sectiontitle">Public Instance methods</div>
<div id="M007163" class="method">
  <div id="M007163_title" class="title">
    <b>test_average_with_from_option</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007163_source')" id="l_M007163_source">show source</a> ]</p>
  <div id="M007163_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 317</span>
317:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_average_with_from_option</span>
318:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Account</span>.<span class="ruby-identifier">average</span>(<span class="ruby-identifier">:credit_limit</span>), <span class="ruby-constant">Account</span>.<span class="ruby-identifier">average</span>(<span class="ruby-identifier">:credit_limit</span>, <span class="ruby-identifier">:from</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'accounts'</span>)
319:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Account</span>.<span class="ruby-identifier">average</span>(<span class="ruby-identifier">:credit_limit</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;credit_limit &gt; 50&quot;</span>),
320:         <span class="ruby-constant">Account</span>.<span class="ruby-identifier">average</span>(<span class="ruby-identifier">:credit_limit</span>, <span class="ruby-identifier">:from</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'accounts'</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;credit_limit &gt; 50&quot;</span>)
321:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007156" class="method">
  <div id="M007156_title" class="title">
    <b>test_count_with_column_and_options_parameter</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007156_source')" id="l_M007156_source">show source</a> ]</p>
  <div id="M007156_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 283</span>
283:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_count_with_column_and_options_parameter</span>
284:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-constant">Account</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:firm_id</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;credit_limit = 50&quot;</span>)
285:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007155" class="method">
  <div id="M007155_title" class="title">
    <b>test_count_with_column_parameter</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007155_source')" id="l_M007155_source">show source</a> ]</p>
  <div id="M007155_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 279</span>
279:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_count_with_column_parameter</span>
280:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">5</span>, <span class="ruby-constant">Account</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:firm_id</span>)
281:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007161" class="method">
  <div id="M007161_title" class="title">
    <b>test_count_with_from_option</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007161_source')" id="l_M007161_source">show source</a> ]</p>
  <div id="M007161_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 303</span>
303:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_count_with_from_option</span>
304:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Company</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:all</span>), <span class="ruby-constant">Company</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:from</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'companies'</span>)
305:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Account</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;credit_limit = 50&quot;</span>),
306:         <span class="ruby-constant">Account</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:from</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'accounts'</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;credit_limit = 50&quot;</span>)
307:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Company</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:type</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Firm&quot;</span>}),
308:         <span class="ruby-constant">Company</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:type</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> {<span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Firm&quot;</span>}, <span class="ruby-identifier">:from</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'companies'</span>)
309:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007157" class="method">
  <div id="M007157_title" class="title">
    <b>test_count_with_no_parameters_isnt_deprecated</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007157_source')" id="l_M007157_source">show source</a> ]</p>
  <div id="M007157_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 287</span>
287:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_count_with_no_parameters_isnt_deprecated</span>
288:     <span class="ruby-identifier">assert_not_deprecated</span> { <span class="ruby-constant">Account</span>.<span class="ruby-identifier">count</span> }
289:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007159" class="method">
  <div id="M007159_title" class="title">
    <b>test_count_with_scoped_has_many_through_association</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007159_source')" id="l_M007159_source">show source</a> ]</p>
  <div id="M007159_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 295</span>
295:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_count_with_scoped_has_many_through_association</span>
296:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">owners</span>(<span class="ruby-identifier">:blackbeard</span>).<span class="ruby-identifier">toys</span>.<span class="ruby-identifier">with_name</span>(<span class="ruby-value str">'Bone'</span>).<span class="ruby-identifier">count</span>
297:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007158" class="method">
  <div id="M007158_title" class="title">
    <b>test_count_with_too_many_parameters_raises</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007158_source')" id="l_M007158_source">show source</a> ]</p>
  <div id="M007158_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 291</span>
291:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_count_with_too_many_parameters_raises</span>
292:     <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ArgumentError</span>) { <span class="ruby-constant">Account</span>.<span class="ruby-identifier">count</span>(<span class="ruby-value">1</span>, <span class="ruby-value">2</span>, <span class="ruby-value">3</span>) }
293:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007166" class="method">
  <div id="M007166_title" class="title">
    <b>test_from_option_with_specified_index</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007166_source')" id="l_M007166_source">show source</a> ]</p>
  <div id="M007166_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 335</span>
335:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_from_option_with_specified_index</span>
336:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Edge</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">adapter_name</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'MySQL'</span>
337:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Edge</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:all</span>), <span class="ruby-constant">Edge</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:from</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'edges USE INDEX(unique_edge_index)'</span>)
338:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Edge</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'sink_id &lt; 5'</span>),
339:           <span class="ruby-constant">Edge</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:from</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'edges USE INDEX(unique_edge_index)'</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'sink_id &lt; 5'</span>)
340:     <span class="ruby-keyword kw">end</span>
341:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007167" class="method">
  <div id="M007167_title" class="title">
    <b>test_from_option_with_table_different_than_class</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007167_source')" id="l_M007167_source">show source</a> ]</p>
  <div id="M007167_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 343</span>
343:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_from_option_with_table_different_than_class</span>
344:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Account</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:all</span>), <span class="ruby-constant">Company</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:from</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'accounts'</span>)
345:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007165" class="method">
  <div id="M007165_title" class="title">
    <b>test_maximum_with_from_option</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007165_source')" id="l_M007165_source">show source</a> ]</p>
  <div id="M007165_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 329</span>
329:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_maximum_with_from_option</span>
330:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Account</span>.<span class="ruby-identifier">maximum</span>(<span class="ruby-identifier">:credit_limit</span>), <span class="ruby-constant">Account</span>.<span class="ruby-identifier">maximum</span>(<span class="ruby-identifier">:credit_limit</span>, <span class="ruby-identifier">:from</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'accounts'</span>)
331:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Account</span>.<span class="ruby-identifier">maximum</span>(<span class="ruby-identifier">:credit_limit</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;credit_limit &gt; 50&quot;</span>),
332:         <span class="ruby-constant">Account</span>.<span class="ruby-identifier">maximum</span>(<span class="ruby-identifier">:credit_limit</span>, <span class="ruby-identifier">:from</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'accounts'</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;credit_limit &gt; 50&quot;</span>)
333:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007164" class="method">
  <div id="M007164_title" class="title">
    <b>test_minimum_with_from_option</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007164_source')" id="l_M007164_source">show source</a> ]</p>
  <div id="M007164_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 323</span>
323:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_minimum_with_from_option</span>
324:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Account</span>.<span class="ruby-identifier">minimum</span>(<span class="ruby-identifier">:credit_limit</span>), <span class="ruby-constant">Account</span>.<span class="ruby-identifier">minimum</span>(<span class="ruby-identifier">:credit_limit</span>, <span class="ruby-identifier">:from</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'accounts'</span>)
325:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Account</span>.<span class="ruby-identifier">minimum</span>(<span class="ruby-identifier">:credit_limit</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;credit_limit &gt; 50&quot;</span>),
326:         <span class="ruby-constant">Account</span>.<span class="ruby-identifier">minimum</span>(<span class="ruby-identifier">:credit_limit</span>, <span class="ruby-identifier">:from</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'accounts'</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;credit_limit &gt; 50&quot;</span>)
327:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007116" class="method">
  <div id="M007116_title" class="title">
    <b>test_should_average_field</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007116_source')" id="l_M007116_source">show source</a> ]</p>
  <div id="M007116_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 24</span>
24:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_average_field</span>
25:     <span class="ruby-identifier">value</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">average</span>(<span class="ruby-identifier">:credit_limit</span>)
26:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">53.0</span>, <span class="ruby-identifier">value</span>
27:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007142" class="method">
  <div id="M007142_title" class="title">
    <b>test_should_calculate_grouped_association_with_foreign_key_option</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007142_source')" id="l_M007142_source">show source</a> ]</p>
  <div id="M007142_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 190</span>
190:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_calculate_grouped_association_with_foreign_key_option</span>
191:     <span class="ruby-constant">Account</span>.<span class="ruby-identifier">belongs_to</span> <span class="ruby-identifier">:another_firm</span>, <span class="ruby-identifier">:class_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'Firm'</span>, <span class="ruby-identifier">:foreign_key</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'firm_id'</span>
192:     <span class="ruby-identifier">c</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:another_firm</span>)
193:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">c</span>[<span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>)]
194:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">c</span>[<span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:rails_core</span>)]
195:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">c</span>[<span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_client</span>)]
196:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007140" class="method">
  <div id="M007140_title" class="title">
    <b>test_should_calculate_grouped_association_with_invalid_field</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007140_source')" id="l_M007140_source">show source</a> ]</p>
  <div id="M007140_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 164</span>
164:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_calculate_grouped_association_with_invalid_field</span>
165:     <span class="ruby-identifier">c</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:firm</span>)
166:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">c</span>[<span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>)]
167:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">c</span>[<span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:rails_core</span>)]
168:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">c</span>[<span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_client</span>)]
169:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007144" class="method">
  <div id="M007144_title" class="title">
    <b>test_should_calculate_grouped_by_function</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007144_source')" id="l_M007144_source">show source</a> ]</p>
  <div id="M007144_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 206</span>
206:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_calculate_grouped_by_function</span>
207:     <span class="ruby-identifier">c</span> = <span class="ruby-constant">Company</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;UPPER(#{QUOTED_TYPE})&quot;</span>)
208:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">c</span>[<span class="ruby-keyword kw">nil</span>]
209:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">c</span>[<span class="ruby-value str">'DEPENDENTFIRM'</span>]
210:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">3</span>, <span class="ruby-identifier">c</span>[<span class="ruby-value str">'CLIENT'</span>]
211:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">c</span>[<span class="ruby-value str">'FIRM'</span>]
212:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007145" class="method">
  <div id="M007145_title" class="title">
    <b>test_should_calculate_grouped_by_function_with_table_alias</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007145_source')" id="l_M007145_source">show source</a> ]</p>
  <div id="M007145_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 214</span>
214:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_calculate_grouped_by_function_with_table_alias</span>
215:     <span class="ruby-identifier">c</span> = <span class="ruby-constant">Company</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;UPPER(companies.#{QUOTED_TYPE})&quot;</span>)
216:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">c</span>[<span class="ruby-keyword kw">nil</span>]
217:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">c</span>[<span class="ruby-value str">'DEPENDENTFIRM'</span>]
218:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">3</span>, <span class="ruby-identifier">c</span>[<span class="ruby-value str">'CLIENT'</span>]
219:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">c</span>[<span class="ruby-value str">'FIRM'</span>]
220:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007139" class="method">
  <div id="M007139_title" class="title">
    <b>test_should_calculate_grouped_with_invalid_field</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007139_source')" id="l_M007139_source">show source</a> ]</p>
  <div id="M007139_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 157</span>
157:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_calculate_grouped_with_invalid_field</span>
158:     <span class="ruby-identifier">c</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'accounts.firm_id'</span>)
159:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">c</span>[<span class="ruby-value">1</span>]
160:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">c</span>[<span class="ruby-value">6</span>]
161:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">c</span>[<span class="ruby-value">2</span>]
162:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007138" class="method">
  <div id="M007138_title" class="title">
    <b>test_should_calculate_with_invalid_field</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007138_source')" id="l_M007138_source">show source</a> ]</p>
  <div id="M007138_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 152</span>
152:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_calculate_with_invalid_field</span>
153:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">6</span>, <span class="ruby-constant">Account</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">:count</span>, <span class="ruby-value str">'*'</span>)
154:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">6</span>, <span class="ruby-constant">Account</span>.<span class="ruby-identifier">calculate</span>(<span class="ruby-identifier">:count</span>, <span class="ruby-identifier">:all</span>)
155:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007154" class="method">
  <div id="M007154_title" class="title">
    <b>test_should_count_manual_select_with_include</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007154_source')" id="l_M007154_source">show source</a> ]</p>
  <div id="M007154_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 275</span>
275:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_count_manual_select_with_include</span>
276:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">6</span>, <span class="ruby-constant">Account</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;DISTINCT accounts.id&quot;</span>, <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:firm</span>)
277:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007153" class="method">
  <div id="M007153_title" class="title">
    <b>test_should_count_selected_field_with_include</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007153_source')" id="l_M007153_source">show source</a> ]</p>
  <div id="M007153_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 270</span>
270:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_count_selected_field_with_include</span>
271:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">6</span>, <span class="ruby-constant">Account</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:distinct</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:firm</span>)
272:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">4</span>, <span class="ruby-constant">Account</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:distinct</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:firm</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:credit_limit</span>)
273:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007119" class="method">
  <div id="M007119_title" class="title">
    <b>test_should_get_maximum_of_field</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007119_source')" id="l_M007119_source">show source</a> ]</p>
  <div id="M007119_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 38</span>
38:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_get_maximum_of_field</span>
39:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">60</span>, <span class="ruby-constant">Account</span>.<span class="ruby-identifier">maximum</span>(<span class="ruby-identifier">:credit_limit</span>)
40:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007120" class="method">
  <div id="M007120_title" class="title">
    <b>test_should_get_maximum_of_field_with_include</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007120_source')" id="l_M007120_source">show source</a> ]</p>
  <div id="M007120_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 42</span>
42:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_get_maximum_of_field_with_include</span>
43:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">50</span>, <span class="ruby-constant">Account</span>.<span class="ruby-identifier">maximum</span>(<span class="ruby-identifier">:credit_limit</span>, <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:firm</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;companies.name != 'Summit'&quot;</span>)
44:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007121" class="method">
  <div id="M007121_title" class="title">
    <b>test_should_get_maximum_of_field_with_scoped_include</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007121_source')" id="l_M007121_source">show source</a> ]</p>
  <div id="M007121_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 46</span>
46:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_get_maximum_of_field_with_scoped_include</span>
47:     <span class="ruby-constant">Account</span>.<span class="ruby-identifier">with_scope</span> <span class="ruby-identifier">:find</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:firm</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;companies.name != 'Summit'&quot;</span> } <span class="ruby-keyword kw">do</span>
48:       <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">50</span>, <span class="ruby-constant">Account</span>.<span class="ruby-identifier">maximum</span>(<span class="ruby-identifier">:credit_limit</span>)
49:     <span class="ruby-keyword kw">end</span>
50:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007122" class="method">
  <div id="M007122_title" class="title">
    <b>test_should_get_minimum_of_field</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007122_source')" id="l_M007122_source">show source</a> ]</p>
  <div id="M007122_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 52</span>
52:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_get_minimum_of_field</span>
53:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">50</span>, <span class="ruby-constant">Account</span>.<span class="ruby-identifier">minimum</span>(<span class="ruby-identifier">:credit_limit</span>)
54:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007141" class="method">
  <div id="M007141_title" class="title">
    <b>test_should_group_by_association_with_non_numeric_foreign_key</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007141_source')" id="l_M007141_source">show source</a> ]</p>
  <div id="M007141_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 171</span>
171:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_group_by_association_with_non_numeric_foreign_key</span>
172:     <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:select_all</span>).<span class="ruby-identifier">returns</span>([{<span class="ruby-value str">&quot;count_all&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-value str">&quot;firm_id&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;ABC&quot;</span>}])
173: 
174:     <span class="ruby-identifier">firm</span> = <span class="ruby-identifier">mock</span>()
175:     <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:id</span>).<span class="ruby-identifier">returns</span>(<span class="ruby-value str">&quot;ABC&quot;</span>)
176:     <span class="ruby-identifier">firm</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:class</span>).<span class="ruby-identifier">returns</span>(<span class="ruby-constant">Firm</span>)
177:     <span class="ruby-constant">Company</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:find</span>).<span class="ruby-identifier">with</span>([<span class="ruby-value str">&quot;ABC&quot;</span>]).<span class="ruby-identifier">returns</span>([<span class="ruby-identifier">firm</span>])
178: 
179:     <span class="ruby-identifier">column</span> = <span class="ruby-identifier">mock</span>()
180:     <span class="ruby-identifier">column</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:name</span>).<span class="ruby-identifier">at_least_once</span>.<span class="ruby-identifier">returns</span>(<span class="ruby-identifier">:firm_id</span>)
181:     <span class="ruby-identifier">column</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:type_cast</span>).<span class="ruby-identifier">with</span>(<span class="ruby-value str">&quot;ABC&quot;</span>).<span class="ruby-identifier">returns</span>(<span class="ruby-value str">&quot;ABC&quot;</span>)
182:     <span class="ruby-constant">Account</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:columns</span>).<span class="ruby-identifier">at_least_once</span>.<span class="ruby-identifier">returns</span>([<span class="ruby-identifier">column</span>])
183: 
184:     <span class="ruby-identifier">c</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:firm</span>)
185:     <span class="ruby-identifier">first_key</span> = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">first</span>
186:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Firm</span>, <span class="ruby-identifier">first_key</span>.<span class="ruby-identifier">class</span>
187:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">c</span>[<span class="ruby-identifier">first_key</span>]
188:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007123" class="method">
  <div id="M007123_title" class="title">
    <b>test_should_group_by_field</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007123_source')" id="l_M007123_source">show source</a> ]</p>
  <div id="M007123_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 56</span>
56:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_group_by_field</span>
57:     <span class="ruby-identifier">c</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:credit_limit</span>, <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:firm_id</span>)
58:     [<span class="ruby-value">1</span>,<span class="ruby-value">6</span>,<span class="ruby-value">2</span>].<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">firm_id</span><span class="ruby-operator">|</span> <span class="ruby-identifier">assert</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">firm_id</span>) }
59:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007137" class="method">
  <div id="M007137_title" class="title">
    <b>test_should_group_by_fields_with_table_alias</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007137_source')" id="l_M007137_source">show source</a> ]</p>
  <div id="M007137_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 145</span>
145:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_group_by_fields_with_table_alias</span>
146:     <span class="ruby-identifier">c</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:credit_limit</span>, <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'accounts.firm_id'</span>)
147:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">50</span>,  <span class="ruby-identifier">c</span>[<span class="ruby-value">1</span>]
148:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">105</span>, <span class="ruby-identifier">c</span>[<span class="ruby-value">6</span>]
149:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">60</span>,  <span class="ruby-identifier">c</span>[<span class="ruby-value">2</span>]
150:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007150" class="method">
  <div id="M007150_title" class="title">
    <b>test_should_group_by_scoped_field</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007150_source')" id="l_M007150_source">show source</a> ]</p>
  <div id="M007150_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 238</span>
238:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_group_by_scoped_field</span>
239:     <span class="ruby-identifier">c</span> = <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:rails_core</span>).<span class="ruby-identifier">companies</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:id</span>, <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:name</span>)
240:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">7</span>, <span class="ruby-identifier">c</span>[<span class="ruby-value str">'Leetsoft'</span>]
241:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">8</span>, <span class="ruby-identifier">c</span>[<span class="ruby-value str">'Jadedpixel'</span>]
242:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007131" class="method">
  <div id="M007131_title" class="title">
    <b>test_should_group_by_summed_association</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007131_source')" id="l_M007131_source">show source</a> ]</p>
  <div id="M007131_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 107</span>
107:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_group_by_summed_association</span>
108:     <span class="ruby-identifier">c</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:credit_limit</span>, <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:firm</span>)
109:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">50</span>,   <span class="ruby-identifier">c</span>[<span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_firm</span>)]
110:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">105</span>,  <span class="ruby-identifier">c</span>[<span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:rails_core</span>)]
111:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">60</span>,   <span class="ruby-identifier">c</span>[<span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:first_client</span>)]
112:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007124" class="method">
  <div id="M007124_title" class="title">
    <b>test_should_group_by_summed_field</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007124_source')" id="l_M007124_source">show source</a> ]</p>
  <div id="M007124_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 61</span>
61:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_group_by_summed_field</span>
62:     <span class="ruby-identifier">c</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:credit_limit</span>, <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:firm_id</span>)
63:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">50</span>,   <span class="ruby-identifier">c</span>[<span class="ruby-value">1</span>]
64:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">105</span>,  <span class="ruby-identifier">c</span>[<span class="ruby-value">6</span>]
65:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">60</span>,   <span class="ruby-identifier">c</span>[<span class="ruby-value">2</span>]
66:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007129" class="method">
  <div id="M007129_title" class="title">
    <b>test_should_group_by_summed_field_having_condition</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007129_source')" id="l_M007129_source">show source</a> ]</p>
  <div id="M007129_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 91</span>
91:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_group_by_summed_field_having_condition</span>
92:     <span class="ruby-identifier">c</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:credit_limit</span>, <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:firm_id</span>,
93:                                    <span class="ruby-identifier">:having</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'sum(credit_limit) &gt; 50'</span>)
94:     <span class="ruby-identifier">assert_nil</span>        <span class="ruby-identifier">c</span>[<span class="ruby-value">1</span>]
95:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">105</span>, <span class="ruby-identifier">c</span>[<span class="ruby-value">6</span>]
96:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">60</span>,  <span class="ruby-identifier">c</span>[<span class="ruby-value">2</span>]
97:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007130" class="method">
  <div id="M007130_title" class="title">
    <b>test_should_group_by_summed_field_having_sanitized_condition</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007130_source')" id="l_M007130_source">show source</a> ]</p>
  <div id="M007130_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 99</span>
 99:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_group_by_summed_field_having_sanitized_condition</span>
100:     <span class="ruby-identifier">c</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:credit_limit</span>, <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:firm_id</span>,
101:                                    <span class="ruby-identifier">:having</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">'sum(credit_limit) &gt; ?'</span>, <span class="ruby-value">50</span>])
102:     <span class="ruby-identifier">assert_nil</span>        <span class="ruby-identifier">c</span>[<span class="ruby-value">1</span>]
103:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">105</span>, <span class="ruby-identifier">c</span>[<span class="ruby-value">6</span>]
104:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">60</span>,  <span class="ruby-identifier">c</span>[<span class="ruby-value">2</span>]
105:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007135" class="method">
  <div id="M007135_title" class="title">
    <b>test_should_group_by_summed_field_with_conditions</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007135_source')" id="l_M007135_source">show source</a> ]</p>
  <div id="M007135_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 128</span>
128:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_group_by_summed_field_with_conditions</span>
129:     <span class="ruby-identifier">c</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:credit_limit</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'firm_id &gt; 1'</span>,
130:                                    <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:firm_id</span>)
131:     <span class="ruby-identifier">assert_nil</span>        <span class="ruby-identifier">c</span>[<span class="ruby-value">1</span>]
132:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">105</span>, <span class="ruby-identifier">c</span>[<span class="ruby-value">6</span>]
133:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">60</span>,  <span class="ruby-identifier">c</span>[<span class="ruby-value">2</span>]
134:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007136" class="method">
  <div id="M007136_title" class="title">
    <b>test_should_group_by_summed_field_with_conditions_and_having</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007136_source')" id="l_M007136_source">show source</a> ]</p>
  <div id="M007136_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 136</span>
136:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_group_by_summed_field_with_conditions_and_having</span>
137:     <span class="ruby-identifier">c</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:credit_limit</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'firm_id &gt; 1'</span>,
138:                                    <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:firm_id</span>,
139:                                    <span class="ruby-identifier">:having</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'sum(credit_limit) &gt; 60'</span>)
140:     <span class="ruby-identifier">assert_nil</span>        <span class="ruby-identifier">c</span>[<span class="ruby-value">1</span>]
141:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">105</span>, <span class="ruby-identifier">c</span>[<span class="ruby-value">6</span>]
142:     <span class="ruby-identifier">assert_nil</span>        <span class="ruby-identifier">c</span>[<span class="ruby-value">2</span>]
143:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007151" class="method">
  <div id="M007151_title" class="title">
    <b>test_should_group_by_summed_field_with_conditions_and_having</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007151_source')" id="l_M007151_source">show source</a> ]</p>
  <div id="M007151_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 244</span>
244:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_group_by_summed_field_with_conditions_and_having</span>
245:     <span class="ruby-identifier">c</span> = <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:rails_core</span>).<span class="ruby-identifier">companies</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:id</span>, <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:name</span>,
246:                                                   <span class="ruby-identifier">:having</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'sum(id) &gt; 7'</span>)
247:     <span class="ruby-identifier">assert_nil</span>      <span class="ruby-identifier">c</span>[<span class="ruby-value str">'Leetsoft'</span>]
248:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">8</span>, <span class="ruby-identifier">c</span>[<span class="ruby-value str">'Jadedpixel'</span>]
249:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007127" class="method">
  <div id="M007127_title" class="title">
    <b>test_should_limit_calculation</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007127_source')" id="l_M007127_source">show source</a> ]</p>
  <div id="M007127_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 79</span>
79:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_limit_calculation</span>
80:     <span class="ruby-identifier">c</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:credit_limit</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;firm_id IS NOT NULL&quot;</span>,
81:                     <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:firm_id</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;firm_id&quot;</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span>)
82:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-value">1</span>, <span class="ruby-value">2</span>], <span class="ruby-identifier">c</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">compact</span>
83:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007128" class="method">
  <div id="M007128_title" class="title">
    <b>test_should_limit_calculation_with_offset</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007128_source')" id="l_M007128_source">show source</a> ]</p>
  <div id="M007128_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 85</span>
85:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_limit_calculation_with_offset</span>
86:     <span class="ruby-identifier">c</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:credit_limit</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;firm_id IS NOT NULL&quot;</span>,
87:                     <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:firm_id</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;firm_id&quot;</span>, <span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">:offset</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>)
88:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-value">2</span>, <span class="ruby-value">6</span>], <span class="ruby-identifier">c</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">compact</span>
89:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007143" class="method">
  <div id="M007143_title" class="title">
    <b>test_should_not_modify_options_when_using_includes</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007143_source')" id="l_M007143_source">show source</a> ]</p>
  <div id="M007143_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 198</span>
198:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_not_modify_options_when_using_includes</span>
199:     <span class="ruby-identifier">options</span> = {<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'companies.id &gt; 1'</span>, <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:firm</span>}
200:     <span class="ruby-identifier">options_copy</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">dup</span>
201: 
202:     <span class="ruby-constant">Account</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">options</span>)
203:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">options_copy</span>, <span class="ruby-identifier">options</span>
204:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007146" class="method">
  <div id="M007146_title" class="title">
    <b>test_should_not_overshadow_enumerable_sum</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007146_source')" id="l_M007146_source">show source</a> ]</p>
  <div id="M007146_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 222</span>
222:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_not_overshadow_enumerable_sum</span>
223:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">6</span>, [<span class="ruby-value">1</span>, <span class="ruby-value">2</span>, <span class="ruby-value">3</span>].<span class="ruby-identifier">sum</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:abs</span>)
224:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007126" class="method">
  <div id="M007126_title" class="title">
    <b>test_should_order_by_calculation</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007126_source')" id="l_M007126_source">show source</a> ]</p>
  <div id="M007126_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 73</span>
73:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_order_by_calculation</span>
74:     <span class="ruby-identifier">c</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:credit_limit</span>, <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:firm_id</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;sum_credit_limit desc, firm_id&quot;</span>)
75:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-value">105</span>, <span class="ruby-value">60</span>, <span class="ruby-value">53</span>, <span class="ruby-value">50</span>, <span class="ruby-value">50</span>], <span class="ruby-identifier">c</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>[<span class="ruby-identifier">k</span>] }
76:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-value">6</span>, <span class="ruby-value">2</span>, <span class="ruby-value">9</span>, <span class="ruby-value">1</span>], <span class="ruby-identifier">c</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">compact</span>
77:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007125" class="method">
  <div id="M007125_title" class="title">
    <b>test_should_order_by_grouped_field</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007125_source')" id="l_M007125_source">show source</a> ]</p>
  <div id="M007125_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 68</span>
68:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_order_by_grouped_field</span>
69:     <span class="ruby-identifier">c</span> = <span class="ruby-constant">Account</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:credit_limit</span>, <span class="ruby-identifier">:group</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:firm_id</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;firm_id&quot;</span>)
70:     <span class="ruby-identifier">assert_equal</span> [<span class="ruby-value">1</span>, <span class="ruby-value">2</span>, <span class="ruby-value">6</span>, <span class="ruby-value">9</span>], <span class="ruby-identifier">c</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">compact</span>
71:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007152" class="method">
  <div id="M007152_title" class="title">
    <b>test_should_reject_invalid_options</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007152_source')" id="l_M007152_source">show source</a> ]</p>
  <div id="M007152_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 251</span>
251:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_reject_invalid_options</span>
252:     <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
253:       [<span class="ruby-identifier">:count</span>, <span class="ruby-identifier">:sum</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">func</span><span class="ruby-operator">|</span>
254:         <span class="ruby-comment cmt"># empty options are valid</span>
255:         <span class="ruby-constant">Company</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">:validate_calculation_options</span>, <span class="ruby-identifier">func</span>)
256:         <span class="ruby-comment cmt"># these options are valid for all calculations</span>
257:         [<span class="ruby-identifier">:select</span>, <span class="ruby-identifier">:conditions</span>, <span class="ruby-identifier">:joins</span>, <span class="ruby-identifier">:order</span>, <span class="ruby-identifier">:group</span>, <span class="ruby-identifier">:having</span>, <span class="ruby-identifier">:distinct</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">opt</span><span class="ruby-operator">|</span>
258:           <span class="ruby-constant">Company</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">:validate_calculation_options</span>, <span class="ruby-identifier">func</span>, <span class="ruby-identifier">opt</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>)
259:         <span class="ruby-keyword kw">end</span>
260:       <span class="ruby-keyword kw">end</span>
261: 
262:       <span class="ruby-comment cmt"># :include is only valid on :count</span>
263:       <span class="ruby-constant">Company</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">:validate_calculation_options</span>, <span class="ruby-identifier">:count</span>, <span class="ruby-identifier">:include</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>)
264:     <span class="ruby-keyword kw">end</span>
265: 
266:     <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ArgumentError</span>) { <span class="ruby-constant">Company</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">:validate_calculation_options</span>, <span class="ruby-identifier">:sum</span>,   <span class="ruby-identifier">:foo</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:bar</span>) }
267:     <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">ArgumentError</span>) { <span class="ruby-constant">Company</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">:validate_calculation_options</span>, <span class="ruby-identifier">:count</span>, <span class="ruby-identifier">:foo</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:bar</span>) }
268:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007117" class="method">
  <div id="M007117_title" class="title">
    <b>test_should_return_nil_as_average</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007117_source')" id="l_M007117_source">show source</a> ]</p>
  <div id="M007117_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 29</span>
29:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_return_nil_as_average</span>
30:     <span class="ruby-identifier">assert_nil</span> <span class="ruby-constant">NumericData</span>.<span class="ruby-identifier">average</span>(<span class="ruby-identifier">:bank_balance</span>)
31:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007133" class="method">
  <div id="M007133_title" class="title">
    <b>test_should_return_zero_if_sum_conditions_return_nothing</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007133_source')" id="l_M007133_source">show source</a> ]</p>
  <div id="M007133_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 118</span>
118:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_return_zero_if_sum_conditions_return_nothing</span>
119:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">0</span>, <span class="ruby-constant">Account</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:credit_limit</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'1 = 2'</span>)
120:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">0</span>, <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:rails_core</span>).<span class="ruby-identifier">companies</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:id</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'1 = 2'</span>)
121:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007160" class="method">
  <div id="M007160_title" class="title">
    <b>test_should_sum_expression</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007160_source')" id="l_M007160_source">show source</a> ]</p>
  <div id="M007160_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 299</span>
299:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_sum_expression</span>
300:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">636</span>, <span class="ruby-constant">Account</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-value str">&quot;2 * credit_limit&quot;</span>).<span class="ruby-identifier">to_i</span>
301:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007115" class="method">
  <div id="M007115_title" class="title">
    <b>test_should_sum_field</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007115_source')" id="l_M007115_source">show source</a> ]</p>
  <div id="M007115_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 20</span>
20:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_sum_field</span>
21:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">318</span>, <span class="ruby-constant">Account</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:credit_limit</span>)
22:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007132" class="method">
  <div id="M007132_title" class="title">
    <b>test_should_sum_field_with_conditions</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007132_source')" id="l_M007132_source">show source</a> ]</p>
  <div id="M007132_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 114</span>
114:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_sum_field_with_conditions</span>
115:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">105</span>, <span class="ruby-constant">Account</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:credit_limit</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'firm_id = 6'</span>)
116:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007147" class="method">
  <div id="M007147_title" class="title">
    <b>test_should_sum_scoped_field</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007147_source')" id="l_M007147_source">show source</a> ]</p>
  <div id="M007147_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 226</span>
226:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_sum_scoped_field</span>
227:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">15</span>, <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:rails_core</span>).<span class="ruby-identifier">companies</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:id</span>)
228:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007149" class="method">
  <div id="M007149_title" class="title">
    <b>test_should_sum_scoped_field_with_conditions</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007149_source')" id="l_M007149_source">show source</a> ]</p>
  <div id="M007149_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 234</span>
234:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_sum_scoped_field_with_conditions</span>
235:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">8</span>,  <span class="ruby-identifier">companies</span>(<span class="ruby-identifier">:rails_core</span>).<span class="ruby-identifier">companies</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:id</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'id &gt; 7'</span>)
236:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007148" class="method">
  <div id="M007148_title" class="title">
    <b>test_should_sum_scoped_field_with_from</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007148_source')" id="l_M007148_source">show source</a> ]</p>
  <div id="M007148_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 230</span>
230:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_should_sum_scoped_field_with_from</span>
231:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Club</span>.<span class="ruby-identifier">count</span>, <span class="ruby-constant">Organization</span>.<span class="ruby-identifier">clubs</span>.<span class="ruby-identifier">count</span>
232:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007134" class="method">
  <div id="M007134_title" class="title">
    <b>test_sum_should_return_valid_values_for_decimals</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007134_source')" id="l_M007134_source">show source</a> ]</p>
  <div id="M007134_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 123</span>
123:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_sum_should_return_valid_values_for_decimals</span>
124:     <span class="ruby-constant">NumericData</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">:bank_balance</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">19.83</span>)
125:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">19.83</span>, <span class="ruby-constant">NumericData</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:bank_balance</span>)
126:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007162" class="method">
  <div id="M007162_title" class="title">
    <b>test_sum_with_from_option</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007162_source')" id="l_M007162_source">show source</a> ]</p>
  <div id="M007162_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 311</span>
311:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_sum_with_from_option</span>
312:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Account</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:credit_limit</span>), <span class="ruby-constant">Account</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:credit_limit</span>, <span class="ruby-identifier">:from</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'accounts'</span>)
313:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-constant">Account</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:credit_limit</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;credit_limit &gt; 50&quot;</span>),
314:         <span class="ruby-constant">Account</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:credit_limit</span>, <span class="ruby-identifier">:from</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'accounts'</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;credit_limit &gt; 50&quot;</span>)
315:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M007118" class="method">
  <div id="M007118_title" class="title">
    <b>test_type_cast_calculated_value_should_convert_db_averages_of_fixnum_class_to_decimal</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M007118_source')" id="l_M007118_source">show source</a> ]</p>
  <div id="M007118_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File activerecord/test/cases/calculations_test.rb, line 33</span>
33:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_type_cast_calculated_value_should_convert_db_averages_of_fixnum_class_to_decimal</span>
34:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">0</span>, <span class="ruby-constant">NumericData</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">:type_cast_calculated_value</span>, <span class="ruby-value">0</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-value str">'avg'</span>)
35:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">53.0</span>, <span class="ruby-constant">NumericData</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">:type_cast_calculated_value</span>, <span class="ruby-value">53</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-value str">'avg'</span>)
36:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>