  <div id="C00000381">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />ActionMailerTest<br/>
  In:
<a href="#" onclick="jsHref('files/actionmailer/test/mail_service_test_rb.html');">actionmailer/test/mail_service_test.rb</a>

Parent:&nbsp;
Test::Unit::TestCase
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">




  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M002250&name=encode" >encode</a></li>
  <li><a href="index.html?a=M002251&name=new_mail" >new_mail</a></li>
  <li><a href="index.html?a=M002252&name=setup" >setup</a></li>
  <li><a href="index.html?a=M002253&name=teardown" >teardown</a></li>
  <li><a href="index.html?a=M002282&name=test_attachment_using_content_location" >test_attachment_using_content_location</a></li>
  <li><a href="index.html?a=M002256&name=test_attachment_with_custom_header" >test_attachment_with_custom_header</a></li>
  <li><a href="index.html?a=M002283&name=test_attachment_with_text_type" >test_attachment_with_text_type</a></li>
  <li><a href="index.html?a=M002312&name=test_body_is_stored_as_an_ivar" >test_body_is_stored_as_an_ivar</a></li>
  <li><a href="index.html?a=M002260&name=test_cancelled_account" >test_cancelled_account</a></li>
  <li><a href="index.html?a=M002261&name=test_cc_bcc" >test_cc_bcc</a></li>
  <li><a href="index.html?a=M002309&name=test_custom_content_type_attributes" >test_custom_content_type_attributes</a></li>
  <li><a href="index.html?a=M002258&name=test_custom_template" >test_custom_template</a></li>
  <li><a href="index.html?a=M002259&name=test_custom_templating_extension" >test_custom_templating_extension</a></li>
  <li><a href="index.html?a=M002281&name=test_decode_attachment_without_charset" >test_decode_attachment_without_charset</a></li>
  <li><a href="index.html?a=M002302&name=test_decode_encoded_attachment_filename" >test_decode_encoded_attachment_filename</a></li>
  <li><a href="index.html?a=M002286&name=test_decode_message_with_incorrect_charset" >test_decode_message_with_incorrect_charset</a></li>
  <li><a href="index.html?a=M002304&name=test_decode_message_with_unknown_charset" >test_decode_message_with_unknown_charset</a></li>
  <li><a href="index.html?a=M002285&name=test_decode_message_without_content_type" >test_decode_message_without_content_type</a></li>
  <li><a href="index.html?a=M002284&name=test_decode_part_without_content_type" >test_decode_part_without_content_type</a></li>
  <li><a href="index.html?a=M002307&name=test_deliver_with_mail_object" >test_deliver_with_mail_object</a></li>
  <li><a href="index.html?a=M002266&name=test_deliveries_array" >test_deliveries_array</a></li>
  <li><a href="index.html?a=M002270&name=test_delivery_logs_sent_mail" >test_delivery_logs_sent_mail</a></li>
  <li><a href="index.html?a=M002268&name=test_doesnt_raise_errors_when_raise_delivery_errors_is_false" >test_doesnt_raise_errors_when_raise_delivery_errors_is_false</a></li>
  <li><a href="index.html?a=M002305&name=test_empty_header_values_omitted" >test_empty_header_values_omitted</a></li>
  <li><a href="index.html?a=M002290&name=test_explicitly_multipart_messages" >test_explicitly_multipart_messages</a></li>
  <li><a href="index.html?a=M002291&name=test_explicitly_multipart_with_content_type" >test_explicitly_multipart_with_content_type</a></li>
  <li><a href="index.html?a=M002292&name=test_explicitly_multipart_with_invalid_content_type" >test_explicitly_multipart_with_invalid_content_type</a></li>
  <li><a href="index.html?a=M002276&name=test_extended_headers" >test_extended_headers</a></li>
  <li><a href="index.html?a=M002300&name=test_headers_removed_on_smtp_delivery" >test_headers_removed_on_smtp_delivery</a></li>
  <li><a href="index.html?a=M002306&name=test_headers_with_nonalpha_chars" >test_headers_with_nonalpha_chars</a></li>
  <li><a href="index.html?a=M002296&name=test_html_mail" >test_html_mail</a></li>
  <li><a href="index.html?a=M002297&name=test_html_mail_with_underscores" >test_html_mail_with_underscores</a></li>
  <li><a href="index.html?a=M002293&name=test_implicitly_multipart_messages" >test_implicitly_multipart_messages</a></li>
  <li><a href="index.html?a=M002295&name=test_implicitly_multipart_messages_with_charset" >test_implicitly_multipart_messages_with_charset</a></li>
  <li><a href="index.html?a=M002294&name=test_implicitly_multipart_messages_with_custom_order" >test_implicitly_multipart_messages_with_custom_order</a></li>
  <li><a href="index.html?a=M002289&name=test_implicitly_multipart_with_utf8" >test_implicitly_multipart_with_utf8</a></li>
  <li><a href="index.html?a=M002265&name=test_instances_are_nil" >test_instances_are_nil</a></li>
  <li><a href="index.html?a=M002263&name=test_iso_charset" >test_iso_charset</a></li>
  <li><a href="index.html?a=M002287&name=test_multipart_with_mime_version" >test_multipart_with_mime_version</a></li>
  <li><a href="index.html?a=M002308&name=test_multipart_with_template_path_with_dots" >test_multipart_with_template_path_with_dots</a></li>
  <li><a href="index.html?a=M002288&name=test_multipart_with_utf8_subject" >test_multipart_with_utf8_subject</a></li>
  <li><a href="index.html?a=M002278&name=test_multiple_utf8_recipients" >test_multiple_utf8_recipients</a></li>
  <li><a href="index.html?a=M002254&name=test_nested_parts" >test_nested_parts</a></li>
  <li><a href="index.html?a=M002255&name=test_nested_parts_with_body" >test_nested_parts_with_body</a></li>
  <li><a href="index.html?a=M002267&name=test_perform_deliveries_flag" >test_perform_deliveries_flag</a></li>
  <li><a href="index.html?a=M002269&name=test_performs_delivery_via_sendmail" >test_performs_delivery_via_sendmail</a></li>
  <li><a href="index.html?a=M002280&name=test_receive_attachments" >test_receive_attachments</a></li>
  <li><a href="index.html?a=M002279&name=test_receive_decodes_base64_encoded_mail" >test_receive_decodes_base64_encoded_mail</a></li>
  <li><a href="index.html?a=M002301&name=test_recursive_multipart_processing" >test_recursive_multipart_processing</a></li>
  <li><a href="index.html?a=M002262&name=test_reply_to" >test_reply_to</a></li>
  <li><a href="index.html?a=M002310&name=test_return_path_with_create" >test_return_path_with_create</a></li>
  <li><a href="index.html?a=M002311&name=test_return_path_with_deliver" >test_return_path_with_deliver</a></li>
  <li><a href="index.html?a=M002257&name=test_signed_up" >test_signed_up</a></li>
  <li><a href="index.html?a=M002314&name=test_starttls_is_disabled_if_not_supported" >test_starttls_is_disabled_if_not_supported</a></li>
  <li><a href="index.html?a=M002313&name=test_starttls_is_enabled_if_supported" >test_starttls_is_enabled_if_supported</a></li>
  <li><a href="index.html?a=M002315&name=test_starttls_is_not_enabled" >test_starttls_is_not_enabled</a></li>
  <li><a href="index.html?a=M002264&name=test_unencoded_subject" >test_unencoded_subject</a></li>
  <li><a href="index.html?a=M002273&name=test_unquote_7bit_body" >test_unquote_7bit_body</a></li>
  <li><a href="index.html?a=M002272&name=test_unquote_7bit_subject" >test_unquote_7bit_subject</a></li>
  <li><a href="index.html?a=M002275&name=test_unquote_base64_body" >test_unquote_base64_body</a></li>
  <li><a href="index.html?a=M002274&name=test_unquote_quoted_printable_body" >test_unquote_quoted_printable_body</a></li>
  <li><a href="index.html?a=M002271&name=test_unquote_quoted_printable_subject" >test_unquote_quoted_printable_subject</a></li>
  <li><a href="index.html?a=M002277&name=test_utf8_body_is_not_quoted" >test_utf8_body_is_not_quoted</a></li>
  <li><a href="index.html?a=M002298&name=test_various_newlines" >test_various_newlines</a></li>
  <li><a href="index.html?a=M002299&name=test_various_newlines_multipart" >test_various_newlines_multipart</a></li>
  <li><a href="index.html?a=M002303&name=test_wrong_mail_header" >test_wrong_mail_header</a></li>
  </ul>

<div class="sectiontitle">Included Modules</div>
<ul>
  <li><a href="#" onclick="jsHref('');">ActionMailer::Quoting</a></li>
</ul>





<div class="sectiontitle">Public Instance methods</div>
<div id="M002250" class="method">
  <div id="M002250_title" class="title">
    <b>encode</b>( text, charset=&quot;utf-8&quot; )
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002250_source')" id="l_M002250_source">show source</a> ]</p>
  <div id="M002250_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 294</span>
294:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">encode</span>( <span class="ruby-identifier">text</span>, <span class="ruby-identifier">charset</span>=<span class="ruby-value str">&quot;utf-8&quot;</span> )
295:     <span class="ruby-identifier">quoted_printable</span>( <span class="ruby-identifier">text</span>, <span class="ruby-identifier">charset</span> )
296:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002251" class="method">
  <div id="M002251_title" class="title">
    <b>new_mail</b>( charset=&quot;utf-8&quot; )
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002251_source')" id="l_M002251_source">show source</a> ]</p>
  <div id="M002251_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 298</span>
298:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">new_mail</span>( <span class="ruby-identifier">charset</span>=<span class="ruby-value str">&quot;utf-8&quot;</span> )
299:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TMail</span><span class="ruby-operator">::</span><span class="ruby-constant">Mail</span>.<span class="ruby-identifier">new</span>
300:     <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">mime_version</span> = <span class="ruby-value str">&quot;1.0&quot;</span>
301:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">charset</span>
302:       <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">set_content_type</span> <span class="ruby-value str">&quot;text&quot;</span>, <span class="ruby-value str">&quot;plain&quot;</span>, { <span class="ruby-value str">&quot;charset&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">charset</span> }
303:     <span class="ruby-keyword kw">end</span>
304:     <span class="ruby-identifier">mail</span>
305:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002252" class="method">
  <div id="M002252_title" class="title">
    <b>setup</b>()
  </div>
  <div class="description">
  <p>
Replacing logger work around for mocha bug. Should be fixed in mocha 0.3.3
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002252_source')" id="l_M002252_source">show source</a> ]</p>
  <div id="M002252_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 308</span>
308:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setup</span>
309:     <span class="ruby-identifier">set_delivery_method</span> <span class="ruby-identifier">:test</span>
310:     <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">perform_deliveries</span> = <span class="ruby-keyword kw">true</span>
311:     <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">raise_delivery_errors</span> = <span class="ruby-keyword kw">true</span>
312:     <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span> = []
313: 
314:     <span class="ruby-ivar">@original_logger</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">logger</span>
315:     <span class="ruby-ivar">@recipient</span> = <span class="ruby-value str">'test@localhost'</span>
316:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002253" class="method">
  <div id="M002253_title" class="title">
    <b>teardown</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002253_source')" id="l_M002253_source">show source</a> ]</p>
  <div id="M002253_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 318</span>
318:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">teardown</span>
319:     <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">logger</span> = <span class="ruby-ivar">@original_logger</span>
320:     <span class="ruby-identifier">restore_delivery_method</span>
321:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002282" class="method">
  <div id="M002282_title" class="title">
    <b>test_attachment_using_content_location</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002282_source')" id="l_M002282_source">show source</a> ]</p>
  <div id="M002282_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 731</span>
731:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_attachment_using_content_location</span>
732:     <span class="ruby-identifier">fixture</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword kw">__FILE__</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/fixtures/raw_email12&quot;</span>)
733:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TMail</span><span class="ruby-operator">::</span><span class="ruby-constant">Mail</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">fixture</span>)
734:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">attachments</span>.<span class="ruby-identifier">length</span>
735:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;Photo25.jpg&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">attachments</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">original_filename</span>
736:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002256" class="method">
  <div id="M002256_title" class="title">
    <b>test_attachment_with_custom_header</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002256_source')" id="l_M002256_source">show source</a> ]</p>
  <div id="M002256_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 351</span>
351:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_attachment_with_custom_header</span>
352:     <span class="ruby-identifier">created</span> = <span class="ruby-keyword kw">nil</span>
353:     <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">created</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_attachment_with_custom_header</span>(<span class="ruby-ivar">@recipient</span>)}
354:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;&lt;test@test.com&gt;&quot;</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">header</span>[<span class="ruby-value str">'content-id'</span>].<span class="ruby-identifier">to_s</span>
355:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002283" class="method">
  <div id="M002283_title" class="title">
    <b>test_attachment_with_text_type</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002283_source')" id="l_M002283_source">show source</a> ]</p>
  <div id="M002283_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 738</span>
738:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_attachment_with_text_type</span>
739:     <span class="ruby-identifier">fixture</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword kw">__FILE__</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/fixtures/raw_email13&quot;</span>)
740:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TMail</span><span class="ruby-operator">::</span><span class="ruby-constant">Mail</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">fixture</span>)
741:     <span class="ruby-identifier">assert</span> <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">has_attachments?</span>
742:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">attachments</span>.<span class="ruby-identifier">length</span>
743:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;hello.rb&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">attachments</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">original_filename</span>
744:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002312" class="method">
  <div id="M002312_title" class="title">
    <b>test_body_is_stored_as_an_ivar</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002312_source')" id="l_M002312_source">show source</a> ]</p>
  <div id="M002312_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 951</span>
951:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_body_is_stored_as_an_ivar</span>
952:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_body_ivar</span>(<span class="ruby-ivar">@recipient</span>)
953:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;body: foo\nbar: baz&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">body</span>
954:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002260" class="method">
  <div id="M002260_title" class="title">
    <b>test_cancelled_account</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002260_source')" id="l_M002260_source">show source</a> ]</p>
  <div id="M002260_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 414</span>
414:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_cancelled_account</span>
415:     <span class="ruby-identifier">expected</span> = <span class="ruby-identifier">new_mail</span>
416:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">to</span>      = <span class="ruby-ivar">@recipient</span>
417:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">subject</span> = <span class="ruby-node">&quot;[Cancelled] Goodbye #{@recipient}&quot;</span>
418:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">body</span>    = <span class="ruby-node">&quot;Goodbye, Mr. #{@recipient}&quot;</span>
419:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">from</span>    = <span class="ruby-value str">&quot;system@loudthinking.com&quot;</span>
420:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">date</span>    = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">local</span>(<span class="ruby-value">2004</span>, <span class="ruby-value">12</span>, <span class="ruby-value">12</span>)
421: 
422:     <span class="ruby-identifier">created</span> = <span class="ruby-keyword kw">nil</span>
423:     <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">created</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_cancelled_account</span>(<span class="ruby-ivar">@recipient</span>) }
424:     <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">created</span>
425:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">encoded</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">encoded</span>
426: 
427:     <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">deliver_cancelled_account</span>(<span class="ruby-ivar">@recipient</span>) }
428:     <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">first</span>
429:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">encoded</span>, <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">encoded</span>
430:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002261" class="method">
  <div id="M002261_title" class="title">
    <b>test_cc_bcc</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002261_source')" id="l_M002261_source">show source</a> ]</p>
  <div id="M002261_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 432</span>
432:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_cc_bcc</span>
433:     <span class="ruby-identifier">expected</span> = <span class="ruby-identifier">new_mail</span>
434:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">to</span>      = <span class="ruby-ivar">@recipient</span>
435:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">subject</span> = <span class="ruby-value str">&quot;testing bcc/cc&quot;</span>
436:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">body</span>    = <span class="ruby-value str">&quot;Nothing to see here.&quot;</span>
437:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">from</span>    = <span class="ruby-value str">&quot;system@loudthinking.com&quot;</span>
438:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">cc</span>      = <span class="ruby-value str">&quot;nobody@loudthinking.com&quot;</span>
439:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">bcc</span>     = <span class="ruby-value str">&quot;root@loudthinking.com&quot;</span>
440:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">date</span>    = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">local</span> <span class="ruby-value">2004</span>, <span class="ruby-value">12</span>, <span class="ruby-value">12</span>
441: 
442:     <span class="ruby-identifier">created</span> = <span class="ruby-keyword kw">nil</span>
443:     <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
444:       <span class="ruby-identifier">created</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_cc_bcc</span> <span class="ruby-ivar">@recipient</span>
445:     <span class="ruby-keyword kw">end</span>
446:     <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">created</span>
447:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">encoded</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">encoded</span>
448: 
449:     <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
450:       <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">deliver_cc_bcc</span> <span class="ruby-ivar">@recipient</span>
451:     <span class="ruby-keyword kw">end</span>
452: 
453:     <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">first</span>
454:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">encoded</span>, <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">encoded</span>
455:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002309" class="method">
  <div id="M002309_title" class="title">
    <b>test_custom_content_type_attributes</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002309_source')" id="l_M002309_source">show source</a> ]</p>
  <div id="M002309_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 933</span>
933:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_custom_content_type_attributes</span>
934:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_custom_content_type_attributes</span>
935:     <span class="ruby-identifier">assert_match</span> <span class="ruby-regexp re">%r{format=flowed}</span>, <span class="ruby-identifier">mail</span>[<span class="ruby-value str">'content-type'</span>].<span class="ruby-identifier">to_s</span>
936:     <span class="ruby-identifier">assert_match</span> <span class="ruby-regexp re">%r{charset=utf-8}</span>, <span class="ruby-identifier">mail</span>[<span class="ruby-value str">'content-type'</span>].<span class="ruby-identifier">to_s</span>
937:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002258" class="method">
  <div id="M002258_title" class="title">
    <b>test_custom_template</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002258_source')" id="l_M002258_source">show source</a> ]</p>
  <div id="M002258_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 377</span>
377:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_custom_template</span>
378:     <span class="ruby-identifier">expected</span> = <span class="ruby-identifier">new_mail</span>
379:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">to</span>      = <span class="ruby-ivar">@recipient</span>
380:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">subject</span> = <span class="ruby-node">&quot;[Signed up] Welcome #{@recipient}&quot;</span>
381:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">body</span>    = <span class="ruby-node">&quot;Hello there, \n\nMr. #{@recipient}&quot;</span>
382:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">from</span>    = <span class="ruby-value str">&quot;system@loudthinking.com&quot;</span>
383:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">date</span>    = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">local</span>(<span class="ruby-value">2004</span>, <span class="ruby-value">12</span>, <span class="ruby-value">12</span>)
384: 
385:     <span class="ruby-identifier">created</span> = <span class="ruby-keyword kw">nil</span>
386:     <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">created</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_custom_template</span>(<span class="ruby-ivar">@recipient</span>) }
387:     <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">created</span>
388:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">encoded</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">encoded</span>
389:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002259" class="method">
  <div id="M002259_title" class="title">
    <b>test_custom_templating_extension</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002259_source')" id="l_M002259_source">show source</a> ]</p>
  <div id="M002259_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 391</span>
391:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_custom_templating_extension</span>
392:     <span class="ruby-identifier">assert</span> <span class="ruby-constant">ActionView</span><span class="ruby-operator">::</span><span class="ruby-constant">Template</span>.<span class="ruby-identifier">template_handler_extensions</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;haml&quot;</span>), <span class="ruby-value str">&quot;haml extension was not registered&quot;</span>
393: 
394:     <span class="ruby-comment cmt"># N.b., custom_templating_extension.text.plain.haml is expected to be in fixtures/test_mailer directory</span>
395:     <span class="ruby-identifier">expected</span> = <span class="ruby-identifier">new_mail</span>
396:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">to</span>      = <span class="ruby-ivar">@recipient</span>
397:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">subject</span> = <span class="ruby-node">&quot;[Signed up] Welcome #{@recipient}&quot;</span>
398:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">body</span>    = <span class="ruby-node">&quot;Hello there, \n\nMr. #{@recipient}&quot;</span>
399:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">from</span>    = <span class="ruby-value str">&quot;system@loudthinking.com&quot;</span>
400:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">date</span>    = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">local</span>(<span class="ruby-value">2004</span>, <span class="ruby-value">12</span>, <span class="ruby-value">12</span>)
401: 
402:     <span class="ruby-comment cmt"># Stub the render method so no alternative renderers need be present.</span>
403:     <span class="ruby-constant">ActionView</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">any_instance</span>.<span class="ruby-identifier">stubs</span>(<span class="ruby-identifier">:render</span>).<span class="ruby-identifier">returns</span>(<span class="ruby-node">&quot;Hello there, \n\nMr. #{@recipient}&quot;</span>)
404: 
405:     <span class="ruby-comment cmt"># Now that the template is registered, there should be one part. The text/plain part.</span>
406:     <span class="ruby-identifier">created</span> = <span class="ruby-keyword kw">nil</span>
407:     <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">created</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_custom_templating_extension</span>(<span class="ruby-ivar">@recipient</span>) }
408:     <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">created</span>
409:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">length</span>
410:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'text/plain'</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">content_type</span>
411:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'text/html'</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">content_type</span>
412:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002281" class="method">
  <div id="M002281_title" class="title">
    <b>test_decode_attachment_without_charset</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002281_source')" id="l_M002281_source">show source</a> ]</p>
  <div id="M002281_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 724</span>
724:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_decode_attachment_without_charset</span>
725:     <span class="ruby-identifier">fixture</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword kw">__FILE__</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/fixtures/raw_email3&quot;</span>)
726:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TMail</span><span class="ruby-operator">::</span><span class="ruby-constant">Mail</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">fixture</span>)
727:     <span class="ruby-identifier">attachment</span> = <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">attachments</span>.<span class="ruby-identifier">last</span>
728:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1026</span>, <span class="ruby-identifier">attachment</span>.<span class="ruby-identifier">read</span>.<span class="ruby-identifier">length</span>
729:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002302" class="method">
  <div id="M002302_title" class="title">
    <b>test_decode_encoded_attachment_filename</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002302_source')" id="l_M002302_source">show source</a> ]</p>
  <div id="M002302_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 882</span>
882:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_decode_encoded_attachment_filename</span>
883:     <span class="ruby-identifier">fixture</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword kw">__FILE__</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/fixtures/raw_email8&quot;</span>)
884:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TMail</span><span class="ruby-operator">::</span><span class="ruby-constant">Mail</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">fixture</span>)
885:     <span class="ruby-identifier">attachment</span> = <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">attachments</span>.<span class="ruby-identifier">last</span>
886: 
887:     <span class="ruby-identifier">expected</span> = <span class="ruby-value str">&quot;01 Quien Te Dij\212at. Pitbull.mp3&quot;</span>
888:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-constant">Encoding</span><span class="ruby-operator">::</span><span class="ruby-constant">ASCII_8BIT</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:force_encoding</span>)
889: 
890:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>, <span class="ruby-identifier">attachment</span>.<span class="ruby-identifier">original_filename</span>
891:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002286" class="method">
  <div id="M002286_title" class="title">
    <b>test_decode_message_with_incorrect_charset</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002286_source')" id="l_M002286_source">show source</a> ]</p>
  <div id="M002286_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 758</span>
758:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_decode_message_with_incorrect_charset</span>
759:     <span class="ruby-identifier">fixture</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword kw">__FILE__</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/fixtures/raw_email6&quot;</span>)
760:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TMail</span><span class="ruby-operator">::</span><span class="ruby-constant">Mail</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">fixture</span>)
761:     <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">body</span> }
762:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002304" class="method">
  <div id="M002304_title" class="title">
    <b>test_decode_message_with_unknown_charset</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002304_source')" id="l_M002304_source">show source</a> ]</p>
  <div id="M002304_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 898</span>
898:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_decode_message_with_unknown_charset</span>
899:     <span class="ruby-identifier">fixture</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword kw">__FILE__</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/fixtures/raw_email10&quot;</span>)
900:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TMail</span><span class="ruby-operator">::</span><span class="ruby-constant">Mail</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">fixture</span>)
901:     <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">body</span> }
902:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002285" class="method">
  <div id="M002285_title" class="title">
    <b>test_decode_message_without_content_type</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002285_source')" id="l_M002285_source">show source</a> ]</p>
  <div id="M002285_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 752</span>
752:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_decode_message_without_content_type</span>
753:     <span class="ruby-identifier">fixture</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword kw">__FILE__</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/fixtures/raw_email5&quot;</span>)
754:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TMail</span><span class="ruby-operator">::</span><span class="ruby-constant">Mail</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">fixture</span>)
755:     <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">body</span> }
756:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002284" class="method">
  <div id="M002284_title" class="title">
    <b>test_decode_part_without_content_type</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002284_source')" id="l_M002284_source">show source</a> ]</p>
  <div id="M002284_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 746</span>
746:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_decode_part_without_content_type</span>
747:     <span class="ruby-identifier">fixture</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword kw">__FILE__</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/fixtures/raw_email4&quot;</span>)
748:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TMail</span><span class="ruby-operator">::</span><span class="ruby-constant">Mail</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">fixture</span>)
749:     <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">body</span> }
750:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002307" class="method">
  <div id="M002307_title" class="title">
    <b>test_deliver_with_mail_object</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002307_source')" id="l_M002307_source">show source</a> ]</p>
  <div id="M002307_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 920</span>
920:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_deliver_with_mail_object</span>
921:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_headers_with_nonalpha_chars</span>(<span class="ruby-ivar">@recipient</span>)
922:     <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">deliver</span>(<span class="ruby-identifier">mail</span>) }
923:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">length</span>
924:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002266" class="method">
  <div id="M002266_title" class="title">
    <b>test_deliveries_array</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002266_source')" id="l_M002266_source">show source</a> ]</p>
  <div id="M002266_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 537</span>
537:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_deliveries_array</span>
538:     <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>
539:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">0</span>, <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">size</span>
540:     <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">deliver_signed_up</span>(<span class="ruby-ivar">@recipient</span>)
541:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">size</span>
542:     <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">first</span>
543:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002270" class="method">
  <div id="M002270_title" class="title">
    <b>test_delivery_logs_sent_mail</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002270_source')" id="l_M002270_source">show source</a> ]</p>
  <div id="M002270_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 569</span>
569:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_delivery_logs_sent_mail</span>
570:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_signed_up</span>(<span class="ruby-ivar">@recipient</span>)
571:     <span class="ruby-identifier">logger</span> = <span class="ruby-identifier">mock</span>()
572:     <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:info</span>).<span class="ruby-identifier">with</span>(<span class="ruby-node">&quot;Sent mail to #{@recipient}&quot;</span>)
573:     <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:debug</span>).<span class="ruby-identifier">with</span>(<span class="ruby-node">&quot;\n#{mail.encoded}&quot;</span>)
574:     <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">logger</span> = <span class="ruby-identifier">logger</span>
575:     <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">deliver_signed_up</span>(<span class="ruby-ivar">@recipient</span>)
576:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002268" class="method">
  <div id="M002268_title" class="title">
    <b>test_doesnt_raise_errors_when_raise_delivery_errors_is_false</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002268_source')" id="l_M002268_source">show source</a> ]</p>
  <div id="M002268_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 554</span>
554:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_doesnt_raise_errors_when_raise_delivery_errors_is_false</span>
555:     <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">raise_delivery_errors</span> = <span class="ruby-keyword kw">false</span>
556:     <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">any_instance</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:perform_delivery_test</span>).<span class="ruby-identifier">raises</span>(<span class="ruby-constant">Exception</span>)
557:     <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">deliver_signed_up</span>(<span class="ruby-ivar">@recipient</span>) }
558:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002305" class="method">
  <div id="M002305_title" class="title">
    <b>test_empty_header_values_omitted</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002305_source')" id="l_M002305_source">show source</a> ]</p>
  <div id="M002305_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 904</span>
904:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_empty_header_values_omitted</span>
905:     <span class="ruby-identifier">result</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_unnamed_attachment</span>(<span class="ruby-ivar">@recipient</span>).<span class="ruby-identifier">encoded</span>
906:     <span class="ruby-identifier">assert_match</span> <span class="ruby-regexp re">%r{Content-Type: application/octet-stream[^;]}</span>, <span class="ruby-identifier">result</span>
907:     <span class="ruby-identifier">assert_match</span> <span class="ruby-regexp re">%r{Content-Disposition: attachment[^;]}</span>, <span class="ruby-identifier">result</span>
908:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002290" class="method">
  <div id="M002290_title" class="title">
    <b>test_explicitly_multipart_messages</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002290_source')" id="l_M002290_source">show source</a> ]</p>
  <div id="M002290_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 779</span>
779:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_explicitly_multipart_messages</span>
780:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_explicitly_multipart_example</span>(<span class="ruby-ivar">@recipient</span>)
781:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">3</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">length</span>
782:     <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">content_type</span>
783:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;text/plain&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">content_type</span>
784: 
785:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;text/html&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">content_type</span>
786:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;iso-8859-1&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">sub_header</span>(<span class="ruby-value str">&quot;content-type&quot;</span>, <span class="ruby-value str">&quot;charset&quot;</span>)
787:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;inline&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">content_disposition</span>
788: 
789:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;image/jpeg&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">content_type</span>
790:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;attachment&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">content_disposition</span>
791:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;foo.jpg&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">sub_header</span>(<span class="ruby-value str">&quot;content-disposition&quot;</span>, <span class="ruby-value str">&quot;filename&quot;</span>)
792:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;foo.jpg&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">sub_header</span>(<span class="ruby-value str">&quot;content-type&quot;</span>, <span class="ruby-value str">&quot;name&quot;</span>)
793:     <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">sub_header</span>(<span class="ruby-value str">&quot;content-type&quot;</span>, <span class="ruby-value str">&quot;charset&quot;</span>)
794:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002291" class="method">
  <div id="M002291_title" class="title">
    <b>test_explicitly_multipart_with_content_type</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002291_source')" id="l_M002291_source">show source</a> ]</p>
  <div id="M002291_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 796</span>
796:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_explicitly_multipart_with_content_type</span>
797:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_explicitly_multipart_example</span>(<span class="ruby-ivar">@recipient</span>, <span class="ruby-value str">&quot;multipart/alternative&quot;</span>)
798:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">3</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">length</span>
799:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;multipart/alternative&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">content_type</span>
800:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002292" class="method">
  <div id="M002292_title" class="title">
    <b>test_explicitly_multipart_with_invalid_content_type</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002292_source')" id="l_M002292_source">show source</a> ]</p>
  <div id="M002292_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 802</span>
802:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_explicitly_multipart_with_invalid_content_type</span>
803:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_explicitly_multipart_example</span>(<span class="ruby-ivar">@recipient</span>, <span class="ruby-value str">&quot;text/xml&quot;</span>)
804:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">3</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">length</span>
805:     <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">content_type</span>
806:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002276" class="method">
  <div id="M002276_title" class="title">
    <b>test_extended_headers</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002276_source')" id="l_M002276_source">show source</a> ]</p>
  <div id="M002276_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 651</span>
651:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_extended_headers</span>
652:     <span class="ruby-ivar">@recipient</span> = <span class="ruby-value str">&quot;Grytyr &lt;test@localhost&gt;&quot;</span>
653: 
654:     <span class="ruby-identifier">expected</span> = <span class="ruby-identifier">new_mail</span> <span class="ruby-value str">&quot;iso-8859-1&quot;</span>
655:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">to</span>      = <span class="ruby-identifier">quote_address_if_necessary</span> <span class="ruby-ivar">@recipient</span>, <span class="ruby-value str">&quot;iso-8859-1&quot;</span>
656:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">subject</span> = <span class="ruby-value str">&quot;testing extended headers&quot;</span>
657:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">body</span>    = <span class="ruby-value str">&quot;Nothing to see here.&quot;</span>
658:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">from</span>    = <span class="ruby-identifier">quote_address_if_necessary</span> <span class="ruby-value str">&quot;Grytyr &lt;stian1@example.net&gt;&quot;</span>, <span class="ruby-value str">&quot;iso-8859-1&quot;</span>
659:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">cc</span>      = <span class="ruby-identifier">quote_address_if_necessary</span> <span class="ruby-value str">&quot;Grytyr &lt;stian2@example.net&gt;&quot;</span>, <span class="ruby-value str">&quot;iso-8859-1&quot;</span>
660:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">bcc</span>     = <span class="ruby-identifier">quote_address_if_necessary</span> <span class="ruby-value str">&quot;Grytyr &lt;stian3@example.net&gt;&quot;</span>, <span class="ruby-value str">&quot;iso-8859-1&quot;</span>
661:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">date</span>    = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">local</span> <span class="ruby-value">2004</span>, <span class="ruby-value">12</span>, <span class="ruby-value">12</span>
662: 
663:     <span class="ruby-identifier">created</span> = <span class="ruby-keyword kw">nil</span>
664:     <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
665:       <span class="ruby-identifier">created</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_extended_headers</span> <span class="ruby-ivar">@recipient</span>
666:     <span class="ruby-keyword kw">end</span>
667: 
668:     <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">created</span>
669:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">encoded</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">encoded</span>
670: 
671:     <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
672:       <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">deliver_extended_headers</span> <span class="ruby-ivar">@recipient</span>
673:     <span class="ruby-keyword kw">end</span>
674: 
675:     <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">first</span>
676:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">encoded</span>, <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">encoded</span>
677:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002300" class="method">
  <div id="M002300_title" class="title">
    <b>test_headers_removed_on_smtp_delivery</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002300_source')" id="l_M002300_source">show source</a> ]</p>
  <div id="M002300_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 865</span>
865:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_headers_removed_on_smtp_delivery</span>
866:     <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">delivery_method</span> = <span class="ruby-identifier">:smtp</span>
867:     <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">deliver_cc_bcc</span>(<span class="ruby-ivar">@recipient</span>)
868:     <span class="ruby-identifier">assert</span> <span class="ruby-constant">MockSMTP</span>.<span class="ruby-identifier">deliveries</span>[<span class="ruby-value">0</span>][<span class="ruby-value">2</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;root@loudthinking.com&quot;</span>)
869:     <span class="ruby-identifier">assert</span> <span class="ruby-constant">MockSMTP</span>.<span class="ruby-identifier">deliveries</span>[<span class="ruby-value">0</span>][<span class="ruby-value">2</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;nobody@loudthinking.com&quot;</span>)
870:     <span class="ruby-identifier">assert</span> <span class="ruby-constant">MockSMTP</span>.<span class="ruby-identifier">deliveries</span>[<span class="ruby-value">0</span>][<span class="ruby-value">2</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-ivar">@recipient</span>)
871:     <span class="ruby-identifier">assert_match</span> <span class="ruby-regexp re">%r{^Cc: nobody@loudthinking.com}</span>, <span class="ruby-constant">MockSMTP</span>.<span class="ruby-identifier">deliveries</span>[<span class="ruby-value">0</span>][<span class="ruby-value">0</span>]
872:     <span class="ruby-identifier">assert_match</span> <span class="ruby-node">%r{^To: #{@recipient}}</span>, <span class="ruby-constant">MockSMTP</span>.<span class="ruby-identifier">deliveries</span>[<span class="ruby-value">0</span>][<span class="ruby-value">0</span>]
873:     <span class="ruby-identifier">assert_no_match</span> <span class="ruby-regexp re">%r{^Bcc: root@loudthinking.com}</span>, <span class="ruby-constant">MockSMTP</span>.<span class="ruby-identifier">deliveries</span>[<span class="ruby-value">0</span>][<span class="ruby-value">0</span>]
874:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002306" class="method">
  <div id="M002306_title" class="title">
    <b>test_headers_with_nonalpha_chars</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002306_source')" id="l_M002306_source">show source</a> ]</p>
  <div id="M002306_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 910</span>
910:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_headers_with_nonalpha_chars</span>
911:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_headers_with_nonalpha_chars</span>(<span class="ruby-ivar">@recipient</span>)
912:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">mail</span>.<span class="ruby-identifier">from_addrs</span>.<span class="ruby-identifier">empty?</span>
913:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">mail</span>.<span class="ruby-identifier">cc_addrs</span>.<span class="ruby-identifier">empty?</span>
914:     <span class="ruby-identifier">assert</span> <span class="ruby-operator">!</span><span class="ruby-identifier">mail</span>.<span class="ruby-identifier">bcc_addrs</span>.<span class="ruby-identifier">empty?</span>
915:     <span class="ruby-identifier">assert_match</span>(<span class="ruby-regexp re">/:/</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">from_addrs</span>.<span class="ruby-identifier">to_s</span>)
916:     <span class="ruby-identifier">assert_match</span>(<span class="ruby-regexp re">/:/</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">cc_addrs</span>.<span class="ruby-identifier">to_s</span>)
917:     <span class="ruby-identifier">assert_match</span>(<span class="ruby-regexp re">/:/</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">bcc_addrs</span>.<span class="ruby-identifier">to_s</span>)
918:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002296" class="method">
  <div id="M002296_title" class="title">
    <b>test_html_mail</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002296_source')" id="l_M002296_source">show source</a> ]</p>
  <div id="M002296_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 843</span>
843:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_html_mail</span>
844:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_html_mail</span>(<span class="ruby-ivar">@recipient</span>)
845:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;text/html&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">content_type</span>
846:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002297" class="method">
  <div id="M002297_title" class="title">
    <b>test_html_mail_with_underscores</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002297_source')" id="l_M002297_source">show source</a> ]</p>
  <div id="M002297_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 848</span>
848:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_html_mail_with_underscores</span>
849:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_html_mail_with_underscores</span>(<span class="ruby-ivar">@recipient</span>)
850:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">%{&lt;a href=&quot;http://google.com&quot; target=&quot;_blank&quot;&gt;_Google&lt;/a&gt;}</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">body</span>
851:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002293" class="method">
  <div id="M002293_title" class="title">
    <b>test_implicitly_multipart_messages</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002293_source')" id="l_M002293_source">show source</a> ]</p>
  <div id="M002293_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 808</span>
808:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_implicitly_multipart_messages</span>
809:     <span class="ruby-identifier">assert</span> <span class="ruby-constant">ActionView</span><span class="ruby-operator">::</span><span class="ruby-constant">Template</span>.<span class="ruby-identifier">template_handler_extensions</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;bak&quot;</span>), <span class="ruby-value str">&quot;bak extension was not registered&quot;</span>
810: 
811:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_implicitly_multipart_example</span>(<span class="ruby-ivar">@recipient</span>)
812:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">3</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">length</span>
813:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;1.0&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">mime_version</span>
814:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;multipart/alternative&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">content_type</span>
815:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;text/yaml&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">content_type</span>
816:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;utf-8&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">sub_header</span>(<span class="ruby-value str">&quot;content-type&quot;</span>, <span class="ruby-value str">&quot;charset&quot;</span>)
817:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;text/plain&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">content_type</span>
818:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;utf-8&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">sub_header</span>(<span class="ruby-value str">&quot;content-type&quot;</span>, <span class="ruby-value str">&quot;charset&quot;</span>)
819:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;text/html&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">content_type</span>
820:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;utf-8&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">sub_header</span>(<span class="ruby-value str">&quot;content-type&quot;</span>, <span class="ruby-value str">&quot;charset&quot;</span>)
821:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002295" class="method">
  <div id="M002295_title" class="title">
    <b>test_implicitly_multipart_messages_with_charset</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002295_source')" id="l_M002295_source">show source</a> ]</p>
  <div id="M002295_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 833</span>
833:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_implicitly_multipart_messages_with_charset</span>
834:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_implicitly_multipart_example</span>(<span class="ruby-ivar">@recipient</span>, <span class="ruby-value str">'iso-8859-1'</span>)
835: 
836:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;multipart/alternative&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">header</span>[<span class="ruby-value str">'content-type'</span>].<span class="ruby-identifier">body</span>
837: 
838:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'iso-8859-1'</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">sub_header</span>(<span class="ruby-value str">&quot;content-type&quot;</span>, <span class="ruby-value str">&quot;charset&quot;</span>)
839:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'iso-8859-1'</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">sub_header</span>(<span class="ruby-value str">&quot;content-type&quot;</span>, <span class="ruby-value str">&quot;charset&quot;</span>)
840:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'iso-8859-1'</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">sub_header</span>(<span class="ruby-value str">&quot;content-type&quot;</span>, <span class="ruby-value str">&quot;charset&quot;</span>)
841:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002294" class="method">
  <div id="M002294_title" class="title">
    <b>test_implicitly_multipart_messages_with_custom_order</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002294_source')" id="l_M002294_source">show source</a> ]</p>
  <div id="M002294_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 823</span>
823:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_implicitly_multipart_messages_with_custom_order</span>
824:     <span class="ruby-identifier">assert</span> <span class="ruby-constant">ActionView</span><span class="ruby-operator">::</span><span class="ruby-constant">Template</span>.<span class="ruby-identifier">template_handler_extensions</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;bak&quot;</span>), <span class="ruby-value str">&quot;bak extension was not registered&quot;</span>
825: 
826:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_implicitly_multipart_example</span>(<span class="ruby-ivar">@recipient</span>, <span class="ruby-keyword kw">nil</span>, [<span class="ruby-value str">&quot;text/yaml&quot;</span>, <span class="ruby-value str">&quot;text/plain&quot;</span>])
827:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">3</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">length</span>
828:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;text/html&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">content_type</span>
829:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;text/plain&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">content_type</span>
830:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;text/yaml&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">content_type</span>
831:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002289" class="method">
  <div id="M002289_title" class="title">
    <b>test_implicitly_multipart_with_utf8</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002289_source')" id="l_M002289_source">show source</a> ]</p>
  <div id="M002289_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 774</span>
774:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_implicitly_multipart_with_utf8</span>
775:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_implicitly_multipart_with_utf8</span>
776:     <span class="ruby-identifier">assert_match</span>(<span class="ruby-regexp re">/\nSubject: =\?utf-8\?Q\?Foo_.*?\?=/</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">encoded</span>)
777:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002265" class="method">
  <div id="M002265_title" class="title">
    <b>test_instances_are_nil</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002265_source')" id="l_M002265_source">show source</a> ]</p>
  <div id="M002265_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 532</span>
532:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_instances_are_nil</span>
533:     <span class="ruby-identifier">assert_nil</span> <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">new</span>
534:     <span class="ruby-identifier">assert_nil</span> <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">new</span>
535:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002263" class="method">
  <div id="M002263_title" class="title">
    <b>test_iso_charset</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002263_source')" id="l_M002263_source">show source</a> ]</p>
  <div id="M002263_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 482</span>
482:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_iso_charset</span>
483:     <span class="ruby-identifier">expected</span> = <span class="ruby-identifier">new_mail</span>( <span class="ruby-value str">&quot;iso-8859-1&quot;</span> )
484:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">to</span>      = <span class="ruby-ivar">@recipient</span>
485:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">subject</span> = <span class="ruby-identifier">encode</span> <span class="ruby-value str">&quot;testing is charsets&quot;</span>, <span class="ruby-value str">&quot;iso-8859-1&quot;</span>
486:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">body</span>    = <span class="ruby-value str">&quot;Nothing to see here.&quot;</span>
487:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">from</span>    = <span class="ruby-value str">&quot;system@loudthinking.com&quot;</span>
488:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">cc</span>      = <span class="ruby-value str">&quot;nobody@loudthinking.com&quot;</span>
489:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">bcc</span>     = <span class="ruby-value str">&quot;root@loudthinking.com&quot;</span>
490:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">date</span>    = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">local</span> <span class="ruby-value">2004</span>, <span class="ruby-value">12</span>, <span class="ruby-value">12</span>
491: 
492:     <span class="ruby-identifier">created</span> = <span class="ruby-keyword kw">nil</span>
493:     <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
494:       <span class="ruby-identifier">created</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_iso_charset</span> <span class="ruby-ivar">@recipient</span>
495:     <span class="ruby-keyword kw">end</span>
496:     <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">created</span>
497:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">encoded</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">encoded</span>
498: 
499:     <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
500:       <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">deliver_iso_charset</span> <span class="ruby-ivar">@recipient</span>
501:     <span class="ruby-keyword kw">end</span>
502: 
503:     <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">first</span>
504:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">encoded</span>, <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">encoded</span>
505:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002287" class="method">
  <div id="M002287_title" class="title">
    <b>test_multipart_with_mime_version</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002287_source')" id="l_M002287_source">show source</a> ]</p>
  <div id="M002287_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 764</span>
764:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_multipart_with_mime_version</span>
765:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_multipart_with_mime_version</span>(<span class="ruby-ivar">@recipient</span>)
766:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;1.1&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">mime_version</span>
767:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002308" class="method">
  <div id="M002308_title" class="title">
    <b>test_multipart_with_template_path_with_dots</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002308_source')" id="l_M002308_source">show source</a> ]</p>
  <div id="M002308_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 926</span>
926:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_multipart_with_template_path_with_dots</span>
927:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">FunkyPathMailer</span>.<span class="ruby-identifier">create_multipart_with_template_path_with_dots</span>(<span class="ruby-ivar">@recipient</span>)
928:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">length</span>
929:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'text/plain'</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">content_type</span>
930:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">'utf-8'</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">charset</span>
931:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002288" class="method">
  <div id="M002288_title" class="title">
    <b>test_multipart_with_utf8_subject</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002288_source')" id="l_M002288_source">show source</a> ]</p>
  <div id="M002288_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 769</span>
769:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_multipart_with_utf8_subject</span>
770:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_multipart_with_utf8_subject</span>(<span class="ruby-ivar">@recipient</span>)
771:     <span class="ruby-identifier">assert_match</span>(<span class="ruby-regexp re">/\nSubject: =\?utf-8\?Q\?Foo_.*?\?=/</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">encoded</span>)
772:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002278" class="method">
  <div id="M002278_title" class="title">
    <b>test_multiple_utf8_recipients</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002278_source')" id="l_M002278_source">show source</a> ]</p>
  <div id="M002278_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 694</span>
694:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_multiple_utf8_recipients</span>
695:     <span class="ruby-ivar">@recipient</span> = [<span class="ruby-value str">&quot;\&quot;Foo  \&quot; &lt;extended@example.net&gt;&quot;</span>, <span class="ruby-value str">&quot;\&quot;Example Recipient\&quot; &lt;me@example.com&gt;&quot;</span>]
696:     <span class="ruby-identifier">expected</span> = <span class="ruby-identifier">new_mail</span> <span class="ruby-value str">&quot;utf-8&quot;</span>
697:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">to</span>      = <span class="ruby-identifier">quote_address_if_necessary</span> <span class="ruby-ivar">@recipient</span>, <span class="ruby-value str">&quot;utf-8&quot;</span>
698:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">subject</span> = <span class="ruby-value str">&quot;testing utf-8 body&quot;</span>
699:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">body</span>    = <span class="ruby-value str">&quot; blah&quot;</span>
700:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">from</span>    = <span class="ruby-identifier">quote_address_if_necessary</span> <span class="ruby-ivar">@recipient</span>.<span class="ruby-identifier">first</span>, <span class="ruby-value str">&quot;utf-8&quot;</span>
701:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">cc</span>      = <span class="ruby-identifier">quote_address_if_necessary</span> <span class="ruby-ivar">@recipient</span>, <span class="ruby-value str">&quot;utf-8&quot;</span>
702:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">bcc</span>     = <span class="ruby-identifier">quote_address_if_necessary</span> <span class="ruby-ivar">@recipient</span>, <span class="ruby-value str">&quot;utf-8&quot;</span>
703:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">date</span>    = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">local</span> <span class="ruby-value">2004</span>, <span class="ruby-value">12</span>, <span class="ruby-value">12</span>
704: 
705:     <span class="ruby-identifier">created</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_utf8_body</span> <span class="ruby-ivar">@recipient</span>
706:     <span class="ruby-identifier">assert_match</span>(<span class="ruby-regexp re">/\nFrom: =\?utf-8\?Q\?Foo_.*?\?= &lt;extended@example.net&gt;\r/</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">encoded</span>)
707:     <span class="ruby-identifier">assert_match</span>(<span class="ruby-regexp re">/\nTo: =\?utf-8\?Q\?Foo_.*?\?= &lt;extended@example.net&gt;, Example Recipient &lt;me/</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">encoded</span>)
708:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002254" class="method">
  <div id="M002254_title" class="title">
    <b>test_nested_parts</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002254_source')" id="l_M002254_source">show source</a> ]</p>
  <div id="M002254_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 323</span>
323:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_nested_parts</span>
324:     <span class="ruby-identifier">created</span> = <span class="ruby-keyword kw">nil</span>
325:     <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">created</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_nested_multipart</span>(<span class="ruby-ivar">@recipient</span>)}
326:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>,<span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">size</span>
327:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>,<span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">size</span>
328: 
329:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;multipart/mixed&quot;</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">content_type</span>
330:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;multipart/alternative&quot;</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">content_type</span>
331:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;bar&quot;</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">header</span>[<span class="ruby-value str">'foo'</span>].<span class="ruby-identifier">to_s</span>
332:     <span class="ruby-identifier">assert_nil</span> <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">charset</span>
333:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;text/plain&quot;</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">content_type</span>
334:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;text/html&quot;</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">content_type</span>
335:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;application/octet-stream&quot;</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">content_type</span>
336:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002255" class="method">
  <div id="M002255_title" class="title">
    <b>test_nested_parts_with_body</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002255_source')" id="l_M002255_source">show source</a> ]</p>
  <div id="M002255_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 338</span>
338:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_nested_parts_with_body</span>
339:     <span class="ruby-identifier">created</span> = <span class="ruby-keyword kw">nil</span>
340:     <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">created</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_nested_multipart_with_body</span>(<span class="ruby-ivar">@recipient</span>)}
341:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>,<span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">size</span>
342:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">2</span>,<span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">size</span>
343: 
344:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;multipart/mixed&quot;</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">content_type</span>
345:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;multipart/alternative&quot;</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">content_type</span>
346:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;Nothing to see here.&quot;</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">body</span>
347:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;text/plain&quot;</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">content_type</span>
348:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;text/html&quot;</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">content_type</span>
349:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002267" class="method">
  <div id="M002267_title" class="title">
    <b>test_perform_deliveries_flag</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002267_source')" id="l_M002267_source">show source</a> ]</p>
  <div id="M002267_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 545</span>
545:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_perform_deliveries_flag</span>
546:     <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">perform_deliveries</span> = <span class="ruby-keyword kw">false</span>
547:     <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">deliver_signed_up</span>(<span class="ruby-ivar">@recipient</span>)
548:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">0</span>, <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">size</span>
549:     <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">perform_deliveries</span> = <span class="ruby-keyword kw">true</span>
550:     <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">deliver_signed_up</span>(<span class="ruby-ivar">@recipient</span>)
551:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value">1</span>, <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">size</span>
552:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002269" class="method">
  <div id="M002269_title" class="title">
    <b>test_performs_delivery_via_sendmail</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002269_source')" id="l_M002269_source">show source</a> ]</p>
  <div id="M002269_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 560</span>
560:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_performs_delivery_via_sendmail</span>
561:     <span class="ruby-identifier">sm</span> = <span class="ruby-identifier">mock</span>()
562:     <span class="ruby-identifier">sm</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:print</span>).<span class="ruby-identifier">with</span>(<span class="ruby-identifier">anything</span>)
563:     <span class="ruby-identifier">sm</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:flush</span>)
564:     <span class="ruby-constant">IO</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:popen</span>).<span class="ruby-identifier">once</span>.<span class="ruby-identifier">with</span>(<span class="ruby-value str">'/usr/sbin/sendmail -i -t'</span>, <span class="ruby-value str">'w+'</span>).<span class="ruby-identifier">yields</span>(<span class="ruby-identifier">sm</span>)
565:     <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">delivery_method</span> = <span class="ruby-identifier">:sendmail</span>
566:     <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">deliver_signed_up</span>(<span class="ruby-ivar">@recipient</span>)
567:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002280" class="method">
  <div id="M002280_title" class="title">
    <b>test_receive_attachments</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002280_source')" id="l_M002280_source">show source</a> ]</p>
  <div id="M002280_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 716</span>
716:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_receive_attachments</span>
717:     <span class="ruby-identifier">fixture</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword kw">__FILE__</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/fixtures/raw_email2&quot;</span>)
718:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TMail</span><span class="ruby-operator">::</span><span class="ruby-constant">Mail</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">fixture</span>)
719:     <span class="ruby-identifier">attachment</span> = <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">attachments</span>.<span class="ruby-identifier">last</span>
720:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;smime.p7s&quot;</span>, <span class="ruby-identifier">attachment</span>.<span class="ruby-identifier">original_filename</span>
721:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;application/pkcs7-signature&quot;</span>, <span class="ruby-identifier">attachment</span>.<span class="ruby-identifier">content_type</span>
722:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002279" class="method">
  <div id="M002279_title" class="title">
    <b>test_receive_decodes_base64_encoded_mail</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002279_source')" id="l_M002279_source">show source</a> ]</p>
  <div id="M002279_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 710</span>
710:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_receive_decodes_base64_encoded_mail</span>
711:     <span class="ruby-identifier">fixture</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword kw">__FILE__</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/fixtures/raw_email&quot;</span>)
712:     <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">receive</span>(<span class="ruby-identifier">fixture</span>)
713:     <span class="ruby-identifier">assert_match</span>(<span class="ruby-regexp re">/Jamis/</span>, <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">received_body</span>)
714:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002301" class="method">
  <div id="M002301_title" class="title">
    <b>test_recursive_multipart_processing</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002301_source')" id="l_M002301_source">show source</a> ]</p>
  <div id="M002301_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 876</span>
876:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_recursive_multipart_processing</span>
877:     <span class="ruby-identifier">fixture</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword kw">__FILE__</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/fixtures/raw_email7&quot;</span>)
878:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TMail</span><span class="ruby-operator">::</span><span class="ruby-constant">Mail</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">fixture</span>)
879:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;This is the first part.\n\nAttachment: test.rb\nAttachment: test.pdf\n\n\nAttachment: smime.p7s\n&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">body</span>
880:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002262" class="method">
  <div id="M002262_title" class="title">
    <b>test_reply_to</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002262_source')" id="l_M002262_source">show source</a> ]</p>
  <div id="M002262_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 457</span>
457:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_reply_to</span>
458:     <span class="ruby-identifier">expected</span> = <span class="ruby-identifier">new_mail</span>
459: 
460:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">to</span>       = <span class="ruby-ivar">@recipient</span>
461:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">subject</span>  = <span class="ruby-value str">&quot;testing reply_to&quot;</span>
462:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">body</span>     = <span class="ruby-value str">&quot;Nothing to see here.&quot;</span>
463:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">from</span>     = <span class="ruby-value str">&quot;system@loudthinking.com&quot;</span>
464:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">reply_to</span> = <span class="ruby-value str">&quot;atraver@gmail.com&quot;</span>
465:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">date</span>     = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">local</span> <span class="ruby-value">2008</span>, <span class="ruby-value">5</span>, <span class="ruby-value">23</span>
466: 
467:     <span class="ruby-identifier">created</span> = <span class="ruby-keyword kw">nil</span>
468:     <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
469:       <span class="ruby-identifier">created</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_different_reply_to</span> <span class="ruby-ivar">@recipient</span>
470:     <span class="ruby-keyword kw">end</span>
471:     <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">created</span>
472:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">encoded</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">encoded</span>
473: 
474:     <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
475:       <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">deliver_different_reply_to</span> <span class="ruby-ivar">@recipient</span>
476:     <span class="ruby-keyword kw">end</span>
477: 
478:     <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">first</span>
479:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">encoded</span>, <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">encoded</span>
480:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002310" class="method">
  <div id="M002310_title" class="title">
    <b>test_return_path_with_create</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002310_source')" id="l_M002310_source">show source</a> ]</p>
  <div id="M002310_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 939</span>
939:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_return_path_with_create</span>
940:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_return_path</span>
941:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;&lt;another@somewhere.test&gt;&quot;</span>, <span class="ruby-identifier">mail</span>[<span class="ruby-value str">'return-path'</span>].<span class="ruby-identifier">to_s</span>
942:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002311" class="method">
  <div id="M002311_title" class="title">
    <b>test_return_path_with_deliver</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002311_source')" id="l_M002311_source">show source</a> ]</p>
  <div id="M002311_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 944</span>
944:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_return_path_with_deliver</span>
945:     <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">delivery_method</span> = <span class="ruby-identifier">:smtp</span>
946:     <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">deliver_return_path</span>
947:     <span class="ruby-identifier">assert_match</span> <span class="ruby-regexp re">%r{^Return-Path: &lt;another@somewhere.test&gt;}</span>, <span class="ruby-constant">MockSMTP</span>.<span class="ruby-identifier">deliveries</span>[<span class="ruby-value">0</span>][<span class="ruby-value">0</span>]
948:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;another@somewhere.test&quot;</span>, <span class="ruby-constant">MockSMTP</span>.<span class="ruby-identifier">deliveries</span>[<span class="ruby-value">0</span>][<span class="ruby-value">1</span>].<span class="ruby-identifier">to_s</span>
949:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002257" class="method">
  <div id="M002257_title" class="title">
    <b>test_signed_up</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002257_source')" id="l_M002257_source">show source</a> ]</p>
  <div id="M002257_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 357</span>
357:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_signed_up</span>
358:     <span class="ruby-constant">Time</span>.<span class="ruby-identifier">stubs</span>(<span class="ruby-identifier">:now</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)
359: 
360:     <span class="ruby-identifier">expected</span> = <span class="ruby-identifier">new_mail</span>
361:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">to</span>      = <span class="ruby-ivar">@recipient</span>
362:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">subject</span> = <span class="ruby-node">&quot;[Signed up] Welcome #{@recipient}&quot;</span>
363:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">body</span>    = <span class="ruby-node">&quot;Hello there, \n\nMr. #{@recipient}&quot;</span>
364:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">from</span>    = <span class="ruby-value str">&quot;system@loudthinking.com&quot;</span>
365:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">date</span>    = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
366: 
367:     <span class="ruby-identifier">created</span> = <span class="ruby-keyword kw">nil</span>
368:     <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-identifier">created</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_signed_up</span>(<span class="ruby-ivar">@recipient</span>) }
369:     <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">created</span>
370:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">encoded</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">encoded</span>
371: 
372:     <span class="ruby-identifier">assert_nothing_raised</span> { <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">deliver_signed_up</span>(<span class="ruby-ivar">@recipient</span>) }
373:     <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">first</span>
374:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">encoded</span>, <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">encoded</span>
375:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002314" class="method">
  <div id="M002314_title" class="title">
    <b>test_starttls_is_disabled_if_not_supported</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002314_source')" id="l_M002314_source">show source</a> ]</p>
  <div id="M002314_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 964</span>
964:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_starttls_is_disabled_if_not_supported</span>
965:     <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">smtp_settings</span>[<span class="ruby-identifier">:enable_starttls_auto</span>] = <span class="ruby-keyword kw">true</span>
966:     <span class="ruby-constant">MockSMTP</span>.<span class="ruby-identifier">any_instance</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:respond_to?</span>).<span class="ruby-identifier">with</span>(<span class="ruby-identifier">:enable_starttls_auto</span>).<span class="ruby-identifier">returns</span>(<span class="ruby-keyword kw">false</span>)
967:     <span class="ruby-constant">MockSMTP</span>.<span class="ruby-identifier">any_instance</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:enable_starttls_auto</span>).<span class="ruby-identifier">never</span>
968:     <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">delivery_method</span> = <span class="ruby-identifier">:smtp</span>
969:     <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">deliver_signed_up</span>(<span class="ruby-ivar">@recipient</span>)
970:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002313" class="method">
  <div id="M002313_title" class="title">
    <b>test_starttls_is_enabled_if_supported</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002313_source')" id="l_M002313_source">show source</a> ]</p>
  <div id="M002313_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 956</span>
956:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_starttls_is_enabled_if_supported</span>
957:     <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">smtp_settings</span>[<span class="ruby-identifier">:enable_starttls_auto</span>] = <span class="ruby-keyword kw">true</span>
958:     <span class="ruby-constant">MockSMTP</span>.<span class="ruby-identifier">any_instance</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:respond_to?</span>).<span class="ruby-identifier">with</span>(<span class="ruby-identifier">:enable_starttls_auto</span>).<span class="ruby-identifier">returns</span>(<span class="ruby-keyword kw">true</span>)
959:     <span class="ruby-constant">MockSMTP</span>.<span class="ruby-identifier">any_instance</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:enable_starttls_auto</span>)
960:     <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">delivery_method</span> = <span class="ruby-identifier">:smtp</span>
961:     <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">deliver_signed_up</span>(<span class="ruby-ivar">@recipient</span>)
962:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002315" class="method">
  <div id="M002315_title" class="title">
    <b>test_starttls_is_not_enabled</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002315_source')" id="l_M002315_source">show source</a> ]</p>
  <div id="M002315_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 972</span>
972:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_starttls_is_not_enabled</span>
973:     <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">smtp_settings</span>[<span class="ruby-identifier">:enable_starttls_auto</span>] = <span class="ruby-keyword kw">false</span>
974:     <span class="ruby-constant">MockSMTP</span>.<span class="ruby-identifier">any_instance</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:respond_to?</span>).<span class="ruby-identifier">never</span>
975:     <span class="ruby-constant">MockSMTP</span>.<span class="ruby-identifier">any_instance</span>.<span class="ruby-identifier">expects</span>(<span class="ruby-identifier">:enable_starttls_auto</span>).<span class="ruby-identifier">never</span>
976:     <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">delivery_method</span> = <span class="ruby-identifier">:smtp</span>
977:     <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">deliver_signed_up</span>(<span class="ruby-ivar">@recipient</span>)
978:   <span class="ruby-keyword kw">ensure</span>
979:     <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">smtp_settings</span>[<span class="ruby-identifier">:enable_starttls_auto</span>] = <span class="ruby-keyword kw">true</span>
980:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002264" class="method">
  <div id="M002264_title" class="title">
    <b>test_unencoded_subject</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002264_source')" id="l_M002264_source">show source</a> ]</p>
  <div id="M002264_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 507</span>
507:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_unencoded_subject</span>
508:     <span class="ruby-identifier">expected</span> = <span class="ruby-identifier">new_mail</span>
509:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">to</span>      = <span class="ruby-ivar">@recipient</span>
510:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">subject</span> = <span class="ruby-value str">&quot;testing unencoded subject&quot;</span>
511:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">body</span>    = <span class="ruby-value str">&quot;Nothing to see here.&quot;</span>
512:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">from</span>    = <span class="ruby-value str">&quot;system@loudthinking.com&quot;</span>
513:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">cc</span>      = <span class="ruby-value str">&quot;nobody@loudthinking.com&quot;</span>
514:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">bcc</span>     = <span class="ruby-value str">&quot;root@loudthinking.com&quot;</span>
515:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">date</span>    = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">local</span> <span class="ruby-value">2004</span>, <span class="ruby-value">12</span>, <span class="ruby-value">12</span>
516: 
517:     <span class="ruby-identifier">created</span> = <span class="ruby-keyword kw">nil</span>
518:     <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
519:       <span class="ruby-identifier">created</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_unencoded_subject</span> <span class="ruby-ivar">@recipient</span>
520:     <span class="ruby-keyword kw">end</span>
521:     <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">created</span>
522:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">encoded</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">encoded</span>
523: 
524:     <span class="ruby-identifier">assert_nothing_raised</span> <span class="ruby-keyword kw">do</span>
525:       <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">deliver_unencoded_subject</span> <span class="ruby-ivar">@recipient</span>
526:     <span class="ruby-keyword kw">end</span>
527: 
528:     <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">first</span>
529:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">encoded</span>, <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">encoded</span>
530:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002273" class="method">
  <div id="M002273_title" class="title">
    <b>test_unquote_7bit_body</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002273_source')" id="l_M002273_source">show source</a> ]</p>
  <div id="M002273_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 606</span>
606:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_unquote_7bit_body</span>
607:     <span class="ruby-identifier">msg</span> = <span class="ruby-value str">&quot;From: me@example.com\nSubject: subject\nContent-Type: text/plain; charset=iso-8859-1\nContent-Transfer-Encoding: 7bit\n\nThe=3Dbody\n&quot;</span>
608:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TMail</span><span class="ruby-operator">::</span><span class="ruby-constant">Mail</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">msg</span>)
609:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;The=3Dbody&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">strip</span>
610:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;The=3Dbody&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">quoted_body</span>.<span class="ruby-identifier">strip</span>
611:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002272" class="method">
  <div id="M002272_title" class="title">
    <b>test_unquote_7bit_subject</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002272_source')" id="l_M002272_source">show source</a> ]</p>
  <div id="M002272_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 592</span>
592:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_unquote_7bit_subject</span>
593:     <span class="ruby-identifier">msg</span> = <span class="ruby-value str">&quot;From: me@example.com\nSubject: this == working?\nContent-Type: text/plain; charset=iso-8859-1\n\nThe body\n&quot;</span>
594:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TMail</span><span class="ruby-operator">::</span><span class="ruby-constant">Mail</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">msg</span>)
595:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;this == working?&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">subject</span>
596:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;this == working?&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">quoted_subject</span>
597:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002275" class="method">
  <div id="M002275_title" class="title">
    <b>test_unquote_base64_body</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002275_source')" id="l_M002275_source">show source</a> ]</p>
  <div id="M002275_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 636</span>
636:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_unquote_base64_body</span>
637:     <span class="ruby-identifier">msg</span> = <span class="ruby-value str">&quot;From: me@example.com\nSubject: subject\nContent-Type: text/plain; charset=iso-8859-1\nContent-Transfer-Encoding: base64\n\nVGhlIGJvZHk=\n&quot;</span>
638:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TMail</span><span class="ruby-operator">::</span><span class="ruby-constant">Mail</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">msg</span>)
639:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;The body&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">strip</span>
640:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;VGhlIGJvZHk=&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">quoted_body</span>.<span class="ruby-identifier">strip</span>
641:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002274" class="method">
  <div id="M002274_title" class="title">
    <b>test_unquote_quoted_printable_body</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002274_source')" id="l_M002274_source">show source</a> ]</p>
  <div id="M002274_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 621</span>
621:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_unquote_quoted_printable_body</span>
622:     <span class="ruby-identifier">msg</span> = <span class="ruby-value str">&quot;From: me@example.com\nSubject: subject\nContent-Type: text/plain; charset=iso-8859-1\nContent-Transfer-Encoding: quoted-printable\n\nThe=3Dbody\n&quot;</span>
623:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TMail</span><span class="ruby-operator">::</span><span class="ruby-constant">Mail</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">msg</span>)
624:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;The=body&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">strip</span>
625:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;The=3Dbody&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">quoted_body</span>.<span class="ruby-identifier">strip</span>
626:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002271" class="method">
  <div id="M002271_title" class="title">
    <b>test_unquote_quoted_printable_subject</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002271_source')" id="l_M002271_source">show source</a> ]</p>
  <div id="M002271_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 578</span>
578:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_unquote_quoted_printable_subject</span>
579:     <span class="ruby-identifier">msg</span> = <span class="ruby-value str">&quot;From: me@example.com\nSubject: =?utf-8?Q?testing_testing_=D6=A4?=\nContent-Type: text/plain; charset=iso-8859-1\n\nThe body\n&quot;</span>
580:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TMail</span><span class="ruby-operator">::</span><span class="ruby-constant">Mail</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">msg</span>)
581:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;testing testing \326\244&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">subject</span>
582:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;=?utf-8?Q?testing_testing_=D6=A4?=&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">quoted_subject</span>
583:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002277" class="method">
  <div id="M002277_title" class="title">
    <b>test_utf8_body_is_not_quoted</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002277_source')" id="l_M002277_source">show source</a> ]</p>
  <div id="M002277_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 679</span>
679:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_utf8_body_is_not_quoted</span>
680:     <span class="ruby-ivar">@recipient</span> = <span class="ruby-value str">&quot;Foo   &lt;extended@example.net&gt;&quot;</span>
681:     <span class="ruby-identifier">expected</span> = <span class="ruby-identifier">new_mail</span> <span class="ruby-value str">&quot;utf-8&quot;</span>
682:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">to</span>      = <span class="ruby-identifier">quote_address_if_necessary</span> <span class="ruby-ivar">@recipient</span>, <span class="ruby-value str">&quot;utf-8&quot;</span>
683:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">subject</span> = <span class="ruby-value str">&quot;testing utf-8 body&quot;</span>
684:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">body</span>    = <span class="ruby-value str">&quot; blah&quot;</span>
685:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">from</span>    = <span class="ruby-identifier">quote_address_if_necessary</span> <span class="ruby-ivar">@recipient</span>, <span class="ruby-value str">&quot;utf-8&quot;</span>
686:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">cc</span>      = <span class="ruby-identifier">quote_address_if_necessary</span> <span class="ruby-ivar">@recipient</span>, <span class="ruby-value str">&quot;utf-8&quot;</span>
687:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">bcc</span>     = <span class="ruby-identifier">quote_address_if_necessary</span> <span class="ruby-ivar">@recipient</span>, <span class="ruby-value str">&quot;utf-8&quot;</span>
688:     <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">date</span>    = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">local</span> <span class="ruby-value">2004</span>, <span class="ruby-value">12</span>, <span class="ruby-value">12</span>
689: 
690:     <span class="ruby-identifier">created</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_utf8_body</span> <span class="ruby-ivar">@recipient</span>
691:     <span class="ruby-identifier">assert_match</span>(<span class="ruby-regexp re">/ blah/</span>, <span class="ruby-identifier">created</span>.<span class="ruby-identifier">encoded</span>)
692:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002298" class="method">
  <div id="M002298_title" class="title">
    <b>test_various_newlines</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002298_source')" id="l_M002298_source">show source</a> ]</p>
  <div id="M002298_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 853</span>
853:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_various_newlines</span>
854:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_various_newlines</span>(<span class="ruby-ivar">@recipient</span>)
855:     <span class="ruby-identifier">assert_equal</span>(<span class="ruby-value str">&quot;line #1\nline #2\nline #3\nline #4\n\n&quot;</span> <span class="ruby-operator">+</span>
856:                  <span class="ruby-value str">&quot;line #5\n\nline#6\n\nline #7&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">body</span>)
857:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002299" class="method">
  <div id="M002299_title" class="title">
    <b>test_various_newlines_multipart</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002299_source')" id="l_M002299_source">show source</a> ]</p>
  <div id="M002299_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 859</span>
859:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_various_newlines_multipart</span>
860:     <span class="ruby-identifier">mail</span> = <span class="ruby-constant">TestMailer</span>.<span class="ruby-identifier">create_various_newlines_multipart</span>(<span class="ruby-ivar">@recipient</span>)
861:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;line #1\nline #2\nline #3\nline #4\n\n&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">body</span>
862:     <span class="ruby-identifier">assert_equal</span> <span class="ruby-value str">&quot;&lt;p&gt;line #1&lt;/p&gt;\n&lt;p&gt;line #2&lt;/p&gt;\n&lt;p&gt;line #3&lt;/p&gt;\n&lt;p&gt;line #4&lt;/p&gt;\n\n&quot;</span>, <span class="ruby-identifier">mail</span>.<span class="ruby-identifier">parts</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">body</span>
863:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M002303" class="method">
  <div id="M002303_title" class="title">
    <b>test_wrong_mail_header</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M002303_source')" id="l_M002303_source">show source</a> ]</p>
  <div id="M002303_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File actionmailer/test/mail_service_test.rb, line 893</span>
893:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">test_wrong_mail_header</span>
894:     <span class="ruby-identifier">fixture</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword kw">__FILE__</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/fixtures/raw_email9&quot;</span>)
895:     <span class="ruby-identifier">assert_raise</span>(<span class="ruby-constant">TMail</span><span class="ruby-operator">::</span><span class="ruby-constant">SyntaxError</span>) { <span class="ruby-constant">TMail</span><span class="ruby-operator">::</span><span class="ruby-constant">Mail</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">fixture</span>) }
896:   <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>