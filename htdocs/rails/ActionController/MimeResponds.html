<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Module: ActionController::MimeResponds</title>
<link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (M)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../ActionController.html" title="ActionController (module)">ActionController</a></span></span>
     &raquo; 
    <span class="title">MimeResponds</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Module: ActionController::MimeResponds
  
  
  
</h1>

<dl class="box">
  
  
    
      <dt class="r1">Extended by:</dt>
      <dd class="r1"><span class='object_link'><a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)">ActiveSupport::Concern</a></span></dd>
      
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">actionpack/lib/action_controller/metal/mime_responds.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
:nodoc:
</p>


  </div>
</div>
<div class="tags">
  
</div><h2>Defined Under Namespace</h2>
<p class="children">
   
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="MimeResponds/ClassMethods.html" title="ActionController::MimeResponds::ClassMethods (module)">ClassMethods</a></span>
    
   
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="MimeResponds/Collector.html" title="ActionController::MimeResponds::Collector (class)">Collector</a></span>
    
  
</p>


  
  
  
  

  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#respond_to-instance_method" title="#respond_to (instance method)">- (Object) <strong>respond_to</strong>(*mimes, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Without web-service support, an action which collects the data for
displaying a list of people might look something like this:.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#respond_with-instance_method" title="#respond_with (instance method)">- (Object) <strong>respond_with</strong>(*resources, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
respond_with wraps a resource around a responder for default
representation.
</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../ActiveSupport/Concern.html" title="ActiveSupport::Concern (module)">ActiveSupport::Concern</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../ActiveSupport/Concern.html#append_features-instance_method" title="ActiveSupport::Concern#append_features (method)">append_features</a></span>, <span class='object_link'><a href="../ActiveSupport/Concern.html#extended-class_method" title="ActiveSupport::Concern.extended (method)">extended</a></span>, <span class='object_link'><a href="../ActiveSupport/Concern.html#included-instance_method" title="ActiveSupport::Concern#included (method)">included</a></span></p>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="respond_to-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>respond_to</strong>(*mimes, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Without web-service support, an action which collects the data for
displaying a list of people might look something like this:
</p>
<pre class="code">
  <span class='kw'>def</span> <span class='id index'>index</span>
    <span class='ivar'>@people</span> <span class='op'>=</span> <span class='const'>Person</span><span class='period'>.</span><span class='id find'>find</span><span class='lparen'>(</span><span class='symbol'>:all</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
</pre>
<p>
Here&#8217;s the same action, with web-service support baked in:
</p>
<pre class="code">
  <span class='kw'>def</span> <span class='id index'>index</span>
    <span class='ivar'>@people</span> <span class='op'>=</span> <span class='const'>Person</span><span class='period'>.</span><span class='id find'>find</span><span class='lparen'>(</span><span class='symbol'>:all</span><span class='rparen'>)</span>

    <span class='id respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id format'>format</span><span class='op'>|</span>
      <span class='id format'>format</span><span class='period'>.</span><span class='id html'>html</span>
      <span class='id format'>format</span><span class='period'>.</span><span class='id xml'>xml</span> <span class='lbrace'>{</span> <span class='id render'>render</span> <span class='symbol'>:xml</span> <span class='op'>=&gt;</span> <span class='ivar'>@people</span><span class='period'>.</span><span class='id to_xml'>to_xml</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
</pre>
<p>
What that says is, &#8220;if the client wants HTML in response to this
action, just respond as we would have before, but if the client wants XML,
return them the list of people in XML format.&#8221; (Rails determines the
desired response format from the HTTP Accept header submitted by the
client.)
</p>
<p>
Supposing you have an action that adds a new person, optionally creating
their company (by name) if it does not already exist, without web-services,
it might look like this:
</p>
<pre class="code">
  <span class='kw'>def</span> <span class='id create'>create</span>
    <span class='ivar'>@company</span> <span class='op'>=</span> <span class='const'>Company</span><span class='period'>.</span><span class='id find_or_create_by_name'>find_or_create_by_name</span><span class='lparen'>(</span><span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:company</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='ivar'>@person</span>  <span class='op'>=</span> <span class='ivar'>@company</span><span class='period'>.</span><span class='id people'>people</span><span class='period'>.</span><span class='id create'>create</span><span class='lparen'>(</span><span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:person</span><span class='rbracket'>]</span><span class='rparen'>)</span>

    <span class='id redirect_to'>redirect_to</span><span class='lparen'>(</span><span class='id person_list_url'>person_list_url</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
</pre>
<p>
Here&#8217;s the same action, with web-service support baked in:
</p>
<pre class="code">
  <span class='kw'>def</span> <span class='id create'>create</span>
    <span class='id company'>company</span>  <span class='op'>=</span> <span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:person</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:company</span><span class='rparen'>)</span>
    <span class='ivar'>@company</span> <span class='op'>=</span> <span class='const'>Company</span><span class='period'>.</span><span class='id find_or_create_by_name'>find_or_create_by_name</span><span class='lparen'>(</span><span class='id company'>company</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='ivar'>@person</span>  <span class='op'>=</span> <span class='ivar'>@company</span><span class='period'>.</span><span class='id people'>people</span><span class='period'>.</span><span class='id create'>create</span><span class='lparen'>(</span><span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:person</span><span class='rbracket'>]</span><span class='rparen'>)</span>

    <span class='id respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id format'>format</span><span class='op'>|</span>
      <span class='id format'>format</span><span class='period'>.</span><span class='id html'>html</span> <span class='lbrace'>{</span> <span class='id redirect_to'>redirect_to</span><span class='lparen'>(</span><span class='id person_list_url'>person_list_url</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
      <span class='id format'>format</span><span class='period'>.</span><span class='id js'>js</span>
      <span class='id format'>format</span><span class='period'>.</span><span class='id xml'>xml</span>  <span class='lbrace'>{</span> <span class='id render'>render</span> <span class='symbol'>:xml</span> <span class='op'>=&gt;</span> <span class='ivar'>@person</span><span class='period'>.</span><span class='id to_xml'>to_xml</span><span class='lparen'>(</span><span class='symbol'>:include</span> <span class='op'>=&gt;</span> <span class='ivar'>@company</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
</pre>
<p>
If the client wants HTML, we just redirect them back to the person list. If
they want Javascript (format.js), then it is an RJS request and we render
the RJS template associated with this action. Lastly, if the client wants
XML, we render the created person as XML, but with a twist: we also include
the person&#8217;s company in the rendered XML, so you get something like
this:
</p>
<pre class="code">
  &lt;person&gt;
    &lt;id&gt;...&lt;/id&gt;
    ...
    &lt;company&gt;
      &lt;id&gt;...&lt;/id&gt;
      &lt;name&gt;...&lt;/name&gt;
      ...
    &lt;/company&gt;
  &lt;/person&gt;
</pre>
<p>
Note, however, the extra bit at the top of that action:
</p>
<pre class="code">
  <span class='id company'>company</span>  <span class='op'>=</span> <span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:person</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:company</span><span class='rparen'>)</span>
  <span class='ivar'>@company</span> <span class='op'>=</span> <span class='const'>Company</span><span class='period'>.</span><span class='id find_or_create_by_name'>find_or_create_by_name</span><span class='lparen'>(</span><span class='id company'>company</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='rparen'>)</span>
</pre>
<p>
This is because the incoming XML document (if a web-service request is in
process) can only contain a single root-node. So, we have to rearrange
things so that the request looks like this (url-encoded):
</p>
<pre class="code">
  person[name]=...&amp;person[company][name]=...&amp;...
</pre>
<p>
And, like this (xml-encoded):
</p>
<pre class="code">
  &lt;person&gt;
    &lt;name&gt;...&lt;/name&gt;
    &lt;company&gt;
      &lt;name&gt;...&lt;/name&gt;
    &lt;/company&gt;
  &lt;/person&gt;
</pre>
<p>
In other words, we make the request so that it operates on a single
entity&#8217;s person. Then, in the action, we extract the company data
from the request, find or create the company, and then create the new
person with the remaining data.
</p>
<p>
Note that you can define your own XML parameter parser which would allow
you to describe multiple entities in a single request (i.e., by wrapping
them all in a single root node), but if you just go with the flow and
accept Rails&#8217; defaults, life will be much easier.
</p>
<p>
If you need to use a MIME type which isn&#8217;t supported by default, you
can register your own handlers in config/initializers/mime_types.rb as
follows.
</p>
<pre class="code">
  <span class='const'>Mime</span><span class='op'>::</span><span class='const'>Type</span><span class='period'>.</span><span class='id register'>register</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>image/jpg</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:jpg</span>
</pre>
<p>
Respond to also allows you to specify a common block for different formats
by using any:
</p>
<pre class="code">
  <span class='kw'>def</span> <span class='id index'>index</span>
    <span class='ivar'>@people</span> <span class='op'>=</span> <span class='const'>Person</span><span class='period'>.</span><span class='id find'>find</span><span class='lparen'>(</span><span class='symbol'>:all</span><span class='rparen'>)</span>

    <span class='id respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id format'>format</span><span class='op'>|</span>
      <span class='id format'>format</span><span class='period'>.</span><span class='id html'>html</span>
      <span class='id format'>format</span><span class='period'>.</span><span class='id any'>any</span><span class='lparen'>(</span><span class='symbol'>:xml</span><span class='comma'>,</span> <span class='symbol'>:json</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='id render'>render</span> <span class='id request'>request</span><span class='period'>.</span><span class='id format'>format</span><span class='period'>.</span><span class='id to_sym'>to_sym</span> <span class='op'>=&gt;</span> <span class='ivar'>@people</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
</pre>
<p>
In the example above, if the format is xml, it will render:
</p>
<pre class="code">
  <span class='id render'>render</span> <span class='symbol'>:xml</span> <span class='op'>=&gt;</span> <span class='ivar'>@people</span>
</pre>
<p>
Or if the format is json:
</p>
<pre class="code">
  <span class='id render'>render</span> <span class='symbol'>:json</span> <span class='op'>=&gt;</span> <span class='ivar'>@people</span>
</pre>
<p>
Since this is a common pattern, you can use the class method respond_to
with the respond_with method to have the same results:
</p>
<pre class="code">
  <span class='kw'>class</span> <span class='const'>PeopleController</span> <span class='op'>&lt;</span> <span class='const'>ApplicationController</span>
    <span class='id respond_to'>respond_to</span> <span class='symbol'>:html</span><span class='comma'>,</span> <span class='symbol'>:xml</span><span class='comma'>,</span> <span class='symbol'>:json</span>

    <span class='kw'>def</span> <span class='id index'>index</span>
      <span class='ivar'>@people</span> <span class='op'>=</span> <span class='const'>Person</span><span class='period'>.</span><span class='id find'>find</span><span class='lparen'>(</span><span class='symbol'>:all</span><span class='rparen'>)</span>
      <span class='id respond_with'>respond_with</span><span class='lparen'>(</span><span class='ivar'>@person</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
</pre>
<p>
Be sure to check respond_with and respond_to documentation for more
examples.
</p>


  </div>
</div>
<div class="tags">
  <h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


188
189
190
191
192
193
194</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/metal/mime_responds.rb', line 188</span>

<span class='kw'>def</span> <span class='id respond_to'>respond_to</span><span class='lparen'>(</span><span class='op'>*</span><span class='id mimes'>mimes</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>respond_to takes either types or a block, never both</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id mimes'>mimes</span><span class='period'>.</span><span class='id any?'>any?</span> <span class='op'>&amp;&amp;</span> <span class='id block_given?'>block_given?</span>

  <span class='kw'>if</span> <span class='id response'>response</span> <span class='op'>=</span> <span class='id retrieve_response_from_mimes'>retrieve_response_from_mimes</span><span class='lparen'>(</span><span class='id mimes'>mimes</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
    <span class='id response'>response</span><span class='period'>.</span><span class='id call'>call</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="respond_with-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>respond_with</strong>(*resources, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
respond_with wraps a resource around a responder for default
representation. First it invokes respond_to, if a response cannot be found
(ie. no block for the request was given and template was not available), it
instantiates an ActionController::Responder with the controller and
resource.
</p>
<h4>Example</h4>
<pre class="code">
  <span class='kw'>def</span> <span class='id index'>index</span>
    <span class='ivar'>@users</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id all'>all</span>
    <span class='id respond_with'>respond_with</span><span class='lparen'>(</span><span class='ivar'>@users</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
</pre>
<p>
It also accepts a block to be given. It&#8217;s used to overwrite a default
response:
</p>
<pre class="code">
  <span class='kw'>def</span> <span class='id destroy'>destroy</span>
    <span class='ivar'>@user</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id find'>find</span><span class='lparen'>(</span><span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User was successfully created.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='ivar'>@user</span><span class='period'>.</span><span class='id save'>save</span>

    <span class='id respond_with'>respond_with</span><span class='lparen'>(</span><span class='ivar'>@user</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id format'>format</span><span class='op'>|</span>
      <span class='id format'>format</span><span class='period'>.</span><span class='id html'>html</span> <span class='lbrace'>{</span> <span class='id render'>render</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
</pre>
<p>
All options given to respond_with are sent to the underlying responder,
except for the option :responder itself. Since the responder interface is
quite simple (it just needs to respond to call), you can even give a proc
to it.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


225
226
227
228
229
230
231
232
233
234</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/metal/mime_responds.rb', line 225</span>

<span class='kw'>def</span> <span class='id respond_with'>respond_with</span><span class='lparen'>(</span><span class='op'>*</span><span class='id resources'>resources</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='id raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>In order to use respond_with, first you need to declare the formats your </span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>controller responds to in the class level</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id class'>class</span><span class='period'>.</span><span class='id mimes_for_respond_to'>mimes_for_respond_to</span><span class='period'>.</span><span class='id empty?'>empty?</span>

  <span class='kw'>if</span> <span class='id response'>response</span> <span class='op'>=</span> <span class='id retrieve_response_from_mimes'>retrieve_response_from_mimes</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
    <span class='id options'>options</span> <span class='op'>=</span> <span class='id resources'>resources</span><span class='period'>.</span><span class='id extract_options!'>extract_options!</span>
    <span class='id options'>options</span><span class='period'>.</span><span class='id merge!'>merge!</span><span class='lparen'>(</span><span class='symbol'>:default_response</span> <span class='op'>=&gt;</span> <span class='id response'>response</span><span class='rparen'>)</span>
    <span class='lparen'>(</span><span class='id options'>options</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:responder</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='kw'>self</span><span class='period'>.</span><span class='id class'>class</span><span class='period'>.</span><span class='id responder'>responder</span><span class='rparen'>)</span><span class='period'>.</span><span class='id call'>call</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id resources'>resources</span><span class='comma'>,</span> <span class='id options'>options</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Thu Nov  4 20:04:17 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.1 (ruby-1.9.2).
</div>

  </body>
</html>