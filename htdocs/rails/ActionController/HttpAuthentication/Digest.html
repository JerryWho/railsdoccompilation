<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Module: ActionController::HttpAuthentication::Digest</title>
<link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (D)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../ActionController.html" title="ActionController (module)">ActionController</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../HttpAuthentication.html" title="ActionController::HttpAuthentication (module)">HttpAuthentication</a></span></span>
     &raquo; 
    <span class="title">Digest</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Module: ActionController::HttpAuthentication::Digest
  
  
  
</h1>

<dl class="box">
  
  
    
      <dt class="r1">Extended by:</dt>
      <dd class="r1"><span class='object_link'><a href="" title="ActionController::HttpAuthentication::Digest (module)">Digest</a></span></dd>
      
    
  
    
  
  
    <dt class="r2">Included in:</dt>
    <dd class="r2"><span class='object_link'><a href="" title="ActionController::HttpAuthentication::Digest (module)">Digest</a></span></dd>
    
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">actionpack/lib/action_controller/metal/http_authentication.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Defined Under Namespace</h2>
<p class="children">
   
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="Digest/ControllerMethods.html" title="ActionController::HttpAuthentication::Digest::ControllerMethods (module)">ControllerMethods</a></span>
    
   
    
  
</p>



  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#authenticate-instance_method" title="#authenticate (instance method)">- (Object) <strong>authenticate</strong>(request, realm, &amp;password_procedure) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns false on a valid response, true otherwise.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#authentication_header-instance_method" title="#authentication_header (instance method)">- (Object) <strong>authentication_header</strong>(controller, realm) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#authentication_request-instance_method" title="#authentication_request (instance method)">- (Object) <strong>authentication_request</strong>(controller, realm, message = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#decode_credentials-instance_method" title="#decode_credentials (instance method)">- (Object) <strong>decode_credentials</strong>(header) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#decode_credentials_header-instance_method" title="#decode_credentials_header (instance method)">- (Object) <strong>decode_credentials_header</strong>(request) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#encode_credentials-instance_method" title="#encode_credentials (instance method)">- (Object) <strong>encode_credentials</strong>(http_method, credentials, password, password_is_ha1) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#expected_response-instance_method" title="#expected_response (instance method)">- (Object) <strong>expected_response</strong>(http_method, uri, credentials, password, password_is_ha1 = true) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the expected response for a request of <tt>http_method</tt> to
<tt>uri</tt> with the decoded <tt>credentials</tt> and the expected
<tt>password</tt> Optional parameter <tt>password_is_ha1</tt> is set to
<tt>true</tt> by default, since best practice is to store ha1 digest
instead of a plain-text password.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ha1-instance_method" title="#ha1 (instance method)">- (Object) <strong>ha1</strong>(credentials, password) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#nonce-instance_method" title="#nonce (instance method)">- (Object) <strong>nonce</strong>(secret_key, time = Time.now) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Uses an MD5 digest based on time to generate a value to be used only once.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#opaque-instance_method" title="#opaque (instance method)">- (Object) <strong>opaque</strong>(secret_key) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Opaque based on random generation - but changing each request?.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#secret_token-instance_method" title="#secret_token (instance method)">- (Object) <strong>secret_token</strong>(request) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#validate_digest_response-instance_method" title="#validate_digest_response (instance method)">- (Object) <strong>validate_digest_response</strong>(request, realm, &amp;password_procedure) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns false unless the request credentials response value matches the
expected value.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#validate_nonce-instance_method" title="#validate_nonce (instance method)">- (Object) <strong>validate_nonce</strong>(secret_key, request, value, seconds_to_timeout = 5*60) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Might want a shorter timeout depending on whether the request is a PUT or
POST, and if client is browser or web service.
</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="authenticate-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>authenticate</strong>(request, realm, &amp;password_procedure) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns false on a valid response, true otherwise
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


172
173
174</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/metal/http_authentication.rb', line 172</span>

<span class='kw'>def</span> <span class='id authenticate'>authenticate</span><span class='lparen'>(</span><span class='id request'>request</span><span class='comma'>,</span> <span class='id realm'>realm</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id password_procedure'>password_procedure</span><span class='rparen'>)</span>
  <span class='id request'>request</span><span class='period'>.</span><span class='id authorization'>authorization</span> <span class='op'>&amp;&amp;</span> <span class='id validate_digest_response'>validate_digest_response</span><span class='lparen'>(</span><span class='id request'>request</span><span class='comma'>,</span> <span class='id realm'>realm</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id password_procedure'>password_procedure</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="authentication_header-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>authentication_header</strong>(controller, realm) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


228
229
230
231
232
233</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/metal/http_authentication.rb', line 228</span>

<span class='kw'>def</span> <span class='id authentication_header'>authentication_header</span><span class='lparen'>(</span><span class='id controller'>controller</span><span class='comma'>,</span> <span class='id realm'>realm</span><span class='rparen'>)</span>
  <span class='id secret_key'>secret_key</span> <span class='op'>=</span> <span class='id secret_token'>secret_token</span><span class='lparen'>(</span><span class='id controller'>controller</span><span class='period'>.</span><span class='id request'>request</span><span class='rparen'>)</span>
  <span class='id nonce'>nonce</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id nonce'>nonce</span><span class='lparen'>(</span><span class='id secret_key'>secret_key</span><span class='rparen'>)</span>
  <span class='id opaque'>opaque</span> <span class='op'>=</span> <span class='id opaque'>opaque</span><span class='lparen'>(</span><span class='id secret_key'>secret_key</span><span class='rparen'>)</span>
  <span class='id controller'>controller</span><span class='period'>.</span><span class='id headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>WWW-Authenticate</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>%(</span><span class='tstring_content'>Digest realm=&quot;</span><span class='embexpr_beg'>#{</span><span class='id realm'>realm</span><span class='rbrace'>}</span><span class='tstring_content'>&quot;, qop=&quot;auth&quot;, algorithm=MD5, nonce=&quot;</span><span class='embexpr_beg'>#{</span><span class='id nonce'>nonce</span><span class='rbrace'>}</span><span class='tstring_content'>&quot;, opaque=&quot;</span><span class='embexpr_beg'>#{</span><span class='id opaque'>opaque</span><span class='rbrace'>}</span><span class='tstring_content'>&quot;</span><span class='tstring_end'>)</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="authentication_request-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>authentication_request</strong>(controller, realm, message = nil) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


235
236
237
238
239
240</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/metal/http_authentication.rb', line 235</span>

<span class='kw'>def</span> <span class='id authentication_request'>authentication_request</span><span class='lparen'>(</span><span class='id controller'>controller</span><span class='comma'>,</span> <span class='id realm'>realm</span><span class='comma'>,</span> <span class='id message'>message</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id message'>message</span> <span class='op'>||=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HTTP Digest: Access denied.\n</span><span class='tstring_end'>&quot;</span></span>
  <span class='id authentication_header'>authentication_header</span><span class='lparen'>(</span><span class='id controller'>controller</span><span class='comma'>,</span> <span class='id realm'>realm</span><span class='rparen'>)</span>
  <span class='id controller'>controller</span><span class='period'>.</span><span class='id response_body'>response_body</span> <span class='op'>=</span> <span class='id message'>message</span>
  <span class='id controller'>controller</span><span class='period'>.</span><span class='id status'>status</span> <span class='op'>=</span> <span class='int'>401</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="decode_credentials-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>decode_credentials</strong>(header) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


220
221
222
223
224
225
226</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/metal/http_authentication.rb', line 220</span>

<span class='kw'>def</span> <span class='id decode_credentials'>decode_credentials</span><span class='lparen'>(</span><span class='id header'>header</span><span class='rparen'>)</span>
  <span class='id header'>header</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='period'>.</span><span class='id gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^Digest\s+</span><span class='regexp_end'>/</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>,</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id inject'>inject</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id hash'>hash</span><span class='comma'>,</span> <span class='id pair'>pair</span><span class='op'>|</span>
    <span class='id key'>key</span><span class='comma'>,</span> <span class='id value'>value</span> <span class='op'>=</span> <span class='id pair'>pair</span><span class='period'>.</span><span class='id split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>=</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='int'>2</span><span class='rparen'>)</span>
    <span class='id hash'>hash</span><span class='lbracket'>[</span><span class='id key'>key</span><span class='period'>.</span><span class='id strip'>strip</span><span class='period'>.</span><span class='id to_sym'>to_sym</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id value'>value</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='period'>.</span><span class='id gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^&quot;|&quot;$</span><span class='regexp_end'>/</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>'</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
    <span class='id hash'>hash</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="decode_credentials_header-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>decode_credentials_header</strong>(request) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


216
217
218</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/metal/http_authentication.rb', line 216</span>

<span class='kw'>def</span> <span class='id decode_credentials_header'>decode_credentials_header</span><span class='lparen'>(</span><span class='id request'>request</span><span class='rparen'>)</span>
  <span class='id decode_credentials'>decode_credentials</span><span class='lparen'>(</span><span class='id request'>request</span><span class='period'>.</span><span class='id authorization'>authorization</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="encode_credentials-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>encode_credentials</strong>(http_method, credentials, password, password_is_ha1) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


211
212
213
214</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/metal/http_authentication.rb', line 211</span>

<span class='kw'>def</span> <span class='id encode_credentials'>encode_credentials</span><span class='lparen'>(</span><span class='id http_method'>http_method</span><span class='comma'>,</span> <span class='id credentials'>credentials</span><span class='comma'>,</span> <span class='id password'>password</span><span class='comma'>,</span> <span class='id password_is_ha1'>password_is_ha1</span><span class='rparen'>)</span>
  <span class='id credentials'>credentials</span><span class='lbracket'>[</span><span class='symbol'>:response</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id expected_response'>expected_response</span><span class='lparen'>(</span><span class='id http_method'>http_method</span><span class='comma'>,</span> <span class='id credentials'>credentials</span><span class='lbracket'>[</span><span class='symbol'>:uri</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id credentials'>credentials</span><span class='comma'>,</span> <span class='id password'>password</span><span class='comma'>,</span> <span class='id password_is_ha1'>password_is_ha1</span><span class='rparen'>)</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Digest </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id credentials'>credentials</span><span class='period'>.</span><span class='id sort_by'>sort_by</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id x'>x</span><span class='op'>|</span> <span class='id x'>x</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id to_s'>to_s</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id inject'>inject</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id a'>a</span><span class='comma'>,</span> <span class='id v'>v</span><span class='op'>|</span> <span class='id a'>a</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id v'>v</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'>='</span><span class='embexpr_beg'>#{</span><span class='id v'>v</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>, </span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="expected_response-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>expected_response</strong>(http_method, uri, credentials, password, password_is_ha1 = true) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the expected response for a request of <tt>http_method</tt> to
<tt>uri</tt> with the decoded <tt>credentials</tt> and the expected
<tt>password</tt> Optional parameter <tt>password_is_ha1</tt> is set to
<tt>true</tt> by default, since best practice is to store ha1 digest
instead of a plain-text password.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


201
202
203
204
205</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/metal/http_authentication.rb', line 201</span>

<span class='kw'>def</span> <span class='id expected_response'>expected_response</span><span class='lparen'>(</span><span class='id http_method'>http_method</span><span class='comma'>,</span> <span class='id uri'>uri</span><span class='comma'>,</span> <span class='id credentials'>credentials</span><span class='comma'>,</span> <span class='id password'>password</span><span class='comma'>,</span> <span class='id password_is_ha1'>password_is_ha1</span><span class='op'>=</span><span class='kw'>true</span><span class='rparen'>)</span>
  <span class='id ha1'>ha1</span> <span class='op'>=</span> <span class='id password_is_ha1'>password_is_ha1</span> <span class='op'>?</span> <span class='id password'>password</span> <span class='op'>:</span> <span class='id ha1'>ha1</span><span class='lparen'>(</span><span class='id credentials'>credentials</span><span class='comma'>,</span> <span class='id password'>password</span><span class='rparen'>)</span>
  <span class='id ha2'>ha2</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>Digest</span><span class='op'>::</span><span class='const'>MD5</span><span class='period'>.</span><span class='id hexdigest'>hexdigest</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id http_method'>http_method</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='period'>.</span><span class='id upcase'>upcase</span><span class='comma'>,</span> <span class='id uri'>uri</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>:</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='op'>::</span><span class='const'>Digest</span><span class='op'>::</span><span class='const'>MD5</span><span class='period'>.</span><span class='id hexdigest'>hexdigest</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id ha1'>ha1</span><span class='comma'>,</span> <span class='id credentials'>credentials</span><span class='lbracket'>[</span><span class='symbol'>:nonce</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id credentials'>credentials</span><span class='lbracket'>[</span><span class='symbol'>:nc</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id credentials'>credentials</span><span class='lbracket'>[</span><span class='symbol'>:cnonce</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id credentials'>credentials</span><span class='lbracket'>[</span><span class='symbol'>:qop</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id ha2'>ha2</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>:</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="ha1-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>ha1</strong>(credentials, password) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


207
208
209</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/metal/http_authentication.rb', line 207</span>

<span class='kw'>def</span> <span class='id ha1'>ha1</span><span class='lparen'>(</span><span class='id credentials'>credentials</span><span class='comma'>,</span> <span class='id password'>password</span><span class='rparen'>)</span>
  <span class='op'>::</span><span class='const'>Digest</span><span class='op'>::</span><span class='const'>MD5</span><span class='period'>.</span><span class='id hexdigest'>hexdigest</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id credentials'>credentials</span><span class='lbracket'>[</span><span class='symbol'>:username</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id credentials'>credentials</span><span class='lbracket'>[</span><span class='symbol'>:realm</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id password'>password</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>:</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="nonce-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>nonce</strong>(secret_key, time = Time.now) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Uses an MD5 digest based on time to generate a value to be used only once.
</p>
<p>
A server-specified data string which should be uniquely generated each time
a 401 response is made. It is recommended that this string be base64 or
hexadecimal data. Specifically, since the string is passed in the header
lines as a quoted string, the double-quote character is not allowed.
</p>
<p>
The contents of the nonce are implementation dependent. The quality of the
implementation depends on a good choice. A nonce might, for example, be
constructed as the base 64 encoding of
</p>
<h1>> time-stamp H(time-stamp &#8220;:&#8221; ETag &#8220;:&#8221; private-key)</h1>
<p>
where time-stamp is a server-generated time or other non-repeating value,
ETag is the value of the HTTP ETag header associated with the requested
entity, and private-key is data known only to the server. With a nonce of
this form a server would recalculate the hash portion after receiving the
client authentication header and reject the request if it did not match the
nonce from that header or if the time-stamp value is not recent enough. In
this way the server can limit the time of the nonce&#8217;s validity. The
inclusion of the ETag prevents a replay request for an updated version of
the resource. (Note: including the IP address of the client in the nonce
would appear to offer the server the ability to limit the reuse of the
nonce to the same client that originally got it. However, that would break
proxy farms, where requests from a single user often go through different
proxies in the farm. Also, IP address spoofing is not that hard.)
</p>
<p>
An implementation might choose not to accept a previously used nonce or a
previously used digest, in order to protect against a replay attack. Or, an
implementation might choose to use one-time nonces or digests for POST or
PUT requests and a time-stamp for GET requests. For more details on the
issues involved see Section 4 of this document.
</p>
<p>
The nonce is opaque to the client. Composed of Time, and hash of Time with
secret key from the Rails session secret generated upon creation of
project. Ensures the time cannot be modified by client.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


280
281
282
283
284
285</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/metal/http_authentication.rb', line 280</span>

<span class='kw'>def</span> <span class='id nonce'>nonce</span><span class='lparen'>(</span><span class='id secret_key'>secret_key</span><span class='comma'>,</span> <span class='id time'>time</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id now'>now</span><span class='rparen'>)</span>
  <span class='id t'>t</span> <span class='op'>=</span> <span class='id time'>time</span><span class='period'>.</span><span class='id to_i'>to_i</span>
  <span class='id hashed'>hashed</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id t'>t</span><span class='comma'>,</span> <span class='id secret_key'>secret_key</span><span class='rbracket'>]</span>
  <span class='id digest'>digest</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>Digest</span><span class='op'>::</span><span class='const'>MD5</span><span class='period'>.</span><span class='id hexdigest'>hexdigest</span><span class='lparen'>(</span><span class='id hashed'>hashed</span><span class='period'>.</span><span class='id join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='const'>ActiveSupport</span><span class='op'>::</span><span class='const'>Base64</span><span class='period'>.</span><span class='id encode64'>encode64</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id t'>t</span><span class='rbrace'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id digest'>digest</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="opaque-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>opaque</strong>(secret_key) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Opaque based on random generation - but changing each request?
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


298
299
300</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/metal/http_authentication.rb', line 298</span>

<span class='kw'>def</span> <span class='id opaque'>opaque</span><span class='lparen'>(</span><span class='id secret_key'>secret_key</span><span class='rparen'>)</span>
  <span class='op'>::</span><span class='const'>Digest</span><span class='op'>::</span><span class='const'>MD5</span><span class='period'>.</span><span class='id hexdigest'>hexdigest</span><span class='lparen'>(</span><span class='id secret_key'>secret_key</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="secret_token-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>secret_token</strong>(request) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


242
243
244
245
246</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/metal/http_authentication.rb', line 242</span>

<span class='kw'>def</span> <span class='id secret_token'>secret_token</span><span class='lparen'>(</span><span class='id request'>request</span><span class='rparen'>)</span>
  <span class='id secret'>secret</span> <span class='op'>=</span> <span class='id request'>request</span><span class='period'>.</span><span class='id env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>action_dispatch.secret_token</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='id raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You must set config.secret_token in your app's config</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id secret'>secret</span><span class='period'>.</span><span class='id blank?'>blank?</span>
  <span class='id secret'>secret</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="validate_digest_response-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>validate_digest_response</strong>(request, realm, &amp;password_procedure) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns false unless the request credentials response value matches the
expected value. First try the password as a ha1 digest password. If this
fails, then try it as a plain text password.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/metal/http_authentication.rb', line 179</span>

<span class='kw'>def</span> <span class='id validate_digest_response'>validate_digest_response</span><span class='lparen'>(</span><span class='id request'>request</span><span class='comma'>,</span> <span class='id realm'>realm</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id password_procedure'>password_procedure</span><span class='rparen'>)</span>
  <span class='id secret_key'>secret_key</span>  <span class='op'>=</span> <span class='id secret_token'>secret_token</span><span class='lparen'>(</span><span class='id request'>request</span><span class='rparen'>)</span>
  <span class='id credentials'>credentials</span> <span class='op'>=</span> <span class='id decode_credentials_header'>decode_credentials_header</span><span class='lparen'>(</span><span class='id request'>request</span><span class='rparen'>)</span>
  <span class='id valid_nonce'>valid_nonce</span> <span class='op'>=</span> <span class='id validate_nonce'>validate_nonce</span><span class='lparen'>(</span><span class='id secret_key'>secret_key</span><span class='comma'>,</span> <span class='id request'>request</span><span class='comma'>,</span> <span class='id credentials'>credentials</span><span class='lbracket'>[</span><span class='symbol'>:nonce</span><span class='rbracket'>]</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id valid_nonce'>valid_nonce</span> <span class='op'>&amp;&amp;</span> <span class='id realm'>realm</span> <span class='op'>==</span> <span class='id credentials'>credentials</span><span class='lbracket'>[</span><span class='symbol'>:realm</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id opaque'>opaque</span><span class='lparen'>(</span><span class='id secret_key'>secret_key</span><span class='rparen'>)</span> <span class='op'>==</span> <span class='id credentials'>credentials</span><span class='lbracket'>[</span><span class='symbol'>:opaque</span><span class='rbracket'>]</span>
    <span class='id password'>password</span> <span class='op'>=</span> <span class='id password_procedure'>password_procedure</span><span class='period'>.</span><span class='id call'>call</span><span class='lparen'>(</span><span class='id credentials'>credentials</span><span class='lbracket'>[</span><span class='symbol'>:username</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='id password'>password</span>

    <span class='id method'>method</span> <span class='op'>=</span> <span class='id request'>request</span><span class='period'>.</span><span class='id env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>rack.methodoverride.original_method</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id request'>request</span><span class='period'>.</span><span class='id env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>REQUEST_METHOD</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
    <span class='id uri'>uri</span>    <span class='op'>=</span> <span class='id credentials'>credentials</span><span class='lbracket'>[</span><span class='symbol'>:uri</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span> <span class='op'>?</span> <span class='id request'>request</span><span class='period'>.</span><span class='id fullpath'>fullpath</span> <span class='op'>:</span> <span class='id request'>request</span><span class='period'>.</span><span class='id url'>url</span>

   <span class='lbracket'>[</span><span class='kw'>true</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id any?'>any?</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id password_is_ha1'>password_is_ha1</span><span class='op'>|</span>
     <span class='id expected'>expected</span> <span class='op'>=</span> <span class='id expected_response'>expected_response</span><span class='lparen'>(</span><span class='id method'>method</span><span class='comma'>,</span> <span class='id uri'>uri</span><span class='comma'>,</span> <span class='id credentials'>credentials</span><span class='comma'>,</span> <span class='id password'>password</span><span class='comma'>,</span> <span class='id password_is_ha1'>password_is_ha1</span><span class='rparen'>)</span>
     <span class='id expected'>expected</span> <span class='op'>==</span> <span class='id credentials'>credentials</span><span class='lbracket'>[</span><span class='symbol'>:response</span><span class='rbracket'>]</span>
   <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="validate_nonce-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>validate_nonce</strong>(secret_key, request, value, seconds_to_timeout = 5*60) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Might want a shorter timeout depending on whether the request is a PUT or
POST, and if client is browser or web service. Can be much shorter if the
Stale directive is implemented. This would allow a user to use new nonce
without prompting user again for their username and password.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


292
293
294
295</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/metal/http_authentication.rb', line 292</span>

<span class='kw'>def</span> <span class='id validate_nonce'>validate_nonce</span><span class='lparen'>(</span><span class='id secret_key'>secret_key</span><span class='comma'>,</span> <span class='id request'>request</span><span class='comma'>,</span> <span class='id value'>value</span><span class='comma'>,</span> <span class='id seconds_to_timeout'>seconds_to_timeout</span><span class='op'>=</span><span class='int'>5</span><span class='op'>*</span><span class='int'>60</span><span class='rparen'>)</span>
  <span class='id t'>t</span> <span class='op'>=</span> <span class='const'>ActiveSupport</span><span class='op'>::</span><span class='const'>Base64</span><span class='period'>.</span><span class='id decode64'>decode64</span><span class='lparen'>(</span><span class='id value'>value</span><span class='rparen'>)</span><span class='period'>.</span><span class='id split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>:</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id first'>first</span><span class='period'>.</span><span class='id to_i'>to_i</span>
  <span class='id nonce'>nonce</span><span class='lparen'>(</span><span class='id secret_key'>secret_key</span><span class='comma'>,</span> <span class='id t'>t</span><span class='rparen'>)</span> <span class='op'>==</span> <span class='id value'>value</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id t'>t</span> <span class='op'>-</span> <span class='const'>Time</span><span class='period'>.</span><span class='id now'>now</span><span class='period'>.</span><span class='id to_i'>to_i</span><span class='rparen'>)</span><span class='period'>.</span><span class='id abs'>abs</span> <span class='op'>&lt;=</span> <span class='id seconds_to_timeout'>seconds_to_timeout</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Thu Nov  4 20:04:23 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.1 (ruby-1.9.2).
</div>

  </body>
</html>