  <div id="fileHeader">
    <h1>state_transition_test.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>activemodel/test/state_machine/state_transition_test.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sun Jul 25 11:32:53 +0200 2010</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require 'test_helper'

class StateTransitionTest &lt; ActiveModel::TestCase
  test 'should set from, to, and opts attr readers' do
    opts = {:from =&gt; 'foo', :to =&gt; 'bar', :guard =&gt; 'g'}
    st = ActiveModel::StateMachine::StateTransition.new(opts)

    assert_equal opts[:from], st.from
    assert_equal opts[:to],   st.to
    assert_equal opts,        st.options
  end

  test 'should pass equality check if from and to are the same' do
    opts = {:from =&gt; 'foo', :to =&gt; 'bar', :guard =&gt; 'g'}
    st = ActiveModel::StateMachine::StateTransition.new(opts)

    obj = stub
    obj.stubs(:from).returns(opts[:from])
    obj.stubs(:to).returns(opts[:to])

    assert_equal st, obj
  end

  test 'should fail equality check if from are not the same' do
    opts = {:from =&gt; 'foo', :to =&gt; 'bar', :guard =&gt; 'g'}
    st = ActiveModel::StateMachine::StateTransition.new(opts)

    obj = stub
    obj.stubs(:from).returns('blah')
    obj.stubs(:to).returns(opts[:to])

    assert_not_equal st, obj
  end

  test 'should fail equality check if to are not the same' do
    opts = {:from =&gt; 'foo', :to =&gt; 'bar', :guard =&gt; 'g'}
    st = ActiveModel::StateMachine::StateTransition.new(opts)

    obj = stub
    obj.stubs(:from).returns(opts[:from])
    obj.stubs(:to).returns('blah')

    assert_not_equal st, obj
  end
end

class StateTransitionGuardCheckTest &lt; ActiveModel::TestCase
  test 'should return true of there is no guard' do
    opts = {:from =&gt; 'foo', :to =&gt; 'bar'}
      st = ActiveModel::StateMachine::StateTransition.new(opts)

    assert st.perform(nil)
  end

  test 'should call the method on the object if guard is a symbol' do
    opts = {:from =&gt; 'foo', :to =&gt; 'bar', :guard =&gt; :test_guard}
    st = ActiveModel::StateMachine::StateTransition.new(opts)
  
    obj = stub
    obj.expects(:test_guard)
    
    st.perform(obj)
  end
  
  test 'should call the method on the object if guard is a string' do
    opts = {:from =&gt; 'foo', :to =&gt; 'bar', :guard =&gt; 'test_guard'}
    st = ActiveModel::StateMachine::StateTransition.new(opts)
  
    obj = stub
    obj.expects(:test_guard)
    
    st.perform(obj)
  end
  
  test 'should call the proc passing the object if the guard is a proc' do
    opts = {:from =&gt; 'foo', :to =&gt; 'bar', :guard =&gt; Proc.new {|o| o.test_guard}}
    st = ActiveModel::StateMachine::StateTransition.new(opts)
  
    obj = stub
    obj.expects(:test_guard)
  
    st.perform(obj)
  end
end
</pre>
    </div>