  <div id="fileHeader">
    <h1>event_test.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>activemodel/test/state_machine/event_test.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Fri Nov 27 16:38:16 +0100 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require 'test_helper'

class EventTest &lt; ActiveModel::TestCase
  def setup
    @state_name = :close_order
    @success = :success_callback
  end

  def new_event
    @event = ActiveModel::StateMachine::Event.new(nil, @state_name, {:success =&gt; @success}) do
      transitions :to =&gt; :closed, :from =&gt; [:open, :received]
    end
  end

  test 'should set the name' do
    assert_equal @state_name, new_event.name
  end

  test 'should set the success option' do
    assert_equal @success, new_event.success
  end

  test 'should create StateTransitions' do
    ActiveModel::StateMachine::StateTransition.expects(:new).with(:to =&gt; :closed, :from =&gt; :open)
    ActiveModel::StateMachine::StateTransition.expects(:new).with(:to =&gt; :closed, :from =&gt; :received)
    new_event
  end
end

class EventBeingFiredTest &lt; ActiveModel::TestCase
  test 'should raise an AASM::InvalidTransition error if the transitions are empty' do
    event = ActiveModel::StateMachine::Event.new(nil, :event)

    assert_raise ActiveModel::StateMachine::InvalidTransition do
      event.fire(nil)
    end
  end

  test 'should return the state of the first matching transition it finds' do
    event = ActiveModel::StateMachine::Event.new(nil, :event) do
      transitions :to =&gt; :closed, :from =&gt; [:open, :received]
    end

    obj = stub
    obj.stubs(:current_state).returns(:open)

    assert_equal :closed, event.fire(obj)
  end
end
</pre>
    </div>