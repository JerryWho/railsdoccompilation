  <div id="fileHeader">
    <h1>state_test.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>activemodel/test/state_machine/state_test.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sun Jul 25 11:32:53 +0200 2010</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require 'test_helper'

class StateTestSubject
  include ActiveModel::StateMachine

  state_machine do
  end
end

class StateTest &lt; ActiveModel::TestCase
  def setup
    @state_name = :astate
    @machine = StateTestSubject.state_machine
    @options = { :crazy_custom_key =&gt; 'key', :machine =&gt; @machine }
  end

  def new_state(options={})
    ActiveModel::StateMachine::State.new(@state_name, @options.merge(options))
  end

  test 'sets the name' do
    assert_equal :astate, new_state.name
  end

  test 'sets the display_name from name' do
    assert_equal &quot;Astate&quot;, new_state.display_name
  end

  test 'sets the display_name from options' do
    assert_equal &quot;A State&quot;, new_state(:display =&gt; &quot;A State&quot;).display_name
  end
  
  test 'sets the options and expose them as options' do
    @options.delete(:machine)
    assert_equal @options, new_state.options
  end

  test 'equals a symbol of the same name' do
    assert_equal new_state, :astate
  end

  test 'equals a State of the same name' do
    assert_equal new_state, new_state
  end

  test 'should send a message to the record for an action if the action is present as a symbol' do
    state = new_state(:entering =&gt; :foo)

    record = stub
    record.expects(:foo)

    state.call_action(:entering, record)
  end

  test 'should send a message to the record for an action if the action is present as a string' do
    state = new_state(:entering =&gt; 'foo')

    record = stub
    record.expects(:foo)

    state.call_action(:entering, record)
  end

  test 'should call a proc, passing in the record for an action if the action is present' do
    state = new_state(:entering =&gt; Proc.new {|r| r.foobar})

    record = stub
    record.expects(:foobar)
  
    state.call_action(:entering, record)
  end
end
</pre>
    </div>