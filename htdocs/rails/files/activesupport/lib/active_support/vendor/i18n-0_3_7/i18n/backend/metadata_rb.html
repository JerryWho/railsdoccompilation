  <div id="fileHeader">
    <h1>metadata.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>activesupport/lib/active_support/vendor/i18n-0.3.7/i18n/backend/metadata.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sun Jul 25 11:32:53 +0200 2010</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre># I18n translation metadata is useful when you want to access information
# about how a translation was looked up, pluralized or interpolated in
# your application.
#
#   msg = I18n.t(:message, :default =&gt; 'Hi!', :scope =&gt; :foo)
#   msg.translation_metadata
#   # =&gt; { :key =&gt; :message, :scope =&gt; :foo, :default =&gt; 'Hi!' }
#
# If a :count option was passed to #translate it will be set to the metadata.
# Likewise, if any interpolation variables were passed they will also be set.
#
# To enable translation metadata you can simply include the Metadata module
# into the Simple backend class - or whatever other backend you are using:
#
#   I18n::Backend::Simple.send(:include, I18n::Backend::Metadata)

require 'i18n/core_ext/object/meta_class'

module I18n
  module Backend
    module Metadata
      class &lt;&lt; self
        def included(base)
          Object.class_eval do
            def translation_metadata
              @translation_metadata ||= {}
            end

            def translation_metadata=(translation_metadata)
              @translation_metadata = translation_metadata
            end
          end
        end
      end

      def translate(locale, key, options = {})
        metadata = {
          :locale    =&gt; locale,
          :key       =&gt; key,
          :scope     =&gt; options[:scope],
          :default   =&gt; options[:default],
          :separator =&gt; options[:separator],
          :values    =&gt; options.reject { |name, value| Base::RESERVED_KEYS.include?(name) }
        }
        with_metadata(metadata) { super }
      end

      def interpolate(locale, string, values = {})
        with_metadata(:original =&gt; string) do
          preserve_translation_metadata(string) { super }
        end if string
      end

      def pluralize(locale, entry, count)
        with_metadata(:count =&gt; count) { super }
      end

      protected

        def with_metadata(metadata, &amp;block)
          result = yield
          result.translation_metadata = result.translation_metadata.merge(metadata) if result
          result
        end

        def preserve_translation_metadata(object, &amp;block)
          result = yield
          result.translation_metadata = object.translation_metadata if result
          result
        end
    end
  end
end
</pre>
    </div>