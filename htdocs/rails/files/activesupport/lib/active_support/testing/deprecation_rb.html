  <div id="fileHeader">
    <h1>deprecation.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>activesupport/lib/active_support/testing/deprecation.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sun Jul 25 11:32:53 +0200 2010</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require &quot;active_support/core_ext/module&quot;

module ActiveSupport
  module Testing
    module Deprecation #:nodoc:
      def assert_deprecated(match = nil, &amp;block)
        result, warnings = collect_deprecations(&amp;block)
        assert !warnings.empty?, &quot;Expected a deprecation warning within the block but received none&quot;
        if match
          match = Regexp.new(Regexp.escape(match)) unless match.is_a?(Regexp)
          assert warnings.any? { |w| w =~ match }, &quot;No deprecation warning matched #{match}: #{warnings.join(', ')}&quot;
        end
        result
      end

      def assert_not_deprecated(&amp;block)
        result, deprecations = collect_deprecations(&amp;block)
        assert deprecations.empty?, &quot;Expected no deprecation warning within the block but received #{deprecations.size}: \n  #{deprecations * &quot;\n  &quot;}&quot;
        result
      end

      private
        def collect_deprecations
          old_behavior = ActiveSupport::Deprecation.behavior
          deprecations = []
          ActiveSupport::Deprecation.behavior = Proc.new do |message, callstack|
            deprecations &lt;&lt; message
          end
          result = yield
          [result, deprecations]
        ensure
          ActiveSupport::Deprecation.behavior = old_behavior
        end
    end
  end
end

begin
  require 'test/unit/error'

  module Test
    module Unit
      class Error # :nodoc:
        # Silence warnings when reporting test errors.
        def message_with_silenced_deprecation
          ActiveSupport::Deprecation.silence do
            message_without_silenced_deprecation
          end
        end

        alias_method_chain :message, :silenced_deprecation
      end
    end
  end
rescue LoadError
  # Using miniunit, ignore.
end
</pre>
    </div>