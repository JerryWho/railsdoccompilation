  <div id="fileHeader">
    <h1>clean_backtrace_test.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>activesupport/test/clean_backtrace_test.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Oct 12 14:59:08 +0200 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require 'abstract_unit'

class BacktraceCleanerFilterTest &lt; ActiveSupport::TestCase
  def setup
    @bc = ActiveSupport::BacktraceCleaner.new
    @bc.add_filter { |line| line.gsub(&quot;/my/prefix&quot;, '') }
  end
  
  test &quot;backtrace should not contain prefix when it has been filtered out&quot; do
    assert_equal &quot;/my/class.rb&quot;, @bc.clean([ &quot;/my/prefix/my/class.rb&quot; ]).first
  end
  
  test &quot;backtrace should contain unaltered lines if they dont match a filter&quot; do
    assert_equal &quot;/my/other_prefix/my/class.rb&quot;, @bc.clean([ &quot;/my/other_prefix/my/class.rb&quot; ]).first
  end
  
  test &quot;backtrace should filter all lines in a backtrace&quot; do
    assert_equal \
      [&quot;/my/class.rb&quot;, &quot;/my/module.rb&quot;], 
      @bc.clean([ &quot;/my/prefix/my/class.rb&quot;, &quot;/my/prefix/my/module.rb&quot; ])
  end
end

class BacktraceCleanerSilencerTest &lt; ActiveSupport::TestCase
  def setup
    @bc = ActiveSupport::BacktraceCleaner.new
    @bc.add_silencer { |line| line =~ /mongrel/ }
  end
  
  test &quot;backtrace should not contain lines that match the silencer&quot; do
    assert_equal \
      [ &quot;/other/class.rb&quot; ], 
      @bc.clean([ &quot;/mongrel/class.rb&quot;, &quot;/other/class.rb&quot;, &quot;/mongrel/stuff.rb&quot; ])
  end
end

class BacktraceCleanerFilterAndSilencerTest &lt; ActiveSupport::TestCase
  def setup
    @bc = ActiveSupport::BacktraceCleaner.new
    @bc.add_filter   { |line| line.gsub(&quot;/mongrel&quot;, &quot;&quot;) }
    @bc.add_silencer { |line| line =~ /mongrel/ }
  end
  
  test &quot;backtrace should not silence lines that has first had their silence hook filtered out&quot; do
    assert_equal [ &quot;/class.rb&quot; ], @bc.clean([ &quot;/mongrel/class.rb&quot; ])
  end
end</pre>
    </div>