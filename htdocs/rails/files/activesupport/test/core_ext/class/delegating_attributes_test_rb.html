  <div id="fileHeader">
    <h1>delegating_attributes_test.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>activesupport/test/core_ext/class/delegating_attributes_test.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Oct 12 19:55:10 +0200 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require 'abstract_unit'

module DelegatingFixtures
  class Parent
  end

  class Child &lt; Parent
    superclass_delegating_accessor :some_attribute
  end

  class Mokopuna &lt; Child
  end
end

class DelegatingAttributesTest &lt; Test::Unit::TestCase
  include DelegatingFixtures
  attr_reader :single_class

  def setup
    @single_class = Class.new(Object)
  end

  def test_simple_reader_declaration
    single_class.superclass_delegating_reader   :only_reader
    # The class and instance should have an accessor, but there
    # should be no mutator
    assert single_class.respond_to?(:only_reader)
    assert single_class.respond_to?(:only_reader?)
    assert single_class.public_instance_methods.map(&amp;:to_s).include?(&quot;only_reader&quot;)
    assert single_class.public_instance_methods.map(&amp;:to_s).include?(&quot;only_reader?&quot;)
    assert !single_class.respond_to?(:only_reader=)
  end

  def test_simple_writer_declaration
    single_class.superclass_delegating_writer   :only_writer
    # The class should have a mutator, the instances shouldn't
    # neither should have an accessor
    assert single_class.respond_to?(:only_writer=)
    assert !single_class.public_instance_methods.include?(&quot;only_writer=&quot;)
    assert !single_class.public_instance_methods.include?(&quot;only_writer&quot;)
    assert !single_class.respond_to?(:only_writer)
  end

  def test_simple_accessor_declaration
    single_class.superclass_delegating_accessor :both
    # Class should have accessor and mutator
    # the instance should have an accessor only
    assert single_class.respond_to?(:both)
    assert single_class.respond_to?(:both=)
    assert single_class.public_instance_methods.map(&amp;:to_s).include?(&quot;both&quot;)
    assert !single_class.public_instance_methods.map(&amp;:to_s).include?(&quot;both=&quot;)
  end

  def test_working_with_simple_attributes
    single_class.superclass_delegating_accessor :both

    single_class.both = &quot;HMMM&quot;

    assert_equal &quot;HMMM&quot;, single_class.both
    assert_equal true, single_class.both?

    assert_equal &quot;HMMM&quot;, single_class.new.both
    assert_equal true, single_class.new.both?

    single_class.both = false
    assert_equal false, single_class.both?
  end

  def test_working_with_accessors
    single_class.superclass_delegating_reader   :only_reader
    single_class.instance_variable_set(&quot;@only_reader&quot;, &quot;reading only&quot;)
    assert_equal &quot;reading only&quot;, single_class.only_reader
    assert_equal &quot;reading only&quot;, single_class.new.only_reader
  end

  def test_working_with_simple_mutators
    single_class.superclass_delegating_writer   :only_writer
    single_class.only_writer=&quot;written&quot;
    assert_equal &quot;written&quot;, single_class.instance_variable_get(&quot;@only_writer&quot;)
  end

  def test_child_class_delegates_to_parent_but_can_be_overridden
    parent = Class.new
    parent.superclass_delegating_accessor :both
    child = Class.new(parent)
    parent.both = &quot;1&quot;
    assert_equal &quot;1&quot;, child.both

    child.both = &quot;2&quot;
    assert_equal &quot;1&quot;, parent.both
    assert_equal &quot;2&quot;, child.both

    parent.both = &quot;3&quot;
    assert_equal &quot;3&quot;, parent.both
    assert_equal &quot;2&quot;, child.both
  end

  def test_delegation_stops_at_the_right_level
    assert_nil Mokopuna.some_attribute
    assert_nil Child.some_attribute
    Child.some_attribute=&quot;1&quot;
    assert_equal &quot;1&quot;, Mokopuna.some_attribute
  ensure
    Child.some_attribute=nil
  end
  
  def test_delegation_stops_for_nil
    Mokopuna.some_attribute = nil
    Child.some_attribute=&quot;1&quot;
    
    assert_equal &quot;1&quot;, Child.some_attribute
    assert_nil Mokopuna.some_attribute
  end

end
</pre>
    </div>