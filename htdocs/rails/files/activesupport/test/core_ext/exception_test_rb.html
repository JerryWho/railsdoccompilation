  <div id="fileHeader">
    <h1>exception_test.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>activesupport/test/core_ext/exception_test.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sun Jul 25 11:32:54 +0200 2010</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require 'abstract_unit'

class ExceptionExtTests &lt; Test::Unit::TestCase

  def get_exception(cls = RuntimeError, msg = nil, trace = nil)
    begin raise cls, msg, (trace || caller)
    rescue Exception =&gt; e  # passed Exception
      return e
    end
  end

  def setup
    Exception::TraceSubstitutions.clear
  end

  def test_clean_backtrace
    Exception::TraceSubstitutions &lt;&lt; [/\s*hidden.*/, '']
    e = get_exception RuntimeError, 'RAWR', ['bhal.rb', 'rawh hid den stuff is not here', 'almost all']
    assert_kind_of Exception, e
    assert_equal ['bhal.rb', 'rawh hid den stuff is not here', 'almost all'], e.clean_backtrace
  end

  def test_app_backtrace
    Exception::TraceSubstitutions &lt;&lt; [/\s*hidden.*/, '']
    e = get_exception RuntimeError, 'RAWR', ['bhal.rb', ' vendor/file.rb some stuff', 'almost all']
    assert_kind_of Exception, e
    assert_equal ['bhal.rb', 'almost all'], e.application_backtrace
  end

  def test_app_backtrace_with_before
    Exception::TraceSubstitutions &lt;&lt; [/\s*hidden.*/, '']
    e = get_exception RuntimeError, 'RAWR', ['vendor/file.rb some stuff', 'bhal.rb', ' vendor/file.rb some stuff', 'almost all']
    assert_kind_of Exception, e
    assert_equal ['vendor/file.rb some stuff', 'bhal.rb', 'almost all'], e.application_backtrace
  end

  def test_framework_backtrace_with_before
    Exception::TraceSubstitutions &lt;&lt; [/\s*hidden.*/, '']
    e = get_exception RuntimeError, 'RAWR', ['vendor/file.rb some stuff', 'bhal.rb', ' vendor/file.rb some stuff', 'almost all']
    assert_kind_of Exception, e
    assert_equal ['vendor/file.rb some stuff', ' vendor/file.rb some stuff'], e.framework_backtrace
  end

  def test_backtrace_should_clean_paths
    Exception::TraceSubstitutions &lt;&lt; [/\s*hidden.*/, '']
    e = get_exception RuntimeError, 'RAWR', ['a/b/c/../d/../../../bhal.rb', 'rawh hid den stuff is not here', 'almost all']
    assert_kind_of Exception, e
    assert_equal ['bhal.rb', 'rawh hid den stuff is not here', 'almost all'], e.clean_backtrace
  end

  def test_clean_message_should_clean_paths
    Exception::TraceSubstitutions &lt;&lt; [/\s*hidden.*/, '']
    e = get_exception RuntimeError, &quot;I dislike a/z/x/../../b/y/../c&quot;, ['a/b/c/../d/../../../bhal.rb', 'rawh hid den stuff is not here', 'almost all']
    assert_kind_of Exception, e
    assert_equal &quot;I dislike a/b/c&quot;, e.clean_message
  end

  def test_app_trace_should_be_empty_when_no_app_frames
    Exception::TraceSubstitutions &lt;&lt; [/\s*hidden.*/, '']
    e = get_exception RuntimeError, 'RAWR', ['vendor/file.rb some stuff', 'generated/bhal.rb', ' vendor/file.rb some stuff', 'generated/almost all']
    assert_kind_of Exception, e
    assert_equal [], e.application_backtrace
  end

  def test_frozen_error
    assert_raise(ActiveSupport::FrozenObjectError) { &quot;foo&quot;.freeze.gsub!(/oo/,'aa') }
  end
end
</pre>
    </div>