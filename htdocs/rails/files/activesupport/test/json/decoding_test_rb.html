  <div id="fileHeader">
    <h1>decoding_test.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>activesupport/test/json/decoding_test.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Fri Nov 27 16:38:16 +0100 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre># encoding: UTF-8
require 'abstract_unit'

class TestJSONDecoding &lt; ActiveSupport::TestCase
  TESTS = {
    %q({&quot;returnTo&quot;:{&quot;\/categories&quot;:&quot;\/&quot;}})        =&gt; {&quot;returnTo&quot; =&gt; {&quot;/categories&quot; =&gt; &quot;/&quot;}},
    %q({&quot;return\\&quot;To\\&quot;:&quot;:{&quot;\/categories&quot;:&quot;\/&quot;}}) =&gt; {&quot;return\&quot;To\&quot;:&quot; =&gt; {&quot;/categories&quot; =&gt; &quot;/&quot;}},
    %q({&quot;returnTo&quot;:{&quot;\/categories&quot;:1}})          =&gt; {&quot;returnTo&quot; =&gt; {&quot;/categories&quot; =&gt; 1}},
    %({&quot;returnTo&quot;:[1,&quot;a&quot;]})                    =&gt; {&quot;returnTo&quot; =&gt; [1, &quot;a&quot;]},
    %({&quot;returnTo&quot;:[1,&quot;\\&quot;a\\&quot;,&quot;, &quot;b&quot;]})        =&gt; {&quot;returnTo&quot; =&gt; [1, &quot;\&quot;a\&quot;,&quot;, &quot;b&quot;]},
    %({&quot;a&quot;: &quot;'&quot;, &quot;b&quot;: &quot;5,000&quot;})                  =&gt; {&quot;a&quot; =&gt; &quot;'&quot;, &quot;b&quot; =&gt; &quot;5,000&quot;},
    %({&quot;a&quot;: &quot;a's, b's and c's&quot;, &quot;b&quot;: &quot;5,000&quot;})   =&gt; {&quot;a&quot; =&gt; &quot;a's, b's and c's&quot;, &quot;b&quot; =&gt; &quot;5,000&quot;},
    # multibyte
    %({&quot;matzue&quot;: &quot;松江&quot;, &quot;asakusa&quot;: &quot;浅草&quot;}) =&gt; {&quot;matzue&quot; =&gt; &quot;松江&quot;, &quot;asakusa&quot; =&gt; &quot;浅草&quot;},
    %({&quot;a&quot;: &quot;2007-01-01&quot;})                       =&gt; {'a' =&gt; Date.new(2007, 1, 1)},
    %({&quot;a&quot;: &quot;2007-01-01 01:12:34 Z&quot;})            =&gt; {'a' =&gt; Time.utc(2007, 1, 1, 1, 12, 34)},
    # no time zone
    %({&quot;a&quot;: &quot;2007-01-01 01:12:34&quot;})              =&gt; {'a' =&gt; &quot;2007-01-01 01:12:34&quot;},
    # needs to be *exact*
    %({&quot;a&quot;: &quot; 2007-01-01 01:12:34 Z &quot;})          =&gt; {'a' =&gt; &quot; 2007-01-01 01:12:34 Z &quot;},
    %({&quot;a&quot;: &quot;2007-01-01 : it's your birthday&quot;})  =&gt; {'a' =&gt; &quot;2007-01-01 : it's your birthday&quot;},
    %([])    =&gt; [],
    %({})    =&gt; {},
    %({&quot;a&quot;:1})     =&gt; {&quot;a&quot; =&gt; 1},
    %({&quot;a&quot;: &quot;&quot;})    =&gt; {&quot;a&quot; =&gt; &quot;&quot;},
    %({&quot;a&quot;:&quot;\\&quot;&quot;}) =&gt; {&quot;a&quot; =&gt; &quot;\&quot;&quot;},
    %({&quot;a&quot;: null})  =&gt; {&quot;a&quot; =&gt; nil},
    %({&quot;a&quot;: true})  =&gt; {&quot;a&quot; =&gt; true},
    %({&quot;a&quot;: false}) =&gt; {&quot;a&quot; =&gt; false},
    %q({&quot;bad&quot;:&quot;\\\\&quot;,&quot;trailing&quot;:&quot;&quot;}) =&gt; {&quot;bad&quot; =&gt; &quot;\\&quot;, &quot;trailing&quot; =&gt; &quot;&quot;},
    %q({&quot;a&quot;: &quot;http:\/\/test.host\/posts\/1&quot;}) =&gt; {&quot;a&quot; =&gt; &quot;http://test.host/posts/1&quot;},
    %q({&quot;a&quot;: &quot;\u003cunicode\u0020escape\u003e&quot;}) =&gt; {&quot;a&quot; =&gt; &quot;&lt;unicode escape&gt;&quot;},
    %q({&quot;a&quot;: &quot;\\\\u0020skip double backslashes&quot;}) =&gt; {&quot;a&quot; =&gt; &quot;\\u0020skip double backslashes&quot;},
    %q({&quot;a&quot;: &quot;\u003cbr /\u003e&quot;}) =&gt; {'a' =&gt; &quot;&lt;br /&gt;&quot;},
    %q({&quot;b&quot;:[&quot;\u003ci\u003e&quot;,&quot;\u003cb\u003e&quot;,&quot;\u003cu\u003e&quot;]}) =&gt; {'b' =&gt; [&quot;&lt;i&gt;&quot;,&quot;&lt;b&gt;&quot;,&quot;&lt;u&gt;&quot;]}
  }

  # load the default JSON backend
  ActiveSupport::JSON.backend

  backends = %w(Yaml)
  backends &lt;&lt; &quot;JSONGem&quot; if defined?(::JSON)

  backends.each do |backend|
    TESTS.each do |json, expected|
      test &quot;json decodes #{json} with the #{backend} backend&quot; do
        ActiveSupport.parse_json_times = true
        silence_warnings do
          ActiveSupport::JSON.with_backend backend do
            assert_nothing_raised do
              assert_equal expected, ActiveSupport::JSON.decode(json)
            end
          end
        end
      end
    end
  end

  if backends.include?(&quot;JSONGem&quot;)
    test &quot;json decodes time json with time parsing disabled&quot; do
      ActiveSupport.parse_json_times = false
      expected = {&quot;a&quot; =&gt; &quot;2007-01-01 01:12:34 Z&quot;}
      ActiveSupport::JSON.with_backend &quot;JSONGem&quot; do
        assert_equal expected, ActiveSupport::JSON.decode(%({&quot;a&quot;: &quot;2007-01-01 01:12:34 Z&quot;}))
      end
    end
  end

  def test_failed_json_decoding
    assert_raise(ActiveSupport::JSON.parse_error) { ActiveSupport::JSON.decode(%({: 1})) }
  end
end

</pre>
    </div>