  <div id="fileHeader">
    <h1>document_test.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>actionpack/test/controller/html-scanner/document_test.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Oct 12 19:55:10 +0200 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require 'abstract_unit'

class DocumentTest &lt; Test::Unit::TestCase
  def test_handle_doctype
    doc = nil
    assert_nothing_raised do
      doc = HTML::Document.new &lt;&lt;-HTML.strip
        &lt;!DOCTYPE &quot;blah&quot; &quot;blah&quot; &quot;blah&quot;&gt;
        &lt;html&gt;
        &lt;/html&gt;
      HTML
    end
    assert_equal 3, doc.root.children.length
    assert_equal %{&lt;!DOCTYPE &quot;blah&quot; &quot;blah&quot; &quot;blah&quot;&gt;}, doc.root.children[0].content
    assert_match %r{\s+}m, doc.root.children[1].content
    assert_equal &quot;html&quot;, doc.root.children[2].name
  end
  
  def test_find_img
    doc = HTML::Document.new &lt;&lt;-HTML.strip
      &lt;html&gt;
        &lt;body&gt;
          &lt;p&gt;&lt;img src=&quot;hello.gif&quot;&gt;&lt;/p&gt;
        &lt;/body&gt;
      &lt;/html&gt;
    HTML
    assert doc.find(:tag=&gt;&quot;img&quot;, :attributes=&gt;{&quot;src&quot;=&gt;&quot;hello.gif&quot;})
  end

  def test_find_all
    doc = HTML::Document.new &lt;&lt;-HTML.strip
      &lt;html&gt;
        &lt;body&gt;
          &lt;p class=&quot;test&quot;&gt;&lt;img src=&quot;hello.gif&quot;&gt;&lt;/p&gt;
          &lt;div class=&quot;foo&quot;&gt;
            &lt;p class=&quot;test&quot;&gt;something&lt;/p&gt;
            &lt;p&gt;here is &lt;em class=&quot;test&quot;&gt;more&lt;/em&gt;&lt;/p&gt;
          &lt;/div&gt;
        &lt;/body&gt;
      &lt;/html&gt;
    HTML
    all = doc.find_all :attributes =&gt; { :class =&gt; &quot;test&quot; }
    assert_equal 3, all.length
    assert_equal [ &quot;p&quot;, &quot;p&quot;, &quot;em&quot; ], all.map { |n| n.name }
  end

  def test_find_with_text
    doc = HTML::Document.new &lt;&lt;-HTML.strip
      &lt;html&gt;
        &lt;body&gt;
          &lt;p&gt;Some text&lt;/p&gt;
        &lt;/body&gt;
      &lt;/html&gt;
    HTML
    assert doc.find(:content =&gt; &quot;Some text&quot;)
    assert doc.find(:tag =&gt; &quot;p&quot;, :child =&gt; { :content =&gt; &quot;Some text&quot; })
    assert doc.find(:tag =&gt; &quot;p&quot;, :child =&gt; &quot;Some text&quot;)
    assert doc.find(:tag =&gt; &quot;p&quot;, :content =&gt; &quot;Some text&quot;)
  end

  def test_parse_xml
    assert_nothing_raised { HTML::Document.new(&quot;&lt;tags&gt;&lt;tag/&gt;&lt;/tags&gt;&quot;, true, true) }
    assert_nothing_raised { HTML::Document.new(&quot;&lt;outer&gt;&lt;link&gt;something&lt;/link&gt;&lt;/outer&gt;&quot;, true, true) }
  end

  def test_parse_document
    doc = HTML::Document.new(&lt;&lt;-HTML)
      &lt;div&gt;
        &lt;h2&gt;blah&lt;/h2&gt;
        &lt;table&gt;
        &lt;/table&gt;
      &lt;/div&gt;
    HTML
    assert_not_nil doc.find(:tag =&gt; &quot;div&quot;, :children =&gt; { :count =&gt; 1, :only =&gt; { :tag =&gt; &quot;table&quot; } })
  end

  def test_tag_nesting_nothing_to_s
    doc = HTML::Document.new(&quot;&lt;tag&gt;&lt;/tag&gt;&quot;)
    assert_equal &quot;&lt;tag&gt;&lt;/tag&gt;&quot;, doc.root.to_s
  end

  def test_tag_nesting_space_to_s
    doc = HTML::Document.new(&quot;&lt;tag&gt; &lt;/tag&gt;&quot;)
    assert_equal &quot;&lt;tag&gt; &lt;/tag&gt;&quot;, doc.root.to_s
  end

  def test_tag_nesting_text_to_s
    doc = HTML::Document.new(&quot;&lt;tag&gt;text&lt;/tag&gt;&quot;)
    assert_equal &quot;&lt;tag&gt;text&lt;/tag&gt;&quot;, doc.root.to_s
  end

  def test_tag_nesting_tag_to_s
    doc = HTML::Document.new(&quot;&lt;tag&gt;&lt;nested /&gt;&lt;/tag&gt;&quot;)
    assert_equal &quot;&lt;tag&gt;&lt;nested /&gt;&lt;/tag&gt;&quot;, doc.root.to_s
  end

  def test_parse_cdata
    doc = HTML::Document.new(&lt;&lt;-HTML)
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot;
        &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; lang=&quot;en&quot; xml:lang=&quot;en&quot;&gt;
  &lt;head&gt;
    &lt;title&gt;&lt;![CDATA[&lt;br&gt;]]&gt;&lt;/title&gt;
   &lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;this document has &amp;lt;br&amp;gt; for a title&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;
HTML

    assert_nil doc.find(:tag =&gt; &quot;title&quot;, :descendant =&gt; { :tag =&gt; &quot;br&quot; })
    assert doc.find(:tag =&gt; &quot;title&quot;, :child =&gt; &quot;&lt;br&gt;&quot;)
  end

  def test_find_empty_tag
    doc = HTML::Document.new(&quot;&lt;div id='map'&gt;&lt;/div&gt;&quot;)
    assert_nil doc.find(:tag =&gt; &quot;div&quot;, :attributes =&gt; { :id =&gt; &quot;map&quot; }, :content =&gt; /./)
    assert doc.find(:tag =&gt; &quot;div&quot;, :attributes =&gt; { :id =&gt; &quot;map&quot; }, :content =&gt; /\A\Z/)
    assert doc.find(:tag =&gt; &quot;div&quot;, :attributes =&gt; { :id =&gt; &quot;map&quot; }, :content =&gt; /^$/)
    assert doc.find(:tag =&gt; &quot;div&quot;, :attributes =&gt; { :id =&gt; &quot;map&quot; }, :content =&gt; &quot;&quot;)
    assert doc.find(:tag =&gt; &quot;div&quot;, :attributes =&gt; { :id =&gt; &quot;map&quot; }, :content =&gt; nil)
  end

  def test_parse_invalid_document
    assert_nothing_raised do
      doc = HTML::Document.new(&quot;&lt;html&gt;
        &lt;table&gt;
          &lt;tr&gt;
            &lt;td style=\&quot;color: #FFFFFF; height: 17px; onclick=\&quot;window.location.href='http://www.rmeinc.com/about_rme.aspx'\&quot; style=\&quot;cursor:pointer; height: 17px;\&quot;; nowrap onclick=\&quot;window.location.href='http://www.rmeinc.com/about_rme.aspx'\&quot; onmouseout=\&quot;this.bgColor='#0066cc'; this.style.color='#FFFFFF'\&quot; onmouseover=\&quot;this.bgColor='#ffffff'; this.style.color='#0033cc'\&quot;&gt;About Us&lt;/td&gt;
          &lt;/tr&gt;
        &lt;/table&gt;
      &lt;/html&gt;&quot;)
    end
  end

  def test_invalid_document_raises_exception_when_strict
    assert_raise RuntimeError do
      doc = HTML::Document.new(&quot;&lt;html&gt;
        &lt;table&gt;
          &lt;tr&gt;
            &lt;td style=\&quot;color: #FFFFFF; height: 17px; onclick=\&quot;window.location.href='http://www.rmeinc.com/about_rme.aspx'\&quot; style=\&quot;cursor:pointer; height: 17px;\&quot;; nowrap onclick=\&quot;window.location.href='http://www.rmeinc.com/about_rme.aspx'\&quot; onmouseout=\&quot;this.bgColor='#0066cc'; this.style.color='#FFFFFF'\&quot; onmouseover=\&quot;this.bgColor='#ffffff'; this.style.color='#0033cc'\&quot;&gt;About Us&lt;/td&gt;
          &lt;/tr&gt;
        &lt;/table&gt;
      &lt;/html&gt;&quot;, true)
    end
  end

end
</pre>
    </div>