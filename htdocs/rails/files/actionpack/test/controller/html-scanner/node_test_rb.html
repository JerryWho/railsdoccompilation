  <div id="fileHeader">
    <h1>node_test.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>actionpack/test/controller/html-scanner/node_test.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Fri Nov 27 16:38:15 +0100 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require 'abstract_unit'

class NodeTest &lt; Test::Unit::TestCase
  
  class MockNode
    def initialize(matched, value)
      @matched = matched
      @value = value
    end
    
    def find(conditions)
      @matched &amp;&amp; self
    end
    
    def to_s
      @value.to_s
    end
  end
  
  def setup
    @node = HTML::Node.new(&quot;parent&quot;)
    @node.children.concat [MockNode.new(false,1), MockNode.new(true,&quot;two&quot;), MockNode.new(false,:three)]
  end
  
  def test_match
    assert !@node.match(&quot;foo&quot;)
  end
  
  def test_tag
    assert !@node.tag?
  end
  
  def test_to_s
    assert_equal &quot;1twothree&quot;, @node.to_s
  end
  
  def test_find
    assert_equal &quot;two&quot;, @node.find('blah').to_s
  end

  def test_parse_strict
    s = &quot;&lt;b foo='hello'' bar='baz'&gt;&quot;
    assert_raise(RuntimeError) { HTML::Node.parse(nil,0,0,s) }
  end

  def test_parse_relaxed
    s = &quot;&lt;b foo='hello'' bar='baz'&gt;&quot;
    node = nil
    assert_nothing_raised { node = HTML::Node.parse(nil,0,0,s,false) }
    assert node.attributes.has_key?(&quot;foo&quot;)
    assert !node.attributes.has_key?(&quot;bar&quot;)
  end

  def test_to_s_with_boolean_attrs
    s = &quot;&lt;b foo bar&gt;&quot;
    node = HTML::Node.parse(nil,0,0,s)
    assert node.attributes.has_key?(&quot;foo&quot;)
    assert node.attributes.has_key?(&quot;bar&quot;)
    assert &quot;&lt;b foo bar&gt;&quot;, node.to_s
  end
  
  def test_parse_with_unclosed_tag
    s = &quot;&lt;span onmouseover='bang'&quot;
    node = nil
    assert_nothing_raised { node = HTML::Node.parse(nil,0,0,s,false) }
    assert node.attributes.has_key?(&quot;onmouseover&quot;)
  end

  def test_parse_with_valid_cdata_section
    s = &quot;&lt;![CDATA[&lt;span&gt;contents&lt;/span&gt;]]&gt;&quot;
    node = nil
    assert_nothing_raised { node = HTML::Node.parse(nil,0,0,s,false) }
    assert_kind_of HTML::CDATA, node
    assert_equal '&lt;span&gt;contents&lt;/span&gt;', node.content
  end

  def test_parse_strict_with_unterminated_cdata_section
    s = &quot;&lt;![CDATA[neverending...&quot;
    assert_raise(RuntimeError) { HTML::Node.parse(nil,0,0,s) }
  end

  def test_parse_relaxed_with_unterminated_cdata_section
    s = &quot;&lt;![CDATA[neverending...&quot;
    node = nil
    assert_nothing_raised { node = HTML::Node.parse(nil,0,0,s,false) }
    assert_kind_of HTML::CDATA, node
    assert_equal 'neverending...', node.content
  end
end
</pre>
    </div>