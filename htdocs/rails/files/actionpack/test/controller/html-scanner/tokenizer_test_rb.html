  <div id="fileHeader">
    <h1>tokenizer_test.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>actionpack/test/controller/html-scanner/tokenizer_test.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Oct 12 19:55:10 +0200 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require 'abstract_unit'

class TokenizerTest &lt; Test::Unit::TestCase

  def test_blank
    tokenize &quot;&quot;
    assert_end
  end

  def test_space
    tokenize &quot; &quot;
    assert_next &quot; &quot;
    assert_end
  end

  def test_tag_simple_open
    tokenize &quot;&lt;tag&gt;&quot;
    assert_next &quot;&lt;tag&gt;&quot;
    assert_end
  end

  def test_tag_simple_self_closing
    tokenize &quot;&lt;tag /&gt;&quot;
    assert_next &quot;&lt;tag /&gt;&quot;
    assert_end
  end

  def test_tag_simple_closing
    tokenize &quot;&lt;/tag&gt;&quot;
    assert_next &quot;&lt;/tag&gt;&quot;
  end
  
  def test_tag_with_single_quoted_attribute
    tokenize %{&lt;tag a='hello'&gt;x}
    assert_next %{&lt;tag a='hello'&gt;}
  end

  def test_tag_with_single_quoted_attribute_with_escape
    tokenize %{&lt;tag a='hello\\''&gt;x}
    assert_next %{&lt;tag a='hello\\''&gt;}
  end

  def test_tag_with_double_quoted_attribute
    tokenize %{&lt;tag a=&quot;hello&quot;&gt;x}
    assert_next %{&lt;tag a=&quot;hello&quot;&gt;}
  end

  def test_tag_with_double_quoted_attribute_with_escape
    tokenize %{&lt;tag a=&quot;hello\\&quot;&quot;&gt;x}
    assert_next %{&lt;tag a=&quot;hello\\&quot;&quot;&gt;}
  end
  
  def test_tag_with_unquoted_attribute
    tokenize %{&lt;tag a=hello&gt;x}
    assert_next %{&lt;tag a=hello&gt;}
  end

  def test_tag_with_lt_char_in_attribute
    tokenize %{&lt;tag a=&quot;x &lt; y&quot;&gt;x}
    assert_next %{&lt;tag a=&quot;x &lt; y&quot;&gt;}
  end
  
  def test_tag_with_gt_char_in_attribute
    tokenize %{&lt;tag a=&quot;x &gt; y&quot;&gt;x}
    assert_next %{&lt;tag a=&quot;x &gt; y&quot;&gt;}
  end
  
  def test_doctype_tag
    tokenize %{&lt;!DOCTYPE &quot;blah&quot; &quot;blah&quot; &quot;blah&quot;&gt;\n    &lt;html&gt;}
    assert_next %{&lt;!DOCTYPE &quot;blah&quot; &quot;blah&quot; &quot;blah&quot;&gt;}
    assert_next %{\n    }
    assert_next %{&lt;html&gt;}
  end

  def test_cdata_tag
    tokenize %{&lt;![CDATA[&lt;br&gt;]]&gt;}
    assert_next %{&lt;![CDATA[&lt;br&gt;]]&gt;}
    assert_end
  end

  def test_unterminated_cdata_tag
    tokenize %{&lt;content:encoded&gt;&lt;![CDATA[ neverending...}
    assert_next %{&lt;content:encoded&gt;}
    assert_next %{&lt;![CDATA[ neverending...}
    assert_end
  end

  def test_less_than_with_space
    tokenize %{original &lt; hello &gt; world}
    assert_next %{original }
    assert_next %{&lt; hello &gt; world}
  end
  
  def test_less_than_without_matching_greater_than
    tokenize %{hello &lt;span onmouseover=&quot;gotcha&quot;\n&lt;b&gt;foo&lt;/b&gt;\nbar&lt;/span&gt;}
    assert_next %{hello }
    assert_next %{&lt;span onmouseover=&quot;gotcha&quot;\n}
    assert_next %{&lt;b&gt;}
    assert_next %{foo}
    assert_next %{&lt;/b&gt;}
    assert_next %{\nbar}
    assert_next %{&lt;/span&gt;}
    assert_end
  end

  def test_unterminated_comment
    tokenize %{hello &lt;!-- neverending...}
    assert_next %{hello }
    assert_next %{&lt;!-- neverending...}
    assert_end
  end
  
  private
  
    def tokenize(text)
      @tokenizer = HTML::Tokenizer.new(text)
    end
    
    def assert_next(expected, message=nil)
      token = @tokenizer.next
      assert_equal expected, token, message
    end
    
    def assert_sequence(*expected)
      assert_next expected.shift until expected.empty?
    end
    
    def assert_end(message=nil)
      assert_nil @tokenizer.next, message
    end
end
</pre>
    </div>