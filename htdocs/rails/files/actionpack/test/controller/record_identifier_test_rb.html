  <div id="fileHeader">
    <h1>record_identifier_test.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>actionpack/test/controller/record_identifier_test.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Fri Nov 27 16:38:15 +0100 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require 'abstract_unit'

class Comment
  attr_reader :id
  def save; @id = 1 end
  def new_record?; @id.nil? end
  def name
    @id.nil? ? 'new comment' : &quot;comment ##{@id}&quot;
  end
end

class Comment::Nested &lt; Comment; end

class Test::Unit::TestCase
  protected
    def comments_url
      'http://www.example.com/comments'
    end
    
    def comment_url(comment)
      &quot;http://www.example.com/comments/#{comment.id}&quot;
    end
end


class RecordIdentifierTest &lt; Test::Unit::TestCase
  include ActionController::RecordIdentifier

  def setup
    @klass  = Comment
    @record = @klass.new
    @singular = 'comment'
    @plural = 'comments'
  end

  def test_dom_id_with_new_record
    assert_equal &quot;new_#{@singular}&quot;, dom_id(@record)
  end

  def test_dom_id_with_new_record_and_prefix
    assert_equal &quot;custom_prefix_#{@singular}&quot;, dom_id(@record, :custom_prefix)
  end

  def test_dom_id_with_saved_record
    @record.save
    assert_equal &quot;#{@singular}_1&quot;, dom_id(@record)
  end

  def test_dom_id_with_prefix
    @record.save
    assert_equal &quot;edit_#{@singular}_1&quot;, dom_id(@record, :edit)
  end

  def test_partial_path
    expected = &quot;#{@plural}/#{@singular}&quot;
    assert_equal expected, partial_path(@record)
    assert_equal expected, partial_path(Comment)
  end

  def test_partial_path_with_namespaced_controller_path
    expected = &quot;admin/#{@plural}/#{@singular}&quot;
    assert_equal expected, partial_path(@record, &quot;admin/posts&quot;)
    assert_equal expected, partial_path(@klass, &quot;admin/posts&quot;)
  end

  def test_partial_path_with_not_namespaced_controller_path
    expected = &quot;#{@plural}/#{@singular}&quot;
    assert_equal expected, partial_path(@record, &quot;posts&quot;)
    assert_equal expected, partial_path(@klass, &quot;posts&quot;)
  end

  def test_dom_class
    assert_equal @singular, dom_class(@record)
  end
  
  def test_dom_class_with_prefix
    assert_equal &quot;custom_prefix_#{@singular}&quot;, dom_class(@record, :custom_prefix)
  end

  def test_singular_class_name
    assert_equal @singular, singular_class_name(@record)
  end

  def test_singular_class_name_for_class
    assert_equal @singular, singular_class_name(@klass)
  end

  def test_plural_class_name
    assert_equal @plural, plural_class_name(@record)
  end

  def test_plural_class_name_for_class
    assert_equal @plural, plural_class_name(@klass)
  end

  private
    def method_missing(method, *args)
      RecordIdentifier.send(method, *args)
    end
end

class NestedRecordIdentifierTest &lt; RecordIdentifierTest
  def setup
    @klass  = Comment::Nested
    @record = @klass.new
    @singular = 'comment_nested'
    @plural = 'comment_nesteds'
  end

  def test_partial_path
    expected = &quot;comment/nesteds/nested&quot;
    assert_equal expected, partial_path(@record)
    assert_equal expected, partial_path(Comment::Nested)
  end

  def test_partial_path_with_namespaced_controller_path
    expected = &quot;admin/comment/nesteds/nested&quot;
    assert_equal expected, partial_path(@record, &quot;admin/posts&quot;)
    assert_equal expected, partial_path(@klass, &quot;admin/posts&quot;)
  end

  def test_partial_path_with_deeper_namespaced_controller_path
    expected = &quot;deeper/admin/comment/nesteds/nested&quot;
    assert_equal expected, partial_path(@record, &quot;deeper/admin/posts&quot;)
    assert_equal expected, partial_path(@klass, &quot;deeper/admin/posts&quot;)
  end

  def test_partial_path_with_even_deeper_namespaced_controller_path
    expected = &quot;even/more/deeper/admin/comment/nesteds/nested&quot;
    assert_equal expected, partial_path(@record, &quot;even/more/deeper/admin/posts&quot;)
    assert_equal expected, partial_path(@klass, &quot;even/more/deeper/admin/posts&quot;)
  end

  def test_partial_path_with_not_namespaced_controller_path
    expected = &quot;comment/nesteds/nested&quot;
    assert_equal expected, partial_path(@record, &quot;posts&quot;)
    assert_equal expected, partial_path(@klass, &quot;posts&quot;)
  end
end
</pre>
    </div>