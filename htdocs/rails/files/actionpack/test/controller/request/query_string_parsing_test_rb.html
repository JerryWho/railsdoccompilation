  <div id="fileHeader">
    <h1>query_string_parsing_test.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>actionpack/test/controller/request/query_string_parsing_test.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Fri Nov 27 16:38:15 +0100 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require 'abstract_unit'

class QueryStringParsingTest &lt; ActionController::IntegrationTest
  class TestController &lt; ActionController::Base
    class &lt;&lt; self
      attr_accessor :last_query_parameters
    end

    def parse
      self.class.last_query_parameters = request.query_parameters
      head :ok
    end
  end

  def teardown
    TestController.last_query_parameters = nil
  end

  test &quot;query string&quot; do
    assert_parses(
      {&quot;action&quot; =&gt; &quot;create_customer&quot;, &quot;full_name&quot; =&gt; &quot;David Heinemeier Hansson&quot;, &quot;customerId&quot; =&gt; &quot;1&quot;},
      &quot;action=create_customer&amp;full_name=David%20Heinemeier%20Hansson&amp;customerId=1&quot;
    )
  end

  test &quot;deep query string&quot; do
    assert_parses(
      {'x' =&gt; {'y' =&gt; {'z' =&gt; '10'}}},
      &quot;x[y][z]=10&quot;
    )
  end

  test &quot;deep query string with array&quot; do
    assert_parses({'x' =&gt; {'y' =&gt; {'z' =&gt; ['10']}}}, 'x[y][z][]=10')
    assert_parses({'x' =&gt; {'y' =&gt; {'z' =&gt; ['10', '5']}}}, 'x[y][z][]=10&amp;x[y][z][]=5')
  end

  test &quot;deep query string with array of hash&quot; do
    assert_parses({'x' =&gt; {'y' =&gt; [{'z' =&gt; '10'}]}}, 'x[y][][z]=10')
    assert_parses({'x' =&gt; {'y' =&gt; [{'z' =&gt; '10', 'w' =&gt; '10'}]}}, 'x[y][][z]=10&amp;x[y][][w]=10')
    assert_parses({'x' =&gt; {'y' =&gt; [{'z' =&gt; '10', 'v' =&gt; {'w' =&gt; '10'}}]}}, 'x[y][][z]=10&amp;x[y][][v][w]=10')
  end

  test &quot;deep query string with array of hashes with one pair&quot; do
    assert_parses({'x' =&gt; {'y' =&gt; [{'z' =&gt; '10'}, {'z' =&gt; '20'}]}}, 'x[y][][z]=10&amp;x[y][][z]=20')
  end

  test &quot;deep query string with array of hashes with multiple pairs&quot; do
    assert_parses(
      {'x' =&gt; {'y' =&gt; [{'z' =&gt; '10', 'w' =&gt; 'a'}, {'z' =&gt; '20', 'w' =&gt; 'b'}]}},
      'x[y][][z]=10&amp;x[y][][w]=a&amp;x[y][][z]=20&amp;x[y][][w]=b'
    )
  end

  test &quot;query string with nil&quot; do
    assert_parses(
      { &quot;action&quot; =&gt; &quot;create_customer&quot;, &quot;full_name&quot; =&gt; ''},
      &quot;action=create_customer&amp;full_name=&quot;
    )
  end

  test &quot;query string with array&quot; do
    assert_parses(
      { &quot;action&quot; =&gt; &quot;create_customer&quot;, &quot;selected&quot; =&gt; [&quot;1&quot;, &quot;2&quot;, &quot;3&quot;]},
      &quot;action=create_customer&amp;selected[]=1&amp;selected[]=2&amp;selected[]=3&quot;
    )
  end

  test &quot;query string with amps&quot; do
    assert_parses(
      { &quot;action&quot; =&gt; &quot;create_customer&quot;, &quot;name&quot; =&gt; &quot;Don't &amp; Does&quot;},
      &quot;action=create_customer&amp;name=Don%27t+%26+Does&quot;
    )
  end

  test &quot;query string with many equal&quot; do
    assert_parses(
      { &quot;action&quot; =&gt; &quot;create_customer&quot;, &quot;full_name&quot; =&gt; &quot;abc=def=ghi&quot;},
      &quot;action=create_customer&amp;full_name=abc=def=ghi&quot;
    )
  end

  test &quot;query string without equal&quot; do
    assert_parses({ &quot;action&quot; =&gt; nil }, &quot;action&quot;)
  end

  test &quot;query string with empty key&quot; do
    assert_parses(
      { &quot;action&quot; =&gt; &quot;create_customer&quot;, &quot;full_name&quot; =&gt; &quot;David Heinemeier Hansson&quot; },
      &quot;action=create_customer&amp;full_name=David%20Heinemeier%20Hansson&amp;=Save&quot;
    )
  end

  test &quot;query string with many ampersands&quot; do
    assert_parses(
      { &quot;action&quot; =&gt; &quot;create_customer&quot;, &quot;full_name&quot; =&gt; &quot;David Heinemeier Hansson&quot;},
      &quot;&amp;action=create_customer&amp;&amp;&amp;full_name=David%20Heinemeier%20Hansson&quot;
    )
  end

  test &quot;unbalanced query string with array&quot; do
    assert_parses(
      {'location' =&gt; [&quot;1&quot;, &quot;2&quot;], 'age_group' =&gt; [&quot;2&quot;]},
      &quot;location[]=1&amp;location[]=2&amp;age_group[]=2&quot;
    )
  end

  private
    def assert_parses(expected, actual)
      with_routing do |set|
        set.draw do |map|
          map.connect ':action', :controller =&gt; &quot;query_string_parsing_test/test&quot;
        end

        get &quot;/parse&quot;, actual
        assert_response :ok
        assert_equal(expected, TestController.last_query_parameters)
      end
    end
end
</pre>
    </div>