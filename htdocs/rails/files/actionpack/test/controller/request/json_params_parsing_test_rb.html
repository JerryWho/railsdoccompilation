  <div id="fileHeader">
    <h1>json_params_parsing_test.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>actionpack/test/controller/request/json_params_parsing_test.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Oct 12 19:55:10 +0200 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require 'abstract_unit'

class JsonParamsParsingTest &lt; ActionController::IntegrationTest
  class TestController &lt; ActionController::Base
    class &lt;&lt; self
      attr_accessor :last_request_parameters
    end

    def parse
      self.class.last_request_parameters = request.request_parameters
      head :ok
    end
  end

  def teardown
    TestController.last_request_parameters = nil
  end

  test &quot;parses json params for application json&quot; do
    assert_parses(
      {&quot;person&quot; =&gt; {&quot;name&quot; =&gt; &quot;David&quot;}},
      &quot;{\&quot;person\&quot;: {\&quot;name\&quot;: \&quot;David\&quot;}}&quot;, { 'CONTENT_TYPE' =&gt; 'application/json' }
    )
  end

  test &quot;parses json params for application jsonrequest&quot; do
    assert_parses(
      {&quot;person&quot; =&gt; {&quot;name&quot; =&gt; &quot;David&quot;}},
      &quot;{\&quot;person\&quot;: {\&quot;name\&quot;: \&quot;David\&quot;}}&quot;, { 'CONTENT_TYPE' =&gt; 'application/jsonrequest' }
    )
  end

  test &quot;logs error if parsing unsuccessful&quot; do
    with_test_routing do
      begin
        $stderr = StringIO.new
        json = &quot;[\&quot;person]\&quot;: {\&quot;name\&quot;: \&quot;David\&quot;}}&quot;
        post &quot;/parse&quot;, json, {'CONTENT_TYPE' =&gt; 'application/json'}
        assert_response :error
        $stderr.rewind &amp;&amp; err = $stderr.read
        assert err =~ /Error occurred while parsing request parameters/
      ensure
        $stderr = STDERR
      end
    end
  end

  private
    def assert_parses(expected, actual, headers = {})
      with_test_routing do
        post &quot;/parse&quot;, actual, headers
        assert_response :ok
        assert_equal(expected, TestController.last_request_parameters)
      end
    end

    def with_test_routing
      with_routing do |set|
        set.draw do |map|
          map.connect ':action', :controller =&gt; &quot;json_params_parsing_test/test&quot;
        end
        yield
      end
    end
end
</pre>
    </div>