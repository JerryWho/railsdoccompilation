  <div id="fileHeader">
    <h1>redirect_test.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>actionpack/test/controller/redirect_test.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sun Jul 25 11:32:53 +0200 2010</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require 'abstract_unit'

class WorkshopsController &lt; ActionController::Base
end

class Workshop
  attr_accessor :id, :new_record

  def initialize(id, new_record)
    @id, @new_record = id, new_record
  end

  def new_record?
    @new_record
  end

  def to_s
    id.to_s
  end
end

class RedirectController &lt; ActionController::Base
  def simple_redirect
    redirect_to :action =&gt; &quot;hello_world&quot;
  end

  def redirect_with_status
    redirect_to({:action =&gt; &quot;hello_world&quot;, :status =&gt; 301})
  end

  def redirect_with_status_hash
    redirect_to({:action =&gt; &quot;hello_world&quot;}, {:status =&gt; 301})
  end

  def url_redirect_with_status
    redirect_to(&quot;http://www.example.com&quot;, :status =&gt; :moved_permanently)
  end

  def url_redirect_with_status_hash
    redirect_to(&quot;http://www.example.com&quot;, {:status =&gt; 301})
  end

  def relative_url_redirect_with_status
    redirect_to(&quot;/things/stuff&quot;, :status =&gt; :found)
  end

  def relative_url_redirect_with_status_hash
    redirect_to(&quot;/things/stuff&quot;, {:status =&gt; 301})
  end

  def redirect_to_back_with_status
    redirect_to :back, :status =&gt; 307
  end

  def host_redirect
    redirect_to :action =&gt; &quot;other_host&quot;, :only_path =&gt; false, :host =&gt; 'other.test.host'
  end

  def module_redirect
    redirect_to :controller =&gt; 'module_test/module_redirect', :action =&gt; &quot;hello_world&quot;
  end

  def redirect_with_assigns
    @hello = &quot;world&quot;
    redirect_to :action =&gt; &quot;hello_world&quot;
  end

  def redirect_to_url
    redirect_to &quot;http://www.rubyonrails.org/&quot;
  end

  def redirect_to_url_with_unescaped_query_string
    redirect_to &quot;http://dev.rubyonrails.org/query?status=new&quot;
  end

  def redirect_to_url_with_complex_scheme
    redirect_to &quot;x-test+scheme.complex:redirect&quot;
  end

  def redirect_to_back
    redirect_to :back
  end

  def redirect_to_existing_record
    redirect_to Workshop.new(5, false)
  end

  def redirect_to_new_record
    redirect_to Workshop.new(5, true)
  end

  def redirect_to_nil
    redirect_to nil
  end

  def rescue_errors(e) raise e end

  def rescue_action(e) raise end

  protected
    def dashbord_url(id, message)
      url_for :action =&gt; &quot;dashboard&quot;, :params =&gt; { &quot;id&quot; =&gt; id, &quot;message&quot; =&gt; message }
    end
end

class RedirectTest &lt; ActionController::TestCase
  tests RedirectController

  def test_simple_redirect
    get :simple_redirect
    assert_response :redirect
    assert_equal &quot;http://test.host/redirect/hello_world&quot;, redirect_to_url
  end

  def test_redirect_with_no_status
    get :simple_redirect
    assert_response 302
    assert_equal &quot;http://test.host/redirect/hello_world&quot;, redirect_to_url
  end

  def test_redirect_with_status
    get :redirect_with_status
    assert_response 301
    assert_equal &quot;http://test.host/redirect/hello_world&quot;, redirect_to_url
  end

  def test_redirect_with_status_hash
    get :redirect_with_status_hash
    assert_response 301
    assert_equal &quot;http://test.host/redirect/hello_world&quot;, redirect_to_url
  end

  def test_url_redirect_with_status
    get :url_redirect_with_status
    assert_response 301
    assert_equal &quot;http://www.example.com&quot;, redirect_to_url
  end

  def test_url_redirect_with_status_hash
    get :url_redirect_with_status_hash
    assert_response 301
    assert_equal &quot;http://www.example.com&quot;, redirect_to_url
  end


  def test_relative_url_redirect_with_status
    get :relative_url_redirect_with_status
    assert_response 302
    assert_equal &quot;http://test.host/things/stuff&quot;, redirect_to_url
  end

  def test_relative_url_redirect_with_status_hash
    get :relative_url_redirect_with_status_hash
    assert_response 301
    assert_equal &quot;http://test.host/things/stuff&quot;, redirect_to_url
  end

  def test_redirect_to_back_with_status
    @request.env[&quot;HTTP_REFERER&quot;] = &quot;http://www.example.com/coming/from&quot;
    get :redirect_to_back_with_status
    assert_response 307
    assert_equal &quot;http://www.example.com/coming/from&quot;, redirect_to_url
  end

  def test_simple_redirect_using_options
    get :host_redirect
    assert_response :redirect
    assert_redirected_to :action =&gt; &quot;other_host&quot;, :only_path =&gt; false, :host =&gt; 'other.test.host'
  end

  def test_module_redirect
    get :module_redirect
    assert_response :redirect
    assert_redirected_to &quot;http://test.host/module_test/module_redirect/hello_world&quot;
  end

  def test_module_redirect_using_options
    get :module_redirect
    assert_response :redirect
    assert_redirected_to :controller =&gt; 'module_test/module_redirect', :action =&gt; 'hello_world'
  end

  def test_redirect_with_assigns
    get :redirect_with_assigns
    assert_response :redirect
    assert_equal &quot;world&quot;, assigns[&quot;hello&quot;]
  end

  def test_redirect_to_url
    get :redirect_to_url
    assert_response :redirect
    assert_redirected_to &quot;http://www.rubyonrails.org/&quot;
  end

  def test_redirect_to_url_with_unescaped_query_string
    get :redirect_to_url_with_unescaped_query_string
    assert_response :redirect
    assert_redirected_to &quot;http://dev.rubyonrails.org/query?status=new&quot;
  end

  def test_redirect_to_url_with_complex_scheme
    get :redirect_to_url_with_complex_scheme
    assert_response :redirect
    assert_equal &quot;x-test+scheme.complex:redirect&quot;, redirect_to_url
  end

  def test_redirect_to_back
    @request.env[&quot;HTTP_REFERER&quot;] = &quot;http://www.example.com/coming/from&quot;
    get :redirect_to_back
    assert_response :redirect
    assert_equal &quot;http://www.example.com/coming/from&quot;, redirect_to_url
  end

  def test_redirect_to_back_with_no_referer
    assert_raise(ActionController::RedirectBackError) {
      @request.env[&quot;HTTP_REFERER&quot;] = nil
      get :redirect_to_back
    }
  end

  def test_redirect_to_record
    ActionController::Routing::Routes.draw do |map|
      map.resources :workshops
      map.connect ':controller/:action/:id'
    end

    get :redirect_to_existing_record
    assert_equal &quot;http://test.host/workshops/5&quot;, redirect_to_url
    assert_redirected_to Workshop.new(5, false)

    get :redirect_to_new_record
    assert_equal &quot;http://test.host/workshops&quot;, redirect_to_url
    assert_redirected_to Workshop.new(5, true)
  end

  def test_redirect_with_partial_params
    get :module_redirect

    assert_deprecated(/test_redirect_with_partial_params/) do
      assert_redirected_to :action =&gt; 'hello_world'
    end
  end

  def test_redirect_to_nil
    assert_raise(ActionController::ActionControllerError) do
      get :redirect_to_nil
    end
  end
end

module ModuleTest
  class ModuleRedirectController &lt; ::RedirectController
    def module_redirect
      redirect_to :controller =&gt; '/redirect', :action =&gt; &quot;hello_world&quot;
    end
  end

  class ModuleRedirectTest &lt; ActionController::TestCase
    tests ModuleRedirectController

    def test_simple_redirect
      get :simple_redirect
      assert_response :redirect
      assert_equal &quot;http://test.host/module_test/module_redirect/hello_world&quot;, redirect_to_url
    end

    def test_simple_redirect_using_options
      get :host_redirect
      assert_response :redirect
      assert_redirected_to :action =&gt; &quot;other_host&quot;, :only_path =&gt; false, :host =&gt; 'other.test.host'
    end

    def test_module_redirect
      get :module_redirect
      assert_response :redirect
      assert_equal &quot;http://test.host/redirect/hello_world&quot;, redirect_to_url
    end

    def test_module_redirect_using_options
      get :module_redirect
      assert_response :redirect
      assert_redirected_to :controller =&gt; '/redirect', :action =&gt; &quot;hello_world&quot;
    end
  end
end
</pre>
    </div>