  <div id="fileHeader">
    <h1>http_basic_authentication_test.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>actionpack/test/controller/http_basic_authentication_test.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Oct 12 14:59:07 +0200 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require 'abstract_unit'

class HttpBasicAuthenticationTest &lt; ActionController::TestCase
  class DummyController &lt; ActionController::Base
    before_filter :authenticate, :only =&gt; :index
    before_filter :authenticate_with_request, :only =&gt; :display
    before_filter :authenticate_long_credentials, :only =&gt; :show

    def index
      render :text =&gt; &quot;Hello Secret&quot;
    end

    def display
      render :text =&gt; 'Definitely Maybe'
    end
    
    def show
      render :text =&gt; 'Only for loooooong credentials'
    end

    private

    def authenticate
      authenticate_or_request_with_http_basic do |username, password|
        username == 'lifo' &amp;&amp; password == 'world'
      end
    end

    def authenticate_with_request
      if authenticate_with_http_basic { |username, password| username == 'pretty' &amp;&amp; password == 'please' }
        @logged_in = true
      else
        request_http_basic_authentication(&quot;SuperSecret&quot;)
      end
    end
    
    def authenticate_long_credentials
      authenticate_or_request_with_http_basic do |username, password|
        username == '1234567890123456789012345678901234567890' &amp;&amp; password == '1234567890123456789012345678901234567890'
      end
    end
  end

  AUTH_HEADERS = ['HTTP_AUTHORIZATION', 'X-HTTP_AUTHORIZATION', 'X_HTTP_AUTHORIZATION', 'REDIRECT_X_HTTP_AUTHORIZATION']

  tests DummyController

  AUTH_HEADERS.each do |header|
    test &quot;successful authentication with #{header.downcase}&quot; do
      @request.env[header] = encode_credentials('lifo', 'world')
      get :index

      assert_response :success
      assert_equal 'Hello Secret', @response.body, &quot;Authentication failed for request header #{header}&quot;
    end
    test &quot;successful authentication with #{header.downcase} and long credentials&quot; do
      @request.env[header] = encode_credentials('1234567890123456789012345678901234567890', '1234567890123456789012345678901234567890')
      get :show
      
      assert_response :success
      assert_equal 'Only for loooooong credentials', @response.body, &quot;Authentication failed for request header #{header} and long credentials&quot;
    end
  end

  AUTH_HEADERS.each do |header|
    test &quot;unsuccessful authentication with #{header.downcase}&quot; do
      @request.env[header] = encode_credentials('h4x0r', 'world')
      get :index

      assert_response :unauthorized
      assert_equal &quot;HTTP Basic: Access denied.\n&quot;, @response.body, &quot;Authentication didn't fail for request header #{header}&quot;
    end
    test &quot;unsuccessful authentication with #{header.downcase} and long credentials&quot; do
      @request.env[header] = encode_credentials('h4x0rh4x0rh4x0rh4x0rh4x0rh4x0rh4x0rh4x0r', 'worldworldworldworldworldworldworldworld')
      get :show

      assert_response :unauthorized
      assert_equal &quot;HTTP Basic: Access denied.\n&quot;, @response.body, &quot;Authentication didn't fail for request header #{header} and long credentials&quot;
    end
  end

  test &quot;authentication request without credential&quot; do
    get :display

    assert_response :unauthorized
    assert_equal &quot;HTTP Basic: Access denied.\n&quot;, @response.body
    assert_equal 'Basic realm=&quot;SuperSecret&quot;', @response.headers['WWW-Authenticate']
  end

  test &quot;authentication request with invalid credential&quot; do
    @request.env['HTTP_AUTHORIZATION'] = encode_credentials('pretty', 'foo')
    get :display

    assert_response :unauthorized
    assert_equal &quot;HTTP Basic: Access denied.\n&quot;, @response.body
    assert_equal 'Basic realm=&quot;SuperSecret&quot;', @response.headers['WWW-Authenticate']
  end

  test &quot;authentication request with valid credential&quot; do
    @request.env['HTTP_AUTHORIZATION'] = encode_credentials('pretty', 'please')
    get :display

    assert_response :success
    assert assigns(:logged_in)
    assert_equal 'Definitely Maybe', @response.body
  end

  private

  def encode_credentials(username, password)
    &quot;Basic #{ActiveSupport::Base64.encode64(&quot;#{username}:#{password}&quot;)}&quot;
  end
end
</pre>
    </div>