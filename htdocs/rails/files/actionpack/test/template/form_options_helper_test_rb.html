  <div id="fileHeader">
    <h1>form_options_helper_test.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>actionpack/test/template/form_options_helper_test.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sun Jul 25 11:32:53 +0200 2010</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require 'abstract_unit'
require 'tzinfo'

TZInfo::Timezone.cattr_reader :loaded_zones

class FormOptionsHelperTest &lt; ActionView::TestCase
  tests ActionView::Helpers::FormOptionsHelper

  silence_warnings do
    Post        = Struct.new('Post', :title, :author_name, :body, :secret, :written_on, :category, :origin)
    Continent   = Struct.new('Continent', :continent_name, :countries)
    Country     = Struct.new('Country', :country_id, :country_name)
    Firm        = Struct.new('Firm', :time_zone)
    Album       = Struct.new('Album', :id, :title, :genre)
  end

  def setup
    @fake_timezones = %w(A B C D E).inject([]) do |zones, id|
      tz = TZInfo::Timezone.loaded_zones[id] = stub(:name =&gt; id, :to_s =&gt; id)
      ActiveSupport::TimeZone.stubs(:[]).with(id).returns(tz)
      zones &lt;&lt; tz
    end
    ActiveSupport::TimeZone.stubs(:all).returns(@fake_timezones)
  end

  def test_collection_options
    assert_dom_equal(
      &quot;&lt;option value=\&quot;&amp;lt;Abe&amp;gt;\&quot;&gt;&amp;lt;Abe&amp;gt; went home&lt;/option&gt;\n&lt;option value=\&quot;Babe\&quot;&gt;Babe went home&lt;/option&gt;\n&lt;option value=\&quot;Cabe\&quot;&gt;Cabe went home&lt;/option&gt;&quot;,
      options_from_collection_for_select(dummy_posts, &quot;author_name&quot;, &quot;title&quot;)
    )
  end


  def test_collection_options_with_preselected_value
    assert_dom_equal(
      &quot;&lt;option value=\&quot;&amp;lt;Abe&amp;gt;\&quot;&gt;&amp;lt;Abe&amp;gt; went home&lt;/option&gt;\n&lt;option value=\&quot;Babe\&quot; selected=\&quot;selected\&quot;&gt;Babe went home&lt;/option&gt;\n&lt;option value=\&quot;Cabe\&quot;&gt;Cabe went home&lt;/option&gt;&quot;,
      options_from_collection_for_select(dummy_posts, &quot;author_name&quot;, &quot;title&quot;, &quot;Babe&quot;)
    )
  end

  def test_collection_options_with_preselected_value_array
      assert_dom_equal(
        &quot;&lt;option value=\&quot;&amp;lt;Abe&amp;gt;\&quot;&gt;&amp;lt;Abe&amp;gt; went home&lt;/option&gt;\n&lt;option value=\&quot;Babe\&quot; selected=\&quot;selected\&quot;&gt;Babe went home&lt;/option&gt;\n&lt;option value=\&quot;Cabe\&quot; selected=\&quot;selected\&quot;&gt;Cabe went home&lt;/option&gt;&quot;,
        options_from_collection_for_select(dummy_posts, &quot;author_name&quot;, &quot;title&quot;, [ &quot;Babe&quot;, &quot;Cabe&quot; ])
      )
  end

  def test_collection_options_with_proc_for_selected
    assert_dom_equal(
      &quot;&lt;option value=\&quot;&amp;lt;Abe&amp;gt;\&quot;&gt;&amp;lt;Abe&amp;gt; went home&lt;/option&gt;\n&lt;option value=\&quot;Babe\&quot; selected=\&quot;selected\&quot;&gt;Babe went home&lt;/option&gt;\n&lt;option value=\&quot;Cabe\&quot;&gt;Cabe went home&lt;/option&gt;&quot;,
      options_from_collection_for_select(dummy_posts, &quot;author_name&quot;, &quot;title&quot;, lambda{|p| p.author_name == 'Babe' })
    )
  end

  def test_collection_options_with_disabled_value
    assert_dom_equal(
      &quot;&lt;option value=\&quot;&amp;lt;Abe&amp;gt;\&quot;&gt;&amp;lt;Abe&amp;gt; went home&lt;/option&gt;\n&lt;option value=\&quot;Babe\&quot; disabled=\&quot;disabled\&quot;&gt;Babe went home&lt;/option&gt;\n&lt;option value=\&quot;Cabe\&quot;&gt;Cabe went home&lt;/option&gt;&quot;,
      options_from_collection_for_select(dummy_posts, &quot;author_name&quot;, &quot;title&quot;, :disabled =&gt; &quot;Babe&quot;)
    )
  end

  def test_collection_options_with_disabled_array
    assert_dom_equal(
      &quot;&lt;option value=\&quot;&amp;lt;Abe&amp;gt;\&quot;&gt;&amp;lt;Abe&amp;gt; went home&lt;/option&gt;\n&lt;option value=\&quot;Babe\&quot; disabled=\&quot;disabled\&quot;&gt;Babe went home&lt;/option&gt;\n&lt;option value=\&quot;Cabe\&quot; disabled=\&quot;disabled\&quot;&gt;Cabe went home&lt;/option&gt;&quot;,
      options_from_collection_for_select(dummy_posts, &quot;author_name&quot;, &quot;title&quot;, :disabled =&gt; [ &quot;Babe&quot;, &quot;Cabe&quot; ])
    )
  end

  def test_collection_options_with_preselected_and_disabled_value
    assert_dom_equal(
      &quot;&lt;option value=\&quot;&amp;lt;Abe&amp;gt;\&quot;&gt;&amp;lt;Abe&amp;gt; went home&lt;/option&gt;\n&lt;option value=\&quot;Babe\&quot; disabled=\&quot;disabled\&quot;&gt;Babe went home&lt;/option&gt;\n&lt;option value=\&quot;Cabe\&quot; selected=\&quot;selected\&quot;&gt;Cabe went home&lt;/option&gt;&quot;,
      options_from_collection_for_select(dummy_posts, &quot;author_name&quot;, &quot;title&quot;, :selected =&gt; &quot;Cabe&quot;, :disabled =&gt; &quot;Babe&quot;)
    )
  end

  def test_collection_options_with_proc_for_disabled
    assert_dom_equal(
      &quot;&lt;option value=\&quot;&amp;lt;Abe&amp;gt;\&quot;&gt;&amp;lt;Abe&amp;gt; went home&lt;/option&gt;\n&lt;option value=\&quot;Babe\&quot; disabled=\&quot;disabled\&quot;&gt;Babe went home&lt;/option&gt;\n&lt;option value=\&quot;Cabe\&quot; disabled=\&quot;disabled\&quot;&gt;Cabe went home&lt;/option&gt;&quot;,
      options_from_collection_for_select(dummy_posts, &quot;author_name&quot;, &quot;title&quot;, :disabled =&gt; lambda{|p| %w(Babe Cabe).include? p.author_name })
    )
  end

  def test_string_options_for_select
    options = &quot;&lt;option value=\&quot;Denmark\&quot;&gt;Denmark&lt;/option&gt;&lt;option value=\&quot;USA\&quot;&gt;USA&lt;/option&gt;&lt;option value=\&quot;Sweden\&quot;&gt;Sweden&lt;/option&gt;&quot;
    assert_dom_equal(
      options,
      options_for_select(options)
    )
  end

  def test_array_options_for_select
    assert_dom_equal(
      &quot;&lt;option value=\&quot;&amp;lt;Denmark&amp;gt;\&quot;&gt;&amp;lt;Denmark&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;USA\&quot;&gt;USA&lt;/option&gt;\n&lt;option value=\&quot;Sweden\&quot;&gt;Sweden&lt;/option&gt;&quot;,
      options_for_select([ &quot;&lt;Denmark&gt;&quot;, &quot;USA&quot;, &quot;Sweden&quot; ])
    )
  end

  def test_array_options_for_select_with_selection
    assert_dom_equal(
      &quot;&lt;option value=\&quot;Denmark\&quot;&gt;Denmark&lt;/option&gt;\n&lt;option value=\&quot;&amp;lt;USA&amp;gt;\&quot; selected=\&quot;selected\&quot;&gt;&amp;lt;USA&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;Sweden\&quot;&gt;Sweden&lt;/option&gt;&quot;,
      options_for_select([ &quot;Denmark&quot;, &quot;&lt;USA&gt;&quot;, &quot;Sweden&quot; ], &quot;&lt;USA&gt;&quot;)
    )
  end

  def test_array_options_for_select_with_selection_array
      assert_dom_equal(
        &quot;&lt;option value=\&quot;Denmark\&quot;&gt;Denmark&lt;/option&gt;\n&lt;option value=\&quot;&amp;lt;USA&amp;gt;\&quot; selected=\&quot;selected\&quot;&gt;&amp;lt;USA&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;Sweden\&quot; selected=\&quot;selected\&quot;&gt;Sweden&lt;/option&gt;&quot;,
        options_for_select([ &quot;Denmark&quot;, &quot;&lt;USA&gt;&quot;, &quot;Sweden&quot; ], [ &quot;&lt;USA&gt;&quot;, &quot;Sweden&quot; ])
      )
  end

  def test_array_options_for_select_with_disabled_value
    assert_dom_equal(
      &quot;&lt;option value=\&quot;Denmark\&quot;&gt;Denmark&lt;/option&gt;\n&lt;option value=\&quot;&amp;lt;USA&amp;gt;\&quot; disabled=\&quot;disabled\&quot;&gt;&amp;lt;USA&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;Sweden\&quot;&gt;Sweden&lt;/option&gt;&quot;,
      options_for_select([ &quot;Denmark&quot;, &quot;&lt;USA&gt;&quot;, &quot;Sweden&quot; ], :disabled =&gt; &quot;&lt;USA&gt;&quot;)
    )
  end

  def test_array_options_for_select_with_disabled_array
    assert_dom_equal(
      &quot;&lt;option value=\&quot;Denmark\&quot;&gt;Denmark&lt;/option&gt;\n&lt;option value=\&quot;&amp;lt;USA&amp;gt;\&quot; disabled=\&quot;disabled\&quot;&gt;&amp;lt;USA&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;Sweden\&quot; disabled=\&quot;disabled\&quot;&gt;Sweden&lt;/option&gt;&quot;,
      options_for_select([ &quot;Denmark&quot;, &quot;&lt;USA&gt;&quot;, &quot;Sweden&quot; ], :disabled =&gt; [&quot;&lt;USA&gt;&quot;, &quot;Sweden&quot;])
    )
  end

  def test_array_options_for_select_with_selection_and_disabled_value
    assert_dom_equal(
      &quot;&lt;option value=\&quot;Denmark\&quot; selected=\&quot;selected\&quot;&gt;Denmark&lt;/option&gt;\n&lt;option value=\&quot;&amp;lt;USA&amp;gt;\&quot; disabled=\&quot;disabled\&quot;&gt;&amp;lt;USA&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;Sweden\&quot;&gt;Sweden&lt;/option&gt;&quot;,
      options_for_select([ &quot;Denmark&quot;, &quot;&lt;USA&gt;&quot;, &quot;Sweden&quot; ], :selected =&gt; &quot;Denmark&quot;, :disabled =&gt; &quot;&lt;USA&gt;&quot;)
    )
  end

  def test_array_options_for_string_include_in_other_string_bug_fix
      assert_dom_equal(
        &quot;&lt;option value=\&quot;ruby\&quot;&gt;ruby&lt;/option&gt;\n&lt;option value=\&quot;rubyonrails\&quot; selected=\&quot;selected\&quot;&gt;rubyonrails&lt;/option&gt;&quot;,
        options_for_select([ &quot;ruby&quot;, &quot;rubyonrails&quot; ], &quot;rubyonrails&quot;)
      )
      assert_dom_equal(
        &quot;&lt;option value=\&quot;ruby\&quot; selected=\&quot;selected\&quot;&gt;ruby&lt;/option&gt;\n&lt;option value=\&quot;rubyonrails\&quot;&gt;rubyonrails&lt;/option&gt;&quot;,
        options_for_select([ &quot;ruby&quot;, &quot;rubyonrails&quot; ], &quot;ruby&quot;)
      )
      assert_dom_equal(
        %(&lt;option value=&quot;ruby&quot; selected=&quot;selected&quot;&gt;ruby&lt;/option&gt;\n&lt;option value=&quot;rubyonrails&quot;&gt;rubyonrails&lt;/option&gt;\n&lt;option value=&quot;&quot;&gt;&lt;/option&gt;),
        options_for_select([ &quot;ruby&quot;, &quot;rubyonrails&quot;, nil ], &quot;ruby&quot;)
      )
  end

  def test_hash_options_for_select
    assert_dom_equal(
      &quot;&lt;option value=\&quot;&amp;lt;Kroner&amp;gt;\&quot;&gt;&amp;lt;DKR&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;Dollar\&quot;&gt;$&lt;/option&gt;&quot;,
      options_for_select(&quot;$&quot; =&gt; &quot;Dollar&quot;, &quot;&lt;DKR&gt;&quot; =&gt; &quot;&lt;Kroner&gt;&quot;).split(&quot;\n&quot;).sort.join(&quot;\n&quot;)
    )
    assert_dom_equal(
      &quot;&lt;option value=\&quot;&amp;lt;Kroner&amp;gt;\&quot;&gt;&amp;lt;DKR&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;Dollar\&quot; selected=\&quot;selected\&quot;&gt;$&lt;/option&gt;&quot;,
      options_for_select({ &quot;$&quot; =&gt; &quot;Dollar&quot;, &quot;&lt;DKR&gt;&quot; =&gt; &quot;&lt;Kroner&gt;&quot; }, &quot;Dollar&quot;).split(&quot;\n&quot;).sort.join(&quot;\n&quot;)
    )
    assert_dom_equal(
      &quot;&lt;option value=\&quot;&amp;lt;Kroner&amp;gt;\&quot; selected=\&quot;selected\&quot;&gt;&amp;lt;DKR&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;Dollar\&quot; selected=\&quot;selected\&quot;&gt;$&lt;/option&gt;&quot;,
      options_for_select({ &quot;$&quot; =&gt; &quot;Dollar&quot;, &quot;&lt;DKR&gt;&quot; =&gt; &quot;&lt;Kroner&gt;&quot; }, [ &quot;Dollar&quot;, &quot;&lt;Kroner&gt;&quot; ]).split(&quot;\n&quot;).sort.join(&quot;\n&quot;)
    )
  end

  def test_ducktyped_options_for_select
    quack = Struct.new(:first, :last)
    assert_dom_equal(
      &quot;&lt;option value=\&quot;&amp;lt;Kroner&amp;gt;\&quot;&gt;&amp;lt;DKR&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;Dollar\&quot;&gt;$&lt;/option&gt;&quot;,
      options_for_select([quack.new(&quot;&lt;DKR&gt;&quot;, &quot;&lt;Kroner&gt;&quot;), quack.new(&quot;$&quot;, &quot;Dollar&quot;)])
    )
    assert_dom_equal(
      &quot;&lt;option value=\&quot;&amp;lt;Kroner&amp;gt;\&quot;&gt;&amp;lt;DKR&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;Dollar\&quot; selected=\&quot;selected\&quot;&gt;$&lt;/option&gt;&quot;,
      options_for_select([quack.new(&quot;&lt;DKR&gt;&quot;, &quot;&lt;Kroner&gt;&quot;), quack.new(&quot;$&quot;, &quot;Dollar&quot;)], &quot;Dollar&quot;)
    )
    assert_dom_equal(
      &quot;&lt;option value=\&quot;&amp;lt;Kroner&amp;gt;\&quot; selected=\&quot;selected\&quot;&gt;&amp;lt;DKR&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;Dollar\&quot; selected=\&quot;selected\&quot;&gt;$&lt;/option&gt;&quot;,
      options_for_select([quack.new(&quot;&lt;DKR&gt;&quot;, &quot;&lt;Kroner&gt;&quot;), quack.new(&quot;$&quot;, &quot;Dollar&quot;)], [&quot;Dollar&quot;, &quot;&lt;Kroner&gt;&quot;])
    )
  end

  def test_option_groups_from_collection_for_select
    @continents = [
      Continent.new(&quot;&lt;Africa&gt;&quot;, [Country.new(&quot;&lt;sa&gt;&quot;, &quot;&lt;South Africa&gt;&quot;), Country.new(&quot;so&quot;, &quot;Somalia&quot;)] ),
      Continent.new(&quot;Europe&quot;, [Country.new(&quot;dk&quot;, &quot;Denmark&quot;), Country.new(&quot;ie&quot;, &quot;Ireland&quot;)] )
    ]

    assert_dom_equal(
      &quot;&lt;optgroup label=\&quot;&amp;lt;Africa&amp;gt;\&quot;&gt;&lt;option value=\&quot;&amp;lt;sa&amp;gt;\&quot;&gt;&amp;lt;South Africa&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;so\&quot;&gt;Somalia&lt;/option&gt;&lt;/optgroup&gt;&lt;optgroup label=\&quot;Europe\&quot;&gt;&lt;option value=\&quot;dk\&quot; selected=\&quot;selected\&quot;&gt;Denmark&lt;/option&gt;\n&lt;option value=\&quot;ie\&quot;&gt;Ireland&lt;/option&gt;&lt;/optgroup&gt;&quot;,
      option_groups_from_collection_for_select(@continents, &quot;countries&quot;, &quot;continent_name&quot;, &quot;country_id&quot;, &quot;country_name&quot;, &quot;dk&quot;)
    )
  end

  def test_grouped_options_for_select_with_array
    assert_dom_equal(
      &quot;&lt;optgroup label=\&quot;North America\&quot;&gt;&lt;option value=\&quot;US\&quot;&gt;United States&lt;/option&gt;\n&lt;option value=\&quot;Canada\&quot;&gt;Canada&lt;/option&gt;&lt;/optgroup&gt;&lt;optgroup label=\&quot;Europe\&quot;&gt;&lt;option value=\&quot;GB\&quot;&gt;Great Britain&lt;/option&gt;\n&lt;option value=\&quot;Germany\&quot;&gt;Germany&lt;/option&gt;&lt;/optgroup&gt;&quot;,
      grouped_options_for_select([
         [&quot;North America&quot;,
             [['United States','US'],&quot;Canada&quot;]],
         [&quot;Europe&quot;,
             [[&quot;Great Britain&quot;,&quot;GB&quot;], &quot;Germany&quot;]]
       ])
    )
  end

  def test_grouped_options_for_select_with_selected_and_prompt
    assert_dom_equal(
        &quot;&lt;option value=\&quot;\&quot;&gt;Choose a product...&lt;/option&gt;&lt;optgroup label=\&quot;Hats\&quot;&gt;&lt;option value=\&quot;Baseball Cap\&quot;&gt;Baseball Cap&lt;/option&gt;\n&lt;option selected=\&quot;selected\&quot; value=\&quot;Cowboy Hat\&quot;&gt;Cowboy Hat&lt;/option&gt;&lt;/optgroup&gt;&quot;,
        grouped_options_for_select([[&quot;Hats&quot;, [&quot;Baseball Cap&quot;,&quot;Cowboy Hat&quot;]]], &quot;Cowboy Hat&quot;, &quot;Choose a product...&quot;)
    )
  end

  def test_optgroups_with_with_options_with_hash
    assert_dom_equal(
       &quot;&lt;optgroup label=\&quot;Europe\&quot;&gt;&lt;option value=\&quot;Denmark\&quot;&gt;Denmark&lt;/option&gt;\n&lt;option value=\&quot;Germany\&quot;&gt;Germany&lt;/option&gt;&lt;/optgroup&gt;&lt;optgroup label=\&quot;North America\&quot;&gt;&lt;option value=\&quot;United States\&quot;&gt;United States&lt;/option&gt;\n&lt;option value=\&quot;Canada\&quot;&gt;Canada&lt;/option&gt;&lt;/optgroup&gt;&quot;,
       grouped_options_for_select({'North America' =&gt; ['United States','Canada'], 'Europe' =&gt; ['Denmark','Germany']})
    )
  end

  def test_time_zone_options_no_parms
    opts = time_zone_options_for_select
    assert_dom_equal &quot;&lt;option value=\&quot;A\&quot;&gt;A&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;B\&quot;&gt;B&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;C\&quot;&gt;C&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;D\&quot;&gt;D&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;E\&quot;&gt;E&lt;/option&gt;&quot;,
                 opts
  end

  def test_time_zone_options_with_selected
    opts = time_zone_options_for_select( &quot;D&quot; )
    assert_dom_equal &quot;&lt;option value=\&quot;A\&quot;&gt;A&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;B\&quot;&gt;B&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;C\&quot;&gt;C&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;D\&quot; selected=\&quot;selected\&quot;&gt;D&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;E\&quot;&gt;E&lt;/option&gt;&quot;,
                 opts
  end

  def test_time_zone_options_with_unknown_selected
    opts = time_zone_options_for_select( &quot;K&quot; )
    assert_dom_equal &quot;&lt;option value=\&quot;A\&quot;&gt;A&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;B\&quot;&gt;B&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;C\&quot;&gt;C&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;D\&quot;&gt;D&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;E\&quot;&gt;E&lt;/option&gt;&quot;,
                 opts
  end

  def test_time_zone_options_with_priority_zones
    zones = [ ActiveSupport::TimeZone.new( &quot;B&quot; ), ActiveSupport::TimeZone.new( &quot;E&quot; ) ]
    opts = time_zone_options_for_select( nil, zones )
    assert_dom_equal &quot;&lt;option value=\&quot;B\&quot;&gt;B&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;E\&quot;&gt;E&lt;/option&gt;&quot; +
                 &quot;&lt;option value=\&quot;\&quot; disabled=\&quot;disabled\&quot;&gt;-------------&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;A\&quot;&gt;A&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;C\&quot;&gt;C&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;D\&quot;&gt;D&lt;/option&gt;&quot;,
                 opts
  end

  def test_time_zone_options_with_selected_priority_zones
    zones = [ ActiveSupport::TimeZone.new( &quot;B&quot; ), ActiveSupport::TimeZone.new( &quot;E&quot; ) ]
    opts = time_zone_options_for_select( &quot;E&quot;, zones )
    assert_dom_equal &quot;&lt;option value=\&quot;B\&quot;&gt;B&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;E\&quot; selected=\&quot;selected\&quot;&gt;E&lt;/option&gt;&quot; +
                 &quot;&lt;option value=\&quot;\&quot; disabled=\&quot;disabled\&quot;&gt;-------------&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;A\&quot;&gt;A&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;C\&quot;&gt;C&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;D\&quot;&gt;D&lt;/option&gt;&quot;,
                 opts
  end

  def test_time_zone_options_with_unselected_priority_zones
    zones = [ ActiveSupport::TimeZone.new( &quot;B&quot; ), ActiveSupport::TimeZone.new( &quot;E&quot; ) ]
    opts = time_zone_options_for_select( &quot;C&quot;, zones )
    assert_dom_equal &quot;&lt;option value=\&quot;B\&quot;&gt;B&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;E\&quot;&gt;E&lt;/option&gt;&quot; +
                 &quot;&lt;option value=\&quot;\&quot; disabled=\&quot;disabled\&quot;&gt;-------------&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;A\&quot;&gt;A&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;C\&quot; selected=\&quot;selected\&quot;&gt;C&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;D\&quot;&gt;D&lt;/option&gt;&quot;,
                 opts
  end

  def test_select
    @post = Post.new
    @post.category = &quot;&lt;mus&gt;&quot;
    assert_dom_equal(
      &quot;&lt;select id=\&quot;post_category\&quot; name=\&quot;post[category]\&quot;&gt;&lt;option value=\&quot;abe\&quot;&gt;abe&lt;/option&gt;\n&lt;option value=\&quot;&amp;lt;mus&amp;gt;\&quot; selected=\&quot;selected\&quot;&gt;&amp;lt;mus&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;hest\&quot;&gt;hest&lt;/option&gt;&lt;/select&gt;&quot;,
      select(&quot;post&quot;, &quot;category&quot;, %w( abe &lt;mus&gt; hest))
    )
  end

  def test_select_under_fields_for
    @post = Post.new
    @post.category = &quot;&lt;mus&gt;&quot;

    fields_for :post, @post do |f|
      concat f.select(:category, %w( abe &lt;mus&gt; hest))
    end
  
    assert_dom_equal(
      &quot;&lt;select id=\&quot;post_category\&quot; name=\&quot;post[category]\&quot;&gt;&lt;option value=\&quot;abe\&quot;&gt;abe&lt;/option&gt;\n&lt;option value=\&quot;&amp;lt;mus&amp;gt;\&quot; selected=\&quot;selected\&quot;&gt;&amp;lt;mus&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;hest\&quot;&gt;hest&lt;/option&gt;&lt;/select&gt;&quot;,
      output_buffer
    )
  end

  def test_select_under_fields_for_with_index
    @post = Post.new
    @post.category = &quot;&lt;mus&gt;&quot;

    fields_for :post, @post, :index =&gt; 108 do |f|
      concat f.select(:category, %w( abe &lt;mus&gt; hest))
    end

    assert_dom_equal(
      &quot;&lt;select id=\&quot;post_108_category\&quot; name=\&quot;post[108][category]\&quot;&gt;&lt;option value=\&quot;abe\&quot;&gt;abe&lt;/option&gt;\n&lt;option value=\&quot;&amp;lt;mus&amp;gt;\&quot; selected=\&quot;selected\&quot;&gt;&amp;lt;mus&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;hest\&quot;&gt;hest&lt;/option&gt;&lt;/select&gt;&quot;,
      output_buffer
    )
  end

  def test_select_under_fields_for_with_auto_index
    @post = Post.new
    @post.category = &quot;&lt;mus&gt;&quot;
    def @post.to_param; 108; end

    fields_for &quot;post[]&quot;, @post do |f|
      concat f.select(:category, %w( abe &lt;mus&gt; hest))
    end

    assert_dom_equal(
      &quot;&lt;select id=\&quot;post_108_category\&quot; name=\&quot;post[108][category]\&quot;&gt;&lt;option value=\&quot;abe\&quot;&gt;abe&lt;/option&gt;\n&lt;option value=\&quot;&amp;lt;mus&amp;gt;\&quot; selected=\&quot;selected\&quot;&gt;&amp;lt;mus&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;hest\&quot;&gt;hest&lt;/option&gt;&lt;/select&gt;&quot;,
      output_buffer
    )
  end

  def test_select_under_fields_for_with_string_and_given_prompt
    @post = Post.new
    options = &quot;&lt;option value=\&quot;abe\&quot;&gt;abe&lt;/option&gt;&lt;option value=\&quot;mus\&quot;&gt;mus&lt;/option&gt;&lt;option value=\&quot;hest\&quot;&gt;hest&lt;/option&gt;&quot;

    fields_for :post, @post do |f|
      concat f.select(:category, options, :prompt =&gt; 'The prompt')
    end

    assert_dom_equal(
      &quot;&lt;select id=\&quot;post_category\&quot; name=\&quot;post[category]\&quot;&gt;&lt;option value=\&quot;\&quot;&gt;The prompt&lt;/option&gt;\n#{options}&lt;/select&gt;&quot;,
      output_buffer
    )
  end

  def test_select_with_blank
    @post = Post.new
    @post.category = &quot;&lt;mus&gt;&quot;
    assert_dom_equal(
      &quot;&lt;select id=\&quot;post_category\&quot; name=\&quot;post[category]\&quot;&gt;&lt;option value=\&quot;\&quot;&gt;&lt;/option&gt;\n&lt;option value=\&quot;abe\&quot;&gt;abe&lt;/option&gt;\n&lt;option value=\&quot;&amp;lt;mus&amp;gt;\&quot; selected=\&quot;selected\&quot;&gt;&amp;lt;mus&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;hest\&quot;&gt;hest&lt;/option&gt;&lt;/select&gt;&quot;,
      select(&quot;post&quot;, &quot;category&quot;, %w( abe &lt;mus&gt; hest), :include_blank =&gt; true)
    )
  end

  def test_select_with_blank_as_string
    @post = Post.new
    @post.category = &quot;&lt;mus&gt;&quot;
    assert_dom_equal(
      &quot;&lt;select id=\&quot;post_category\&quot; name=\&quot;post[category]\&quot;&gt;&lt;option value=\&quot;\&quot;&gt;None&lt;/option&gt;\n&lt;option value=\&quot;abe\&quot;&gt;abe&lt;/option&gt;\n&lt;option value=\&quot;&amp;lt;mus&amp;gt;\&quot; selected=\&quot;selected\&quot;&gt;&amp;lt;mus&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;hest\&quot;&gt;hest&lt;/option&gt;&lt;/select&gt;&quot;,
      select(&quot;post&quot;, &quot;category&quot;, %w( abe &lt;mus&gt; hest), :include_blank =&gt; 'None')
    )
  end

  def test_select_with_default_prompt
    @post = Post.new
    @post.category = &quot;&quot;
    assert_dom_equal(
      &quot;&lt;select id=\&quot;post_category\&quot; name=\&quot;post[category]\&quot;&gt;&lt;option value=\&quot;\&quot;&gt;Please select&lt;/option&gt;\n&lt;option value=\&quot;abe\&quot;&gt;abe&lt;/option&gt;\n&lt;option value=\&quot;&amp;lt;mus&amp;gt;\&quot;&gt;&amp;lt;mus&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;hest\&quot;&gt;hest&lt;/option&gt;&lt;/select&gt;&quot;,
      select(&quot;post&quot;, &quot;category&quot;, %w( abe &lt;mus&gt; hest), :prompt =&gt; true)
    )
  end

  def test_select_no_prompt_when_select_has_value
    @post = Post.new
    @post.category = &quot;&lt;mus&gt;&quot;
    assert_dom_equal(
      &quot;&lt;select id=\&quot;post_category\&quot; name=\&quot;post[category]\&quot;&gt;&lt;option value=\&quot;abe\&quot;&gt;abe&lt;/option&gt;\n&lt;option value=\&quot;&amp;lt;mus&amp;gt;\&quot; selected=\&quot;selected\&quot;&gt;&amp;lt;mus&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;hest\&quot;&gt;hest&lt;/option&gt;&lt;/select&gt;&quot;,
      select(&quot;post&quot;, &quot;category&quot;, %w( abe &lt;mus&gt; hest), :prompt =&gt; true)
    )
  end

  def test_select_with_given_prompt
    @post = Post.new
    @post.category = &quot;&quot;
    assert_dom_equal(
      &quot;&lt;select id=\&quot;post_category\&quot; name=\&quot;post[category]\&quot;&gt;&lt;option value=\&quot;\&quot;&gt;The prompt&lt;/option&gt;\n&lt;option value=\&quot;abe\&quot;&gt;abe&lt;/option&gt;\n&lt;option value=\&quot;&amp;lt;mus&amp;gt;\&quot;&gt;&amp;lt;mus&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;hest\&quot;&gt;hest&lt;/option&gt;&lt;/select&gt;&quot;,
      select(&quot;post&quot;, &quot;category&quot;, %w( abe &lt;mus&gt; hest), :prompt =&gt; 'The prompt')
    )
  end

  def test_select_with_prompt_and_blank
    @post = Post.new
    @post.category = &quot;&quot;
    assert_dom_equal(
      &quot;&lt;select id=\&quot;post_category\&quot; name=\&quot;post[category]\&quot;&gt;&lt;option value=\&quot;\&quot;&gt;Please select&lt;/option&gt;\n&lt;option value=\&quot;\&quot;&gt;&lt;/option&gt;\n&lt;option value=\&quot;abe\&quot;&gt;abe&lt;/option&gt;\n&lt;option value=\&quot;&amp;lt;mus&amp;gt;\&quot;&gt;&amp;lt;mus&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;hest\&quot;&gt;hest&lt;/option&gt;&lt;/select&gt;&quot;,
      select(&quot;post&quot;, &quot;category&quot;, %w( abe &lt;mus&gt; hest), :prompt =&gt; true, :include_blank =&gt; true)
    )
  end

  def test_select_with_selected_value
    @post = Post.new
    @post.category = &quot;&lt;mus&gt;&quot;
    assert_dom_equal(
      &quot;&lt;select id=\&quot;post_category\&quot; name=\&quot;post[category]\&quot;&gt;&lt;option value=\&quot;abe\&quot; selected=\&quot;selected\&quot;&gt;abe&lt;/option&gt;\n&lt;option value=\&quot;&amp;lt;mus&amp;gt;\&quot;&gt;&amp;lt;mus&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;hest\&quot;&gt;hest&lt;/option&gt;&lt;/select&gt;&quot;,
      select(&quot;post&quot;, &quot;category&quot;, %w( abe &lt;mus&gt; hest ), :selected =&gt; 'abe')
    )
  end

  def test_select_with_index_option
    @album = Album.new
    @album.id = 1
  
    expected = &quot;&lt;select id=\&quot;album__genre\&quot; name=\&quot;album[][genre]\&quot;&gt;&lt;option value=\&quot;rap\&quot;&gt;rap&lt;/option&gt;\n&lt;option value=\&quot;rock\&quot;&gt;rock&lt;/option&gt;\n&lt;option value=\&quot;country\&quot;&gt;country&lt;/option&gt;&lt;/select&gt;&quot;    

    assert_dom_equal(
      expected, 
      select(&quot;album[]&quot;, &quot;genre&quot;, %w[rap rock country], {}, { :index =&gt; nil })
    )
  end

  def test_select_with_selected_nil
    @post = Post.new
    @post.category = &quot;&lt;mus&gt;&quot;
    assert_dom_equal(
      &quot;&lt;select id=\&quot;post_category\&quot; name=\&quot;post[category]\&quot;&gt;&lt;option value=\&quot;abe\&quot;&gt;abe&lt;/option&gt;\n&lt;option value=\&quot;&amp;lt;mus&amp;gt;\&quot;&gt;&amp;lt;mus&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;hest\&quot;&gt;hest&lt;/option&gt;&lt;/select&gt;&quot;,
      select(&quot;post&quot;, &quot;category&quot;, %w( abe &lt;mus&gt; hest ), :selected =&gt; nil)
    )
  end

  def test_select_with_disabled_value
    @post = Post.new
    @post.category = &quot;&lt;mus&gt;&quot;
    assert_dom_equal(
      &quot;&lt;select id=\&quot;post_category\&quot; name=\&quot;post[category]\&quot;&gt;&lt;option value=\&quot;abe\&quot;&gt;abe&lt;/option&gt;\n&lt;option value=\&quot;&amp;lt;mus&amp;gt;\&quot; selected=\&quot;selected\&quot;&gt;&amp;lt;mus&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;hest\&quot; disabled=\&quot;disabled\&quot;&gt;hest&lt;/option&gt;&lt;/select&gt;&quot;,
      select(&quot;post&quot;, &quot;category&quot;, %w( abe &lt;mus&gt; hest ), :disabled =&gt; 'hest')
    )
  end

  def test_select_with_disabled_array
    @post = Post.new
    @post.category = &quot;&lt;mus&gt;&quot;
    assert_dom_equal(
      &quot;&lt;select id=\&quot;post_category\&quot; name=\&quot;post[category]\&quot;&gt;&lt;option value=\&quot;abe\&quot; disabled=\&quot;disabled\&quot;&gt;abe&lt;/option&gt;\n&lt;option value=\&quot;&amp;lt;mus&amp;gt;\&quot; selected=\&quot;selected\&quot;&gt;&amp;lt;mus&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;hest\&quot; disabled=\&quot;disabled\&quot;&gt;hest&lt;/option&gt;&lt;/select&gt;&quot;,
      select(&quot;post&quot;, &quot;category&quot;, %w( abe &lt;mus&gt; hest ), :disabled =&gt; ['hest', 'abe'])
    )
  end

  def test_collection_select
    @post = Post.new
    @post.author_name = &quot;Babe&quot;

    assert_dom_equal(
      &quot;&lt;select id=\&quot;post_author_name\&quot; name=\&quot;post[author_name]\&quot;&gt;&lt;option value=\&quot;&amp;lt;Abe&amp;gt;\&quot;&gt;&amp;lt;Abe&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;Babe\&quot; selected=\&quot;selected\&quot;&gt;Babe&lt;/option&gt;\n&lt;option value=\&quot;Cabe\&quot;&gt;Cabe&lt;/option&gt;&lt;/select&gt;&quot;,
      collection_select(&quot;post&quot;, &quot;author_name&quot;, dummy_posts, &quot;author_name&quot;, &quot;author_name&quot;)
    )
  end

  def test_collection_select_under_fields_for
    @post = Post.new
    @post.author_name = &quot;Babe&quot;

    fields_for :post, @post do |f|
      concat f.collection_select(:author_name, dummy_posts, :author_name, :author_name)
    end
  
    assert_dom_equal(
      &quot;&lt;select id=\&quot;post_author_name\&quot; name=\&quot;post[author_name]\&quot;&gt;&lt;option value=\&quot;&amp;lt;Abe&amp;gt;\&quot;&gt;&amp;lt;Abe&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;Babe\&quot; selected=\&quot;selected\&quot;&gt;Babe&lt;/option&gt;\n&lt;option value=\&quot;Cabe\&quot;&gt;Cabe&lt;/option&gt;&lt;/select&gt;&quot;,
      output_buffer
    )
  end

  def test_collection_select_under_fields_for_with_index
    @post = Post.new
    @post.author_name = &quot;Babe&quot;

    fields_for :post, @post, :index =&gt; 815 do |f|
      concat f.collection_select(:author_name, dummy_posts, :author_name, :author_name)
    end

    assert_dom_equal(
      &quot;&lt;select id=\&quot;post_815_author_name\&quot; name=\&quot;post[815][author_name]\&quot;&gt;&lt;option value=\&quot;&amp;lt;Abe&amp;gt;\&quot;&gt;&amp;lt;Abe&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;Babe\&quot; selected=\&quot;selected\&quot;&gt;Babe&lt;/option&gt;\n&lt;option value=\&quot;Cabe\&quot;&gt;Cabe&lt;/option&gt;&lt;/select&gt;&quot;,
      output_buffer
    )
  end

  def test_collection_select_under_fields_for_with_auto_index
    @post = Post.new
    @post.author_name = &quot;Babe&quot;
    def @post.to_param; 815; end

    fields_for &quot;post[]&quot;, @post do |f|
      concat f.collection_select(:author_name, dummy_posts, :author_name, :author_name)
    end

    assert_dom_equal(
      &quot;&lt;select id=\&quot;post_815_author_name\&quot; name=\&quot;post[815][author_name]\&quot;&gt;&lt;option value=\&quot;&amp;lt;Abe&amp;gt;\&quot;&gt;&amp;lt;Abe&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;Babe\&quot; selected=\&quot;selected\&quot;&gt;Babe&lt;/option&gt;\n&lt;option value=\&quot;Cabe\&quot;&gt;Cabe&lt;/option&gt;&lt;/select&gt;&quot;,
      output_buffer
    )
  end

  def test_collection_select_with_blank_and_style
    @post = Post.new
    @post.author_name = &quot;Babe&quot;

    assert_dom_equal(
      &quot;&lt;select id=\&quot;post_author_name\&quot; name=\&quot;post[author_name]\&quot; style=\&quot;width: 200px\&quot;&gt;&lt;option value=\&quot;\&quot;&gt;&lt;/option&gt;\n&lt;option value=\&quot;&amp;lt;Abe&amp;gt;\&quot;&gt;&amp;lt;Abe&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;Babe\&quot; selected=\&quot;selected\&quot;&gt;Babe&lt;/option&gt;\n&lt;option value=\&quot;Cabe\&quot;&gt;Cabe&lt;/option&gt;&lt;/select&gt;&quot;,
      collection_select(&quot;post&quot;, &quot;author_name&quot;, dummy_posts, &quot;author_name&quot;, &quot;author_name&quot;, { :include_blank =&gt; true }, &quot;style&quot; =&gt; &quot;width: 200px&quot;)
    )
  end

  def test_collection_select_with_blank_as_string_and_style
    @post = Post.new
    @post.author_name = &quot;Babe&quot;

    assert_dom_equal(
      &quot;&lt;select id=\&quot;post_author_name\&quot; name=\&quot;post[author_name]\&quot; style=\&quot;width: 200px\&quot;&gt;&lt;option value=\&quot;\&quot;&gt;No Selection&lt;/option&gt;\n&lt;option value=\&quot;&amp;lt;Abe&amp;gt;\&quot;&gt;&amp;lt;Abe&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;Babe\&quot; selected=\&quot;selected\&quot;&gt;Babe&lt;/option&gt;\n&lt;option value=\&quot;Cabe\&quot;&gt;Cabe&lt;/option&gt;&lt;/select&gt;&quot;,
      collection_select(&quot;post&quot;, &quot;author_name&quot;, dummy_posts, &quot;author_name&quot;, &quot;author_name&quot;, { :include_blank =&gt; 'No Selection' }, &quot;style&quot; =&gt; &quot;width: 200px&quot;)
    )
  end

  def test_collection_select_with_multiple_option_appends_array_brackets
    @post = Post.new
    @post.author_name = &quot;Babe&quot;

    expected = &quot;&lt;select id=\&quot;post_author_name\&quot; name=\&quot;post[author_name][]\&quot; multiple=\&quot;multiple\&quot;&gt;&lt;option value=\&quot;\&quot;&gt;&lt;/option&gt;\n&lt;option value=\&quot;&amp;lt;Abe&amp;gt;\&quot;&gt;&amp;lt;Abe&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;Babe\&quot; selected=\&quot;selected\&quot;&gt;Babe&lt;/option&gt;\n&lt;option value=\&quot;Cabe\&quot;&gt;Cabe&lt;/option&gt;&lt;/select&gt;&quot;

    # Should suffix default name with [].
    assert_dom_equal expected, collection_select(&quot;post&quot;, &quot;author_name&quot;, dummy_posts, &quot;author_name&quot;, &quot;author_name&quot;, { :include_blank =&gt; true }, :multiple =&gt; true)

    # Shouldn't suffix custom name with [].
    assert_dom_equal expected, collection_select(&quot;post&quot;, &quot;author_name&quot;, dummy_posts, &quot;author_name&quot;, &quot;author_name&quot;, { :include_blank =&gt; true, :name =&gt; 'post[author_name][]' }, :multiple =&gt; true)
  end

  def test_collection_select_with_blank_and_selected
    @post = Post.new
    @post.author_name = &quot;Babe&quot;

    assert_dom_equal(
      %{&lt;select id=&quot;post_author_name&quot; name=&quot;post[author_name]&quot;&gt;&lt;option value=&quot;&quot;&gt;&lt;/option&gt;\n&lt;option value=&quot;&amp;lt;Abe&amp;gt;&quot; selected=&quot;selected&quot;&gt;&amp;lt;Abe&amp;gt;&lt;/option&gt;\n&lt;option value=&quot;Babe&quot;&gt;Babe&lt;/option&gt;\n&lt;option value=&quot;Cabe&quot;&gt;Cabe&lt;/option&gt;&lt;/select&gt;},
      collection_select(&quot;post&quot;, &quot;author_name&quot;, dummy_posts, &quot;author_name&quot;, &quot;author_name&quot;, {:include_blank =&gt; true, :selected =&gt; &quot;&lt;Abe&gt;&quot;})
    )
  end

  def test_collection_select_with_disabled
    @post = Post.new
    @post.author_name = &quot;Babe&quot;

    assert_dom_equal(
      &quot;&lt;select id=\&quot;post_author_name\&quot; name=\&quot;post[author_name]\&quot;&gt;&lt;option value=\&quot;&amp;lt;Abe&amp;gt;\&quot;&gt;&amp;lt;Abe&amp;gt;&lt;/option&gt;\n&lt;option value=\&quot;Babe\&quot; selected=\&quot;selected\&quot;&gt;Babe&lt;/option&gt;\n&lt;option value=\&quot;Cabe\&quot; disabled=\&quot;disabled\&quot;&gt;Cabe&lt;/option&gt;&lt;/select&gt;&quot;,
      collection_select(&quot;post&quot;, &quot;author_name&quot;, dummy_posts, &quot;author_name&quot;, &quot;author_name&quot;, :disabled =&gt; 'Cabe')
       )
  end

  def test_time_zone_select
    @firm = Firm.new(&quot;D&quot;)
    html = time_zone_select( &quot;firm&quot;, &quot;time_zone&quot; )
    assert_dom_equal &quot;&lt;select id=\&quot;firm_time_zone\&quot; name=\&quot;firm[time_zone]\&quot;&gt;&quot; +
                 &quot;&lt;option value=\&quot;A\&quot;&gt;A&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;B\&quot;&gt;B&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;C\&quot;&gt;C&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;D\&quot; selected=\&quot;selected\&quot;&gt;D&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;E\&quot;&gt;E&lt;/option&gt;&quot; +
                 &quot;&lt;/select&gt;&quot;,
                 html
  end

  def test_time_zone_select_under_fields_for
    @firm = Firm.new(&quot;D&quot;)

    fields_for :firm, @firm do |f|
      concat f.time_zone_select(:time_zone)
    end
  
    assert_dom_equal(
      &quot;&lt;select id=\&quot;firm_time_zone\&quot; name=\&quot;firm[time_zone]\&quot;&gt;&quot; +
      &quot;&lt;option value=\&quot;A\&quot;&gt;A&lt;/option&gt;\n&quot; +
      &quot;&lt;option value=\&quot;B\&quot;&gt;B&lt;/option&gt;\n&quot; +
      &quot;&lt;option value=\&quot;C\&quot;&gt;C&lt;/option&gt;\n&quot; +
      &quot;&lt;option value=\&quot;D\&quot; selected=\&quot;selected\&quot;&gt;D&lt;/option&gt;\n&quot; +
      &quot;&lt;option value=\&quot;E\&quot;&gt;E&lt;/option&gt;&quot; +
      &quot;&lt;/select&gt;&quot;,
      output_buffer
    )
  end

  def test_time_zone_select_under_fields_for_with_index
    @firm = Firm.new(&quot;D&quot;)

    fields_for :firm, @firm, :index =&gt; 305 do |f|
      concat f.time_zone_select(:time_zone)
    end

    assert_dom_equal(
      &quot;&lt;select id=\&quot;firm_305_time_zone\&quot; name=\&quot;firm[305][time_zone]\&quot;&gt;&quot; +
      &quot;&lt;option value=\&quot;A\&quot;&gt;A&lt;/option&gt;\n&quot; +
      &quot;&lt;option value=\&quot;B\&quot;&gt;B&lt;/option&gt;\n&quot; +
      &quot;&lt;option value=\&quot;C\&quot;&gt;C&lt;/option&gt;\n&quot; +
      &quot;&lt;option value=\&quot;D\&quot; selected=\&quot;selected\&quot;&gt;D&lt;/option&gt;\n&quot; +
      &quot;&lt;option value=\&quot;E\&quot;&gt;E&lt;/option&gt;&quot; +
      &quot;&lt;/select&gt;&quot;,
      output_buffer
    )
  end

  def test_time_zone_select_under_fields_for_with_auto_index
    @firm = Firm.new(&quot;D&quot;)
    def @firm.to_param; 305; end

    fields_for &quot;firm[]&quot;, @firm do |f|
      concat f.time_zone_select(:time_zone)
    end

    assert_dom_equal(
      &quot;&lt;select id=\&quot;firm_305_time_zone\&quot; name=\&quot;firm[305][time_zone]\&quot;&gt;&quot; +
      &quot;&lt;option value=\&quot;A\&quot;&gt;A&lt;/option&gt;\n&quot; +
      &quot;&lt;option value=\&quot;B\&quot;&gt;B&lt;/option&gt;\n&quot; +
      &quot;&lt;option value=\&quot;C\&quot;&gt;C&lt;/option&gt;\n&quot; +
      &quot;&lt;option value=\&quot;D\&quot; selected=\&quot;selected\&quot;&gt;D&lt;/option&gt;\n&quot; +
      &quot;&lt;option value=\&quot;E\&quot;&gt;E&lt;/option&gt;&quot; +
      &quot;&lt;/select&gt;&quot;,
      output_buffer
    )
  end

  def test_time_zone_select_with_blank
    @firm = Firm.new(&quot;D&quot;)
    html = time_zone_select(&quot;firm&quot;, &quot;time_zone&quot;, nil, :include_blank =&gt; true)
    assert_dom_equal &quot;&lt;select id=\&quot;firm_time_zone\&quot; name=\&quot;firm[time_zone]\&quot;&gt;&quot; +
                 &quot;&lt;option value=\&quot;\&quot;&gt;&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;A\&quot;&gt;A&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;B\&quot;&gt;B&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;C\&quot;&gt;C&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;D\&quot; selected=\&quot;selected\&quot;&gt;D&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;E\&quot;&gt;E&lt;/option&gt;&quot; +
                 &quot;&lt;/select&gt;&quot;,
                 html
  end

  def test_time_zone_select_with_blank_as_string
    @firm = Firm.new(&quot;D&quot;)
    html = time_zone_select(&quot;firm&quot;, &quot;time_zone&quot;, nil, :include_blank =&gt; 'No Zone')
    assert_dom_equal &quot;&lt;select id=\&quot;firm_time_zone\&quot; name=\&quot;firm[time_zone]\&quot;&gt;&quot; +
                 &quot;&lt;option value=\&quot;\&quot;&gt;No Zone&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;A\&quot;&gt;A&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;B\&quot;&gt;B&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;C\&quot;&gt;C&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;D\&quot; selected=\&quot;selected\&quot;&gt;D&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;E\&quot;&gt;E&lt;/option&gt;&quot; +
                 &quot;&lt;/select&gt;&quot;,
                 html
  end

  def test_time_zone_select_with_style
    @firm = Firm.new(&quot;D&quot;)
    html = time_zone_select(&quot;firm&quot;, &quot;time_zone&quot;, nil, {},
      &quot;style&quot; =&gt; &quot;color: red&quot;)
    assert_dom_equal &quot;&lt;select id=\&quot;firm_time_zone\&quot; name=\&quot;firm[time_zone]\&quot; style=\&quot;color: red\&quot;&gt;&quot; +
                 &quot;&lt;option value=\&quot;A\&quot;&gt;A&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;B\&quot;&gt;B&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;C\&quot;&gt;C&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;D\&quot; selected=\&quot;selected\&quot;&gt;D&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;E\&quot;&gt;E&lt;/option&gt;&quot; +
                 &quot;&lt;/select&gt;&quot;,
                 html
    assert_dom_equal html, time_zone_select(&quot;firm&quot;, &quot;time_zone&quot;, nil, {},
      :style =&gt; &quot;color: red&quot;)
  end

  def test_time_zone_select_with_blank_and_style
    @firm = Firm.new(&quot;D&quot;)
    html = time_zone_select(&quot;firm&quot;, &quot;time_zone&quot;, nil,
      { :include_blank =&gt; true }, &quot;style&quot; =&gt; &quot;color: red&quot;)
    assert_dom_equal &quot;&lt;select id=\&quot;firm_time_zone\&quot; name=\&quot;firm[time_zone]\&quot; style=\&quot;color: red\&quot;&gt;&quot; +
                 &quot;&lt;option value=\&quot;\&quot;&gt;&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;A\&quot;&gt;A&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;B\&quot;&gt;B&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;C\&quot;&gt;C&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;D\&quot; selected=\&quot;selected\&quot;&gt;D&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;E\&quot;&gt;E&lt;/option&gt;&quot; +
                 &quot;&lt;/select&gt;&quot;,
                 html
    assert_dom_equal html, time_zone_select(&quot;firm&quot;, &quot;time_zone&quot;, nil,
      { :include_blank =&gt; true }, :style =&gt; &quot;color: red&quot;)
  end

  def test_time_zone_select_with_blank_as_string_and_style
    @firm = Firm.new(&quot;D&quot;)
    html = time_zone_select(&quot;firm&quot;, &quot;time_zone&quot;, nil,
      { :include_blank =&gt; 'No Zone' }, &quot;style&quot; =&gt; &quot;color: red&quot;)
    assert_dom_equal &quot;&lt;select id=\&quot;firm_time_zone\&quot; name=\&quot;firm[time_zone]\&quot; style=\&quot;color: red\&quot;&gt;&quot; +
                 &quot;&lt;option value=\&quot;\&quot;&gt;No Zone&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;A\&quot;&gt;A&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;B\&quot;&gt;B&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;C\&quot;&gt;C&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;D\&quot; selected=\&quot;selected\&quot;&gt;D&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;E\&quot;&gt;E&lt;/option&gt;&quot; +
                 &quot;&lt;/select&gt;&quot;,
                 html
    assert_dom_equal html, time_zone_select(&quot;firm&quot;, &quot;time_zone&quot;, nil,
      { :include_blank =&gt; 'No Zone' }, :style =&gt; &quot;color: red&quot;)
  end

  def test_time_zone_select_with_priority_zones
    @firm = Firm.new(&quot;D&quot;)
    zones = [ ActiveSupport::TimeZone.new(&quot;A&quot;), ActiveSupport::TimeZone.new(&quot;D&quot;) ]
    html = time_zone_select(&quot;firm&quot;, &quot;time_zone&quot;, zones )
    assert_dom_equal &quot;&lt;select id=\&quot;firm_time_zone\&quot; name=\&quot;firm[time_zone]\&quot;&gt;&quot; +
                 &quot;&lt;option value=\&quot;A\&quot;&gt;A&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;D\&quot; selected=\&quot;selected\&quot;&gt;D&lt;/option&gt;&quot; +
                 &quot;&lt;option value=\&quot;\&quot; disabled=\&quot;disabled\&quot;&gt;-------------&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;B\&quot;&gt;B&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;C\&quot;&gt;C&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;E\&quot;&gt;E&lt;/option&gt;&quot; +
                 &quot;&lt;/select&gt;&quot;,
                 html
  end

  def test_time_zone_select_with_priority_zones_as_regexp
    @firm = Firm.new(&quot;D&quot;)
    @fake_timezones.each_with_index do |tz, i|
      tz.stubs(:=~).returns(i.zero? || i == 3)
    end

    html = time_zone_select(&quot;firm&quot;, &quot;time_zone&quot;, /A|D/)
    assert_dom_equal &quot;&lt;select id=\&quot;firm_time_zone\&quot; name=\&quot;firm[time_zone]\&quot;&gt;&quot; +
                 &quot;&lt;option value=\&quot;A\&quot;&gt;A&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;D\&quot; selected=\&quot;selected\&quot;&gt;D&lt;/option&gt;&quot; +
                 &quot;&lt;option value=\&quot;\&quot; disabled=\&quot;disabled\&quot;&gt;-------------&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;B\&quot;&gt;B&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;C\&quot;&gt;C&lt;/option&gt;\n&quot; +
                 &quot;&lt;option value=\&quot;E\&quot;&gt;E&lt;/option&gt;&quot; +
                 &quot;&lt;/select&gt;&quot;,
                 html
  end

  def test_time_zone_select_with_default_time_zone_and_nil_value
     @firm = Firm.new()
     @firm.time_zone = nil
      html = time_zone_select( &quot;firm&quot;, &quot;time_zone&quot;, nil, :default =&gt; 'B' )
      assert_dom_equal &quot;&lt;select id=\&quot;firm_time_zone\&quot; name=\&quot;firm[time_zone]\&quot;&gt;&quot; +
                   &quot;&lt;option value=\&quot;A\&quot;&gt;A&lt;/option&gt;\n&quot; +
                   &quot;&lt;option value=\&quot;B\&quot; selected=\&quot;selected\&quot;&gt;B&lt;/option&gt;\n&quot; +
                   &quot;&lt;option value=\&quot;C\&quot;&gt;C&lt;/option&gt;\n&quot; +
                   &quot;&lt;option value=\&quot;D\&quot;&gt;D&lt;/option&gt;\n&quot; +
                   &quot;&lt;option value=\&quot;E\&quot;&gt;E&lt;/option&gt;&quot; +
                   &quot;&lt;/select&gt;&quot;,
                   html
  end

  def test_time_zone_select_with_default_time_zone_and_value
     @firm = Firm.new('D')
      html = time_zone_select( &quot;firm&quot;, &quot;time_zone&quot;, nil, :default =&gt; 'B' )
      assert_dom_equal &quot;&lt;select id=\&quot;firm_time_zone\&quot; name=\&quot;firm[time_zone]\&quot;&gt;&quot; +
                   &quot;&lt;option value=\&quot;A\&quot;&gt;A&lt;/option&gt;\n&quot; +
                   &quot;&lt;option value=\&quot;B\&quot;&gt;B&lt;/option&gt;\n&quot; +
                   &quot;&lt;option value=\&quot;C\&quot;&gt;C&lt;/option&gt;\n&quot; +
                   &quot;&lt;option value=\&quot;D\&quot; selected=\&quot;selected\&quot;&gt;D&lt;/option&gt;\n&quot; +
                   &quot;&lt;option value=\&quot;E\&quot;&gt;E&lt;/option&gt;&quot; +
                   &quot;&lt;/select&gt;&quot;,
                   html
  end

  def test_grouped_collection_select
    @continents = [
      Continent.new(&quot;&lt;Africa&gt;&quot;, [Country.new(&quot;&lt;sa&gt;&quot;, &quot;&lt;South Africa&gt;&quot;), Country.new(&quot;so&quot;, &quot;Somalia&quot;)] ),
      Continent.new(&quot;Europe&quot;, [Country.new(&quot;dk&quot;, &quot;Denmark&quot;), Country.new(&quot;ie&quot;, &quot;Ireland&quot;)] )
    ]

    @post = Post.new
    @post.origin = 'dk'

    assert_dom_equal(
      %Q{&lt;select id=&quot;post_origin&quot; name=&quot;post[origin]&quot;&gt;&lt;optgroup label=&quot;&amp;lt;Africa&amp;gt;&quot;&gt;&lt;option value=&quot;&amp;lt;sa&amp;gt;&quot;&gt;&amp;lt;South Africa&amp;gt;&lt;/option&gt;\n&lt;option value=&quot;so&quot;&gt;Somalia&lt;/option&gt;&lt;/optgroup&gt;&lt;optgroup label=&quot;Europe&quot;&gt;&lt;option value=&quot;dk&quot; selected=&quot;selected&quot;&gt;Denmark&lt;/option&gt;\n&lt;option value=&quot;ie&quot;&gt;Ireland&lt;/option&gt;&lt;/optgroup&gt;&lt;/select&gt;},
      grouped_collection_select(&quot;post&quot;, &quot;origin&quot;, @continents, :countries, :continent_name, :country_id, :country_name)
    )
  end

  def test_grouped_collection_select_under_fields_for
    @continents = [
      Continent.new(&quot;&lt;Africa&gt;&quot;, [Country.new(&quot;&lt;sa&gt;&quot;, &quot;&lt;South Africa&gt;&quot;), Country.new(&quot;so&quot;, &quot;Somalia&quot;)] ),
      Continent.new(&quot;Europe&quot;, [Country.new(&quot;dk&quot;, &quot;Denmark&quot;), Country.new(&quot;ie&quot;, &quot;Ireland&quot;)] )
    ]

    @post = Post.new
    @post.origin = 'dk'

    fields_for :post, @post do |f|
      concat f.grouped_collection_select(&quot;origin&quot;, @continents, :countries, :continent_name, :country_id, :country_name)
    end

    assert_dom_equal(
      %Q{&lt;select id=&quot;post_origin&quot; name=&quot;post[origin]&quot;&gt;&lt;optgroup label=&quot;&amp;lt;Africa&amp;gt;&quot;&gt;&lt;option value=&quot;&amp;lt;sa&amp;gt;&quot;&gt;&amp;lt;South Africa&amp;gt;&lt;/option&gt;\n&lt;option value=&quot;so&quot;&gt;Somalia&lt;/option&gt;&lt;/optgroup&gt;&lt;optgroup label=&quot;Europe&quot;&gt;&lt;option value=&quot;dk&quot; selected=&quot;selected&quot;&gt;Denmark&lt;/option&gt;\n&lt;option value=&quot;ie&quot;&gt;Ireland&lt;/option&gt;&lt;/optgroup&gt;&lt;/select&gt;},
      output_buffer
    )
  end

  private

    def dummy_posts
      [ Post.new(&quot;&lt;Abe&gt; went home&quot;, &quot;&lt;Abe&gt;&quot;, &quot;To a little house&quot;, &quot;shh!&quot;),
        Post.new(&quot;Babe went home&quot;, &quot;Babe&quot;, &quot;To a little house&quot;, &quot;shh!&quot;),
        Post.new(&quot;Cabe went home&quot;, &quot;Cabe&quot;, &quot;To a little house&quot;, &quot;shh!&quot;) ]
    end
end
</pre>
    </div>