  <div id="fileHeader">
    <h1>tag_helper_test.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>actionpack/test/template/tag_helper_test.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sun Jul 25 11:32:53 +0200 2010</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require 'abstract_unit'

class TagHelperTest &lt; ActionView::TestCase
  tests ActionView::Helpers::TagHelper

  def test_tag
    assert_equal &quot;&lt;br /&gt;&quot;, tag(&quot;br&quot;)
    assert_equal &quot;&lt;br clear=\&quot;left\&quot; /&gt;&quot;, tag(:br, :clear =&gt; &quot;left&quot;)
    assert_equal &quot;&lt;br&gt;&quot;, tag(&quot;br&quot;, nil, true)
  end

  def test_tag_options
    str = tag(&quot;p&quot;, &quot;class&quot; =&gt; &quot;show&quot;, :class =&gt; &quot;elsewhere&quot;)
    assert_match /class=&quot;show&quot;/, str
    assert_match /class=&quot;elsewhere&quot;/, str
  end

  def test_tag_options_rejects_nil_option
    assert_equal &quot;&lt;p /&gt;&quot;, tag(&quot;p&quot;, :ignored =&gt; nil)
  end

  def test_tag_options_accepts_false_option
    assert_equal &quot;&lt;p value=\&quot;false\&quot; /&gt;&quot;, tag(&quot;p&quot;, :value =&gt; false)
  end

  def test_tag_options_accepts_blank_option
    assert_equal &quot;&lt;p included=\&quot;\&quot; /&gt;&quot;, tag(&quot;p&quot;, :included =&gt; '')
  end

  def test_tag_options_converts_boolean_option
    assert_equal '&lt;p disabled=&quot;disabled&quot; multiple=&quot;multiple&quot; readonly=&quot;readonly&quot; /&gt;',
      tag(&quot;p&quot;, :disabled =&gt; true, :multiple =&gt; true, :readonly =&gt; true)
  end

  def test_content_tag
    assert_equal &quot;&lt;a href=\&quot;create\&quot;&gt;Create&lt;/a&gt;&quot;, content_tag(&quot;a&quot;, &quot;Create&quot;, &quot;href&quot; =&gt; &quot;create&quot;)
    assert content_tag(&quot;a&quot;, &quot;Create&quot;, &quot;href&quot; =&gt; &quot;create&quot;).html_safe?
    assert_equal content_tag(&quot;a&quot;, &quot;Create&quot;, &quot;href&quot; =&gt; &quot;create&quot;),
                 content_tag(&quot;a&quot;, &quot;Create&quot;, :href =&gt; &quot;create&quot;)
  end

  def test_content_tag_with_block_in_erb
    __in_erb_template = ''
    content_tag(:div) { concat &quot;Hello world!&quot; }
    assert_dom_equal &quot;&lt;div&gt;Hello world!&lt;/div&gt;&quot;, output_buffer
  end

  def test_content_tag_with_block_and_options_in_erb
    __in_erb_template = ''
    content_tag(:div, :class =&gt; &quot;green&quot;) { concat &quot;Hello world!&quot; }
    assert_dom_equal %(&lt;div class=&quot;green&quot;&gt;Hello world!&lt;/div&gt;), output_buffer
  end

  def test_content_tag_with_block_and_options_out_of_erb
    assert_dom_equal %(&lt;div class=&quot;green&quot;&gt;Hello world!&lt;/div&gt;), content_tag(:div, :class =&gt; &quot;green&quot;) { &quot;Hello world!&quot; }
  end

  def test_content_tag_with_block_and_options_outside_out_of_erb
    assert_equal content_tag(&quot;a&quot;, &quot;Create&quot;, :href =&gt; &quot;create&quot;),
                 content_tag(&quot;a&quot;, &quot;href&quot; =&gt; &quot;create&quot;) { &quot;Create&quot; }
  end

  def test_content_tag_nested_in_content_tag_out_of_erb
    assert_equal content_tag(&quot;p&quot;, content_tag(&quot;b&quot;, &quot;Hello&quot;)),
                 content_tag(&quot;p&quot;) { content_tag(&quot;b&quot;, &quot;Hello&quot;) },
                 output_buffer
  end

  def test_content_tag_nested_in_content_tag_in_erb
    __in_erb_template = true
    content_tag(&quot;p&quot;) { concat content_tag(&quot;b&quot;, &quot;Hello&quot;) }
    assert_equal '&lt;p&gt;&lt;b&gt;Hello&lt;/b&gt;&lt;/p&gt;', output_buffer
  end

  def test_cdata_section
    assert_equal &quot;&lt;![CDATA[&lt;hello world&gt;]]&gt;&quot;, cdata_section(&quot;&lt;hello world&gt;&quot;)
  end
  
  def test_escape_once
    assert_equal '1 &amp;lt; 2 &amp;amp; 3', escape_once('1 &lt; 2 &amp;amp; 3')
  end
  
  def test_double_escaping_attributes
    ['1&amp;amp;2', '1 &amp;lt; 2', '&amp;#8220;test&amp;#8220;'].each do |escaped|
      assert_equal %(&lt;a href=&quot;#{escaped}&quot; /&gt;), tag('a', :href =&gt; escaped)
    end
  end
  
  def test_skip_invalid_escaped_attributes
    ['&amp;1;', '&amp;#1dfa3;', '&amp; #123;'].each do |escaped|
      assert_equal %(&lt;a href=&quot;#{escaped.gsub /&amp;/, '&amp;amp;'}&quot; /&gt;), tag('a', :href =&gt; escaped)
    end
  end

  def test_disable_escaping
    assert_equal '&lt;a href=&quot;&amp;amp;&quot; /&gt;', tag('a', { :href =&gt; '&amp;amp;' }, false, false)
  end
end
</pre>
    </div>