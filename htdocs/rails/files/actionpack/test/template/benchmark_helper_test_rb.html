  <div id="fileHeader">
    <h1>benchmark_helper_test.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>actionpack/test/template/benchmark_helper_test.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sun Jul 25 11:32:53 +0200 2010</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require 'abstract_unit'
require 'action_view/helpers/benchmark_helper'

class BenchmarkHelperTest &lt; ActionView::TestCase
  tests ActionView::Helpers::BenchmarkHelper

  def setup
    super
    controller.logger = ActiveSupport::BufferedLogger.new(StringIO.new)
    controller.logger.auto_flushing = false
  end

  def teardown
    controller.logger.send(:clear_buffer)
  end

  def test_without_block
    assert_raise(LocalJumpError) { benchmark }
    assert buffer.empty?
  end

  def test_defaults
    i_was_run = false
    benchmark { i_was_run = true }
    assert i_was_run
    assert_last_logged
  end

  def test_with_message
    i_was_run = false
    benchmark('test_run') { i_was_run = true }
    assert i_was_run
    assert_last_logged 'test_run'
  end

  def test_with_message_and_deprecated_level
    i_was_run = false

    assert_deprecated do
      benchmark('debug_run', :debug) { i_was_run = true }
    end

    assert i_was_run
    assert_last_logged 'debug_run'
  end

  def test_within_level
    controller.logger.level = ActiveSupport::BufferedLogger::DEBUG
    benchmark('included_debug_run', :level =&gt; :debug) { }
    assert_last_logged 'included_debug_run'
  end

  def test_outside_level
    controller.logger.level = ActiveSupport::BufferedLogger::ERROR
    benchmark('skipped_debug_run', :level =&gt; :debug) { }
    assert_no_match(/skipped_debug_run/, buffer.last)
  ensure
    controller.logger.level = ActiveSupport::BufferedLogger::DEBUG
  end

  def test_without_silencing
    benchmark('debug_run', :silence =&gt; false) do
      controller.logger.info &quot;not silenced!&quot;
    end

    assert_equal 2, buffer.size
  end

  def test_with_silencing
    benchmark('debug_run', :silence =&gt; true) do
      controller.logger.info &quot;silenced!&quot;
    end

    assert_equal 1, buffer.size
  end


  private
    def buffer
      controller.logger.send(:buffer)
    end
  
    def assert_last_logged(message = 'Benchmarking')
      assert_match(/^#{message} \(.*\)$/, buffer.last)
    end
end
</pre>
    </div>