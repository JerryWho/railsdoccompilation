  <div id="fileHeader">
    <h1>author.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>activerecord/test/models/author.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sun Jul 25 11:32:53 +0200 2010</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>class Author &lt; ActiveRecord::Base
  has_many :posts
  has_many :very_special_comments, :through =&gt; :posts
  has_many :posts_with_comments, :include =&gt; :comments, :class_name =&gt; &quot;Post&quot;
  has_many :popular_grouped_posts, :include =&gt; :comments, :class_name =&gt; &quot;Post&quot;, :group =&gt; &quot;type&quot;, :having =&gt; &quot;SUM(comments_count) &gt; 1&quot;, :select =&gt; &quot;type&quot;
  has_many :posts_with_comments_sorted_by_comment_id, :include =&gt; :comments, :class_name =&gt; &quot;Post&quot;, :order =&gt; 'comments.id'
  has_many :posts_sorted_by_id_limited, :class_name =&gt; &quot;Post&quot;, :order =&gt; 'posts.id', :limit =&gt; 1
  has_many :posts_with_categories, :include =&gt; :categories, :class_name =&gt; &quot;Post&quot;
  has_many :posts_with_comments_and_categories, :include =&gt; [ :comments, :categories ], :order =&gt; &quot;posts.id&quot;, :class_name =&gt; &quot;Post&quot;
  has_many :posts_containing_the_letter_a, :class_name =&gt; &quot;Post&quot;
  has_many :posts_with_extension, :class_name =&gt; &quot;Post&quot; do #, :extend =&gt; ProxyTestExtension
    def testing_proxy_owner
      proxy_owner
    end
    def testing_proxy_reflection
      proxy_reflection
    end
    def testing_proxy_target
      proxy_target
    end
  end
  has_one  :post_about_thinking, :class_name =&gt; 'Post', :conditions =&gt; &quot;posts.title like '%thinking%'&quot;
  has_one  :post_about_thinking_with_last_comment, :class_name =&gt; 'Post', :conditions =&gt; &quot;posts.title like '%thinking%'&quot;, :include =&gt; :last_comment
  has_many :comments, :through =&gt; :posts
  has_many :comments_containing_the_letter_e, :through =&gt; :posts, :source =&gt; :comments
  has_many :comments_with_order_and_conditions, :through =&gt; :posts, :source =&gt; :comments, :order =&gt; 'comments.body', :conditions =&gt; &quot;comments.body like 'Thank%'&quot;
  has_many :comments_with_include, :through =&gt; :posts, :source =&gt; :comments, :include =&gt; :post

  has_many :thinking_posts, :class_name =&gt; 'Post', :conditions =&gt; { :title =&gt; 'So I was thinking' }, :dependent =&gt; :delete_all
  has_many :welcome_posts,  :class_name =&gt; 'Post', :conditions =&gt; { :title =&gt; 'Welcome to the weblog' }

  has_many :comments_desc, :through =&gt; :posts, :source =&gt; :comments, :order =&gt; 'comments.id DESC'
  has_many :limited_comments, :through =&gt; :posts, :source =&gt; :comments, :limit =&gt; 1
  has_many :funky_comments, :through =&gt; :posts, :source =&gt; :comments
  has_many :ordered_uniq_comments, :through =&gt; :posts, :source =&gt; :comments, :uniq =&gt; true, :order =&gt; 'comments.id'
  has_many :ordered_uniq_comments_desc, :through =&gt; :posts, :source =&gt; :comments, :uniq =&gt; true, :order =&gt; 'comments.id DESC'
  has_many :readonly_comments, :through =&gt; :posts, :source =&gt; :comments, :readonly =&gt; true
  
  has_many :special_posts
  has_many :special_post_comments, :through =&gt; :special_posts, :source =&gt; :comments

  has_many :sti_posts, :class_name =&gt; 'StiPost'
  has_many :sti_post_comments, :through =&gt; :sti_posts, :source =&gt; :comments

  has_many :special_nonexistant_posts, :class_name =&gt; &quot;SpecialPost&quot;, :conditions =&gt; &quot;posts.body = 'nonexistant'&quot;
  has_many :special_nonexistant_post_comments, :through =&gt; :special_nonexistant_posts, :source =&gt; :comments, :conditions =&gt; &quot;comments.post_id = 0&quot;
  has_many :nonexistant_comments, :through =&gt; :posts

  has_many :hello_posts, :class_name =&gt; &quot;Post&quot;, :conditions =&gt; &quot;posts.body = 'hello'&quot;
  has_many :hello_post_comments, :through =&gt; :hello_posts, :source =&gt; :comments
  has_many :posts_with_no_comments, :class_name =&gt; 'Post', :conditions =&gt; 'comments.id is null', :include =&gt; :comments

  has_many :hello_posts_with_hash_conditions, :class_name =&gt; &quot;Post&quot;,
:conditions =&gt; {:body =&gt; 'hello'}
  has_many :hello_post_comments_with_hash_conditions, :through =&gt;
:hello_posts_with_hash_conditions, :source =&gt; :comments

  has_many :other_posts,          :class_name =&gt; &quot;Post&quot;
  has_many :posts_with_callbacks, :class_name =&gt; &quot;Post&quot;, :before_add =&gt; :log_before_adding,
           :after_add     =&gt; :log_after_adding,
           :before_remove =&gt; :log_before_removing,
           :after_remove  =&gt; :log_after_removing
  has_many :posts_with_proc_callbacks, :class_name =&gt; &quot;Post&quot;,
           :before_add    =&gt; Proc.new {|o, r| o.post_log &lt;&lt; &quot;before_adding#{r.id || '&lt;new&gt;'}&quot;},
           :after_add     =&gt; Proc.new {|o, r| o.post_log &lt;&lt; &quot;after_adding#{r.id || '&lt;new&gt;'}&quot;},
           :before_remove =&gt; Proc.new {|o, r| o.post_log &lt;&lt; &quot;before_removing#{r.id}&quot;},
           :after_remove  =&gt; Proc.new {|o, r| o.post_log &lt;&lt; &quot;after_removing#{r.id}&quot;}
  has_many :posts_with_multiple_callbacks, :class_name =&gt; &quot;Post&quot;,
           :before_add =&gt; [:log_before_adding, Proc.new {|o, r| o.post_log &lt;&lt; &quot;before_adding_proc#{r.id || '&lt;new&gt;'}&quot;}],
           :after_add  =&gt; [:log_after_adding,  Proc.new {|o, r| o.post_log &lt;&lt; &quot;after_adding_proc#{r.id || '&lt;new&gt;'}&quot;}]
  has_many :unchangable_posts, :class_name =&gt; &quot;Post&quot;, :before_add =&gt; :raise_exception, :after_add =&gt; :log_after_adding

  has_many :categorizations
  has_many :categories, :through =&gt; :categorizations

  has_many :categories_like_general, :through =&gt; :categorizations, :source =&gt; :category, :class_name =&gt; 'Category', :conditions =&gt; { :name =&gt; 'General' }

  has_many :categorized_posts, :through =&gt; :categorizations, :source =&gt; :post
  has_many :unique_categorized_posts, :through =&gt; :categorizations, :source =&gt; :post, :uniq =&gt; true

  has_many :nothings, :through =&gt; :kateggorisatons, :class_name =&gt; 'Category'

  has_many :author_favorites
  has_many :favorite_authors, :through =&gt; :author_favorites, :order =&gt; 'name'

  has_many :tagging,  :through =&gt; :posts # through polymorphic has_one
  has_many :taggings, :through =&gt; :posts, :source =&gt; :taggings # through polymorphic has_many
  has_many :tags,     :through =&gt; :posts # through has_many :through
  has_many :post_categories, :through =&gt; :posts, :source =&gt; :categories

  has_many :event_authors
  has_many :events, :through =&gt; :event_authors
  
  has_one :essay, :primary_key =&gt; :name, :as =&gt; :writer

  belongs_to :author_address, :dependent =&gt; :destroy
  belongs_to :author_address_extra, :dependent =&gt; :delete, :class_name =&gt; &quot;AuthorAddress&quot;

  attr_accessor :post_log

  def after_initialize
    @post_log = []
  end

  def label
    &quot;#{id}-#{name}&quot;
  end

  private
    def log_before_adding(object)
      @post_log &lt;&lt; &quot;before_adding#{object.id || '&lt;new&gt;'}&quot;
    end

    def log_after_adding(object)
      @post_log &lt;&lt; &quot;after_adding#{object.id}&quot;
    end

    def log_before_removing(object)
      @post_log &lt;&lt; &quot;before_removing#{object.id}&quot;
    end

    def log_after_removing(object)
      @post_log &lt;&lt; &quot;after_removing#{object.id}&quot;
    end

    def raise_exception(object)
      raise Exception.new(&quot;You can't add a post&quot;)
    end
end

class AuthorAddress &lt; ActiveRecord::Base
  has_one :author

  def self.destroyed_author_address_ids
    @destroyed_author_address_ids ||= Hash.new { |h,k| h[k] = [] }
  end

  before_destroy do |author_address|
    if author_address.author
      AuthorAddress.destroyed_author_address_ids[author_address.author.id] &lt;&lt; author_address.id
    end
    true
  end
end

class AuthorFavorite &lt; ActiveRecord::Base
  belongs_to :author
  belongs_to :favorite_author, :class_name =&gt; &quot;Author&quot;
end
</pre>
    </div>