  <div id="fileHeader">
    <h1>eager_load_includes_full_sti_class_test.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>activerecord/test/cases/associations/eager_load_includes_full_sti_class_test.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sun Jul 25 11:32:53 +0200 2010</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require 'cases/helper'
require 'models/post'
require 'models/tagging'

module Namespaced
  class Post &lt; ActiveRecord::Base
    set_table_name 'posts'
    has_one :tagging, :as =&gt; :taggable, :class_name =&gt; 'Tagging'
  end
end

class EagerLoadIncludeFullStiClassNamesTest &lt; ActiveRecord::TestCase

  def setup
    generate_test_objects
  end

  def generate_test_objects
    post = Namespaced::Post.create( :title =&gt; 'Great stuff', :body =&gt; 'This is not', :author_id =&gt; 1 )
    tagging = Tagging.create( :taggable =&gt; post )
  end

  def test_class_names
    old = ActiveRecord::Base.store_full_sti_class

    ActiveRecord::Base.store_full_sti_class = false
    post = Namespaced::Post.find_by_title( 'Great stuff', :include =&gt; :tagging )
    assert_nil post.tagging

    ActiveRecord::Base.store_full_sti_class = true
    post = Namespaced::Post.find_by_title( 'Great stuff', :include =&gt; :tagging )
    assert_equal 'Tagging', post.tagging.class.name
  ensure
    ActiveRecord::Base.store_full_sti_class = old
  end
end
</pre>
    </div>