  <div id="fileHeader">
    <h1>callbacks_observers_test.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>activerecord/test/cases/callbacks_observers_test.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Fri Nov 27 16:38:16 +0100 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require &quot;cases/helper&quot;

class Comment &lt; ActiveRecord::Base
  attr_accessor :callers

  before_validation :record_callers

  def after_validation
    record_callers
  end

  def record_callers
    callers &lt;&lt; self.class if callers
  end
end

class CommentObserver &lt; ActiveRecord::Observer
  attr_accessor :callers

  def after_validation(model)
    callers &lt;&lt; self.class if callers
  end
end

class CallbacksObserversTest &lt; ActiveRecord::TestCase
  def test_model_callbacks_fire_before_observers_are_notified
    callers = []

    comment = Comment.new
    comment.callers = callers

    CommentObserver.instance.callers = callers

    comment.valid?

    assert_equal [Comment, Comment, CommentObserver], callers, &quot;model callbacks did not fire before observers were notified&quot;
  end
end
</pre>
    </div>