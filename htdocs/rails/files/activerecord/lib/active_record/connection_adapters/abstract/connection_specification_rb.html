  <div id="fileHeader">
    <h1>connection_specification.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>activerecord/lib/active_record/connection_adapters/abstract/connection_specification.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sun Jul 25 11:32:53 +0200 2010</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>module ActiveRecord
  class Base
    class ConnectionSpecification #:nodoc:
      attr_reader :config, :adapter_method
      def initialize (config, adapter_method)
        @config, @adapter_method = config, adapter_method
      end
    end

    ##
    # :singleton-method:
    # The connection handler
    superclass_delegating_accessor :connection_handler
    self.connection_handler = ConnectionAdapters::ConnectionHandler.new

    # Returns the connection currently associated with the class. This can
    # also be used to &quot;borrow&quot; the connection to do database work that isn't
    # easily done without going straight to SQL.
    def connection
      self.class.connection
    end

    # Establishes the connection to the database. Accepts a hash as input where
    # the &lt;tt&gt;:adapter&lt;/tt&gt; key must be specified with the name of a database adapter (in lower-case)
    # example for regular databases (MySQL, Postgresql, etc):
    #
    #   ActiveRecord::Base.establish_connection(
    #     :adapter  =&gt; &quot;mysql&quot;,
    #     :host     =&gt; &quot;localhost&quot;,
    #     :username =&gt; &quot;myuser&quot;,
    #     :password =&gt; &quot;mypass&quot;,
    #     :database =&gt; &quot;somedatabase&quot;
    #   )
    #
    # Example for SQLite database:
    #
    #   ActiveRecord::Base.establish_connection(
    #     :adapter =&gt; &quot;sqlite&quot;,
    #     :database  =&gt; &quot;path/to/dbfile&quot;
    #   )
    #
    # Also accepts keys as strings (for parsing from YAML for example):
    #
    #   ActiveRecord::Base.establish_connection(
    #     &quot;adapter&quot; =&gt; &quot;sqlite&quot;,
    #     &quot;database&quot;  =&gt; &quot;path/to/dbfile&quot;
    #   )
    #
    # The exceptions AdapterNotSpecified, AdapterNotFound and ArgumentError
    # may be returned on an error.
    def self.establish_connection(spec = nil)
      case spec
        when nil
          raise AdapterNotSpecified unless defined? RAILS_ENV
          establish_connection(RAILS_ENV)
        when ConnectionSpecification
          self.connection_handler.establish_connection(name, spec)
        when Symbol, String
          if configuration = configurations[spec.to_s]
            establish_connection(configuration)
          else
            raise AdapterNotSpecified, &quot;#{spec} database is not configured&quot;
          end
        else
          spec = spec.symbolize_keys
          unless spec.key?(:adapter) then raise AdapterNotSpecified, &quot;database configuration does not specify adapter&quot; end

          begin
            require 'rubygems'
            gem &quot;activerecord-#{spec[:adapter]}-adapter&quot;
            require &quot;active_record/connection_adapters/#{spec[:adapter]}_adapter&quot;
          rescue LoadError
            begin
              require &quot;active_record/connection_adapters/#{spec[:adapter]}_adapter&quot;
            rescue LoadError
              raise &quot;Please install the #{spec[:adapter]} adapter: `gem install activerecord-#{spec[:adapter]}-adapter` (#{$!})&quot;
            end
          end

          adapter_method = &quot;#{spec[:adapter]}_connection&quot;
          if !respond_to?(adapter_method)
            raise AdapterNotFound, &quot;database configuration specifies nonexistent #{spec[:adapter]} adapter&quot;
          end

          remove_connection
          establish_connection(ConnectionSpecification.new(spec, adapter_method))
      end
    end

    class &lt;&lt; self
      # Deprecated and no longer has any effect.
      def allow_concurrency
        ActiveSupport::Deprecation.warn(&quot;ActiveRecord::Base.allow_concurrency has been deprecated and no longer has any effect. Please remove all references to allow_concurrency.&quot;)
      end

      # Deprecated and no longer has any effect.
      def allow_concurrency=(flag)
        ActiveSupport::Deprecation.warn(&quot;ActiveRecord::Base.allow_concurrency= has been deprecated and no longer has any effect. Please remove all references to allow_concurrency=.&quot;)
      end

      # Deprecated and no longer has any effect.
      def verification_timeout
        ActiveSupport::Deprecation.warn(&quot;ActiveRecord::Base.verification_timeout has been deprecated and no longer has any effect. Please remove all references to verification_timeout.&quot;)
      end

      # Deprecated and no longer has any effect.
      def verification_timeout=(flag)
        ActiveSupport::Deprecation.warn(&quot;ActiveRecord::Base.verification_timeout= has been deprecated and no longer has any effect. Please remove all references to verification_timeout=.&quot;)
      end

      # Returns the connection currently associated with the class. This can
      # also be used to &quot;borrow&quot; the connection to do database work unrelated
      # to any of the specific Active Records.
      def connection
        retrieve_connection
      end

      def connection_pool
        connection_handler.retrieve_connection_pool(self)
      end

      def retrieve_connection
        connection_handler.retrieve_connection(self)
      end

      # Returns true if +ActiveRecord+ is connected.
      def connected?
        connection_handler.connected?(self)
      end

      def remove_connection(klass = self)
        connection_handler.remove_connection(klass)
      end

      delegate :clear_active_connections!, :clear_reloadable_connections!,
        :clear_all_connections!,:verify_active_connections!, :to =&gt; :connection_handler
    end
  end
end
</pre>
    </div>