  <div id="fileHeader">
    <h1>test_case.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>activerecord/lib/active_record/test_case.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Fri Nov 27 16:38:16 +0100 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require &quot;active_support/test_case&quot;

module ActiveRecord
  class TestCase &lt; ActiveSupport::TestCase #:nodoc:
    def assert_date_from_db(expected, actual, message = nil)
      # SybaseAdapter doesn't have a separate column type just for dates,
      # so the time is in the string and incorrectly formatted
      if current_adapter?(:SybaseAdapter)
        assert_equal expected.to_s, actual.to_date.to_s, message
      else
        assert_equal expected.to_s, actual.to_s, message
      end
    end

    def assert_sql(*patterns_to_match)
      $queries_executed = []
      yield
    ensure
      failed_patterns = []
      patterns_to_match.each do |pattern|
        failed_patterns &lt;&lt; pattern unless $queries_executed.any?{ |sql| pattern === sql }
      end
      assert failed_patterns.empty?, &quot;Query pattern(s) #{failed_patterns.map(&amp;:inspect).join(', ')} not found.&quot;
    end

    def assert_queries(num = 1)
      $queries_executed = []
      yield
    ensure
      %w{ BEGIN COMMIT }.each { |x| $queries_executed.delete(x) }
      assert_equal num, $queries_executed.size, &quot;#{$queries_executed.size} instead of #{num} queries were executed.#{$queries_executed.size == 0 ? '' : &quot;\nQueries:\n#{$queries_executed.join(&quot;\n&quot;)}&quot;}&quot;
    end

    def assert_no_queries(&amp;block)
      assert_queries(0, &amp;block)
    end

    def self.use_concurrent_connections
      setup :connection_allow_concurrency_setup
      teardown :connection_allow_concurrency_teardown
    end

    def connection_allow_concurrency_setup
      @connection = ActiveRecord::Base.remove_connection
      ActiveRecord::Base.establish_connection(@connection.merge({:allow_concurrency =&gt; true}))
    end

    def connection_allow_concurrency_teardown
      ActiveRecord::Base.clear_all_connections!
      ActiveRecord::Base.establish_connection(@connection)
    end

    def with_kcode(kcode)
      if RUBY_VERSION &lt; '1.9'
        orig_kcode, $KCODE = $KCODE, kcode
        begin
          yield
        ensure
          $KCODE = orig_kcode
        end
      else
        yield
      end
    end
  end
end
</pre>
    </div>