  <div id="fileHeader">
    <h1>asset_host_test.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>actionmailer/test/asset_host_test.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Sun Jul 25 11:32:52 +0200 2010</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require 'abstract_unit'

class AssetHostMailer &lt; ActionMailer::Base
  def email_with_asset(recipient)
    recipients recipient
    subject    &quot;testing email containing asset path while asset_host is set&quot;
    from       &quot;tester@example.com&quot;
  end
end

class AssetHostTest &lt; Test::Unit::TestCase
  def setup
    set_delivery_method :test
    ActionMailer::Base.perform_deliveries = true
    ActionMailer::Base.deliveries = []

    @recipient = 'test@localhost'
  end

  def teardown
    restore_delivery_method
  end

  def test_asset_host_as_string
    ActionController::Base.asset_host = &quot;http://www.example.com&quot;
    mail = AssetHostMailer.deliver_email_with_asset(@recipient)
    assert_equal &quot;&lt;img alt=\&quot;Somelogo\&quot; src=\&quot;http://www.example.com/images/somelogo.png\&quot; /&gt;&quot;, mail.body.strip
  end

  def test_asset_host_as_one_arguement_proc
    ActionController::Base.asset_host = Proc.new { |source|
      if source.starts_with?('/images')
        &quot;http://images.example.com&quot;
      else
        &quot;http://assets.example.com&quot;
      end
    }
    mail = AssetHostMailer.deliver_email_with_asset(@recipient)
    assert_equal &quot;&lt;img alt=\&quot;Somelogo\&quot; src=\&quot;http://images.example.com/images/somelogo.png\&quot; /&gt;&quot;, mail.body.strip
  end

  def test_asset_host_as_two_arguement_proc
    ActionController::Base.asset_host = Proc.new {|source,request|
      if request &amp;&amp; request.ssl?
        &quot;https://www.example.com&quot;
      else
        &quot;http://www.example.com&quot;
      end
    }
    mail = nil
    assert_nothing_raised { mail = AssetHostMailer.deliver_email_with_asset(@recipient) }
    assert_equal &quot;&lt;img alt=\&quot;Somelogo\&quot; src=\&quot;http://www.example.com/images/somelogo.png\&quot; /&gt;&quot;, mail.body.strip
  end
end</pre>
    </div>