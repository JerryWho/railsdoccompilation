  <div id="fileHeader">
    <h1>console_app_test.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>railties/test/console_app_test.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Fri Nov 27 16:38:16 +0100 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require 'abstract_unit'

require 'action_controller' # console_app uses 'action_controller/integration'

unless defined? ApplicationController
  class ApplicationController &lt; ActionController::Base; end
  ActionController::Base.session_store = nil
end

require 'dispatcher'
require 'console_app'

# console_app sets Test::Unit.run to work around the at_exit hook in test/unit, which kills IRB
if Test::Unit.respond_to?(:run=)
  Test::Unit.run = false

  class ConsoleAppTest &lt; Test::Unit::TestCase
    def test_app_method_should_return_integration_session
      assert_nothing_thrown do
        console_session = app
        assert_not_nil console_session
        assert_instance_of ActionController::Integration::Session,
          console_session
      end
    end

    def test_reload_should_fire_preparation_callbacks
      a = b = c = nil

      Dispatcher.to_prepare { a = b = c = 1 }
      Dispatcher.to_prepare { b = c = 2 }
      Dispatcher.to_prepare { c = 3 }
      ActionController::Routing::Routes.expects(:reload)

      reload!

      assert_equal 1, a
      assert_equal 2, b
      assert_equal 3, c
    end
  end
end
</pre>
    </div>