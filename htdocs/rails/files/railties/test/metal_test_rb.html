  <div id="fileHeader">
    <h1>metal_test.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>railties/test/metal_test.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Fri Nov 27 16:38:16 +0100 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require 'abstract_unit'
require 'initializer'

class MetalTest &lt; Test::Unit::TestCase
  def test_metals_should_return_list_of_found_metal_apps
    use_appdir(&quot;singlemetal&quot;) do
      assert_equal([&quot;FooMetal&quot;], found_metals_as_string_array)
    end
  end

  def test_metals_should_respect_class_name_conventions
    use_appdir(&quot;pluralmetal&quot;) do
      assert_equal([&quot;LegacyRoutes&quot;], found_metals_as_string_array)
    end
  end

  def test_metals_should_return_alphabetical_list_of_found_metal_apps
    use_appdir(&quot;multiplemetals&quot;) do
      assert_equal([&quot;MetalA&quot;, &quot;MetalB&quot;], found_metals_as_string_array)
    end
  end

  def test_metals_load_order_should_be_overriden_by_requested_metals
    use_appdir(&quot;multiplemetals&quot;) do
      Rails::Rack::Metal.requested_metals = [&quot;MetalB&quot;, &quot;MetalA&quot;]
      assert_equal([&quot;MetalB&quot;, &quot;MetalA&quot;], found_metals_as_string_array)
    end
  end

  def test_metals_not_listed_should_not_load
    use_appdir(&quot;multiplemetals&quot;) do
      Rails::Rack::Metal.requested_metals = [&quot;MetalB&quot;]
      assert_equal([&quot;MetalB&quot;], found_metals_as_string_array)
    end
  end

  def test_metal_finding_should_work_with_subfolders
    use_appdir(&quot;subfolders&quot;) do
      assert_equal([&quot;Folder::MetalA&quot;, &quot;Folder::MetalB&quot;], found_metals_as_string_array)
    end
  end

  def test_metal_finding_with_requested_metals_should_work_with_subfolders
    use_appdir(&quot;subfolders&quot;) do
      Rails::Rack::Metal.requested_metals = [&quot;Folder::MetalB&quot;]
      assert_equal([&quot;Folder::MetalB&quot;], found_metals_as_string_array)
    end
  end

  def test_metal_finding_should_work_with_multiple_metal_paths_in_185_and_below
    use_appdir(&quot;singlemetal&quot;) do
      engine_metal_path = &quot;#{File.dirname(__FILE__)}/fixtures/plugins/engines/engine/app/metal&quot; 
      Rails::Rack::Metal.metal_paths &lt;&lt; engine_metal_path
      $LOAD_PATH &lt;&lt; engine_metal_path
      assert_equal([&quot;FooMetal&quot;, &quot;EngineMetal&quot;], found_metals_as_string_array)
    end
  end

  private

  def use_appdir(root)
    dir = &quot;#{File.dirname(__FILE__)}/fixtures/metal/#{root}&quot;
    Rails::Rack::Metal.metal_paths = [&quot;#{dir}/app/metal&quot;]
    Rails::Rack::Metal.requested_metals = nil
    $LOAD_PATH &lt;&lt; &quot;#{dir}/app/metal&quot;
    yield
  end

  def found_metals_as_string_array
    Rails::Rack::Metal.metals.map { |m| m.to_s }
  end
end
</pre>
    </div>