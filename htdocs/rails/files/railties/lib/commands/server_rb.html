  <div id="fileHeader">
    <h1>server.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>railties/lib/commands/server.rb</td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Oct 12 19:55:10 +0200 2009</td>
    </tr>
    </table>
  </div>
 <!-- banner header -->

  <div id="bodyContent" >
    <h2>Source Code</h2>
    <pre>require 'active_support'
require 'action_controller'

require 'fileutils'
require 'optparse'

# TODO: Push Thin adapter upstream so we don't need worry about requiring it
begin
  require_library_or_gem 'thin'
rescue Exception
  # Thin not available
end

options = {
  :Port        =&gt; 3000,
  :Host        =&gt; &quot;0.0.0.0&quot;,
  :environment =&gt; (ENV['RAILS_ENV'] || &quot;development&quot;).dup,
  :config      =&gt; RAILS_ROOT + &quot;/config.ru&quot;,
  :detach      =&gt; false,
  :debugger    =&gt; false,
  :path        =&gt; nil
}

ARGV.clone.options do |opts|
  opts.on(&quot;-p&quot;, &quot;--port=port&quot;, Integer,
          &quot;Runs Rails on the specified port.&quot;, &quot;Default: 3000&quot;) { |v| options[:Port] = v }
  opts.on(&quot;-b&quot;, &quot;--binding=ip&quot;, String,
          &quot;Binds Rails to the specified ip.&quot;, &quot;Default: 0.0.0.0&quot;) { |v| options[:Host] = v }
  opts.on(&quot;-c&quot;, &quot;--config=file&quot;, String,
          &quot;Use custom rackup configuration file&quot;) { |v| options[:config] = v }
  opts.on(&quot;-d&quot;, &quot;--daemon&quot;, &quot;Make server run as a Daemon.&quot;) { options[:detach] = true }
  opts.on(&quot;-u&quot;, &quot;--debugger&quot;, &quot;Enable ruby-debugging for the server.&quot;) { options[:debugger] = true }
  opts.on(&quot;-e&quot;, &quot;--environment=name&quot;, String,
          &quot;Specifies the environment to run this server under (test/development/production).&quot;,
          &quot;Default: development&quot;) { |v| options[:environment] = v }
  opts.on(&quot;-P&quot;, &quot;--path=/path&quot;, String, &quot;Runs Rails app mounted at a specific path.&quot;, &quot;Default: /&quot;) { |v| options[:path] = v }

  opts.separator &quot;&quot;

  opts.on(&quot;-h&quot;, &quot;--help&quot;, &quot;Show this help message.&quot;) { puts opts; exit }

  opts.parse!
end

server = Rack::Handler.get(ARGV.first) rescue nil
unless server
  begin
    server = Rack::Handler::Mongrel
  rescue LoadError =&gt; e
    server = Rack::Handler::WEBrick
  end
end

puts &quot;=&gt; Booting #{ActiveSupport::Inflector.demodulize(server)}&quot;
puts &quot;=&gt; Rails #{Rails.version} application starting on http://#{options[:Host]}:#{options[:Port]}#{options[:path]}&quot;

%w(cache pids sessions sockets).each do |dir_to_make|
  FileUtils.mkdir_p(File.join(RAILS_ROOT, 'tmp', dir_to_make))
end

if options[:detach]
  Process.daemon
  pid = &quot;#{RAILS_ROOT}/tmp/pids/server.pid&quot;
  File.open(pid, 'w'){ |f| f.write(Process.pid) }
  at_exit { File.delete(pid) if File.exist?(pid) }
end

ENV[&quot;RAILS_ENV&quot;] = options[:environment]
RAILS_ENV.replace(options[:environment]) if defined?(RAILS_ENV)

if File.exist?(options[:config])
  config = options[:config]
  if config =~ /\.ru$/
    cfgfile = File.read(config)
    if cfgfile[/^#\\(.*)/]
      opts.parse!($1.split(/\s+/))
    end
    inner_app = eval(&quot;Rack::Builder.new {( &quot; + cfgfile + &quot;\n )}.to_app&quot;, nil, config)
  else
    require config
    inner_app = Object.const_get(File.basename(config, '.rb').capitalize)
  end
else
  require RAILS_ROOT + &quot;/config/environment&quot;
  inner_app = ActionController::Dispatcher.new
end

if options[:path].nil?
  map_path = &quot;/&quot;
else
  ActionController::Base.relative_url_root = options[:path]
  map_path = options[:path]
end

app = Rack::Builder.new {
  use Rails::Rack::LogTailer unless options[:detach]
  use Rails::Rack::Debugger if options[:debugger]
  map map_path do
    use Rails::Rack::Static 
    run inner_app
  end
}.to_app

puts &quot;=&gt; Call with -d to detach&quot;

trap(:INT) { exit }

puts &quot;=&gt; Ctrl-C to shutdown server&quot;

begin
  server.run(app, options.merge(:AccessLog =&gt; []))
ensure
  puts 'Exiting'
end
</pre>
    </div>