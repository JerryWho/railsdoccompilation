<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Module: ActiveSupport::Multibyte::Unicode</title>
<link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (U)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../ActiveSupport.html" title="ActiveSupport (module)">ActiveSupport</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Multibyte.html" title="ActiveSupport::Multibyte (module)">Multibyte</a></span></span>
     &raquo; 
    <span class="title">Unicode</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Module: ActiveSupport::Multibyte::Unicode
  
  
  
</h1>

<dl class="box">
  
  
    
      <dt class="r1">Extended by:</dt>
      <dd class="r1"><span class='object_link'><a href="" title="ActiveSupport::Multibyte::Unicode (module)">Unicode</a></span></dd>
      
    
  
    
  
  
    <dt class="r2">Included in:</dt>
    <dd class="r2"><span class='object_link'><a href="" title="ActiveSupport::Multibyte::Unicode (module)">Unicode</a></span></dd>
    
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">activesupport/lib/active_support/multibyte/unicode.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Defined Under Namespace</h2>
<p class="children">
   
    
   
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Unicode/Codepoint.html" title="ActiveSupport::Multibyte::Unicode::Codepoint (class)">Codepoint</a></span>, <span class='object_link'><a href="Unicode/UnicodeDatabase.html" title="ActiveSupport::Multibyte::Unicode::UnicodeDatabase (class)">UnicodeDatabase</a></span>
    
  
</p>

  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="NORMALIZATION_FORMS-constant" class="">NORMALIZATION_FORMS =
          <div class="docstring">
  <div class="discussion">
    <p>
A list of all available normalization forms. See <a
href="http://www.unicode.org/reports/tr15/tr15-29.html">www.unicode.org/reports/tr15/tr15-29.html</a>
for more information about normalization.
</p>


  </div>
</div>
<div class="tags">
  
</div>
        </dt>
        <dd><pre class="code"><span class='lbracket'>[</span><span class='symbol'>:c</span><span class='comma'>,</span> <span class='symbol'>:kc</span><span class='comma'>,</span> <span class='symbol'>:d</span><span class='comma'>,</span> <span class='symbol'>:kd</span><span class='rbracket'>]</span></pre></dd>
      
        <dt id="UNICODE_VERSION-constant" class="">UNICODE_VERSION =
          <div class="docstring">
  <div class="discussion">
    <p>
The Unicode version that is supported by the implementation
</p>


  </div>
</div>
<div class="tags">
  
</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>5.2.0</span><span class='tstring_end'>'</span></span></pre></dd>
      
        <dt id="HANGUL_SBASE-constant" class="">HANGUL_SBASE =
          <div class="docstring">
  <div class="discussion">
    <p>
Hangul character boundaries and properties
</p>


  </div>
</div>
<div class="tags">
  
</div>
        </dt>
        <dd><pre class="code"><span class='int'>0xAC00</span></pre></dd>
      
        <dt id="HANGUL_LBASE-constant" class="">HANGUL_LBASE =
          
        </dt>
        <dd><pre class="code"><span class='int'>0x1100</span></pre></dd>
      
        <dt id="HANGUL_VBASE-constant" class="">HANGUL_VBASE =
          
        </dt>
        <dd><pre class="code"><span class='int'>0x1161</span></pre></dd>
      
        <dt id="HANGUL_TBASE-constant" class="">HANGUL_TBASE =
          
        </dt>
        <dd><pre class="code"><span class='int'>0x11A7</span></pre></dd>
      
        <dt id="HANGUL_LCOUNT-constant" class="">HANGUL_LCOUNT =
          
        </dt>
        <dd><pre class="code"><span class='int'>19</span></pre></dd>
      
        <dt id="HANGUL_VCOUNT-constant" class="">HANGUL_VCOUNT =
          
        </dt>
        <dd><pre class="code"><span class='int'>21</span></pre></dd>
      
        <dt id="HANGUL_TCOUNT-constant" class="">HANGUL_TCOUNT =
          
        </dt>
        <dd><pre class="code"><span class='int'>28</span></pre></dd>
      
        <dt id="HANGUL_NCOUNT-constant" class="">HANGUL_NCOUNT =
          
        </dt>
        <dd><pre class="code"><span class='const'>HANGUL_VCOUNT</span> <span class='op'>*</span> <span class='const'>HANGUL_TCOUNT</span></pre></dd>
      
        <dt id="HANGUL_SCOUNT-constant" class="">HANGUL_SCOUNT =
          
        </dt>
        <dd><pre class="code"><span class='int'>11172</span></pre></dd>
      
        <dt id="HANGUL_SLAST-constant" class="">HANGUL_SLAST =
          
        </dt>
        <dd><pre class="code"><span class='const'>HANGUL_SBASE</span> <span class='op'>+</span> <span class='const'>HANGUL_SCOUNT</span></pre></dd>
      
        <dt id="HANGUL_JAMO_FIRST-constant" class="">HANGUL_JAMO_FIRST =
          
        </dt>
        <dd><pre class="code"><span class='int'>0x1100</span></pre></dd>
      
        <dt id="HANGUL_JAMO_LAST-constant" class="">HANGUL_JAMO_LAST =
          
        </dt>
        <dd><pre class="code"><span class='int'>0x11FF</span></pre></dd>
      
        <dt id="WHITESPACE-constant" class="">WHITESPACE =
          <div class="docstring">
  <div class="discussion">
    <p>
All the unicode whitespace
</p>


  </div>
</div>
<div class="tags">
  
</div>
        </dt>
        <dd><pre class="code"><span class='lbracket'>[</span>
  <span class='lparen'>(</span><span class='int'>0x0009</span><span class='op'>..</span><span class='int'>0x000D</span><span class='rparen'>)</span><span class='period'>.</span><span class='id to_a'>to_a</span><span class='comma'>,</span> <span class='comment'># White_Space # Cc   [5] &lt;control-0009&gt;..&lt;control-000D&gt;
</span>  <span class='int'>0x0020</span><span class='comma'>,</span>                <span class='comment'># White_Space # Zs       SPACE
</span>  <span class='int'>0x0085</span><span class='comma'>,</span>                <span class='comment'># White_Space # Cc       &lt;control-0085&gt;
</span>  <span class='int'>0x00A0</span><span class='comma'>,</span>                <span class='comment'># White_Space # Zs       NO-BREAK SPACE
</span>  <span class='int'>0x1680</span><span class='comma'>,</span>                <span class='comment'># White_Space # Zs       OGHAM SPACE MARK
</span>  <span class='int'>0x180E</span><span class='comma'>,</span>                <span class='comment'># White_Space # Zs       MONGOLIAN VOWEL SEPARATOR
</span>  <span class='lparen'>(</span><span class='int'>0x2000</span><span class='op'>..</span><span class='int'>0x200A</span><span class='rparen'>)</span><span class='period'>.</span><span class='id to_a'>to_a</span><span class='comma'>,</span> <span class='comment'># White_Space # Zs  [11] EN QUAD..HAIR SPACE
</span>  <span class='int'>0x2028</span><span class='comma'>,</span>                <span class='comment'># White_Space # Zl       LINE SEPARATOR
</span>  <span class='int'>0x2029</span><span class='comma'>,</span>                <span class='comment'># White_Space # Zp       PARAGRAPH SEPARATOR
</span>  <span class='int'>0x202F</span><span class='comma'>,</span>                <span class='comment'># White_Space # Zs       NARROW NO-BREAK SPACE
</span>  <span class='int'>0x205F</span><span class='comma'>,</span>                <span class='comment'># White_Space # Zs       MEDIUM MATHEMATICAL SPACE
</span>  <span class='int'>0x3000</span><span class='comma'>,</span>                <span class='comment'># White_Space # Zs       IDEOGRAPHIC SPACE
</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id flatten'>flatten</span><span class='period'>.</span><span class='id freeze'>freeze</span></pre></dd>
      
        <dt id="LEADERS_AND_TRAILERS-constant" class="">LEADERS_AND_TRAILERS =
          <div class="docstring">
  <div class="discussion">
    <p>
BOM (byte order mark) can also be seen as whitespace, it&#8217;s a
non-rendering character used to distinguish between little and big endian.
This is not an issue in utf-8, so it must be ignored.
</p>


  </div>
</div>
<div class="tags">
  
</div>
        </dt>
        <dd><pre class="code"><span class='const'>WHITESPACE</span> <span class='op'>+</span> <span class='lbracket'>[</span><span class='int'>65279</span><span class='rbracket'>]</span></pre></dd>
      
        <dt id="TRAILERS_PAT-constant" class="">TRAILERS_PAT =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id codepoints_to_pattern'>codepoints_to_pattern</span><span class='lparen'>(</span><span class='const'>LEADERS_AND_TRAILERS</span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='tstring_content'>)+\Z</span><span class='regexp_end'>/u</span></span></pre></dd>
      
        <dt id="LEADERS_PAT-constant" class="">LEADERS_PAT =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A(</span><span class='embexpr_beg'>#{</span><span class='id codepoints_to_pattern'>codepoints_to_pattern</span><span class='lparen'>(</span><span class='const'>LEADERS_AND_TRAILERS</span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='tstring_content'>)+</span><span class='regexp_end'>/u</span></span></pre></dd>
      
    </dl>
  


  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#default_normalization_form-instance_method" title="#default_normalization_form (instance method)">- (Object) <strong>default_normalization_form</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The default normalization used for operations that require normalization.
</p>
</div></span>
  
</li>

    
  </ul>


  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#codepoints_to_pattern-class_method" title="codepoints_to_pattern (class method)">+ (Object) <strong>codepoints_to_pattern</strong>(array_of_codepoints) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns a regular expression pattern that matches the passed Unicode
codepoints.
</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#apply_mapping-instance_method" title="#apply_mapping (instance method)">- (Object) <strong>apply_mapping</strong>(string, mapping) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
:nodoc:.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#compose_codepoints-instance_method" title="#compose_codepoints (instance method)">- (Object) <strong>compose_codepoints</strong>(codepoints) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Compose decomposed characters to the composed form.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#decompose_codepoints-instance_method" title="#decompose_codepoints (instance method)">- (Object) <strong>decompose_codepoints</strong>(type, codepoints) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Decompose composed characters to the decomposed form.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#g_pack-instance_method" title="#g_pack (instance method)">- (Object) <strong>g_pack</strong>(unpacked) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Reverse operation of g_unpack.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#g_unpack-instance_method" title="#g_unpack (instance method)">- (Object) <strong>g_unpack</strong>(string) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Unpack the string at grapheme boundaries.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#in_char_class%3F-instance_method" title="#in_char_class? (instance method)">- (Boolean) <strong>in_char_class?</strong>(codepoint, classes) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Detect whether the codepoint is in a certain character class.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#normalize-instance_method" title="#normalize (instance method)">- (Object) <strong>normalize</strong>(string, form = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the KC normalization of the string by default.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reorder_characters-instance_method" title="#reorder_characters (instance method)">- (Object) <strong>reorder_characters</strong>(codepoints) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Re-order codepoints so the string becomes canonical.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#tidy_bytes-instance_method" title="#tidy_bytes (instance method)">- (Object) <strong>tidy_bytes</strong>(string, force = false) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Replaces all ISO-8859-1 or CP1252 characters by their UTF-8 equivalent
resulting in a valid UTF-8 string.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#u_unpack-instance_method" title="#u_unpack (instance method)">- (Object) <strong>u_unpack</strong>(string) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Unpack the string at codepoints boundaries.
</p>
</div></span>
  
</li>

      
    </ul>
  


  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="default_normalization_form=-instance_method"></span>
      <span id="default_normalization_form-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="default_normalization_form-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>default_normalization_form</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The default normalization used for operations that require normalization.
It can be set to any of the normalizations in NORMALIZATION_FORMS.
</p>
<p>
Example:
</p>
<pre class="code">
  <span class='const'>ActiveSupport</span><span class='op'>::</span><span class='const'>Multibyte</span><span class='op'>::</span><span class='const'>Unicode</span><span class='period'>.</span><span class='id default_normalization_form'>default_normalization_form</span> <span class='op'>=</span> <span class='symbol'>:c</span></pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'activesupport/lib/active_support/multibyte/unicode.rb', line 19</span>

<span class='kw'>def</span> <span class='id default_normalization_form'>default_normalization_form</span>
  <span class='ivar'>@default_normalization_form</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="codepoints_to_pattern-class_method">
  
    + (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>codepoints_to_pattern</strong>(array_of_codepoints) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns a regular expression pattern that matches the passed Unicode
codepoints
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


57
58
59</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'activesupport/lib/active_support/multibyte/unicode.rb', line 57</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id codepoints_to_pattern'>codepoints_to_pattern</span><span class='lparen'>(</span><span class='id array_of_codepoints'>array_of_codepoints</span><span class='rparen'>)</span> <span class='comment'>#:nodoc:
</span>  <span class='id array_of_codepoints'>array_of_codepoints</span><span class='period'>.</span><span class='id collect'>collect</span><span class='lbrace'>{</span> <span class='op'>|</span><span class='id e'>e</span><span class='op'>|</span> <span class='lbracket'>[</span><span class='id e'>e</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id pack'>pack</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>U*</span><span class='tstring_end'>'</span></span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>|</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="apply_mapping-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>apply_mapping</strong>(string, mapping) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
:nodoc:
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


300
301
302
303
304
305
306
307
308
309</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'activesupport/lib/active_support/multibyte/unicode.rb', line 300</span>

<span class='kw'>def</span> <span class='id apply_mapping'>apply_mapping</span><span class='lparen'>(</span><span class='id string'>string</span><span class='comma'>,</span> <span class='id mapping'>mapping</span><span class='rparen'>)</span> <span class='comment'>#:nodoc:
</span>  <span class='id u_unpack'>u_unpack</span><span class='lparen'>(</span><span class='id string'>string</span><span class='rparen'>)</span><span class='period'>.</span><span class='id map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id codepoint'>codepoint</span><span class='op'>|</span>
    <span class='id cp'>cp</span> <span class='op'>=</span> <span class='id database'>database</span><span class='period'>.</span><span class='id codepoints'>codepoints</span><span class='lbracket'>[</span><span class='id codepoint'>codepoint</span><span class='rbracket'>]</span>
    <span class='kw'>if</span> <span class='id cp'>cp</span> <span class='kw'>and</span> <span class='lparen'>(</span><span class='id ncp'>ncp</span> <span class='op'>=</span> <span class='id cp'>cp</span><span class='period'>.</span><span class='id send'>send</span><span class='lparen'>(</span><span class='id mapping'>mapping</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='id ncp'>ncp</span> <span class='op'>&gt;</span> <span class='int'>0</span>
      <span class='id ncp'>ncp</span>
    <span class='kw'>else</span>
      <span class='id codepoint'>codepoint</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span><span class='period'>.</span><span class='id pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>U*</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="compose_codepoints-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>compose_codepoints</strong>(codepoints) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Compose decomposed characters to the composed form.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'activesupport/lib/active_support/multibyte/unicode.rb', line 166</span>

<span class='kw'>def</span> <span class='id compose_codepoints'>compose_codepoints</span><span class='lparen'>(</span><span class='id codepoints'>codepoints</span><span class='rparen'>)</span>
  <span class='id pos'>pos</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id eoa'>eoa</span> <span class='op'>=</span> <span class='id codepoints'>codepoints</span><span class='period'>.</span><span class='id length'>length</span> <span class='op'>-</span> <span class='int'>1</span>
  <span class='id starter_pos'>starter_pos</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id starter_char'>starter_char</span> <span class='op'>=</span> <span class='id codepoints'>codepoints</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
  <span class='id previous_combining_class'>previous_combining_class</span> <span class='op'>=</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>while</span> <span class='id pos'>pos</span> <span class='op'>&lt;</span> <span class='id eoa'>eoa</span>
    <span class='id pos'>pos</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='id lindex'>lindex</span> <span class='op'>=</span> <span class='id starter_char'>starter_char</span> <span class='op'>-</span> <span class='const'>HANGUL_LBASE</span>
    <span class='comment'># -- Hangul
</span>    <span class='kw'>if</span> <span class='int'>0</span> <span class='op'>&lt;=</span> <span class='id lindex'>lindex</span> <span class='kw'>and</span> <span class='id lindex'>lindex</span> <span class='op'>&lt;</span> <span class='const'>HANGUL_LCOUNT</span>
      <span class='id vindex'>vindex</span> <span class='op'>=</span> <span class='id codepoints'>codepoints</span><span class='lbracket'>[</span><span class='id starter_pos'>starter_pos</span><span class='op'>+</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='const'>HANGUL_VBASE</span> <span class='kw'>rescue</span> <span class='id vindex'>vindex</span> <span class='op'>=</span> <span class='op'>-</span><span class='int'>1</span>
      <span class='kw'>if</span> <span class='int'>0</span> <span class='op'>&lt;=</span> <span class='id vindex'>vindex</span> <span class='kw'>and</span> <span class='id vindex'>vindex</span> <span class='op'>&lt;</span> <span class='const'>HANGUL_VCOUNT</span>
        <span class='id tindex'>tindex</span> <span class='op'>=</span> <span class='id codepoints'>codepoints</span><span class='lbracket'>[</span><span class='id starter_pos'>starter_pos</span><span class='op'>+</span><span class='int'>2</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='const'>HANGUL_TBASE</span> <span class='kw'>rescue</span> <span class='id tindex'>tindex</span> <span class='op'>=</span> <span class='op'>-</span><span class='int'>1</span>
        <span class='kw'>if</span> <span class='int'>0</span> <span class='op'>&lt;=</span> <span class='id tindex'>tindex</span> <span class='kw'>and</span> <span class='id tindex'>tindex</span> <span class='op'>&lt;</span> <span class='const'>HANGUL_TCOUNT</span>
          <span class='id j'>j</span> <span class='op'>=</span> <span class='id starter_pos'>starter_pos</span> <span class='op'>+</span> <span class='int'>2</span>
          <span class='id eoa'>eoa</span> <span class='op'>-=</span> <span class='int'>2</span>
        <span class='kw'>else</span>
          <span class='id tindex'>tindex</span> <span class='op'>=</span> <span class='int'>0</span>
          <span class='id j'>j</span> <span class='op'>=</span> <span class='id starter_pos'>starter_pos</span> <span class='op'>+</span> <span class='int'>1</span>
          <span class='id eoa'>eoa</span> <span class='op'>-=</span> <span class='int'>1</span>
        <span class='kw'>end</span>
        <span class='id codepoints'>codepoints</span><span class='lbracket'>[</span><span class='id starter_pos'>starter_pos</span><span class='op'>..</span><span class='id j'>j</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id lindex'>lindex</span> <span class='op'>*</span> <span class='const'>HANGUL_VCOUNT</span> <span class='op'>+</span> <span class='id vindex'>vindex</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='const'>HANGUL_TCOUNT</span> <span class='op'>+</span> <span class='id tindex'>tindex</span> <span class='op'>+</span> <span class='const'>HANGUL_SBASE</span>
      <span class='kw'>end</span>
      <span class='id starter_pos'>starter_pos</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='id starter_char'>starter_char</span> <span class='op'>=</span> <span class='id codepoints'>codepoints</span><span class='lbracket'>[</span><span class='id starter_pos'>starter_pos</span><span class='rbracket'>]</span>
    <span class='comment'># -- Other characters
</span>    <span class='kw'>else</span>
      <span class='id current_char'>current_char</span> <span class='op'>=</span> <span class='id codepoints'>codepoints</span><span class='lbracket'>[</span><span class='id pos'>pos</span><span class='rbracket'>]</span>
      <span class='id current'>current</span> <span class='op'>=</span> <span class='id database'>database</span><span class='period'>.</span><span class='id codepoints'>codepoints</span><span class='lbracket'>[</span><span class='id current_char'>current_char</span><span class='rbracket'>]</span>
      <span class='kw'>if</span> <span class='id current'>current</span><span class='period'>.</span><span class='id combining_class'>combining_class</span> <span class='op'>&gt;</span> <span class='id previous_combining_class'>previous_combining_class</span>
        <span class='kw'>if</span> <span class='id ref'>ref</span> <span class='op'>=</span> <span class='id database'>database</span><span class='period'>.</span><span class='id composition_map'>composition_map</span><span class='lbracket'>[</span><span class='id starter_char'>starter_char</span><span class='rbracket'>]</span>
          <span class='id composition'>composition</span> <span class='op'>=</span> <span class='id ref'>ref</span><span class='lbracket'>[</span><span class='id current_char'>current_char</span><span class='rbracket'>]</span>
        <span class='kw'>else</span>
          <span class='id composition'>composition</span> <span class='op'>=</span> <span class='kw'>nil</span>
        <span class='kw'>end</span>
        <span class='kw'>unless</span> <span class='id composition'>composition</span><span class='period'>.</span><span class='id nil?'>nil?</span>
          <span class='id codepoints'>codepoints</span><span class='lbracket'>[</span><span class='id starter_pos'>starter_pos</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id composition'>composition</span>
          <span class='id starter_char'>starter_char</span> <span class='op'>=</span> <span class='id composition'>composition</span>
          <span class='id codepoints'>codepoints</span><span class='period'>.</span><span class='id delete_at'>delete_at</span> <span class='id pos'>pos</span>
          <span class='id eoa'>eoa</span> <span class='op'>-=</span> <span class='int'>1</span>
          <span class='id pos'>pos</span> <span class='op'>-=</span> <span class='int'>1</span>
          <span class='id previous_combining_class'>previous_combining_class</span> <span class='op'>=</span> <span class='op'>-</span><span class='int'>1</span>
        <span class='kw'>else</span>
          <span class='id previous_combining_class'>previous_combining_class</span> <span class='op'>=</span> <span class='id current'>current</span><span class='period'>.</span><span class='id combining_class'>combining_class</span>
        <span class='kw'>end</span>
      <span class='kw'>else</span>
        <span class='id previous_combining_class'>previous_combining_class</span> <span class='op'>=</span> <span class='id current'>current</span><span class='period'>.</span><span class='id combining_class'>combining_class</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id current'>current</span><span class='period'>.</span><span class='id combining_class'>combining_class</span> <span class='op'>==</span> <span class='int'>0</span>
        <span class='id starter_pos'>starter_pos</span> <span class='op'>=</span> <span class='id pos'>pos</span>
        <span class='id starter_char'>starter_char</span> <span class='op'>=</span> <span class='id codepoints'>codepoints</span><span class='lbracket'>[</span><span class='id pos'>pos</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id codepoints'>codepoints</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="decompose_codepoints-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>decompose_codepoints</strong>(type, codepoints) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Decompose composed characters to the decomposed form.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'activesupport/lib/active_support/multibyte/unicode.rb', line 145</span>

<span class='kw'>def</span> <span class='id decompose_codepoints'>decompose_codepoints</span><span class='lparen'>(</span><span class='id type'>type</span><span class='comma'>,</span> <span class='id codepoints'>codepoints</span><span class='rparen'>)</span>
  <span class='id codepoints'>codepoints</span><span class='period'>.</span><span class='id inject'>inject</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id decomposed'>decomposed</span><span class='comma'>,</span> <span class='id cp'>cp</span><span class='op'>|</span>
    <span class='comment'># if it's a hangul syllable starter character
</span>    <span class='kw'>if</span> <span class='const'>HANGUL_SBASE</span> <span class='op'>&lt;=</span> <span class='id cp'>cp</span> <span class='kw'>and</span> <span class='id cp'>cp</span> <span class='op'>&lt;</span> <span class='const'>HANGUL_SLAST</span>
      <span class='id sindex'>sindex</span> <span class='op'>=</span> <span class='id cp'>cp</span> <span class='op'>-</span> <span class='const'>HANGUL_SBASE</span>
      <span class='id ncp'>ncp</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='comment'># new codepoints
</span>      <span class='id ncp'>ncp</span> <span class='op'>&lt;&lt;</span> <span class='const'>HANGUL_LBASE</span> <span class='op'>+</span> <span class='id sindex'>sindex</span> <span class='op'>/</span> <span class='const'>HANGUL_NCOUNT</span>
      <span class='id ncp'>ncp</span> <span class='op'>&lt;&lt;</span> <span class='const'>HANGUL_VBASE</span> <span class='op'>+</span> <span class='lparen'>(</span><span class='id sindex'>sindex</span> <span class='op'>%</span> <span class='const'>HANGUL_NCOUNT</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='const'>HANGUL_TCOUNT</span>
      <span class='id tindex'>tindex</span> <span class='op'>=</span> <span class='id sindex'>sindex</span> <span class='op'>%</span> <span class='const'>HANGUL_TCOUNT</span>
      <span class='id ncp'>ncp</span> <span class='op'>&lt;&lt;</span> <span class='lparen'>(</span><span class='const'>HANGUL_TBASE</span> <span class='op'>+</span> <span class='id tindex'>tindex</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id tindex'>tindex</span> <span class='op'>==</span> <span class='int'>0</span>
      <span class='id decomposed'>decomposed</span><span class='period'>.</span><span class='id concat'>concat</span> <span class='id ncp'>ncp</span>
    <span class='comment'># if the codepoint is decomposable in with the current decomposition type
</span>    <span class='kw'>elsif</span> <span class='lparen'>(</span><span class='id ncp'>ncp</span> <span class='op'>=</span> <span class='id database'>database</span><span class='period'>.</span><span class='id codepoints'>codepoints</span><span class='lbracket'>[</span><span class='id cp'>cp</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id decomp_mapping'>decomp_mapping</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='lparen'>(</span><span class='op'>!</span><span class='id database'>database</span><span class='period'>.</span><span class='id codepoints'>codepoints</span><span class='lbracket'>[</span><span class='id cp'>cp</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id decomp_type'>decomp_type</span> <span class='op'>||</span> <span class='id type'>type</span> <span class='op'>==</span> <span class='symbol'>:compatability</span><span class='rparen'>)</span>
      <span class='id decomposed'>decomposed</span><span class='period'>.</span><span class='id concat'>concat</span> <span class='id decompose_codepoints'>decompose_codepoints</span><span class='lparen'>(</span><span class='id type'>type</span><span class='comma'>,</span> <span class='id ncp'>ncp</span><span class='period'>.</span><span class='id dup'>dup</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id decomposed'>decomposed</span> <span class='op'>&lt;&lt;</span> <span class='id cp'>cp</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="g_pack-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>g_pack</strong>(unpacked) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Reverse operation of g_unpack.
</p>
<p>
Example:
</p>
<pre class="code">
  <span class='const'>Unicode</span><span class='period'>.</span><span class='id g_pack'>g_pack</span><span class='lparen'>(</span><span class='const'>Unicode</span><span class='period'>.</span><span class='id g_unpack'>g_unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>????????????</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='comment'># =&gt; '????????????'</span></pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


124
125
126</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'activesupport/lib/active_support/multibyte/unicode.rb', line 124</span>

<span class='kw'>def</span> <span class='id g_pack'>g_pack</span><span class='lparen'>(</span><span class='id unpacked'>unpacked</span><span class='rparen'>)</span>
  <span class='lparen'>(</span><span class='id unpacked'>unpacked</span><span class='period'>.</span><span class='id flatten'>flatten</span><span class='rparen'>)</span><span class='period'>.</span><span class='id pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>U*</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="g_unpack-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>g_unpack</strong>(string) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Unpack the string at grapheme boundaries. Returns a list of character
lists.
</p>
<p>
Example:
</p>
<pre class="code">
  <span class='const'>Unicode</span><span class='period'>.</span><span class='id g_unpack'>g_unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>????????????</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='comment'># =&gt; [[2325, 2381], [2359], [2367]]
</span>  <span class='const'>Unicode</span><span class='period'>.</span><span class='id g_unpack'>g_unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Caf??</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='comment'># =&gt; [[67], [97], [102], [233]]</span></pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'activesupport/lib/active_support/multibyte/unicode.rb', line 90</span>

<span class='kw'>def</span> <span class='id g_unpack'>g_unpack</span><span class='lparen'>(</span><span class='id string'>string</span><span class='rparen'>)</span>
  <span class='id codepoints'>codepoints</span> <span class='op'>=</span> <span class='id u_unpack'>u_unpack</span><span class='lparen'>(</span><span class='id string'>string</span><span class='rparen'>)</span>
  <span class='id unpacked'>unpacked</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id pos'>pos</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id marker'>marker</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id eoc'>eoc</span> <span class='op'>=</span> <span class='id codepoints'>codepoints</span><span class='period'>.</span><span class='id length'>length</span>
  <span class='kw'>while</span><span class='lparen'>(</span><span class='id pos'>pos</span> <span class='op'>&lt;</span> <span class='id eoc'>eoc</span><span class='rparen'>)</span>
    <span class='id pos'>pos</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='id previous'>previous</span> <span class='op'>=</span> <span class='id codepoints'>codepoints</span><span class='lbracket'>[</span><span class='id pos'>pos</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='id current'>current</span> <span class='op'>=</span> <span class='id codepoints'>codepoints</span><span class='lbracket'>[</span><span class='id pos'>pos</span><span class='rbracket'>]</span>
    <span class='kw'>if</span> <span class='lparen'>(</span>
        <span class='comment'># CR X LF
</span>        <span class='lparen'>(</span> <span class='id previous'>previous</span> <span class='op'>==</span> <span class='id database'>database</span><span class='period'>.</span><span class='id boundary'>boundary</span><span class='lbracket'>[</span><span class='symbol'>:cr</span><span class='rbracket'>]</span> <span class='kw'>and</span> <span class='id current'>current</span> <span class='op'>==</span> <span class='id database'>database</span><span class='period'>.</span><span class='id boundary'>boundary</span><span class='lbracket'>[</span><span class='symbol'>:lf</span><span class='rbracket'>]</span> <span class='rparen'>)</span> <span class='kw'>or</span>
        <span class='comment'># L X (L|V|LV|LVT)
</span>        <span class='lparen'>(</span> <span class='id database'>database</span><span class='period'>.</span><span class='id boundary'>boundary</span><span class='lbracket'>[</span><span class='symbol'>:l</span><span class='rbracket'>]</span> <span class='op'>===</span> <span class='id previous'>previous</span> <span class='kw'>and</span> <span class='id in_char_class?'>in_char_class?</span><span class='lparen'>(</span><span class='id current'>current</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='symbol'>:l</span><span class='comma'>,</span><span class='symbol'>:v</span><span class='comma'>,</span><span class='symbol'>:lv</span><span class='comma'>,</span><span class='symbol'>:lvt</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='rparen'>)</span> <span class='kw'>or</span>
        <span class='comment'># (LV|V) X (V|T)
</span>        <span class='lparen'>(</span> <span class='id in_char_class?'>in_char_class?</span><span class='lparen'>(</span><span class='id previous'>previous</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='symbol'>:lv</span><span class='comma'>,</span><span class='symbol'>:v</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='id in_char_class?'>in_char_class?</span><span class='lparen'>(</span><span class='id current'>current</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='symbol'>:v</span><span class='comma'>,</span><span class='symbol'>:t</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='rparen'>)</span> <span class='kw'>or</span>
        <span class='comment'># (LVT|T) X (T)
</span>        <span class='lparen'>(</span> <span class='id in_char_class?'>in_char_class?</span><span class='lparen'>(</span><span class='id previous'>previous</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='symbol'>:lvt</span><span class='comma'>,</span><span class='symbol'>:t</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='id database'>database</span><span class='period'>.</span><span class='id boundary'>boundary</span><span class='lbracket'>[</span><span class='symbol'>:t</span><span class='rbracket'>]</span> <span class='op'>===</span> <span class='id current'>current</span> <span class='rparen'>)</span> <span class='kw'>or</span>
        <span class='comment'># X Extend
</span>        <span class='lparen'>(</span><span class='id database'>database</span><span class='period'>.</span><span class='id boundary'>boundary</span><span class='lbracket'>[</span><span class='symbol'>:extend</span><span class='rbracket'>]</span> <span class='op'>===</span> <span class='id current'>current</span><span class='rparen'>)</span>
      <span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id unpacked'>unpacked</span> <span class='op'>&lt;&lt;</span> <span class='id codepoints'>codepoints</span><span class='lbracket'>[</span><span class='id marker'>marker</span><span class='op'>..</span><span class='id pos'>pos</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='id marker'>marker</span> <span class='op'>=</span> <span class='id pos'>pos</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id unpacked'>unpacked</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="in_char_class?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>in_char_class?</strong>(codepoint, classes) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Detect whether the codepoint is in a certain character class. Returns
<tt>true</tt> when it&#8217;s in the specified character class and
<tt>false</tt> otherwise. Valid character classes are: <tt>:cr</tt>,
<tt>:lf</tt>, <tt>:l</tt>, <tt>:v</tt>, <tt>:lv</tt>, <tt>:lvt</tt> and
<tt>:t</tt>.
</p>
<p>
Primarily used by the grapheme cluster support.
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


81
82
83</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'activesupport/lib/active_support/multibyte/unicode.rb', line 81</span>

<span class='kw'>def</span> <span class='id in_char_class?'>in_char_class?</span><span class='lparen'>(</span><span class='id codepoint'>codepoint</span><span class='comma'>,</span> <span class='id classes'>classes</span><span class='rparen'>)</span>
  <span class='id classes'>classes</span><span class='period'>.</span><span class='id detect'>detect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id c'>c</span><span class='op'>|</span> <span class='id database'>database</span><span class='period'>.</span><span class='id boundary'>boundary</span><span class='lbracket'>[</span><span class='id c'>c</span><span class='rbracket'>]</span> <span class='op'>===</span> <span class='id codepoint'>codepoint</span> <span class='rbrace'>}</span> <span class='op'>?</span> <span class='kw'>true</span> <span class='op'>:</span> <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="normalize-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>normalize</strong>(string, form = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the KC normalization of the string by default. NFKC is considered
the best normalization form for passing strings to databases and
validations.
</p>
<ul>
<li><p>
<tt>string</tt> - The string to perform normalization on.
</p>
</li>
<li><p>
<tt>form</tt> - The form you want to normalize in. Should be one of the
following: <tt>:c</tt>, <tt>:kc</tt>, <tt>:d</tt>, or <tt>:kd</tt>. Default
is ActiveSupport::Multibyte.default_normalization_form
</p>
</li>
</ul>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'activesupport/lib/active_support/multibyte/unicode.rb', line 282</span>

<span class='kw'>def</span> <span class='id normalize'>normalize</span><span class='lparen'>(</span><span class='id string'>string</span><span class='comma'>,</span> <span class='id form'>form</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id form'>form</span> <span class='op'>||=</span> <span class='ivar'>@default_normalization_form</span>
  <span class='comment'># See http://www.unicode.org/reports/tr15, Table 1
</span>  <span class='id codepoints'>codepoints</span> <span class='op'>=</span> <span class='id u_unpack'>u_unpack</span><span class='lparen'>(</span><span class='id string'>string</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id form'>form</span>
    <span class='kw'>when</span> <span class='symbol'>:d</span>
      <span class='id reorder_characters'>reorder_characters</span><span class='lparen'>(</span><span class='id decompose_codepoints'>decompose_codepoints</span><span class='lparen'>(</span><span class='symbol'>:canonical</span><span class='comma'>,</span> <span class='id codepoints'>codepoints</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='symbol'>:c</span>
      <span class='id compose_codepoints'>compose_codepoints</span><span class='lparen'>(</span><span class='id reorder_characters'>reorder_characters</span><span class='lparen'>(</span><span class='id decompose_codepoints'>decompose_codepoints</span><span class='lparen'>(</span><span class='symbol'>:canonical</span><span class='comma'>,</span> <span class='id codepoints'>codepoints</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='symbol'>:kd</span>
      <span class='id reorder_characters'>reorder_characters</span><span class='lparen'>(</span><span class='id decompose_codepoints'>decompose_codepoints</span><span class='lparen'>(</span><span class='symbol'>:compatability</span><span class='comma'>,</span> <span class='id codepoints'>codepoints</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='symbol'>:kc</span>
      <span class='id compose_codepoints'>compose_codepoints</span><span class='lparen'>(</span><span class='id reorder_characters'>reorder_characters</span><span class='lparen'>(</span><span class='id decompose_codepoints'>decompose_codepoints</span><span class='lparen'>(</span><span class='symbol'>:compatability</span><span class='comma'>,</span> <span class='id codepoints'>codepoints</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id form'>form</span><span class='rbrace'>}</span><span class='tstring_content'> is not a valid normalization variant</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id caller'>caller</span>
  <span class='kw'>end</span><span class='period'>.</span><span class='id pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>U*</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="reorder_characters-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>reorder_characters</strong>(codepoints) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Re-order codepoints so the string becomes canonical.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


129
130
131
132
133
134
135
136
137
138
139
140
141
142</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'activesupport/lib/active_support/multibyte/unicode.rb', line 129</span>

<span class='kw'>def</span> <span class='id reorder_characters'>reorder_characters</span><span class='lparen'>(</span><span class='id codepoints'>codepoints</span><span class='rparen'>)</span>
  <span class='id length'>length</span> <span class='op'>=</span> <span class='id codepoints'>codepoints</span><span class='period'>.</span><span class='id length'>length</span><span class='op'>-</span> <span class='int'>1</span>
  <span class='id pos'>pos</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>while</span> <span class='id pos'>pos</span> <span class='op'>&lt;</span> <span class='id length'>length</span> <span class='kw'>do</span>
    <span class='id cp1'>cp1</span><span class='comma'>,</span> <span class='id cp2'>cp2</span> <span class='op'>=</span> <span class='id database'>database</span><span class='period'>.</span><span class='id codepoints'>codepoints</span><span class='lbracket'>[</span><span class='id codepoints'>codepoints</span><span class='lbracket'>[</span><span class='id pos'>pos</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id database'>database</span><span class='period'>.</span><span class='id codepoints'>codepoints</span><span class='lbracket'>[</span><span class='id codepoints'>codepoints</span><span class='lbracket'>[</span><span class='id pos'>pos</span><span class='op'>+</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
    <span class='kw'>if</span> <span class='lparen'>(</span><span class='id cp1'>cp1</span><span class='period'>.</span><span class='id combining_class'>combining_class</span> <span class='op'>&gt;</span> <span class='id cp2'>cp2</span><span class='period'>.</span><span class='id combining_class'>combining_class</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id cp2'>cp2</span><span class='period'>.</span><span class='id combining_class'>combining_class</span> <span class='op'>&gt;</span> <span class='int'>0</span><span class='rparen'>)</span>
      <span class='id codepoints'>codepoints</span><span class='lbracket'>[</span><span class='id pos'>pos</span><span class='op'>..</span><span class='id pos'>pos</span><span class='op'>+</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id cp2'>cp2</span><span class='period'>.</span><span class='id code'>code</span><span class='comma'>,</span> <span class='id cp1'>cp1</span><span class='period'>.</span><span class='id code'>code</span>
      <span class='id pos'>pos</span> <span class='op'>+=</span> <span class='lparen'>(</span><span class='id pos'>pos</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='op'>?</span> <span class='op'>-</span><span class='int'>1</span> <span class='op'>:</span> <span class='int'>1</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id pos'>pos</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id codepoints'>codepoints</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="tidy_bytes-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>tidy_bytes</strong>(string, force = false) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Replaces all ISO-8859-1 or CP1252 characters by their UTF-8 equivalent
resulting in a valid UTF-8 string.
</p>
<p>
Passing <tt>true</tt> will forcibly tidy all bytes, assuming that the
string&#8217;s encoding is entirely CP1252 or ISO-8859-1.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'activesupport/lib/active_support/multibyte/unicode.rb', line 227</span>

<span class='kw'>def</span> <span class='id tidy_bytes'>tidy_bytes</span><span class='lparen'>(</span><span class='id string'>string</span><span class='comma'>,</span> <span class='id force'>force</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id force'>force</span>
    <span class='kw'>return</span> <span class='id string'>string</span><span class='period'>.</span><span class='id unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>C*</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id b'>b</span><span class='op'>|</span>
      <span class='id tidy_byte'>tidy_byte</span><span class='lparen'>(</span><span class='id b'>b</span><span class='rparen'>)</span>
    <span class='kw'>end</span><span class='period'>.</span><span class='id flatten'>flatten</span><span class='period'>.</span><span class='id compact'>compact</span><span class='period'>.</span><span class='id pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>C*</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>U*</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>U*</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id bytes'>bytes</span> <span class='op'>=</span> <span class='id string'>string</span><span class='period'>.</span><span class='id unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>C*</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id conts_expected'>conts_expected</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id last_lead'>last_lead</span> <span class='op'>=</span> <span class='int'>0</span>

  <span class='id bytes'>bytes</span><span class='period'>.</span><span class='id each_index'>each_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id i'>i</span><span class='op'>|</span>

    <span class='id byte'>byte</span>          <span class='op'>=</span> <span class='id bytes'>bytes</span><span class='lbracket'>[</span><span class='id i'>i</span><span class='rbracket'>]</span>
    <span class='id is_cont'>is_cont</span>       <span class='op'>=</span> <span class='id byte'>byte</span> <span class='op'>&gt;</span> <span class='int'>127</span> <span class='op'>&amp;&amp;</span> <span class='id byte'>byte</span> <span class='op'>&lt;</span> <span class='int'>192</span>
    <span class='id is_lead'>is_lead</span>       <span class='op'>=</span> <span class='id byte'>byte</span> <span class='op'>&gt;</span> <span class='int'>191</span> <span class='op'>&amp;&amp;</span> <span class='id byte'>byte</span> <span class='op'>&lt;</span> <span class='int'>245</span>
    <span class='id is_unused'>is_unused</span>     <span class='op'>=</span> <span class='id byte'>byte</span> <span class='op'>&gt;</span> <span class='int'>240</span>
    <span class='id is_restricted'>is_restricted</span> <span class='op'>=</span> <span class='id byte'>byte</span> <span class='op'>&gt;</span> <span class='int'>244</span>

    <span class='comment'># Impossible or highly unlikely byte? Clean it.
</span>    <span class='kw'>if</span> <span class='id is_unused'>is_unused</span> <span class='op'>||</span> <span class='id is_restricted'>is_restricted</span>
      <span class='id bytes'>bytes</span><span class='lbracket'>[</span><span class='id i'>i</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id tidy_byte'>tidy_byte</span><span class='lparen'>(</span><span class='id byte'>byte</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='id is_cont'>is_cont</span>
      <span class='comment'># Not expecting contination byte? Clean up. Otherwise, now expect one less.
</span>      <span class='id conts_expected'>conts_expected</span> <span class='op'>==</span> <span class='int'>0</span> <span class='op'>?</span> <span class='id bytes'>bytes</span><span class='lbracket'>[</span><span class='id i'>i</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id tidy_byte'>tidy_byte</span><span class='lparen'>(</span><span class='id byte'>byte</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id conts_expected'>conts_expected</span> <span class='op'>-=</span> <span class='int'>1</span>
    <span class='kw'>else</span>
      <span class='kw'>if</span> <span class='id conts_expected'>conts_expected</span> <span class='op'>&gt;</span> <span class='int'>0</span>
        <span class='comment'># Expected continuation, but got ASCII or leading? Clean backwards up to
</span>        <span class='comment'># the leading byte.
</span>        <span class='lparen'>(</span><span class='int'>1</span><span class='op'>..</span><span class='lparen'>(</span><span class='id i'>i</span> <span class='op'>-</span> <span class='id last_lead'>last_lead</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id j'>j</span><span class='op'>|</span> <span class='id bytes'>bytes</span><span class='lbracket'>[</span><span class='id i'>i</span> <span class='op'>-</span> <span class='id j'>j</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id tidy_byte'>tidy_byte</span><span class='lparen'>(</span><span class='id bytes'>bytes</span><span class='lbracket'>[</span><span class='id i'>i</span> <span class='op'>-</span> <span class='id j'>j</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rbrace'>}</span>
        <span class='id conts_expected'>conts_expected</span> <span class='op'>=</span> <span class='int'>0</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id is_lead'>is_lead</span>
        <span class='comment'># Final byte is leading? Clean it.
</span>        <span class='kw'>if</span> <span class='id i'>i</span> <span class='op'>==</span> <span class='id bytes'>bytes</span><span class='period'>.</span><span class='id length'>length</span> <span class='op'>-</span> <span class='int'>1</span>
          <span class='id bytes'>bytes</span><span class='lbracket'>[</span><span class='id i'>i</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id tidy_byte'>tidy_byte</span><span class='lparen'>(</span><span class='id bytes'>bytes</span><span class='period'>.</span><span class='id last'>last</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='comment'># Valid leading byte? Expect continuations determined by position of
</span>          <span class='comment'># first zero bit, with max of 3.
</span>          <span class='id conts_expected'>conts_expected</span> <span class='op'>=</span> <span class='id byte'>byte</span> <span class='op'>&lt;</span> <span class='int'>224</span> <span class='op'>?</span> <span class='int'>1</span> <span class='op'>:</span> <span class='id byte'>byte</span> <span class='op'>&lt;</span> <span class='int'>240</span> <span class='op'>?</span> <span class='int'>2</span> <span class='op'>:</span> <span class='int'>3</span>
          <span class='id last_lead'>last_lead</span> <span class='op'>=</span> <span class='id i'>i</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id bytes'>bytes</span><span class='period'>.</span><span class='id empty?'>empty?</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id bytes'>bytes</span><span class='period'>.</span><span class='id flatten'>flatten</span><span class='period'>.</span><span class='id compact'>compact</span><span class='period'>.</span><span class='id pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>C*</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>U*</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>U*</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="u_unpack-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>u_unpack</strong>(string) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Unpack the string at codepoints boundaries. Raises an EncodingError when
the encoding of the string isn&#8217;t valid UTF-8.
</p>
<p>
Example:
</p>
<pre class="code">
  <span class='const'>Unicode</span><span class='period'>.</span><span class='id u_unpack'>u_unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Caf??</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='comment'># =&gt; [67, 97, 102, 233]</span></pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


68
69
70
71
72
73
74</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'activesupport/lib/active_support/multibyte/unicode.rb', line 68</span>

<span class='kw'>def</span> <span class='id u_unpack'>u_unpack</span><span class='lparen'>(</span><span class='id string'>string</span><span class='rparen'>)</span>
  <span class='kw'>begin</span>
    <span class='id string'>string</span><span class='period'>.</span><span class='id unpack'>unpack</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>U*</span><span class='tstring_end'>'</span></span>
  <span class='kw'>rescue</span> <span class='const'>ArgumentError</span>
    <span class='id raise'>raise</span> <span class='const'>EncodingError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>malformed UTF-8 character</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Thu Nov  4 20:04:06 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.1 (ruby-1.9.2).
</div>

  </body>
</html>