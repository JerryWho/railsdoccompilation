  <div id="C00000023">
<div class='banner'>
  <span class="file-title-prefix">Module</span><br />Base<br/>
  In:
<a href="#" onclick="jsHref('files/lib/haml/filters_rb.html');">lib/haml/filters.rb</a>

</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">

  <div class="description"><p>
The base module for <a href="index.html?a=C00000016&name=Haml">Haml</a>
filters. User-defined filters should be modules including this module.
</p>
<p>
A user-defined filter should override either <a
href="index.html?a=M000218&name=Base#render">Base#render</a> or <a
href="index.html?a=C00000023&name=Base">Base</a> <a
href="index.html?a=M000220&name=compile">compile</a>. <a
href="index.html?a=M000218&name=Base#render">Base#render</a> is the most
common. It takes a string, the filter source, and returns another string,
the result of the filter. For example:
</p>
<pre>
  module Haml::Filters::Sass
    include Haml::Filters::Base

    def render(text)
      ::Sass::Engine.new(text).render
    end
  end
</pre>
<p>
For details on overriding <a
href="index.html?a=M000220&name=compile">compile</a>, see its
documentation.
</p>
</div>



  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M000220&name=compile" >compile</a></li>
  <li><a href="index.html?a=M000221&name=lazy_require" >lazy_require</a></li>
  <li><a href="index.html?a=M000218&name=render" >render</a></li>
  <li><a href="index.html?a=M000219&name=render_with_options" >render_with_options</a></li>
  </ul>






<div class="sectiontitle">Public Instance methods</div>
<div id="M000220" class="method">
  <div id="M000220_title" class="title">
    <b>compile</b>(precompiler, text)
  </div>
  <div class="description">
  <p>
compile should be overridden when a filter needs to have access to the <a
href="index.html?a=C00000016&name=Haml">Haml</a> evaluation context. Rather
than applying a filter to a string at compile-time, compile uses the <a
href="index.html?a=C00000019&name=Haml::Precompiler">Haml::Precompiler</a>
instance to compile the string to Ruby code that will be executed in the
context of the active <a href="index.html?a=C00000016&name=Haml">Haml</a>
template.
</p>
<p>
Warning: the <a
href="index.html?a=C00000019&name=Haml::Precompiler">Haml::Precompiler</a>
interface is neither well-documented nor guaranteed to be stable. If you
want to make use of it, you&#8217;ll probably need to look at the source
code and should test your filter when upgrading to new <a
href="index.html?a=C00000016&name=Haml">Haml</a> versions.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000220_source')" id="l_M000220_source">show source</a> ]</p>
  <div id="M000220_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File lib/haml/filters.rb, line 70</span>
70:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">compile</span>(<span class="ruby-identifier">precompiler</span>, <span class="ruby-identifier">text</span>)
71:         <span class="ruby-identifier">resolve_lazy_requires</span>
72:         <span class="ruby-identifier">filter</span> = <span class="ruby-keyword kw">self</span>
73:         <span class="ruby-identifier">precompiler</span>.<span class="ruby-identifier">instance_eval</span> <span class="ruby-keyword kw">do</span>
74:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">contains_interpolation?</span>(<span class="ruby-identifier">text</span>)
75:             <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:suppress_eval</span>]
76: 
77:             <span class="ruby-identifier">push_script</span>(<span class="ruby-value str">&quot;find_and_preserve(\#{filter.inspect}.render_with_options(\#{unescape_interpolation(text)}, _hamlout.options))\n&quot;</span>, <span class="ruby-keyword kw">false</span>)
78:             <span class="ruby-keyword kw">return</span>
79:           <span class="ruby-keyword kw">end</span>
80: 
81:           <span class="ruby-identifier">rendered</span> = <span class="ruby-constant">Haml</span><span class="ruby-operator">::</span><span class="ruby-constant">Helpers</span><span class="ruby-operator">::</span><span class="ruby-identifier">find_and_preserve</span>(<span class="ruby-identifier">filter</span>.<span class="ruby-identifier">render_with_options</span>(<span class="ruby-identifier">text</span>, <span class="ruby-identifier">precompiler</span>.<span class="ruby-identifier">options</span>), <span class="ruby-identifier">precompiler</span>.<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:preserve</span>])
82: 
83:           <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">options</span>[<span class="ruby-identifier">:ugly</span>]
84:             <span class="ruby-identifier">push_text</span>(<span class="ruby-identifier">rendered</span>.<span class="ruby-identifier">rstrip</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">&quot;\n&quot;</span>, <span class="ruby-node">&quot;\n#{'  ' * @output_tabs}&quot;</span>))
85:           <span class="ruby-keyword kw">else</span>
86:             <span class="ruby-identifier">push_text</span>(<span class="ruby-identifier">rendered</span>.<span class="ruby-identifier">rstrip</span>)
87:           <span class="ruby-keyword kw">end</span>
88:         <span class="ruby-keyword kw">end</span>
89:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000221" class="method">
  <div id="M000221_title" class="title">
    <b>lazy_require</b>(*reqs)
  </div>
  <div class="description">
  <p>
This becomes a class method of modules that include <a
href="index.html?a=C00000023&name=Base">Base</a>. It allows the module to
specify one or more Ruby files that <a
href="index.html?a=C00000016&name=Haml">Haml</a> should try to require when
compiling the filter.
</p>
<p>
The first file specified is tried first, then the second, etc. If none are
found, the compilation throws an exception.
</p>
<p>
For example:
</p>
<pre>
  module Haml::Filters::Markdown
    lazy_require 'rdiscount', 'peg_markdown', 'maruku', 'bluecloth'

    ...
  end
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000221_source')" id="l_M000221_source">show source</a> ]</p>
  <div id="M000221_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/haml/filters.rb, line 110</span>
110:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">lazy_require</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">reqs</span>)
111:         <span class="ruby-ivar">@lazy_requires</span> = <span class="ruby-identifier">reqs</span>
112:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000218" class="method">
  <div id="M000218_title" class="title">
    <b>render</b>(text)
  </div>
  <div class="description">
  <p>
Takes a string, the source text that should be passed to the filter, and
returns the string resulting from running the filter on <tt>text</tt>.
</p>
<p>
This should be overridden in most individual filter modules to render text
with the given filter. If compile is overridden, however, render
doesn&#8217;t need to be.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000218_source')" id="l_M000218_source">show source</a> ]</p>
  <div id="M000218_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File lib/haml/filters.rb, line 44</span>
44:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">render</span>(<span class="ruby-identifier">text</span>)
45:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;#{self.inspect}#render not defined!&quot;</span>)
46:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000219" class="method">
  <div id="M000219_title" class="title">
    <b>render_with_options</b>(text, options)
  </div>
  <div class="description">
  <p>
Same as render, but takes the <a
href="index.html?a=C00000016&name=Haml">Haml</a> options hash as well.
It&#8217;s only safe to rely on options made available in
Haml::Engine#options_for_buffer.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000219_source')" id="l_M000219_source">show source</a> ]</p>
  <div id="M000219_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File lib/haml/filters.rb, line 50</span>
50:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">render_with_options</span>(<span class="ruby-identifier">text</span>, <span class="ruby-identifier">options</span>)
51:         <span class="ruby-identifier">render</span>(<span class="ruby-identifier">text</span>)
52:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>