  <div id="C00000074">
<div class='banner'>
  <span class="file-title-prefix">Module</span><br />Util<br/>
  In:
<a href="#" onclick="jsHref('files/lib/haml/util/subset_map_rb.html');">lib/haml/util/subset_map.rb</a>
<a href="#" onclick="jsHref('files/lib/haml/util_rb.html');">lib/haml/util.rb</a>

</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">

  <div class="description"><p>
A module containing various useful functions.
</p>
</div>



  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M001129&name=_enc" >_enc</a></li>
  <li><a href="index.html?a=M001118&name=ap_geq?" >ap_geq?</a></li>
  <li><a href="index.html?a=M001117&name=ap_geq_3?" >ap_geq_3?</a></li>
  <li><a href="index.html?a=M001122&name=assert_html_safe!" >assert_html_safe!</a></li>
  <li><a href="index.html?a=M001119&name=av_template_class" >av_template_class</a></li>
  <li><a href="index.html?a=M001111&name=caller_info" >caller_info</a></li>
  <li><a href="index.html?a=M001126&name=check_encoding" >check_encoding</a></li>
  <li><a href="index.html?a=M001127&name=check_haml_encoding" >check_haml_encoding</a></li>
  <li><a href="index.html?a=M001128&name=check_sass_encoding" >check_sass_encoding</a></li>
  <li><a href="index.html?a=M001114&name=haml_warn" >haml_warn</a></li>
  <li><a href="index.html?a=M001121&name=html_safe" >html_safe</a></li>
  <li><a href="index.html?a=M001106&name=intersperse" >intersperse</a></li>
  <li><a href="index.html?a=M001110&name=lcs" >lcs</a></li>
  <li><a href="index.html?a=M001102&name=map_hash" >map_hash</a></li>
  <li><a href="index.html?a=M001100&name=map_keys" >map_keys</a></li>
  <li><a href="index.html?a=M001101&name=map_vals" >map_vals</a></li>
  <li><a href="index.html?a=M001105&name=merge_adjacent_strings" >merge_adjacent_strings</a></li>
  <li><a href="index.html?a=M001109&name=paths" >paths</a></li>
  <li><a href="index.html?a=M001103&name=powerset" >powerset</a></li>
  <li><a href="index.html?a=M001116&name=rails_env" >rails_env</a></li>
  <li><a href="index.html?a=M001115&name=rails_root" >rails_root</a></li>
  <li><a href="index.html?a=M001123&name=rails_safe_buffer_class" >rails_safe_buffer_class</a></li>
  <li><a href="index.html?a=M001120&name=rails_xss_safe?" >rails_xss_safe?</a></li>
  <li><a href="index.html?a=M001104&name=restrict" >restrict</a></li>
  <li><a href="index.html?a=M001124&name=ruby1_8?" >ruby1_8?</a></li>
  <li><a href="index.html?a=M001125&name=ruby1_8_6?" >ruby1_8_6?</a></li>
  <li><a href="index.html?a=M001098&name=scope" >scope</a></li>
  <li><a href="index.html?a=M001113&name=silence_haml_warnings" >silence_haml_warnings</a></li>
  <li><a href="index.html?a=M001112&name=silence_warnings" >silence_warnings</a></li>
  <li><a href="index.html?a=M001108&name=strip_string_array" >strip_string_array</a></li>
  <li><a href="index.html?a=M001107&name=substitute" >substitute</a></li>
  <li><a href="index.html?a=M001099&name=to_hash" >to_hash</a></li>
  </ul>



  <div class="sectiontitle">Classes and Modules</div>
  Class "<a href="#" onclick="jsHref('classes/Haml/Util/SubsetMap.html');" class="link">Haml::Util::SubsetMap</a>"<br />


  <div class="sectiontitle">Constants</div>
  <table border='0' cellpadding='5'>
  <tr valign='top'>
    <td class="attr-name">RUBY_VERSION</td>
    <td>=</td>
    <td class="attr-value">::RUBY_VERSION.split(&quot;.&quot;).map {|s| s.to_i}</td>
  </tr>
  <tr valign='top'>
    <td>&nbsp;</td>
    <td colspan="2" class="attr-desc">
An array of ints representing the Ruby version number. @api public

</td>
  </tr>
  <tr valign='top'>
    <td class="attr-name">ENCODINGS_TO_CHECK</td>
    <td>=</td>
    <td class="attr-value">%w[UTF-8 UTF-16BE UTF-16LE UTF-32BE UTF-32LE]</td>
  </tr>
  <tr valign='top'>
    <td>&nbsp;</td>
    <td colspan="2" class="attr-desc">
We could automatically add in any non-ASCII-compatible encodings here, but
there&#8217;s not really a good way to do that without manually checking
that each encoding encodes all ASCII characters properly, which takes long
enough to affect the startup time of the CLI.

</td>
  </tr>
  <tr valign='top'>
    <td class="attr-name">CHARSET_REGEXPS</td>
    <td>=</td>
    <td class="attr-value">Hash.new do |h, e|         h[e] =           begin             # /\A(?:\uFEFF)?@charset &quot;(.*?)&quot;|\A(\uFEFF)/             Regexp.new(/\A(?:#{_enc(&quot;\uFEFF&quot;, e)})?#{               _enc('@charset &quot;', e)}(.*?)#{_enc('&quot;', e)}|\A(#{               _enc(&quot;\uFEFF&quot;, e)})/)</td>
  </tr>
  </table>


<div class="sectiontitle">Public Instance methods</div>
<div id="M001129" class="method">
  <div id="M001129_title" class="title">
    <b>_enc</b>(string, encoding)
  </div>
  <div class="description">
  <p>
@private
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001129_source')" id="l_M001129_source">show source</a> ]</p>
  <div id="M001129_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/haml/util.rb, line 501</span>
501:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">_enc</span>(<span class="ruby-identifier">string</span>, <span class="ruby-identifier">encoding</span>)
502:         <span class="ruby-identifier">string</span>.<span class="ruby-identifier">encode</span>(<span class="ruby-identifier">encoding</span>).<span class="ruby-identifier">force_encoding</span>(<span class="ruby-value str">&quot;BINARY&quot;</span>)
503:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001118" class="method">
  <div id="M001118_title" class="title">
    <b>ap_geq?</b>(version)
  </div>
  <div class="description">
  <p>
Returns whether this environment is using ActionPack of a version greater
than or equal to that specified.
</p>
<p>
@param version [String] The string version number to check against.
</p>
<pre>
  Should be greater than or equal to Rails 3,
  because otherwise ActionPack::VERSION isn't autoloaded
</pre>
<p>
@return [Boolean]
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001118_source')" id="l_M001118_source">show source</a> ]</p>
  <div id="M001118_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/haml/util.rb, line 304</span>
304:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ap_geq?</span>(<span class="ruby-identifier">version</span>)
305:       <span class="ruby-comment cmt"># The ActionPack module is always loaded automatically in Rails &gt;= 3</span>
306:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-constant">ActionPack</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-constant">ActionPack</span><span class="ruby-operator">::</span><span class="ruby-constant">VERSION</span>) <span class="ruby-operator">&amp;&amp;</span>
307:         <span class="ruby-keyword kw">defined?</span>(<span class="ruby-constant">ActionPack</span><span class="ruby-operator">::</span><span class="ruby-constant">VERSION</span><span class="ruby-operator">::</span><span class="ruby-constant">STRING</span>)
308: 
309:       <span class="ruby-constant">ActionPack</span><span class="ruby-operator">::</span><span class="ruby-constant">VERSION</span><span class="ruby-operator">::</span><span class="ruby-constant">STRING</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">version</span>
310:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001117" class="method">
  <div id="M001117_title" class="title">
    <b>ap_geq_3?</b>()
  </div>
  <div class="description">
  <p>
Returns whether this environment is using ActionPack version 3.0.0 or
greater.
</p>
<p>
@return [Boolean]
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001117_source')" id="l_M001117_source">show source</a> ]</p>
  <div id="M001117_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/haml/util.rb, line 293</span>
293:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ap_geq_3?</span>
294:       <span class="ruby-identifier">ap_geq?</span>(<span class="ruby-value str">&quot;3.0.0.beta1&quot;</span>)
295:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001122" class="method">
  <div id="M001122_title" class="title">
    <b>assert_html_safe!</b>(text)
  </div>
  <div class="description">
  <p>
Assert that a given object (usually a String) is <a
href="index.html?a=C00000105&name=HTML">HTML</a> safe according to
Rails&#8217; XSS handling, if it&#8217;s loaded.
</p>
<p>
@param text [<a href="index.html?a=C00000008&name=Object">Object</a>]
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001122_source')" id="l_M001122_source">show source</a> ]</p>
  <div id="M001122_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/haml/util.rb, line 352</span>
352:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">assert_html_safe!</span>(<span class="ruby-identifier">text</span>)
353:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">rails_xss_safe?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">text</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">text</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">html_safe?</span>
354:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Haml</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;Expected #{text.inspect} to be HTML-safe.&quot;</span>)
355:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001119" class="method">
  <div id="M001119_title" class="title">
    <b>av_template_class</b>(name)
  </div>
  <div class="description">
  <p>
Returns an ActionView::Template* class. In pre-3.0 versions of Rails, most
of these classes were of the form `ActionView::TemplateFoo`, while
afterwards they were of the form `<a
href="index.html?a=C00000185&name=ActionView">ActionView</a>;:Template::Foo`.
</p>
<p>
@param name [to_s] The name of the class to get.
</p>
<pre>
  For example, `:Error` will return `ActionView::TemplateError`
  or `ActionView::Template::Error`.
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001119_source')" id="l_M001119_source">show source</a> ]</p>
  <div id="M001119_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/haml/util.rb, line 320</span>
320:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">av_template_class</span>(<span class="ruby-identifier">name</span>)
321:       <span class="ruby-keyword kw">return</span> <span class="ruby-constant">ActionView</span>.<span class="ruby-identifier">const_get</span>(<span class="ruby-node">&quot;Template#{name}&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-constant">ActionView</span>.<span class="ruby-identifier">const_defined?</span>(<span class="ruby-node">&quot;Template#{name}&quot;</span>)
322:       <span class="ruby-keyword kw">return</span> <span class="ruby-constant">ActionView</span><span class="ruby-operator">::</span><span class="ruby-constant">Template</span>.<span class="ruby-identifier">const_get</span>(<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>)
323:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001111" class="method">
  <div id="M001111_title" class="title">
    <b>caller_info</b>(entry = caller[1])
  </div>
  <div class="description">
  <p>
Returns information about the caller of the previous method.
</p>
<p>
@param entry [String] An entry in the `caller` list, or a similarly
formatted string @return [[String, Fixnum, (String, nil)]] An array
containing the filename, line, and method name of the caller.
</p>
<pre>
  The method name may be nil
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001111_source')" id="l_M001111_source">show source</a> ]</p>
  <div id="M001111_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/haml/util.rb, line 224</span>
224:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">caller_info</span>(<span class="ruby-identifier">entry</span> = <span class="ruby-identifier">caller</span>[<span class="ruby-value">1</span>])
225:       <span class="ruby-identifier">info</span> = <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/^(.*?):(-?.*?)(?::.*`(.+)')?$/</span>).<span class="ruby-identifier">first</span>
226:       <span class="ruby-identifier">info</span>[<span class="ruby-value">1</span>] = <span class="ruby-identifier">info</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>
227:       <span class="ruby-comment cmt"># This is added by Rubinius to designate a block, but we don't care about it.</span>
228:       <span class="ruby-identifier">info</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp re">/ \{\}\Z/</span>, <span class="ruby-value str">''</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">info</span>[<span class="ruby-value">2</span>]
229:       <span class="ruby-identifier">info</span>
230:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001126" class="method">
  <div id="M001126_title" class="title">
    <b>check_encoding</b>(str) {|&lt;&lt;MSG.rstrip, i + 1| ...}
  </div>
  <div class="description">
  <p>
Checks that the encoding of a string is valid in Ruby 1.9 and cleans up
potential encoding gotchas like the UTF-8 BOM. If it&#8217;s not, yields an
error string describing the invalid character and the line on which it
occurrs.
</p>
<p>
@param str [String] The string of which to check the encoding @yield [msg]
A block in which an encoding error can be raised.
</p>
<pre>
  Only yields if there is an encoding error
</pre>
<p>
@yieldparam msg [String] The error message to be raised @return [String]
`str`, potentially with encoding gotchas like BOMs removed
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001126_source')" id="l_M001126_source">show source</a> ]</p>
  <div id="M001126_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/haml/util.rb, line 396</span>
396:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_encoding</span>(<span class="ruby-identifier">str</span>)
397:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ruby1_8?</span>
398:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/\A\xEF\xBB\xBF/</span>, <span class="ruby-value str">''</span>) <span class="ruby-comment cmt"># Get rid of the UTF-8 BOM</span>
399:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">valid_encoding?</span>
400:         <span class="ruby-comment cmt"># Get rid of the Unicode BOM if possible</span>
401:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">encoding</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^UTF-(8|16|32)(BE|LE)?$/</span>
402:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;\\A\uFEFF&quot;</span>.<span class="ruby-identifier">encode</span>(<span class="ruby-identifier">str</span>.<span class="ruby-identifier">encoding</span>.<span class="ruby-identifier">name</span>)), <span class="ruby-value str">''</span>)
403:         <span class="ruby-keyword kw">else</span>
404:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">str</span>
405:         <span class="ruby-keyword kw">end</span>
406:       <span class="ruby-keyword kw">end</span>
407: 
408:       <span class="ruby-identifier">encoding</span> = <span class="ruby-identifier">str</span>.<span class="ruby-identifier">encoding</span>
409:       <span class="ruby-identifier">newlines</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;\r\n|\r|\n&quot;</span>.<span class="ruby-identifier">encode</span>(<span class="ruby-identifier">encoding</span>).<span class="ruby-identifier">force_encoding</span>(<span class="ruby-value str">&quot;binary&quot;</span>))
410:       <span class="ruby-identifier">str</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-value str">&quot;binary&quot;</span>).<span class="ruby-identifier">split</span>(<span class="ruby-identifier">newlines</span>).<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
411:         <span class="ruby-keyword kw">begin</span>
412:           <span class="ruby-identifier">line</span>.<span class="ruby-identifier">encode</span>(<span class="ruby-identifier">encoding</span>)
413:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Encoding</span><span class="ruby-operator">::</span><span class="ruby-constant">UndefinedConversionError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
414:           <span class="ruby-keyword kw">yield</span> <span class="ruby-operator">&lt;&lt;</span><span class="ruby-constant">MSG</span>.<span class="ruby-identifier">rstrip</span>, <span class="ruby-identifier">i</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
415: <span class="ruby-constant">Invalid</span> <span class="ruby-comment cmt">#{encoding.name} character #{e.error_char.dump}</span>
416: <span class="ruby-constant">MSG</span>
417:         <span class="ruby-keyword kw">end</span>
418:       <span class="ruby-keyword kw">end</span>
419:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">str</span>
420:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001127" class="method">
  <div id="M001127_title" class="title">
    <b>check_haml_encoding</b>(str, &amp;block)
  </div>
  <div class="description">
  <p>
Like {\check_encoding}, but also checks for a Ruby-style `-# coding:`
comment at the beginning of the template and uses that encoding if it
exists.
</p>
<p>
The <a href="index.html?a=C00000111&name=Sass">Sass</a> encoding rules are
simple. If a `-# coding:` comment exists, we assume that that&#8217;s the
original encoding of the document. Otherwise, we use whatever encoding Ruby
has.
</p>
<p>
<a href="index.html?a=C00000072&name=Haml">Haml</a> uses the same rules for
parsing coding comments as Ruby. This means that it can understand
Emacs-style comments (e.g. `-*- encoding: &quot;utf-8&quot; -*-`), and also
that it cannot understand non-ASCII-compatible encodings such as `UTF-16`
and `UTF-32`.
</p>
<p>
@param str [String] The <a href="index.html?a=C00000072&name=Haml">Haml</a>
template of which to check the encoding @yield [msg] A block in which an
encoding error can be raised.
</p>
<pre>
  Only yields if there is an encoding error
</pre>
<p>
@yieldparam msg [String] The error message to be raised @return [String]
The original string encoded properly @raise [ArgumentError] if the document
declares an unknown encoding
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001127_source')" id="l_M001127_source">show source</a> ]</p>
  <div id="M001127_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/haml/util.rb, line 442</span>
442:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_haml_encoding</span>(<span class="ruby-identifier">str</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
443:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">check_encoding</span>(<span class="ruby-identifier">str</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ruby1_8?</span>
444:       <span class="ruby-identifier">str</span> = <span class="ruby-identifier">str</span>.<span class="ruby-identifier">dup</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">frozen?</span>
445: 
446:       <span class="ruby-identifier">bom</span>, <span class="ruby-identifier">encoding</span> = <span class="ruby-identifier">parse_haml_magic_comment</span>(<span class="ruby-identifier">str</span>)
447:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">encoding</span>; <span class="ruby-identifier">str</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-identifier">encoding</span>)
448:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">bom</span>; <span class="ruby-identifier">str</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-value str">&quot;UTF-8&quot;</span>)
449:       <span class="ruby-keyword kw">end</span>
450: 
451:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">check_encoding</span>(<span class="ruby-identifier">str</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
452:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001128" class="method">
  <div id="M001128_title" class="title">
    <b>check_sass_encoding</b>(str, &amp;block)
  </div>
  <div class="description">
  <p>
Like {\check_encoding}, but also checks for a `@charset` declaration at the
beginning of the file and uses that encoding if it exists.
</p>
<p>
The <a href="index.html?a=C00000111&name=Sass">Sass</a> encoding rules are
simple. If a `@charset` declaration exists, we assume that that&#8217;s the
original encoding of the document. Otherwise, we use whatever encoding Ruby
has. Then we convert that to UTF-8 to process internally. The UTF-8 end
result is what&#8217;s returned by this method.
</p>
<p>
@param str [String] The string of which to check the encoding @yield [msg]
A block in which an encoding error can be raised.
</p>
<pre>
  Only yields if there is an encoding error
</pre>
<p>
@yieldparam msg [String] The error message to be raised @return [(String,
Encoding)] The original string encoded as UTF-8,
</p>
<pre>
  and the source encoding of the string (or `nil` under Ruby 1.8)
</pre>
<p>
@raise [Encoding::UndefinedConversionError] if the source encoding
</p>
<pre>
  cannot be converted to UTF-8
</pre>
<p>
@raise [ArgumentError] if the document uses an unknown encoding with
`@charset`
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001128_source')" id="l_M001128_source">show source</a> ]</p>
  <div id="M001128_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/haml/util.rb, line 473</span>
473:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_sass_encoding</span>(<span class="ruby-identifier">str</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
474:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">check_encoding</span>(<span class="ruby-identifier">str</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>), <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ruby1_8?</span>
475:       <span class="ruby-comment cmt"># We allow any printable ASCII characters but double quotes in the charset decl</span>
476:       <span class="ruby-identifier">bin</span> = <span class="ruby-identifier">str</span>.<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-value str">&quot;BINARY&quot;</span>)
477:       <span class="ruby-identifier">encoding</span> = <span class="ruby-constant">Haml</span><span class="ruby-operator">::</span><span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">ENCODINGS_TO_CHECK</span>.<span class="ruby-identifier">find</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">enc</span><span class="ruby-operator">|</span>
478:         <span class="ruby-identifier">bin</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">Haml</span><span class="ruby-operator">::</span><span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">CHARSET_REGEXPS</span>[<span class="ruby-identifier">enc</span>]
479:       <span class="ruby-keyword kw">end</span>
480:       <span class="ruby-identifier">charset</span>, <span class="ruby-identifier">bom</span> = <span class="ruby-identifier">$1</span>, <span class="ruby-identifier">$2</span>
481:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">charset</span>
482:         <span class="ruby-identifier">charset</span> = <span class="ruby-identifier">charset</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-identifier">encoding</span>).<span class="ruby-identifier">encode</span>(<span class="ruby-value str">&quot;UTF-8&quot;</span>)
483:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">endianness</span> = <span class="ruby-identifier">encoding</span>[<span class="ruby-regexp re">/[BL]E$/</span>]
484:           <span class="ruby-keyword kw">begin</span>
485:             <span class="ruby-constant">Encoding</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">charset</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">endianness</span>)
486:             <span class="ruby-identifier">charset</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">endianness</span>
487:           <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">ArgumentError</span> <span class="ruby-comment cmt"># Encoding charset + endianness doesn't exist</span>
488:           <span class="ruby-keyword kw">end</span>
489:         <span class="ruby-keyword kw">end</span>
490:         <span class="ruby-identifier">str</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-identifier">charset</span>)
491:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">bom</span>
492:         <span class="ruby-identifier">str</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-identifier">encoding</span>)
493:       <span class="ruby-keyword kw">end</span>
494: 
495:       <span class="ruby-identifier">str</span> = <span class="ruby-identifier">check_encoding</span>(<span class="ruby-identifier">str</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
496:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">encode</span>(<span class="ruby-value str">&quot;UTF-8&quot;</span>), <span class="ruby-identifier">str</span>.<span class="ruby-identifier">encoding</span>
497:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001114" class="method">
  <div id="M001114_title" class="title">
    <b>haml_warn</b>(msg)
  </div>
  <div class="description">
  <p>
The same as `Kernel#warn`, but is silenced by \{silence_haml_warnings}.
</p>
<p>
@param msg [String]
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001114_source')" id="l_M001114_source">show source</a> ]</p>
  <div id="M001114_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/haml/util.rb, line 257</span>
257:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">haml_warn</span>(<span class="ruby-identifier">msg</span>)
258:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@@silence_warnings</span>
259:       <span class="ruby-identifier">warn</span>(<span class="ruby-identifier">msg</span>)
260:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001121" class="method">
  <div id="M001121_title" class="title">
    <b>html_safe</b>(text)
  </div>
  <div class="description">
  <p>
Returns the given text, marked as being <a
href="index.html?a=C00000105&name=HTML">HTML</a>-safe. With older versions
of the Rails XSS-safety mechanism, this destructively modifies the <a
href="index.html?a=C00000105&name=HTML">HTML</a>-safety of `text`.
</p>
<p>
@param text [String, nil] @return [String, nil] `text`, marked as <a
href="index.html?a=C00000105&name=HTML">HTML</a>-safe
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001121_source')" id="l_M001121_source">show source</a> ]</p>
  <div id="M001121_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/haml/util.rb, line 342</span>
342:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">html_safe</span>(<span class="ruby-identifier">text</span>)
343:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">text</span>
344:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">html_safe</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">SafeBuffer</span>)
345:       <span class="ruby-identifier">text</span>.<span class="ruby-identifier">html_safe!</span>
346:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001106" class="method">
  <div id="M001106_title" class="title">
    <b>intersperse</b>(enum, val)
  </div>
  <div class="description">
  <p>
Intersperses a value in an enumerable, as would be done with `Array#join`
but without concatenating the array together afterwards.
</p>
<p>
@param enum [Enumerable] @param val @return [Array]
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001106_source')" id="l_M001106_source">show source</a> ]</p>
  <div id="M001106_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/haml/util.rb, line 151</span>
151:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">intersperse</span>(<span class="ruby-identifier">enum</span>, <span class="ruby-identifier">val</span>)
152:       <span class="ruby-identifier">enum</span>.<span class="ruby-identifier">inject</span>([]) {<span class="ruby-operator">|</span><span class="ruby-identifier">a</span>, <span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">e</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">val</span>}[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-value">-1</span>]
153:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001110" class="method">
  <div id="M001110_title" class="title">
    <b>lcs</b>(x, y, &amp;block)
  </div>
  <div class="description">
  <p>
Computes a single longest common subsequence for `x` and `y`. If there are
more than one longest common subsequences, the one returned is that which
starts first in `x`.
</p>
<p>
@param x [Array] @param y [Array] @yield [a, b] An optional block to use in
place of a check for equality
</p>
<pre>
  between elements of `x` and `y`.
</pre>
<p>
@yieldreturn [<a href="index.html?a=C00000008&name=Object">Object</a>, nil]
If the two values register as equal,
</p>
<pre>
  this will return the value to use in the LCS array.
</pre>
<p>
@return [Array] The LCS
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001110_source')" id="l_M001110_source">show source</a> ]</p>
  <div id="M001110_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/haml/util.rb, line 212</span>
212:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">lcs</span>(<span class="ruby-identifier">x</span>, <span class="ruby-identifier">y</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
213:       <span class="ruby-identifier">x</span> = [<span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">x</span>]
214:       <span class="ruby-identifier">y</span> = [<span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">y</span>]
215:       <span class="ruby-identifier">block</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">proc</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">b</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">a</span>}
216:       <span class="ruby-identifier">lcs_backtrace</span>(<span class="ruby-identifier">lcs_table</span>(<span class="ruby-identifier">x</span>, <span class="ruby-identifier">y</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>), <span class="ruby-identifier">x</span>, <span class="ruby-identifier">y</span>, <span class="ruby-identifier">x</span>.<span class="ruby-identifier">size</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>, <span class="ruby-identifier">y</span>.<span class="ruby-identifier">size</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
217:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001102" class="method">
  <div id="M001102_title" class="title">
    <b>map_hash</b>(hash, &amp;block)
  </div>
  <div class="description">
  <p>
Maps the key-value pairs of a hash according to a block. For example:
</p>
<pre>
    map_hash({:foo =&gt; &quot;bar&quot;, :baz =&gt; &quot;bang&quot;}) {|k, v| [k.to_s, v.to_sym]}
      #=&gt; {&quot;foo&quot; =&gt; :bar, &quot;baz&quot; =&gt; :bang}
</pre>
<p>
@param hash [Hash] The hash to map @yield [key, value] A block in which the
key-value pairs are transformed @yieldparam [key] The hash key @yieldparam
[value] The hash value @yieldreturn [(<a
href="index.html?a=C00000008&name=Object">Object</a>, <a
href="index.html?a=C00000008&name=Object">Object</a>)] The new value for
the `[key, value]` pair @return [Hash] The mapped hash @see <a
href="index.html?a=M001100&name=map_keys">map_keys</a> @see <a
href="index.html?a=M001101&name=map_vals">map_vals</a>
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001102_source')" id="l_M001102_source">show source</a> ]</p>
  <div id="M001102_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File lib/haml/util.rb, line 86</span>
86:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">map_hash</span>(<span class="ruby-identifier">hash</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
87:       <span class="ruby-identifier">to_hash</span>(<span class="ruby-identifier">hash</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>))
88:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001100" class="method">
  <div id="M001100_title" class="title">
    <b>map_keys</b>(hash) {|k| ...}
  </div>
  <div class="description">
  <p>
Maps the keys in a hash according to a block. For example:
</p>
<pre>
    map_keys({:foo =&gt; &quot;bar&quot;, :baz =&gt; &quot;bang&quot;}) {|k| k.to_s}
      #=&gt; {&quot;foo&quot; =&gt; &quot;bar&quot;, &quot;baz&quot; =&gt; &quot;bang&quot;}
</pre>
<p>
@param hash [Hash] The hash to map @yield [key] A block in which the keys
are transformed @yieldparam key [<a
href="index.html?a=C00000008&name=Object">Object</a>] The key that should
be mapped @yieldreturn [<a
href="index.html?a=C00000008&name=Object">Object</a>] The new value for the
key @return [Hash] The mapped hash @see <a
href="index.html?a=M001101&name=map_vals">map_vals</a> @see <a
href="index.html?a=M001102&name=map_hash">map_hash</a>
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001100_source')" id="l_M001100_source">show source</a> ]</p>
  <div id="M001100_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File lib/haml/util.rb, line 51</span>
51:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">map_keys</span>(<span class="ruby-identifier">hash</span>)
52:       <span class="ruby-identifier">to_hash</span>(<span class="ruby-identifier">hash</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> [<span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">k</span>), <span class="ruby-identifier">v</span>]})
53:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001101" class="method">
  <div id="M001101_title" class="title">
    <b>map_vals</b>(hash) {|v| ...}
  </div>
  <div class="description">
  <p>
Maps the values in a hash according to a block. For example:
</p>
<pre>
    map_values({:foo =&gt; &quot;bar&quot;, :baz =&gt; &quot;bang&quot;}) {|v| v.to_sym}
      #=&gt; {:foo =&gt; :bar, :baz =&gt; :bang}
</pre>
<p>
@param hash [Hash] The hash to map @yield [value] A block in which the
values are transformed @yieldparam value [<a
href="index.html?a=C00000008&name=Object">Object</a>] The value that should
be mapped @yieldreturn [<a
href="index.html?a=C00000008&name=Object">Object</a>] The new value for the
value @return [Hash] The mapped hash @see <a
href="index.html?a=M001100&name=map_keys">map_keys</a> @see <a
href="index.html?a=M001102&name=map_hash">map_hash</a>
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001101_source')" id="l_M001101_source">show source</a> ]</p>
  <div id="M001101_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File lib/haml/util.rb, line 68</span>
68:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">map_vals</span>(<span class="ruby-identifier">hash</span>)
69:       <span class="ruby-identifier">to_hash</span>(<span class="ruby-identifier">hash</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">k</span>, <span class="ruby-keyword kw">yield</span>(<span class="ruby-identifier">v</span>)]})
70:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001105" class="method">
  <div id="M001105_title" class="title">
    <b>merge_adjacent_strings</b>(enum)
  </div>
  <div class="description">
  <p>
Concatenates all strings that are adjacent in an array, while leaving other
elements as they are. For example:
</p>
<pre>
    merge_adjacent_strings([1, &quot;foo&quot;, &quot;bar&quot;, 2, &quot;baz&quot;])
      #=&gt; [1, &quot;foobar&quot;, 2, &quot;baz&quot;]
</pre>
<p>
@param enum [Enumerable] @return [Array] The enumerable with strings merged
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001105_source')" id="l_M001105_source">show source</a> ]</p>
  <div id="M001105_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/haml/util.rb, line 130</span>
130:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">merge_adjacent_strings</span>(<span class="ruby-identifier">enum</span>)
131:       <span class="ruby-identifier">enum</span>.<span class="ruby-identifier">inject</span>([]) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>, <span class="ruby-identifier">e</span><span class="ruby-operator">|</span>
132:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
133:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
134:             <span class="ruby-identifier">a</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">e</span>
135:           <span class="ruby-keyword kw">else</span>
136:             <span class="ruby-identifier">a</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">dup</span>
137:           <span class="ruby-keyword kw">end</span>
138:         <span class="ruby-keyword kw">else</span>
139:           <span class="ruby-identifier">a</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">e</span>
140:         <span class="ruby-keyword kw">end</span>
141:         <span class="ruby-identifier">a</span>
142:       <span class="ruby-keyword kw">end</span>
143:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001109" class="method">
  <div id="M001109_title" class="title">
    <b>paths</b>(arrs)
  </div>
  <div class="description">
  <p>
Return an array of all possible paths through the given arrays.
</p>
<p>
@param arrs [Array&lt;Array&gt;] @return [Array&lt;Arrays&gt;]
</p>
<p>
@example paths([[1, 2], [3, 4], [5]]) #=&gt;
</p>
<pre>
  # [[1, 3, 5],
  #  [2, 3, 5],
  #  [1, 4, 5],
  #  [2, 4, 5]]
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001109_source')" id="l_M001109_source">show source</a> ]</p>
  <div id="M001109_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/haml/util.rb, line 195</span>
195:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">paths</span>(<span class="ruby-identifier">arrs</span>)
196:       <span class="ruby-identifier">arrs</span>.<span class="ruby-identifier">inject</span>([[]]) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">paths</span>, <span class="ruby-identifier">arr</span><span class="ruby-operator">|</span>
197:         <span class="ruby-identifier">flatten</span>(<span class="ruby-identifier">arr</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">paths</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span> <span class="ruby-identifier">path</span> <span class="ruby-operator">+</span> [<span class="ruby-identifier">e</span>]}}, <span class="ruby-value">1</span>)
198:       <span class="ruby-keyword kw">end</span>
199:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001103" class="method">
  <div id="M001103_title" class="title">
    <b>powerset</b>(arr)
  </div>
  <div class="description">
  <p>
Computes the powerset of the given array. This is the set of all subsets of
the array. For example:
</p>
<pre>
    powerset([1, 2, 3]) #=&gt;
      Set[Set[], Set[1], Set[2], Set[3], Set[1, 2], Set[2, 3], Set[1, 3], Set[1, 2, 3]]
</pre>
<p>
@param arr [Enumerable] @return [Set&lt;Set&gt;] The subsets of `arr`
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001103_source')" id="l_M001103_source">show source</a> ]</p>
  <div id="M001103_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/haml/util.rb, line 99</span>
 99:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">powerset</span>(<span class="ruby-identifier">arr</span>)
100:       <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">inject</span>([<span class="ruby-constant">Set</span>.<span class="ruby-identifier">new</span>].<span class="ruby-identifier">to_set</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">powerset</span>, <span class="ruby-identifier">el</span><span class="ruby-operator">|</span>
101:         <span class="ruby-identifier">new_powerset</span> = <span class="ruby-constant">Set</span>.<span class="ruby-identifier">new</span>
102:         <span class="ruby-identifier">powerset</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">subset</span><span class="ruby-operator">|</span>
103:           <span class="ruby-identifier">new_powerset</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">subset</span>
104:           <span class="ruby-identifier">new_powerset</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">subset</span> <span class="ruby-operator">+</span> [<span class="ruby-identifier">el</span>]
105:         <span class="ruby-keyword kw">end</span>
106:         <span class="ruby-identifier">new_powerset</span>
107:       <span class="ruby-keyword kw">end</span>
108:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001116" class="method">
  <div id="M001116_title" class="title">
    <b>rails_env</b>()
  </div>
  <div class="description">
  <p>
Returns the environment of the Rails application, if this is running in a
Rails context. Returns `nil` if no such environment is defined.
</p>
<p>
@return [String, nil]
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001116_source')" id="l_M001116_source">show source</a> ]</p>
  <div id="M001116_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/haml/util.rb, line 283</span>
283:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rails_env</span>
284:       <span class="ruby-keyword kw">return</span> <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">env</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>)
285:       <span class="ruby-keyword kw">return</span> <span class="ruby-constant">RAILS_ENV</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-constant">RAILS_ENV</span>)
286:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
287:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001115" class="method">
  <div id="M001115_title" class="title">
    <b>rails_root</b>()
  </div>
  <div class="description">
  <p>
Returns the root of the Rails application, if this is running in a Rails
context. Returns `nil` if no such root is defined.
</p>
<p>
@return [String, nil]
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001115_source')" id="l_M001115_source">show source</a> ]</p>
  <div id="M001115_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/haml/util.rb, line 269</span>
269:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rails_root</span>
270:       <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>)
271:         <span class="ruby-keyword kw">return</span> <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span>
272:         <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;ERROR: Rails.root is nil!&quot;</span>
273:       <span class="ruby-keyword kw">end</span>
274:       <span class="ruby-keyword kw">return</span> <span class="ruby-constant">RAILS_ROOT</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-constant">RAILS_ROOT</span>)
275:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
276:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001123" class="method">
  <div id="M001123_title" class="title">
    <b>rails_safe_buffer_class</b>()
  </div>
  <div class="description">
  <p>
The class for the Rails SafeBuffer XSS protection class. This varies
depending on Rails version.
</p>
<p>
@return [Class]
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001123_source')" id="l_M001123_source">show source</a> ]</p>
  <div id="M001123_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/haml/util.rb, line 361</span>
361:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rails_safe_buffer_class</span>
362:       <span class="ruby-comment cmt"># It's important that we check ActiveSupport first,</span>
363:       <span class="ruby-comment cmt"># because in Rails 2.3.6 ActionView::SafeBuffer exists</span>
364:       <span class="ruby-comment cmt"># but is a deprecated proxy object.</span>
365:       <span class="ruby-keyword kw">return</span> <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">SafeBuffer</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">SafeBuffer</span>)
366:       <span class="ruby-keyword kw">return</span> <span class="ruby-constant">ActionView</span><span class="ruby-operator">::</span><span class="ruby-constant">SafeBuffer</span>
367:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001120" class="method">
  <div id="M001120_title" class="title">
    <b>rails_xss_safe?</b>()
  </div>
  <div class="description">
  <p>
Whether or not <a
href="index.html?a=C00000185&name=ActionView">ActionView</a>&#8217;s XSS
protection is available and enabled, as is the default for Rails 3.0+, and
optional for version 2.3.5+. Overridden in haml/template.rb if this is the
case.
</p>
<p>
@return [Boolean]
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001120_source')" id="l_M001120_source">show source</a> ]</p>
  <div id="M001120_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/haml/util.rb, line 332</span>
332:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rails_xss_safe?</span>
333:       <span class="ruby-keyword kw">false</span>
334:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001104" class="method">
  <div id="M001104_title" class="title">
    <b>restrict</b>(value, range)
  </div>
  <div class="description">
  <p>
Restricts a number to falling within a given range. Returns the number if
it falls within the range, or the closest value in the range if it
doesn&#8217;t.
</p>
<p>
@param value [Numeric] @param range [Range&lt;Numeric&gt;] @return
[Numeric]
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001104_source')" id="l_M001104_source">show source</a> ]</p>
  <div id="M001104_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/haml/util.rb, line 117</span>
117:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">restrict</span>(<span class="ruby-identifier">value</span>, <span class="ruby-identifier">range</span>)
118:       [[<span class="ruby-identifier">value</span>, <span class="ruby-identifier">range</span>.<span class="ruby-identifier">first</span>].<span class="ruby-identifier">max</span>, <span class="ruby-identifier">range</span>.<span class="ruby-identifier">last</span>].<span class="ruby-identifier">min</span>
119:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001124" class="method">
  <div id="M001124_title" class="title">
    <b>ruby1_8?</b>()
  </div>
  <div class="description">
  <p>
Whether or not this is running under Ruby 1.8 or lower.
</p>
<p>
@return [Boolean]
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001124_source')" id="l_M001124_source">show source</a> ]</p>
  <div id="M001124_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/haml/util.rb, line 374</span>
374:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ruby1_8?</span>
375:       <span class="ruby-constant">Haml</span><span class="ruby-operator">::</span><span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">RUBY_VERSION</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">Haml</span><span class="ruby-operator">::</span><span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">RUBY_VERSION</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">&lt;</span> <span class="ruby-value">9</span>
376:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001125" class="method">
  <div id="M001125_title" class="title">
    <b>ruby1_8_6?</b>()
  </div>
  <div class="description">
  <p>
Whether or not this is running under Ruby 1.8.6 or lower. Note that lower
versions are not officially supported.
</p>
<p>
@return [Boolean]
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001125_source')" id="l_M001125_source">show source</a> ]</p>
  <div id="M001125_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/haml/util.rb, line 382</span>
382:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ruby1_8_6?</span>
383:       <span class="ruby-identifier">ruby1_8?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">Haml</span><span class="ruby-operator">::</span><span class="ruby-constant">Util</span><span class="ruby-operator">::</span><span class="ruby-constant">RUBY_VERSION</span>[<span class="ruby-value">2</span>] <span class="ruby-operator">&lt;</span> <span class="ruby-value">7</span>
384:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001098" class="method">
  <div id="M001098_title" class="title">
    <b>scope</b>(file)
  </div>
  <div class="description">
  <p>
Returns the path of a file relative to the <a
href="index.html?a=C00000072&name=Haml">Haml</a> root directory.
</p>
<p>
@param file [String] The filename relative to the <a
href="index.html?a=C00000072&name=Haml">Haml</a> root @return [String] The
filename relative to the the working directory
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001098_source')" id="l_M001098_source">show source</a> ]</p>
  <div id="M001098_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File lib/haml/util.rb, line 22</span>
22:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">scope</span>(<span class="ruby-identifier">file</span>)
23:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">Haml</span><span class="ruby-operator">::</span><span class="ruby-constant">ROOT_DIR</span>, <span class="ruby-identifier">file</span>)
24:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001113" class="method">
  <div id="M001113_title" class="title">
    <b>silence_haml_warnings</b>() {|| ...}
  </div>
  <div class="description">
  <p>
Silences all <a href="index.html?a=C00000072&name=Haml">Haml</a> warnings
within a block.
</p>
<p>
@yield A block in which no <a
href="index.html?a=C00000072&name=Haml">Haml</a> warnings will be printed
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001113_source')" id="l_M001113_source">show source</a> ]</p>
  <div id="M001113_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/haml/util.rb, line 246</span>
246:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">silence_haml_warnings</span>
247:       <span class="ruby-identifier">old_silence_warnings</span> = <span class="ruby-ivar">@@silence_warnings</span>
248:       <span class="ruby-ivar">@@silence_warnings</span> = <span class="ruby-keyword kw">true</span>
249:       <span class="ruby-keyword kw">yield</span>
250:     <span class="ruby-keyword kw">ensure</span>
251:       <span class="ruby-ivar">@@silence_warnings</span> = <span class="ruby-identifier">old_silence_warnings</span>
252:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001112" class="method">
  <div id="M001112_title" class="title">
    <b>silence_warnings</b>() {|| ...}
  </div>
  <div class="description">
  <p>
Silence all output to STDERR within a block.
</p>
<p>
@yield A block in which no output will be printed to STDERR
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001112_source')" id="l_M001112_source">show source</a> ]</p>
  <div id="M001112_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/haml/util.rb, line 235</span>
235:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">silence_warnings</span>
236:       <span class="ruby-identifier">the_real_stderr</span>, <span class="ruby-identifier">$stderr</span> = <span class="ruby-identifier">$stderr</span>, <span class="ruby-constant">StringIO</span>.<span class="ruby-identifier">new</span>
237:       <span class="ruby-keyword kw">yield</span>
238:     <span class="ruby-keyword kw">ensure</span>
239:       <span class="ruby-identifier">$stderr</span> = <span class="ruby-identifier">the_real_stderr</span>
240:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001108" class="method">
  <div id="M001108_title" class="title">
    <b>strip_string_array</b>(arr)
  </div>
  <div class="description">
  <p>
Destructively strips whitespace from the beginning and end of the first and
last elements, respectively, in the array (if those elements are strings).
</p>
<p>
@param arr [Array] @return [Array] `arr`
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001108_source')" id="l_M001108_source">show source</a> ]</p>
  <div id="M001108_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/haml/util.rb, line 178</span>
178:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">strip_string_array</span>(<span class="ruby-identifier">arr</span>)
179:       <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">lstrip!</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
180:       <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">rstrip!</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
181:       <span class="ruby-identifier">arr</span>
182:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001107" class="method">
  <div id="M001107_title" class="title">
    <b>substitute</b>(ary, from, to)
  </div>
  <div class="description">
  <p>
Substitutes a sub-array of one array with another sub-array.
</p>
<p>
@param ary [Array] The array in which to make the substitution @param from
[Array] The sequence of elements to replace with `to` @param to [Array] The
sequence of elements to replace `from` with
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001107_source')" id="l_M001107_source">show source</a> ]</p>
  <div id="M001107_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/haml/util.rb, line 160</span>
160:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">substitute</span>(<span class="ruby-identifier">ary</span>, <span class="ruby-identifier">from</span>, <span class="ruby-identifier">to</span>)
161:       <span class="ruby-identifier">res</span> = <span class="ruby-identifier">ary</span>.<span class="ruby-identifier">dup</span>
162:       <span class="ruby-identifier">i</span> = <span class="ruby-value">0</span>
163:       <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">size</span>
164:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">res</span>[<span class="ruby-identifier">i</span><span class="ruby-operator">...</span><span class="ruby-identifier">i</span><span class="ruby-operator">+</span><span class="ruby-identifier">from</span>.<span class="ruby-identifier">size</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">from</span>
165:           <span class="ruby-identifier">res</span>[<span class="ruby-identifier">i</span><span class="ruby-operator">...</span><span class="ruby-identifier">i</span><span class="ruby-operator">+</span><span class="ruby-identifier">from</span>.<span class="ruby-identifier">size</span>] = <span class="ruby-identifier">to</span>
166:         <span class="ruby-keyword kw">end</span>
167:         <span class="ruby-identifier">i</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
168:       <span class="ruby-keyword kw">end</span>
169:       <span class="ruby-identifier">res</span>
170:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M001099" class="method">
  <div id="M001099_title" class="title">
    <b>to_hash</b>(arr)
  </div>
  <div class="description">
  <p>
Converts an array of `[key, value]` pairs to a hash. For example:
</p>
<pre>
    to_hash([[:foo, &quot;bar&quot;], [:baz, &quot;bang&quot;]])
      #=&gt; {:foo =&gt; &quot;bar&quot;, :baz =&gt; &quot;bang&quot;}
</pre>
<p>
@param arr [Array&lt;(<a
href="index.html?a=C00000008&name=Object">Object</a>, <a
href="index.html?a=C00000008&name=Object">Object</a>)&gt;] An array of
pairs @return [Hash] A hash
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M001099_source')" id="l_M001099_source">show source</a> ]</p>
  <div id="M001099_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File lib/haml/util.rb, line 34</span>
34:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_hash</span>(<span class="ruby-identifier">arr</span>)
35:       <span class="ruby-identifier">arr</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">inject</span>({}) {<span class="ruby-operator">|</span><span class="ruby-identifier">h</span>, (<span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span>)<span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span>; <span class="ruby-identifier">h</span>}
36:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>