  <div id="C00000047">
<div class='banner'>
  <span class="file-title-prefix">Module</span><br />Plugin<br/>
  In:
<a href="#" onclick="jsHref('files/lib/sass/plugin_rb.html');">lib/sass/plugin.rb</a>
<a href="#" onclick="jsHref('files/test/sass/plugin_test_rb.html');">test/sass/plugin_test.rb</a>

</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">

  <div class="description"><p>
This module contains methods to aid in using <a
href="index.html?a=C00000039&name=Sass">Sass</a> as a stylesheet-rendering
plugin for various systems. Currently Rails/<a
href="index.html?a=C00000014&name=ActionController">ActionController</a>
and <a href="index.html?a=C00000061&name=Merb">Merb</a> are supported out
of the box.
</p>
</div>



  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M000269&name=checked_for_updates" >checked_for_updates</a></li>
  <li><a href="index.html?a=M000272&name=engine_options" >engine_options</a></li>
  <li><a href="index.html?a=M000270&name=options" >options</a></li>
  <li><a href="index.html?a=M000271&name=options=" >options=</a></li>
  <li><a href="index.html?a=M000274&name=stylesheet_needs_update?" >stylesheet_needs_update?</a></li>
  <li><a href="index.html?a=M000273&name=update_stylesheets" >update_stylesheets</a></li>
  </ul>






<div class="sectiontitle">Public Class methods</div>
<div id="M000269" class="method">
  <div id="M000269_title" class="title">
    <b>checked_for_updates</b>()
  </div>
  <div class="description">
  <p>
Whether or not <a href="index.html?a=C00000039&name=Sass">Sass</a> has
<b>ever</b> checked if the stylesheets need updates (in this Ruby
instance).
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000269_source')" id="l_M000269_source">show source</a> ]</p>
  <div id="M000269_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File lib/sass/plugin.rb, line 20</span>
20:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">checked_for_updates</span>
21:         <span class="ruby-ivar">@@checked_for_updates</span>
22:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000272" class="method">
  <div id="M000272_title" class="title">
    <b>engine_options</b>(additional_options = {})
  </div>
  <div class="description">
  <p>
Get the options ready to be passed to the <a
href="index.html?a=C00000055&name=Sass::Engine">Sass::Engine</a>
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000272_source')" id="l_M000272_source">show source</a> ]</p>
  <div id="M000272_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File lib/sass/plugin.rb, line 38</span>
38:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">engine_options</span>(<span class="ruby-identifier">additional_options</span> = {})
39:         <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">additional_options</span>)
40:         <span class="ruby-identifier">opts</span>[<span class="ruby-identifier">:load_paths</span>] = <span class="ruby-identifier">load_paths</span>(<span class="ruby-identifier">opts</span>)
41:         <span class="ruby-identifier">opts</span>
42:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000270" class="method">
  <div id="M000270_title" class="title">
    <b>options</b>()
  </div>
  <div class="description">
  <p>
Gets various options for <a
href="index.html?a=C00000039&name=Sass">Sass</a>. See README.rdoc for
details.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000270_source')" id="l_M000270_source">show source</a> ]</p>
  <div id="M000270_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File lib/sass/plugin.rb, line 28</span>
28:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">options</span>
29:         <span class="ruby-ivar">@@options</span>
30:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000271" class="method">
  <div id="M000271_title" class="title">
    <b>options=</b>(value)
  </div>
  <div class="description">
  <p>
Sets various options for <a
href="index.html?a=C00000039&name=Sass">Sass</a>.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000271_source')" id="l_M000271_source">show source</a> ]</p>
  <div id="M000271_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File lib/sass/plugin.rb, line 33</span>
33:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">options=</span>(<span class="ruby-identifier">value</span>)
34:         <span class="ruby-ivar">@@options</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">value</span>)
35:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000274" class="method">
  <div id="M000274_title" class="title">
    <b>stylesheet_needs_update?</b>(name)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000274_source')" id="l_M000274_source">show source</a> ]</p>
  <div id="M000274_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/sass/plugin.rb, line 141</span>
141:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">stylesheet_needs_update?</span>(<span class="ruby-identifier">name</span>)
142:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">css_filename</span>(<span class="ruby-identifier">name</span>))
143:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
144:         <span class="ruby-keyword kw">else</span>
145:           <span class="ruby-identifier">css_mtime</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">mtime</span>(<span class="ruby-identifier">css_filename</span>(<span class="ruby-identifier">name</span>))
146:           <span class="ruby-constant">File</span>.<span class="ruby-identifier">mtime</span>(<span class="ruby-identifier">template_filename</span>(<span class="ruby-identifier">name</span>)) <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">css_mtime</span> <span class="ruby-operator">||</span>
147:             <span class="ruby-identifier">dependencies</span>(<span class="ruby-identifier">template_filename</span>(<span class="ruby-identifier">name</span>)).<span class="ruby-identifier">any?</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">dependency_updated?</span>(<span class="ruby-identifier">css_mtime</span>))
148:         <span class="ruby-keyword kw">end</span>
149:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000273" class="method">
  <div id="M000273_title" class="title">
    <b>update_stylesheets</b>()
  </div>
  <div class="description">
  <p>
Checks each stylesheet in <tt>options[:css_location]</tt> to see if it
needs updating, and updates it using the corresponding template from
<tt>options[:templates]</tt> if it does.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000273_source')" id="l_M000273_source">show source</a> ]</p>
  <div id="M000273_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File lib/sass/plugin.rb, line 49</span>
49:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_stylesheets</span>
50:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:never_update</span>]
51: 
52:         <span class="ruby-ivar">@@checked_for_updates</span> = <span class="ruby-keyword kw">true</span>
53:         <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:template_location</span>], <span class="ruby-value str">&quot;**&quot;</span>, <span class="ruby-value str">&quot;*.sass&quot;</span>)).<span class="ruby-identifier">entries</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
54: 
55:           <span class="ruby-comment cmt"># Get the relative path to the file with no extension</span>
56:           <span class="ruby-identifier">name</span> = <span class="ruby-identifier">file</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:template_location</span>] <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;/&quot;</span>, <span class="ruby-value str">&quot;&quot;</span>)[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-value">-5</span>]
57: 
58:           <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">forbid_update?</span>(<span class="ruby-identifier">name</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:always_update</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">stylesheet_needs_update?</span>(<span class="ruby-identifier">name</span>))
59:             <span class="ruby-identifier">css</span> = <span class="ruby-identifier">css_filename</span>(<span class="ruby-identifier">name</span>)
60:             <span class="ruby-constant">File</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">css</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">css</span>)
61: 
62:             <span class="ruby-identifier">filename</span> = <span class="ruby-identifier">template_filename</span>(<span class="ruby-identifier">name</span>)
63:             <span class="ruby-identifier">engine</span> = <span class="ruby-constant">Engine</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">filename</span>), <span class="ruby-identifier">engine_options</span>(<span class="ruby-identifier">:filename</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">filename</span>))
64:             <span class="ruby-identifier">result</span> = <span class="ruby-keyword kw">begin</span>
65:                        <span class="ruby-identifier">engine</span>.<span class="ruby-identifier">render</span>
66:                      <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
67:                        <span class="ruby-identifier">exception_string</span>(<span class="ruby-identifier">e</span>)
68:                      <span class="ruby-keyword kw">end</span>
69: 
70:             <span class="ruby-comment cmt"># Create any directories that might be necessary</span>
71:             <span class="ruby-identifier">dirs</span> = [<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:css_location</span>]]
72:             <span class="ruby-identifier">name</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;/&quot;</span>)[<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">dir</span><span class="ruby-operator">|</span> <span class="ruby-identifier">dirs</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{dirs[-1]}/#{dir}&quot;</span> }
73:             <span class="ruby-identifier">dirs</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">dir</span><span class="ruby-operator">|</span> <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">mkdir</span>(<span class="ruby-identifier">dir</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">dir</span>) }
74: 
75:             <span class="ruby-comment cmt"># Finally, write the file</span>
76:             <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">css</span>, <span class="ruby-value str">'w'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
77:               <span class="ruby-identifier">file</span>.<span class="ruby-identifier">print</span>(<span class="ruby-identifier">result</span>)
78:             <span class="ruby-keyword kw">end</span>
79:           <span class="ruby-keyword kw">end</span>
80:         <span class="ruby-keyword kw">end</span>
81:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>